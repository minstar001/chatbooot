/*! For license information please see converse-headless.min.js.LICENSE.txt */
(()=>{var e,t,n,r,i={9494:(e,t,n)=>{"use strict";const r=n(7672),i=n(4817);e.exports={atob:r,btoa:i}},7672:e=>{"use strict";function t(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}e.exports=function(e){if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let n="",r=0,i=0;for(let s=0;s<e.length;s++)r<<=6,r|=t(e[s]),i+=6,24===i&&(n+=String.fromCharCode((16711680&r)>>16),n+=String.fromCharCode((65280&r)>>8),n+=String.fromCharCode(255&r),r=i=0);return 12===i?(r>>=4,n+=String.fromCharCode(r)):18===i&&(r>>=2,n+=String.fromCharCode((65280&r)>>8),n+=String.fromCharCode(255&r)),n}},4817:e=>{"use strict";function t(e){if(e>=0&&e<64)return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]}e.exports=function(e){let n;for(e=`${e}`,n=0;n<e.length;n++)if(e.charCodeAt(n)>255)return null;let r="";for(n=0;n<e.length;n+=3){const i=[void 0,void 0,void 0,void 0];i[0]=e.charCodeAt(n)>>2,i[1]=(3&e.charCodeAt(n))<<4,e.length>n+1&&(i[1]|=e.charCodeAt(n+1)>>4,i[2]=(15&e.charCodeAt(n+1))<<2),e.length>n+2&&(i[2]|=e.charCodeAt(n+2)>>6,i[3]=63&e.charCodeAt(n+2));for(let e=0;e<i.length;e++)void 0===i[e]?r+="=":r+=t(i[e])}return r}},4223:(e,t,n)=>{var r;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function s(e){return a(u(e),arguments)}function o(e,t){return s.apply(null,[e].concat(t||[]))}function a(e,t){var n,r,o,a,c,u,d,l,h,f=1,p=e.length,g="";for(r=0;r<p;r++)if("string"==typeof e[r])g+=e[r];else if("object"==typeof e[r]){if((a=e[r]).keys)for(n=t[f],o=0;o<a.keys.length;o++){if(null==n)throw new Error(s('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?t[a.param_no]:t[f++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(s("[sprintf] expecting number but found %T",n));switch(i.number.test(a.type)&&(l=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?g+=n:(!i.number.test(a.type)||l&&!a.sign?h="":(h=l?"+":"-",n=n.toString().replace(i.sign,"")),u=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",d=a.width-(h+n).length,c=a.width&&d>0?u.repeat(d):"",g+=a.align?h+n+c:"0"===u?h+c+n:c+h+n)}return g}var c=Object.create(null);function u(e){if(c[e])return c[e];for(var t,n=e,r=[],s=0;n;){if(null!==(t=i.text.exec(n)))r.push(t[0]);else if(null!==(t=i.modulo.exec(n)))r.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){s|=1;var o=[],a=t[2],u=[];if(null===(u=i.key.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(u[1]);""!==(a=a.substring(u[0].length));)if(null!==(u=i.key_access.exec(a)))o.push(u[1]);else{if(null===(u=i.index_access.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(u[1])}t[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return c[e]=r}t.sprintf=s,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=s,window.vsprintf=o,void 0===(r=function(){return{sprintf:s,vsprintf:o}}.call(t,n,t,e))||(e.exports=r))}()},8677:function(e,t,n){var r,i;!function(s,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,n,r=e.toLowerCase().split(":"),i=r.length,s=8;for(""===r[0]&&""===r[1]&&""===r[2]?(r.shift(),r.shift()):""===r[0]&&""===r[1]?r.shift():""===r[i-1]&&""===r[i-2]&&r.pop(),-1!==r[(i=r.length)-1].indexOf(".")&&(s=7),t=0;t<i&&""!==r[t];t++);if(t<s)for(r.splice(t,1,"0000");r.length<s;)r.splice(t,0,"0000");for(var o=0;o<s;o++){n=r[o].split("");for(var a=0;a<3&&"0"===n[0]&&n.length>1;a++)n.splice(0,1);r[o]=n.join("")}var c=-1,u=0,d=0,l=-1,h=!1;for(o=0;o<s;o++)h?"0"===r[o]?d+=1:(h=!1,d>u&&(c=l,u=d)):"0"===r[o]&&(h=!0,l=o,d=1);d>u&&(c=l,u=d),u>1&&r.splice(c,u,""),i=r.length;var f="";for(""===r[0]&&(f=":"),o=0;o<i&&(f+=r[o],o!==i-1);o++)f+=":";return""===r[i-1]&&(f+=":"),f},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},9827:function(e,t,n){var r,i;!function(s,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var r=e.lastIndexOf(".",t-1);if(r<=0||r>=t-1)return!1;var i=n.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(r+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var r=n.list[e.slice(t+1)];return!!r&&r.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var r=e.lastIndexOf(".",t-1);if(r<=0||r>=t-1)return null;var i=n.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(r+1,t)+" ")<0?null:e.slice(r+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n}))},5215:function(e,t,n){var r,i,s;!function(o,a){"use strict";e.exports?e.exports=a(n(7819),n(8677),n(9827)):(i=[n(7819),n(8677),n(9827)],void 0===(s="function"==typeof(r=a)?r.apply(t,i):r)||(e.exports=s))}(0,(function(e,t,n,r){"use strict";var i=r&&r.URI;function s(e,t){var n=arguments.length>=1,r=arguments.length>=2;if(!(this instanceof s))return n?r?new s(e,t):new s(e):new s;if(void 0===e){if(n)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&n)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}s.version="1.19.7";var o=s.prototype,a=Object.prototype.hasOwnProperty;function c(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function d(e){return"Array"===u(e)}function l(e,t){var n,r,i={};if("RegExp"===u(t))i=null;else if(d(t))for(n=0,r=t.length;n<r;n++)i[t[n]]=!0;else i[t]=!0;for(n=0,r=e.length;n<r;n++)(i&&void 0!==i[e[n]]||!i&&t.test(e[n]))&&(e.splice(n,1),r--,n--);return e}function h(e,t){var n,r;if(d(t)){for(n=0,r=t.length;n<r;n++)if(!h(e,t[n]))return!1;return!0}var i=u(t);for(n=0,r=e.length;n<r;n++)if("RegExp"===i){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function f(e,t){if(!d(e)||!d(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function p(e){return e.replace(/^\/+|\/+$/g,"")}function g(e){return escape(e)}function m(e){return encodeURIComponent(e).replace(/[!'()*]/g,g).replace(/\*/g,"%2A")}s._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:s.preventInvalidHostname,duplicateQueryParameters:s.duplicateQueryParameters,escapeQuerySpace:s.escapeQuerySpace}},s.preventInvalidHostname=!1,s.duplicateQueryParameters=!1,s.escapeQuerySpace=!0,s.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,s.idn_expression=/[^a-z0-9\._-]/i,s.punycode_expression=/(xn--)/i,s.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,s.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,s.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,s.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},s.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},s.hostProtocols=["http","https"],s.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,s.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},s.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return s.domAttributes[t]}},s.encode=m,s.decode=decodeURIComponent,s.iso8859=function(){s.encode=escape,s.decode=unescape},s.unicode=function(){s.encode=m,s.decode=decodeURIComponent},s.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},s.encodeQuery=function(e,t){var n=s.encode(e+"");return void 0===t&&(t=s.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},s.decodeQuery=function(e,t){e+="",void 0===t&&(t=s.escapeQuerySpace);try{return s.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var v,_={encode:"encode",decode:"decode"},y=function(e,t){return function(n){try{return s[t](n+"").replace(s.characters[e][t].expression,(function(n){return s.characters[e][t].map[n]}))}catch(e){return n}}};for(v in _)s[v+"PathSegment"]=y("pathname",_[v]),s[v+"UrnPathSegment"]=y("urnpath",_[v]);var b=function(e,t,n){return function(r){var i;i=n?function(e){return s[t](s[n](e))}:s[t];for(var o=(r+"").split(e),a=0,c=o.length;a<c;a++)o[a]=i(o[a]);return o.join(e)}};function w(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function S(e,t){return function(n,r){return void 0===n?this._parts[e]||"":(null!==n&&(n+="").charAt(0)===t&&(n=n.substring(1)),this._parts[e]=n,this.build(!r),this)}}s.decodePath=b("/","decodePathSegment"),s.decodeUrnPath=b(":","decodeUrnPathSegment"),s.recodePath=b("/","encodePathSegment","decode"),s.recodeUrnPath=b(":","encodeUrnPathSegment","decode"),s.encodeReserved=y("reserved","encode"),s.parse=function(e,t){var n;return t||(t={preventInvalidHostname:s.preventInvalidHostname}),(n=e.indexOf("#"))>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),(n=e.indexOf("?"))>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===(e=e.replace(/^(https?|ftp|wss?)?:[/\\]*/,"$1://")).substring(0,2)?(t.protocol=null,e=e.substring(2),e=s.parseAuthority(e,t)):(n=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(s.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3).replace(/\\/g,"/")?(e=e.substring(n+3),e=s.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0)),t.path=e,t},s.parseHost=function(e,t){e||(e="");var n,r,i=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===i&&(i=e.length),"["===e.charAt(0))n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,i)||null,"/"===t.port&&(t.port=null);else{var o=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",o+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,i)||null,t.port=null):(r=e.substring(0,i).split(":"),t.hostname=r[0]||null,t.port=r[1]||null)}return t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),t.preventInvalidHostname&&s.ensureValidHostname(t.hostname,t.protocol),t.port&&s.ensureValidPort(t.port),e.substring(i)||"/"},s.parseAuthority=function(e,t){return e=s.parseUserinfo(e,t),s.parseHost(e,t)},s.parseUserinfo=function(e,t){var n=e;-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/"));var r,i=e.indexOf("/"),o=e.lastIndexOf("@",i>-1?i:e.length-1);return o>-1&&(-1===i||o<i)?(r=e.substring(0,o).split(":"),t.username=r[0]?s.decode(r[0]):null,r.shift(),t.password=r[0]?s.decode(r.join(":")):null,e=n.substring(o+1)):(t.username=null,t.password=null),e},s.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,r,i,o={},c=e.split("&"),u=c.length,d=0;d<u;d++)n=c[d].split("="),r=s.decodeQuery(n.shift(),t),i=n.length?s.decodeQuery(n.join("="),t):null,"__proto__"!==r&&(a.call(o,r)?("string"!=typeof o[r]&&null!==o[r]||(o[r]=[o[r]]),o[r].push(i)):o[r]=i);return o},s.build=function(e){var t="",n=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",n=!0),t+=s.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&n&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},s.buildHost=function(e){var t="";return e.hostname?(s.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},s.buildAuthority=function(e){return s.buildUserinfo(e)+s.buildHost(e)},s.buildUserinfo=function(e){var t="";return e.username&&(t+=s.encode(e.username)),e.password&&(t+=":"+s.encode(e.password)),t&&(t+="@"),t},s.buildQuery=function(e,t,n){var r,i,o,c,u="";for(i in e)if("__proto__"!==i&&a.call(e,i))if(d(e[i]))for(r={},o=0,c=e[i].length;o<c;o++)void 0!==e[i][o]&&void 0===r[e[i][o]+""]&&(u+="&"+s.buildQueryParameter(i,e[i][o],n),!0!==t&&(r[e[i][o]+""]=!0));else void 0!==e[i]&&(u+="&"+s.buildQueryParameter(i,e[i],n));return u.substring(1)},s.buildQueryParameter=function(e,t,n){return s.encodeQuery(e,n)+(null!==t?"="+s.encodeQuery(t,n):"")},s.addQuery=function(e,t,n){if("object"==typeof t)for(var r in t)a.call(t,r)&&s.addQuery(e,r,t[r]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"==typeof e[t]&&(e[t]=[e[t]]),d(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},s.setQuery=function(e,t,n){if("object"==typeof t)for(var r in t)a.call(t,r)&&s.setQuery(e,r,t[r]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===n?null:n}},s.removeQuery=function(e,t,n){var r,i,o;if(d(t))for(r=0,i=t.length;r<i;r++)e[t[r]]=void 0;else if("RegExp"===u(t))for(o in e)t.test(o)&&(e[o]=void 0);else if("object"==typeof t)for(o in t)a.call(t,o)&&s.removeQuery(e,o,t[o]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===u(n)?!d(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=l(e[t],n):e[t]!==String(n)||d(n)&&1!==n.length?d(e[t])&&(e[t]=l(e[t],n)):e[t]=void 0:e[t]=void 0}},s.hasQuery=function(e,t,n,r){switch(u(t)){case"String":break;case"RegExp":for(var i in e)if(a.call(e,i)&&t.test(i)&&(void 0===n||s.hasQuery(e,i,n)))return!0;return!1;case"Object":for(var o in t)if(a.call(t,o)&&!s.hasQuery(e,o,t[o]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(n)){case"Undefined":return t in e;case"Boolean":return n===Boolean(d(e[t])?e[t].length:e[t]);case"Function":return!!n(e[t],t,e);case"Array":return!!d(e[t])&&(r?h:f)(e[t],n);case"RegExp":return d(e[t])?!!r&&h(e[t],n):Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return d(e[t])?!!r&&h(e[t],n):e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},s.joinPaths=function(){for(var e=[],t=[],n=0,r=0;r<arguments.length;r++){var i=new s(arguments[r]);e.push(i);for(var o=i.segment(),a=0;a<o.length;a++)"string"==typeof o[a]&&t.push(o[a]),o[a]&&n++}if(!t.length||!n)return new s("");var c=new s("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},s.commonPath=function(e,t){var n,r=Math.min(e.length,t.length);for(n=0;n<r;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return n<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(n)&&"/"===t.charAt(n)||(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},s.withinString=function(e,t,n){n||(n={});var r=n.start||s.findUri.start,i=n.end||s.findUri.end,o=n.trim||s.findUri.trim,a=n.parens||s.findUri.parens,c=/[a-z0-9-]=["']?$/i;for(r.lastIndex=0;;){var u=r.exec(e);if(!u)break;var d=u.index;if(n.ignoreHtml){var l=e.slice(Math.max(d-3,0),d);if(l&&c.test(l))continue}for(var h=d+e.slice(d).search(i),f=e.slice(d,h),p=-1;;){var g=a.exec(f);if(!g)break;var m=g.index+g[0].length;p=Math.max(p,m)}if(!((f=p>-1?f.slice(0,p)+f.slice(p).replace(o,""):f.replace(o,"")).length<=u[0].length||n.ignore&&n.ignore.test(f))){var v=t(f,d,h=d+f.length,e);void 0!==v?(v=String(v),e=e.slice(0,d)+v+e.slice(h),r.lastIndex=d+v.length):r.lastIndex=h}}return r.lastIndex=0,e},s.ensureValidHostname=function(t,n){var r=!!t,i=!1;if(!!n&&(i=h(s.hostProtocols,n)),i&&!r)throw new TypeError("Hostname cannot be empty, if protocol is "+n);if(t&&t.match(s.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(s.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},s.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},s.noConflict=function(e){if(e){var t={URI:this.noConflict()};return r.URITemplate&&"function"==typeof r.URITemplate.noConflict&&(t.URITemplate=r.URITemplate.noConflict()),r.IPv6&&"function"==typeof r.IPv6.noConflict&&(t.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&"function"==typeof r.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=r.SecondLevelDomains.noConflict()),t}return r.URI===this&&(r.URI=i),this},o.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=s.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new s(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},o.protocol=w("protocol"),o.username=w("username"),o.password=w("password"),o.hostname=w("hostname"),o.port=w("port"),o.query=S("query","?"),o.fragment=S("fragment","#"),o.search=function(e,t){var n=this.query(e,t);return"string"==typeof n&&n.length?"?"+n:n},o.hash=function(e,t){var n=this.fragment(e,t);return"string"==typeof n&&n.length?"#"+n:n},o.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?s.decodeUrnPath:s.decodePath)(n):n}return this._parts.urn?this._parts.path=e?s.recodeUrnPath(e):"":this._parts.path=e?s.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=s._parts();var r=e instanceof s,i="object"==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName&&(e=e[s.getDomAttribute(e)]||"",i=!1),!r&&i&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=s.parse(String(e),this._parts);else{if(!r&&!i)throw new TypeError("invalid input");var o=r?e._parts:e;for(n in o)"query"!==n&&a.call(this._parts,n)&&(this._parts[n]=o[n]);o.query&&this.query(o.query,!1)}return this.build(!t),this},o.is=function(e){var t=!1,r=!1,i=!1,o=!1,a=!1,c=!1,u=!1,d=!this._parts.urn;switch(this._parts.hostname&&(d=!1,r=s.ip4_expression.test(this._parts.hostname),i=s.ip6_expression.test(this._parts.hostname),a=(o=!(t=r||i))&&n&&n.has(this._parts.hostname),c=o&&s.idn_expression.test(this._parts.hostname),u=o&&s.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return d;case"absolute":return!d;case"domain":case"name":return o;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return i;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return u}return null};var E=o.protocol,x=o.port,A=o.hostname;o.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(s.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return E.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),s.ensureValidPort(e))),x.call(this,e,t))},o.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==s.parseHost(e,n))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,this._parts.preventInvalidHostname&&s.ensureValidHostname(e,this._parts.protocol)}return A.call(this,e,t)},o.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=this.protocol();return this.authority()?(n?n+"://":"")+this.authority():""}var r=s(e);return this.protocol(r.protocol()).authority(r.authority()).build(!t),this},o.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?s.buildHost(this._parts):"";if("/"!==s.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?s.buildAuthority(this._parts):"";if("/"!==s.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=s.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==e[e.length-1]&&(e+="@"),s.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=s.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var r=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,r),o=new RegExp("^"+c(i));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&s.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(t).length-1;return r=this._parts.hostname.lastIndexOf(".",r-1)+1,this._parts.hostname.substring(r)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(s.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(r+1);return!0!==t&&n&&n.list[i.toLowerCase()]&&n.get(this._parts.hostname)||i}var s;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');s=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");s=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?s.decodePath(r):r}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),a=new RegExp("^"+c(o));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=s.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(n+1);return e?s.decodePathSegment(r):r}var i=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var o=new RegExp(c(this.filename())+"$");return e=s.recodePath(e),this._parts.path=this._parts.path.replace(o,e),i?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n,r,i=this.filename(),o=i.lastIndexOf(".");return-1===o?"":(n=i.substring(o+1),r=/^[a-z0-9%]+$/i.test(n)?n:"",e?s.decodePathSegment(r):r)}"."===e.charAt(0)&&(e=e.substring(1));var a,u=this.suffix();if(u)a=e?new RegExp(c(u)+"$"):new RegExp(c("."+u)+"$");else{if(!e)return this;this._parts.path+="."+s.recodePath(e)}return a&&(e=s.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},o.segment=function(e,t,n){var r=this._parts.urn?":":"/",i=this.path(),s="/"===i.substring(0,1),o=i.split(r);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(s&&o.shift(),e<0&&(e=Math.max(o.length+e,0)),void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e])if(d(t)){o=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||o.length&&o[o.length-1].length)&&(o.length&&!o[o.length-1].length&&o.pop(),o.push(p(t[a])))}else(t||"string"==typeof t)&&(t=p(t),""===o[o.length-1]?o[o.length-1]=t:o.push(t));else t?o[e]=p(t):o.splice(e,1);return s&&o.unshift(""),this.path(o.join(r),n)},o.segmentCoded=function(e,t,n){var r,i,o;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(d(r=this.segment(e,t,n)))for(i=0,o=r.length;i<o;i++)r[i]=s.decode(r[i]);else r=void 0!==r?s.decode(r):void 0;return r}if(d(t))for(i=0,o=t.length;i<o;i++)t[i]=s.encode(t[i]);else t="string"==typeof t||t instanceof String?s.encode(t):t;return this.segment(e,t,n)};var N=o.query;return o.query=function(e,t){if(!0===e)return s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=e.call(this,n);return this._parts.query=s.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=s.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):N.call(this,e,t)},o.setQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)r[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)a.call(e,i)&&(r[i]=e[i])}return this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.addQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.addQuery(r,e,void 0===t?null:t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.removeQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.removeQuery(r,e,t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.hasQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.hasQuery(r,e,t,n)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},o.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===s.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){var t,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=s.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var r,i,o="";for("/"!==(n=s.recodePath(n)).charAt(0)&&(t=!0,n="/"+n),"/.."!==n.slice(-3)&&"/."!==n.slice(-2)||(n+="/"),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(o=n.substring(1).match(/^(\.\.\/)+/)||"")&&(o=o[0]);-1!==(r=n.search(/\/\.\.(\/|$)/));)0!==r?(-1===(i=n.substring(0,r).lastIndexOf("/"))&&(i=r),n=n.substring(0,i)+n.substring(r+3)):n=n.substring(3);return t&&this.is("relative")&&(n=o+n.substring(1)),this._parts.path=n,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(s.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=s.encode,t=s.decode;s.encode=escape,s.decode=decodeURIComponent;try{this.normalize()}finally{s.encode=e,s.decode=t}return this},o.unicode=function(){var e=s.encode,t=s.decode;s.encode=m,s.decode=unescape;try{this.normalize()}finally{s.encode=e,s.decode=t}return this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var r="",i=0,o=t._parts.query.split("&"),a=o.length;i<a;i++){var c=(o[i]||"").split("=");r+="&"+s.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(r+="="+s.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+s.decodeQuery(t.hash(),!0)},o.absoluteTo=function(e){var t,n,r,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof s||(e=new s(e)),i._parts.protocol)return i;if(i._parts.protocol=e._parts.protocol,this._parts.hostname)return i;for(n=0;r=o[n];n++)i._parts[r]=e._parts[r];return i._parts.path?(".."===i._parts.path.substring(-2)&&(i._parts.path+="/"),"/"!==i.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),i._parts.path=(t?t+"/":"")+i._parts.path,i.normalizePath())):(i._parts.path=e._parts.path,i._parts.query||(i._parts.query=e._parts.query)),i.build(),i},o.relativeTo=function(e){var t,n,r,i,o,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new s(e).normalize(),t=a._parts,n=e._parts,i=a.path(),o=e.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==o.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==n.hostname||t.port!==n.port)return a.build();if(t.hostname=null,t.port=null,i===o)return t.path="",a.build();if(!(r=s.commonPath(i,o)))return a.build();var c=n.path.substring(r.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(r.length)||"./",a.build()},o.equals=function(e){var t,n,r,i,o,c=this.clone(),u=new s(e),l={};if(c.normalize(),u.normalize(),c.toString()===u.toString())return!0;if(r=c.query(),i=u.query(),c.query(""),u.query(""),c.toString()!==u.toString())return!1;if(r.length!==i.length)return!1;for(o in t=s.parseQuery(r,this._parts.escapeQuerySpace),n=s.parseQuery(i,this._parts.escapeQuerySpace),t)if(a.call(t,o)){if(d(t[o])){if(!f(t[o],n[o]))return!1}else if(t[o]!==n[o])return!1;l[o]=!0}for(o in n)if(a.call(n,o)&&!l[o])return!1;return!0},o.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},s}))},7819:function(e,t,n){var r;e=n.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,c=36,u=/^xn--/,d=/[^\x20-\x7E]/,l=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function g(e){throw new RangeError(h[e])}function m(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function v(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+m((e=e.replace(l,".")).split("."),t).join(".")}function _(e){for(var t,n,r=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function y(e){return m(e,(function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+p(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,n){var r=0;for(e=n?f(e/700):e>>1,e+=f(e/t);e>455;r+=c)e=f(e/35);return f(r+36*e/(e+38))}function S(e){var t,n,r,i,s,o,u,d,l,h,p,m=[],v=e.length,_=0,b=128,S=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&g("not-basic"),m.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<v;){for(s=_,o=1,u=c;i>=v&&g("invalid-input"),((d=(p=e.charCodeAt(i++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:c)>=c||d>f((a-_)/o))&&g("overflow"),_+=d*o,!(d<(l=u<=S?1:u>=S+26?26:u-S));u+=c)o>f(a/(h=c-l))&&g("overflow"),o*=h;S=w(_-s,t=m.length+1,0==s),f(_/t)>a-b&&g("overflow"),b+=f(_/t),_%=t,m.splice(_++,0,b)}return y(m)}function E(e){var t,n,r,i,s,o,u,d,l,h,m,v,y,S,E,x=[];for(v=(e=_(e)).length,t=128,n=0,s=72,o=0;o<v;++o)(m=e[o])<128&&x.push(p(m));for(r=i=x.length,i&&x.push("-");r<v;){for(u=a,o=0;o<v;++o)(m=e[o])>=t&&m<u&&(u=m);for(u-t>f((a-n)/(y=r+1))&&g("overflow"),n+=(u-t)*y,t=u,o=0;o<v;++o)if((m=e[o])<t&&++n>a&&g("overflow"),m==t){for(d=n,l=c;!(d<(h=l<=s?1:l>=s+26?26:l-s));l+=c)E=d-h,S=c-h,x.push(p(b(h+E%S,0))),d=f(E/S);x.push(p(b(d,0))),s=w(n,y,r==i),n=0,++r}++n,++t}return x.join("")}o={version:"1.3.2",ucs2:{decode:_,encode:y},decode:S,encode:E,toASCII:function(e){return v(e,(function(e){return d.test(e)?"xn--"+E(e):e}))},toUnicode:function(e){return v(e,(function(e){return u.test(e)?S(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()},2242:(e,t,n)=>{e.exports={default:n(3391),__esModule:!0}},8902:(e,t,n)=>{e.exports={default:n(8613),__esModule:!0}},6593:(e,t,n)=>{e.exports={default:n(112),__esModule:!0}},6803:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=(r=n(6593))&&r.__esModule?r:{default:r};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,n){return function r(s,o){try{var a=t[s](o),c=a.value}catch(e){return void n(e)}if(!a.done)return i.default.resolve(c).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(c)}("next")}))}}},8106:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=(r=n(2242))&&r.__esModule?r:{default:r};t.default=function(e,t,n){return t in e?(0,i.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},2548:(e,t,n)=>{var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,s=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(8544),i)r.regeneratorRuntime=s;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},8544:e=>{!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag",u=t.regeneratorRuntime;if(u)e.exports=u;else{(u=t.regeneratorRuntime=e.exports).wrap=y;var d="suspendedStart",l="suspendedYield",h="executing",f="completed",p={},g={};g[o]=function(){return this};var m=Object.getPrototypeOf,v=m&&m(m(I([])));v&&v!==r&&i.call(v,o)&&(g=v);var _=E.prototype=w.prototype=Object.create(g);S.prototype=_.constructor=E,E.constructor=S,E[c]=S.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(_),e},u.awrap=function(e){return{__await:e}},x(A.prototype),A.prototype[a]=function(){return this},u.AsyncIterator=A,u.async=function(e,t,n,r){var i=new A(y(e,t,n,r));return u.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(_),_[c]="Generator",_[o]=function(){return this},_.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},u.values=I,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return a.type="throw",a.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),p}}}function y(e,t,n,r){var i=t&&t.prototype instanceof w?t:w,s=Object.create(i.prototype),o=new C(r||[]);return s._invoke=function(e,t,n){var r=d;return function(i,s){if(r===h)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw s;return O()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=N(o,n);if(a){if(a===p)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=b(e,t,n);if("normal"===c.type){if(r=n.done?f:l,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(e,n,o),s}function b(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function S(){}function E(){}function x(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function A(e){function t(n,r,s,o){var a=b(e[n],e,r);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,s,o)}),(function(e){t("throw",e,s,o)})):Promise.resolve(u).then((function(e){c.value=e,s(c)}),o)}o(a.arg)}var n;this._invoke=function(e,r){function i(){return new Promise((function(n,i){t(e,r,n,i)}))}return n=n?n.then(i,i):i()}}function N(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,N(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,p):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function I(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return s.next=s}}return{next:O}}function O(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},4942:(e,t,n)=>{e.exports=n(2548)},3391:(e,t,n)=>{n(1477);var r=n(4579).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},8613:(e,t,n)=>{n(961),e.exports=n(4579).Object.keys},112:(e,t,n)=>{n(4058),n(1867),n(3871),n(2878),n(5971),n(2526),e.exports=n(4579).Promise},5663:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},9003:e=>{e.exports=function(){}},9142:e=>{e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},2159:(e,t,n)=>{var r=n(6727);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},7428:(e,t,n)=>{var r=n(7932),i=n(8728),s=n(6531);e.exports=function(e){return function(t,n,o){var a,c=r(t),u=i(c.length),d=s(o,u);if(e&&n!=n){for(;u>d;)if((a=c[d++])!=a)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===n)return e||d||0;return!e&&-1}}},4677:(e,t,n)=>{var r=n(2894),i=n(2939)("toStringTag"),s="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:s?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},2894:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},4579:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},9216:(e,t,n)=>{var r=n(5663);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},8333:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},9666:(e,t,n)=>{e.exports=!n(7929)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},7467:(e,t,n)=>{var r=n(6727),i=n(3938).document,s=r(i)&&r(i.createElement);e.exports=function(e){return s?i.createElement(e):{}}},3338:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},3856:(e,t,n)=>{var r=n(3938),i=n(4579),s=n(9216),o=n(1818),a=n(7069),c=function(e,t,n){var u,d,l,h=e&c.F,f=e&c.G,p=e&c.S,g=e&c.P,m=e&c.B,v=e&c.W,_=f?i:i[t]||(i[t]={}),y=_.prototype,b=f?r:p?r[t]:(r[t]||{}).prototype;for(u in f&&(n=t),n)(d=!h&&b&&void 0!==b[u])&&a(_,u)||(l=d?b[u]:n[u],_[u]=f&&"function"!=typeof b[u]?n[u]:m&&d?s(l,r):v&&b[u]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):g&&"function"==typeof l?s(Function.call,l):l,g&&((_.virtual||(_.virtual={}))[u]=l,e&c.R&&y&&!y[u]&&o(y,u,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},7929:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},5576:(e,t,n)=>{var r=n(9216),i=n(5602),s=n(5991),o=n(2159),a=n(8728),c=n(3728),u={},d={},l=e.exports=function(e,t,n,l,h){var f,p,g,m,v=h?function(){return e}:c(e),_=r(n,l,t?2:1),y=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(s(v)){for(f=a(e.length);f>y;y++)if((m=t?_(o(p=e[y])[0],p[1]):_(e[y]))===u||m===d)return m}else for(g=v.call(e);!(p=g.next()).done;)if((m=i(g,_,p.value,t))===u||m===d)return m};l.BREAK=u,l.RETURN=d},3938:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},7069:e=>{var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},1818:(e,t,n)=>{var r=n(4743),i=n(3101);e.exports=n(9666)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},4881:(e,t,n)=>{var r=n(3938).document;e.exports=r&&r.documentElement},3758:(e,t,n)=>{e.exports=!n(9666)&&!n(7929)((function(){return 7!=Object.defineProperty(n(7467)("div"),"a",{get:function(){return 7}}).a}))},6778:e=>{e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},799:(e,t,n)=>{var r=n(2894);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},5991:(e,t,n)=>{var r=n(5449),i=n(2939)("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||s[i]===e)}},6727:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},5602:(e,t,n)=>{var r=n(2159);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var s=e.return;throw void 0!==s&&r(s.call(e)),t}}},3945:(e,t,n)=>{"use strict";var r=n(526),i=n(3101),s=n(5378),o={};n(1818)(o,n(2939)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),s(e,t+" Iterator")}},5700:(e,t,n)=>{"use strict";var r=n(6227),i=n(3856),s=n(7470),o=n(1818),a=n(5449),c=n(3945),u=n(5378),d=n(5089),l=n(2939)("iterator"),h=!([].keys&&"next"in[].keys()),f="keys",p="values",g=function(){return this};e.exports=function(e,t,n,m,v,_,y){c(n,t,m);var b,w,S,E=function(e){if(!h&&e in j)return j[e];switch(e){case f:case p:return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",A=v==p,N=!1,j=e.prototype,T=j[l]||j["@@iterator"]||v&&j[v],C=T||E(v),I=v?A?E("entries"):C:void 0,O="Array"==t&&j.entries||T;if(O&&(S=d(O.call(new e)))!==Object.prototype&&S.next&&(u(S,x,!0),r||"function"==typeof S[l]||o(S,l,g)),A&&T&&T.name!==p&&(N=!0,C=function(){return T.call(this)}),r&&!y||!h&&!N&&j[l]||o(j,l,C),a[t]=C,a[x]=g,v)if(b={values:A?C:E(p),keys:_?C:E(f),entries:I},y)for(w in b)w in j||s(j,w,b[w]);else i(i.P+i.F*(h||N),t,b);return b}},6630:(e,t,n)=>{var r=n(2939)("iterator"),i=!1;try{var s=[7][r]();s.return=function(){i=!0},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var s=[7],o=s[r]();o.next=function(){return{done:n=!0}},s[r]=function(){return o},e(s)}catch(e){}return n}},5084:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},5449:e=>{e.exports={}},6227:e=>{e.exports=!0},1601:(e,t,n)=>{var r=n(3938),i=n(2569).set,s=r.MutationObserver||r.WebKitMutationObserver,o=r.process,a=r.Promise,c="process"==n(2894)(o);e.exports=function(){var e,t,n,u=function(){var r,i;for(c&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){o.nextTick(u)};else if(!s||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var d=a.resolve(void 0);n=function(){d.then(u)}}else n=function(){i.call(r,u)};else{var l=!0,h=document.createTextNode("");new s(u).observe(h,{characterData:!0}),n=function(){h.data=l=!l}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},9304:(e,t,n)=>{"use strict";var r=n(5663);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},526:(e,t,n)=>{var r=n(2159),i=n(3865),s=n(3338),o=n(8989)("IE_PROTO"),a=function(){},c=function(){var e,t=n(7467)("iframe"),r=s.length;for(t.style.display="none",n(4881).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[s[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[o]=e):n=c(),void 0===t?n:i(n,t)}},4743:(e,t,n)=>{var r=n(2159),i=n(3758),s=n(3206),o=Object.defineProperty;t.f=n(9666)?Object.defineProperty:function(e,t,n){if(r(e),t=s(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},3865:(e,t,n)=>{var r=n(4743),i=n(2159),s=n(6162);e.exports=n(9666)?Object.defineProperties:function(e,t){i(e);for(var n,o=s(t),a=o.length,c=0;a>c;)r.f(e,n=o[c++],t[n]);return e}},5089:(e,t,n)=>{var r=n(7069),i=n(6530),s=n(8989)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},2963:(e,t,n)=>{var r=n(7069),i=n(7932),s=n(7428)(!1),o=n(8989)("IE_PROTO");e.exports=function(e,t){var n,a=i(e),c=0,u=[];for(n in a)n!=o&&r(a,n)&&u.push(n);for(;t.length>c;)r(a,n=t[c++])&&(~s(u,n)||u.push(n));return u}},6162:(e,t,n)=>{var r=n(2963),i=n(3338);e.exports=Object.keys||function(e){return r(e,i)}},2584:(e,t,n)=>{var r=n(3856),i=n(4579),s=n(7929);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*s((function(){n(1)})),"Object",o)}},931:e=>{e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},7790:(e,t,n)=>{var r=n(2159),i=n(6727),s=n(9304);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=s.f(e);return(0,n.resolve)(t),n.promise}},3101:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},8144:(e,t,n)=>{var r=n(1818);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},7470:(e,t,n)=>{e.exports=n(1818)},9967:(e,t,n)=>{"use strict";var r=n(3938),i=n(4579),s=n(4743),o=n(9666),a=n(2939)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];o&&t&&!t[a]&&s.f(t,a,{configurable:!0,get:function(){return this}})}},5378:(e,t,n)=>{var r=n(4743).f,i=n(7069),s=n(2939)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,s)&&r(e,s,{configurable:!0,value:t})}},8989:(e,t,n)=>{var r=n(250)("keys"),i=n(5730);e.exports=function(e){return r[e]||(r[e]=i(e))}},250:(e,t,n)=>{var r=n(4579),i=n(3938),s="__core-js_shared__",o=i[s]||(i[s]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(6227)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},2707:(e,t,n)=>{var r=n(2159),i=n(5663),s=n(2939)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[s])?t:i(n)}},510:(e,t,n)=>{var r=n(1052),i=n(8333);e.exports=function(e){return function(t,n){var s,o,a=String(i(t)),c=r(n),u=a.length;return c<0||c>=u?e?"":void 0:(s=a.charCodeAt(c))<55296||s>56319||c+1===u||(o=a.charCodeAt(c+1))<56320||o>57343?e?a.charAt(c):s:e?a.slice(c,c+2):o-56320+(s-55296<<10)+65536}}},2569:(e,t,n)=>{var r,i,s,o=n(9216),a=n(6778),c=n(4881),u=n(7467),d=n(3938),l=d.process,h=d.setImmediate,f=d.clearImmediate,p=d.MessageChannel,g=d.Dispatch,m=0,v={},_=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},y=function(e){_.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++m]=function(){a("function"==typeof e?e:Function(e),t)},r(m),m},f=function(e){delete v[e]},"process"==n(2894)(l)?r=function(e){l.nextTick(o(_,e,1))}:g&&g.now?r=function(e){g.now(o(_,e,1))}:p?(s=(i=new p).port2,i.port1.onmessage=y,r=o(s.postMessage,s,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(r=function(e){d.postMessage(e+"","*")},d.addEventListener("message",y,!1)):r="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),_.call(e)}}:function(e){setTimeout(o(_,e,1),0)}),e.exports={set:h,clear:f}},6531:(e,t,n)=>{var r=n(1052),i=Math.max,s=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):s(e,t)}},1052:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},7932:(e,t,n)=>{var r=n(799),i=n(8333);e.exports=function(e){return r(i(e))}},8728:(e,t,n)=>{var r=n(1052),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},6530:(e,t,n)=>{var r=n(8333);e.exports=function(e){return Object(r(e))}},3206:(e,t,n)=>{var r=n(6727);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},5730:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},6640:(e,t,n)=>{var r=n(3938).navigator;e.exports=r&&r.userAgent||""},2939:(e,t,n)=>{var r=n(250)("wks"),i=n(5730),s=n(3938).Symbol,o="function"==typeof s;(e.exports=function(e){return r[e]||(r[e]=o&&s[e]||(o?s:i)("Symbol."+e))}).store=r},3728:(e,t,n)=>{var r=n(4677),i=n(2939)("iterator"),s=n(5449);e.exports=n(4579).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||s[r(e)]}},3882:(e,t,n)=>{"use strict";var r=n(9003),i=n(5084),s=n(5449),o=n(7932);e.exports=n(5700)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),s.Arguments=s.Array,r("keys"),r("values"),r("entries")},1477:(e,t,n)=>{var r=n(3856);r(r.S+r.F*!n(9666),"Object",{defineProperty:n(4743).f})},961:(e,t,n)=>{var r=n(6530),i=n(6162);n(2584)("keys",(function(){return function(e){return i(r(e))}}))},4058:()=>{},2878:(e,t,n)=>{"use strict";var r,i,s,o,a=n(6227),c=n(3938),u=n(9216),d=n(4677),l=n(3856),h=n(6727),f=n(5663),p=n(9142),g=n(5576),m=n(2707),v=n(2569).set,_=n(1601)(),y=n(9304),b=n(931),w=n(6640),S=n(7790),E="Promise",x=c.TypeError,A=c.process,N=A&&A.versions,j=N&&N.v8||"",T=c.Promise,C="process"==d(A),I=function(){},O=i=y.f,k=!!function(){try{var e=T.resolve(1),t=(e.constructor={})[n(2939)("species")]=function(e){e(I,I)};return(C||"function"==typeof PromiseRejectionEvent)&&e.then(I)instanceof t&&0!==j.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),M=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},R=function(e,t){if(!e._n){e._n=!0;var n=e._c;_((function(){for(var r=e._v,i=1==e._s,s=0,o=function(t){var n,s,o,a=i?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{a?(i||(2==e._h&&L(e),e._h=1),!0===a?n=r:(d&&d.enter(),n=a(r),d&&(d.exit(),o=!0)),n===t.promise?u(x("Promise-chain cycle")):(s=M(n))?s.call(n,c,u):c(n)):u(r)}catch(e){d&&!o&&d.exit(),u(e)}};n.length>s;)o(n[s++]);e._c=[],e._n=!1,t&&!e._h&&D(e)}))}},D=function(e){v.call(c,(function(){var t,n,r,i=e._v,s=F(e);if(s&&(t=b((function(){C?A.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=C||F(e)?2:1),e._a=void 0,s&&t.e)throw t.v}))},F=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){v.call(c,(function(){var t;C?A.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},P=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},U=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw x("Promise can't be resolved itself");(t=M(e))?_((function(){var r={_w:n,_d:!1};try{t.call(e,u(U,r,1),u(P,r,1))}catch(e){P.call(r,e)}})):(n._v=e,n._s=1,R(n,!1))}catch(e){P.call({_w:n,_d:!1},e)}}};k||(T=function(e){p(this,T,E,"_h"),f(e),r.call(this);try{e(u(U,this,1),u(P,this,1))}catch(e){P.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(8144)(T.prototype,{then:function(e,t){var n=O(m(this,T));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=C?A.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&R(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),s=function(){var e=new r;this.promise=e,this.resolve=u(U,e,1),this.reject=u(P,e,1)},y.f=O=function(e){return e===T||e===o?new s(e):i(e)}),l(l.G+l.W+l.F*!k,{Promise:T}),n(5378)(T,E),n(9967)(E),o=n(4579).Promise,l(l.S+l.F*!k,E,{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(a||!k),E,{resolve:function(e){return S(a&&this===o?T:this,e)}}),l(l.S+l.F*!(k&&n(6630)((function(e){T.all(e).catch(I)}))),E,{all:function(e){var t=this,n=O(t),r=n.resolve,i=n.reject,s=b((function(){var n=[],s=0,o=1;g(e,!1,(function(e){var a=s++,c=!1;n.push(void 0),o++,t.resolve(e).then((function(e){c||(c=!0,n[a]=e,--o||r(n))}),i)})),--o||r(n)}));return s.e&&i(s.v),n.promise},race:function(e){var t=this,n=O(t),r=n.reject,i=b((function(){g(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},1867:(e,t,n)=>{"use strict";var r=n(510)(!0);n(5700)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},5971:(e,t,n)=>{"use strict";var r=n(3856),i=n(4579),s=n(3938),o=n(2707),a=n(7790);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,i.Promise||s.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then((function(){return n}))}:e,n?function(n){return a(t,e()).then((function(){throw n}))}:e)}})},2526:(e,t,n)=>{"use strict";var r=n(3856),i=n(9304),s=n(931);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=s(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},3871:(e,t,n)=>{n(3882);for(var r=n(3938),i=n(1818),s=n(5449),o=n(2939)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],d=r[u],l=d&&d.prototype;l&&!l[o]&&i(l,o,u),s[u]=s.Array}},7484:function(e){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",r="second",i="minute",s="hour",o="day",a="week",c="month",u="quarter",d="year",l="date",h="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},m=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},v={s:m,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+m(r,2,"0")+":"+m(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,c),s=n-i<0,o=t.clone().add(r+(s?-1:1),c);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:d,w:a,d:o,D:l,h:s,m:i,s:r,ms:n,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},_="en",y={};y[_]=g;var b=function(e){return e instanceof x},w=function(e,t,n){var r;if(!e)return _;if("string"==typeof e)y[e]&&(r=e),t&&(y[e]=t,r=e);else{var i=e.name;y[i]=e,r=i}return!n&&r&&(_=r),r||!n&&_},S=function(e,t){if(b(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new x(n)},E=v;E.l=w,E.i=b,E.w=function(e,t){return S(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var x=function(){function g(e){this.$L=w(e.locale,null,!0),this.parse(e)}var m=g.prototype;return m.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(E.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(f);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},m.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},m.$utils=function(){return E},m.isValid=function(){return!(this.$d.toString()===h)},m.isSame=function(e,t){var n=S(e);return this.startOf(t)<=n&&n<=this.endOf(t)},m.isAfter=function(e,t){return S(e)<this.startOf(t)},m.isBefore=function(e,t){return this.endOf(t)<S(e)},m.$g=function(e,t,n){return E.u(e)?this[t]:this.set(n,e)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(e,t){var n=this,u=!!E.u(t)||t,h=E.p(e),f=function(e,t){var r=E.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return u?r:r.endOf(o)},p=function(e,t){return E.w(n.toDate()[e].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,m=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(h){case d:return u?f(1,0):f(31,11);case c:return u?f(1,m):f(0,m+1);case a:var y=this.$locale().weekStart||0,b=(g<y?g+7:g)-y;return f(u?v-b:v+(6-b),m);case o:case l:return p(_+"Hours",0);case s:return p(_+"Minutes",1);case i:return p(_+"Seconds",2);case r:return p(_+"Milliseconds",3);default:return this.clone()}},m.endOf=function(e){return this.startOf(e,!1)},m.$set=function(e,t){var a,u=E.p(e),h="set"+(this.$u?"UTC":""),f=(a={},a[o]=h+"Date",a[l]=h+"Date",a[c]=h+"Month",a[d]=h+"FullYear",a[s]=h+"Hours",a[i]=h+"Minutes",a[r]=h+"Seconds",a[n]=h+"Milliseconds",a)[u],p=u===o?this.$D+(t-this.$W):t;if(u===c||u===d){var g=this.clone().set(l,1);g.$d[f](p),g.init(),this.$d=g.set(l,Math.min(this.$D,g.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},m.set=function(e,t){return this.clone().$set(e,t)},m.get=function(e){return this[E.p(e)]()},m.add=function(n,u){var l,h=this;n=Number(n);var f=E.p(u),p=function(e){var t=S(h);return E.w(t.date(t.date()+Math.round(e*n)),h)};if(f===c)return this.set(c,this.$M+n);if(f===d)return this.set(d,this.$y+n);if(f===o)return p(1);if(f===a)return p(7);var g=(l={},l[i]=e,l[s]=t,l[r]=1e3,l)[f]||1,m=this.$d.getTime()+n*g;return E.w(m,this)},m.subtract=function(e,t){return this.add(-1*e,t)},m.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=E.z(this),s=this.$H,o=this.$m,a=this.$M,c=n.weekdays,u=n.months,d=function(e,n,i,s){return e&&(e[n]||e(t,r))||i[n].substr(0,s)},l=function(e){return E.s(s%12||12,e,"0")},f=n.meridiem||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r},g={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:E.s(a+1,2,"0"),MMM:d(n.monthsShort,a,u,3),MMMM:d(u,a),D:this.$D,DD:E.s(this.$D,2,"0"),d:String(this.$W),dd:d(n.weekdaysMin,this.$W,c,2),ddd:d(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(s),HH:E.s(s,2,"0"),h:l(1),hh:l(2),a:f(s,o,!0),A:f(s,o,!1),m:String(o),mm:E.s(o,2,"0"),s:String(this.$s),ss:E.s(this.$s,2,"0"),SSS:E.s(this.$ms,3,"0"),Z:i};return r.replace(p,(function(e,t){return t||g[e]||i.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(n,l,h){var f,p=E.p(l),g=S(n),m=(g.utcOffset()-this.utcOffset())*e,v=this-g,_=E.m(this,g);return _=(f={},f[d]=_/12,f[c]=_,f[u]=_/3,f[a]=(v-m)/6048e5,f[o]=(v-m)/864e5,f[s]=v/t,f[i]=v/e,f[r]=v/1e3,f)[p]||v,h?_:E.a(_)},m.daysInMonth=function(){return this.endOf(c).$D},m.$locale=function(){return y[this.$L]},m.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=w(e,t,!0);return r&&(n.$L=r),n},m.clone=function(){return E.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},g}(),A=x.prototype;return S.prototype=A,[["$ms",n],["$s",r],["$m",i],["$H",s],["$W",o],["$M",c],["$y",d],["$D",l]].forEach((function(e){A[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),S.extend=function(e,t){return e.$i||(e(t,x,S),e.$i=!0),S},S.locale=w,S.isDayjs=b,S.unix=function(e){return S(1e3*e)},S.en=y[_],S.Ls=y,S.p={},S}()},9434:(e,t,n)=>{var r={"./af.js":[5903,9210],"./am.js":[9911,5073],"./ar-dz.js":[7200,9406],"./ar-kw.js":[2376,9897],"./ar-ly.js":[8540,3521],"./ar-ma.js":[6817,5313],"./ar-sa.js":[1573,485],"./ar-tn.js":[9339,8040],"./ar.js":[3939,6755],"./az.js":[8092,4963],"./be.js":[504,9478],"./bg.js":[9091,578],"./bi.js":[9149,2984],"./bm.js":[5287,2263],"./bn.js":[5254,280],"./bo.js":[2502,9950],"./br.js":[8864,760],"./bs.js":[4502,9833],"./ca.js":[3646,102],"./cs.js":[8507,7400],"./cv.js":[6636,4481],"./cy.js":[8792,6740],"./da.js":[7427,2548],"./de-at.js":[3237,7175],"./de-ch.js":[6148,1679],"./de.js":[790,52],"./dv.js":[1794,5569],"./el.js":[5423,1606],"./en-au.js":[5109,5485],"./en-ca.js":[5105,4035],"./en-gb.js":[9517,6031],"./en-ie.js":[758,8129],"./en-il.js":[5805,3463],"./en-in.js":[8529,6898],"./en-nz.js":[302,8547],"./en-sg.js":[5941,1735],"./en-tt.js":[6183,6105],"./en.js":[5054,535],"./eo.js":[4990,5121],"./es-do.js":[3864,8758],"./es-pr.js":[3521,911],"./es-us.js":[6165,3208],"./es.js":[7763,3411],"./et.js":[9670,4153],"./eu.js":[6629,1396],"./fa.js":[6953,5544],"./fi.js":[7822,2130],"./fo.js":[9197,8745],"./fr-ca.js":[7989,7363],"./fr-ch.js":[4254,7952],"./fr.js":[6023,1910],"./fy.js":[3220,6376],"./ga.js":[2186,688],"./gd.js":[4855,5050],"./gl.js":[229,5818],"./gom-latn.js":[6312,825],"./gu.js":[7632,3623],"./he.js":[5418,9372],"./hi.js":[7573,8010],"./hr.js":[6257,7419],"./ht.js":[8889,5822],"./hu.js":[8562,8214],"./hy-am.js":[8242,5407],"./id.js":[3783,9513],"./is.js":[8980,1194],"./it-ch.js":[3706,6010],"./it.js":[5551,1880],"./ja.js":[6831,1107],"./jv.js":[2641,4305],"./ka.js":[6622,5186],"./kk.js":[2921,5206],"./km.js":[5567,2475],"./kn.js":[1113,7523],"./ko.js":[9132,3446],"./ku.js":[4888,7024],"./ky.js":[466,5055],"./lb.js":[1796,5215],"./lo.js":[8894,1204],"./lt.js":[8768,7899],"./lv.js":[953,631],"./me.js":[8066,145],"./mi.js":[8602,7454],"./mk.js":[1560,4951],"./ml.js":[4017,7679],"./mn.js":[4717,8618],"./mr.js":[5473,5600],"./ms-my.js":[7387,882],"./ms.js":[5742,9095],"./mt.js":[8477,9665],"./my.js":[2966,5166],"./nb.js":[9682,646],"./ne.js":[4149,9030],"./nl-be.js":[7496,3155],"./nl.js":[9182,1520],"./nn.js":[2722,7050],"./oc-lnc.js":[6159,7203],"./pa-in.js":[5914,5850],"./pl.js":[1987,1211],"./pt-br.js":[7548,5274],"./pt.js":[5001,265],"./ro.js":[8146,8022],"./ru.js":[600,559],"./rw.js":[6509,3221],"./sd.js":[5437,1298],"./se.js":[772,1942],"./si.js":[7109,9333],"./sk.js":[5627,6783],"./sl.js":[2544,9625],"./sq.js":[8341,8603],"./sr-cyrl.js":[7101,3435],"./sr.js":[617,7390],"./ss.js":[4127,9238],"./sv-fi.js":[6421,9997],"./sv.js":[1876,9652],"./sw.js":[2030,9733],"./ta.js":[5596,7645],"./te.js":[5159,7714],"./tet.js":[9157,555],"./tg.js":[9928,2446],"./th.js":[2019,1729],"./tk.js":[5817,5256],"./tl-ph.js":[6513,9443],"./tlh.js":[7296,2814],"./tr.js":[3035,8665],"./tzl.js":[7797,2843],"./tzm-latn.js":[261,3933],"./tzm.js":[4722,4342],"./ug-cn.js":[313,6890],"./uk.js":[4144,1619],"./ur.js":[2957,9568],"./uz-latn.js":[8727,1110],"./uz.js":[7486,3153],"./vi.js":[7553,8073],"./x-pseudo.js":[5321,4423],"./yo.js":[4724,8692],"./zh-cn.js":[3852,9630],"./zh-hk.js":[2390,3755],"./zh-tw.js":[9709,6776],"./zh.js":[2009,8458]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,7)))}i.keys=()=>Object.keys(r),i.id=9434,e.exports=i},8734:function(e){e.exports=function(){"use strict";return function(e,t,n){var r=t.prototype,i=r.format;n.en.ordinal=function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"},r.format=function(e){var t=this,n=this.$locale(),r=this.$utils(),s=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return r.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return r.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return r.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return i.bind(this)(s)}}}()},7856:function(e){e.exports=function(){"use strict";var e=Object.hasOwnProperty,t=Object.setPrototypeOf,n=Object.isFrozen,r=Object.getPrototypeOf,i=Object.getOwnPropertyDescriptor,s=Object.freeze,o=Object.seal,a=Object.create,c="undefined"!=typeof Reflect&&Reflect,u=c.apply,d=c.construct;u||(u=function(e,t,n){return e.apply(t,n)}),s||(s=function(e){return e}),o||(o=function(e){return e}),d||(d=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))))});var l,h=S(Array.prototype.forEach),f=S(Array.prototype.pop),p=S(Array.prototype.push),g=S(String.prototype.toLowerCase),m=S(String.prototype.match),v=S(String.prototype.replace),_=S(String.prototype.indexOf),y=S(String.prototype.trim),b=S(RegExp.prototype.test),w=(l=TypeError,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return d(l,t)});function S(e){return function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return u(e,t,r)}}function E(e,r){t&&t(e,null);for(var i=r.length;i--;){var s=r[i];if("string"==typeof s){var o=g(s);o!==s&&(n(r)||(r[i]=o),s=o)}e[s]=!0}return e}function x(t){var n=a(null),r=void 0;for(r in t)u(e,t,[r])&&(n[r]=t[r]);return n}function A(e,t){for(;null!==e;){var n=i(e,t);if(n){if(n.get)return S(n.get);if("function"==typeof n.value)return S(n.value)}e=r(e)}return function(e){return console.warn("fallback value for",e),null}}var N=s(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),j=s(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),T=s(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),C=s(["animate","color-profile","cursor","discard","fedropshadow","feimage","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),I=s(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),O=s(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),k=s(["#text"]),M=s(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),R=s(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),D=s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),F=s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),L=o(/\{\{[\s\S]*|[\s\S]*\}\}/gm),P=o(/<%[\s\S]*|[\s\S]*%>/gm),U=o(/^data-[\-\w.\u00B7-\uFFFF]/),$=o(/^aria-[\-\w]+$/),z=o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),B=o(/^(?:\w+script|data):/i),H=o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function G(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var W=function(){return"undefined"==typeof window?null:window},J=function(e,t){if("object"!==(void 0===e?"undefined":q(e))||"function"!=typeof e.createPolicy)return null;var n=null,r="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(r)&&(n=t.currentScript.getAttribute(r));var i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}};return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W(),n=function(t){return e(t)};if(n.version="2.3.1",n.removed=[],!t||!t.document||9!==t.document.nodeType)return n.isSupported=!1,n;var r=t.document,i=t.document,o=t.DocumentFragment,a=t.HTMLTemplateElement,c=t.Node,u=t.Element,d=t.NodeFilter,l=t.NamedNodeMap,S=void 0===l?t.NamedNodeMap||t.MozNamedAttrMap:l,Q=t.Text,V=t.Comment,Y=t.DOMParser,X=t.trustedTypes,K=u.prototype,Z=A(K,"cloneNode"),ee=A(K,"nextSibling"),te=A(K,"childNodes"),ne=A(K,"parentNode");if("function"==typeof a){var re=i.createElement("template");re.content&&re.content.ownerDocument&&(i=re.content.ownerDocument)}var ie=J(X,r),se=ie&&Le?ie.createHTML(""):"",oe=i,ae=oe.implementation,ce=oe.createNodeIterator,ue=oe.createDocumentFragment,de=oe.getElementsByTagName,le=r.importNode,he={};try{he=x(i).documentMode?i.documentMode:{}}catch(e){}var fe={};n.isSupported="function"==typeof ne&&ae&&void 0!==ae.createHTMLDocument&&9!==he;var pe=L,ge=P,me=U,ve=$,_e=B,ye=H,be=z,we=null,Se=E({},[].concat(G(N),G(j),G(T),G(I),G(k))),Ee=null,xe=E({},[].concat(G(M),G(R),G(D),G(F))),Ae=null,Ne=null,je=!0,Te=!0,Ce=!1,Ie=!1,Oe=!1,ke=!1,Me=!1,Re=!1,De=!1,Fe=!0,Le=!1,Pe=!0,Ue=!0,$e=!1,ze={},Be=null,He=E({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),qe=null,Ge=E({},["audio","video","img","source","image","track"]),We=null,Je=E({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Qe="http://www.w3.org/1998/Math/MathML",Ve="http://www.w3.org/2000/svg",Ye="http://www.w3.org/1999/xhtml",Xe=Ye,Ke=!1,Ze=null,et=i.createElement("form"),tt=function(e){Ze&&Ze===e||(e&&"object"===(void 0===e?"undefined":q(e))||(e={}),e=x(e),we="ALLOWED_TAGS"in e?E({},e.ALLOWED_TAGS):Se,Ee="ALLOWED_ATTR"in e?E({},e.ALLOWED_ATTR):xe,We="ADD_URI_SAFE_ATTR"in e?E(x(Je),e.ADD_URI_SAFE_ATTR):Je,qe="ADD_DATA_URI_TAGS"in e?E(x(Ge),e.ADD_DATA_URI_TAGS):Ge,Be="FORBID_CONTENTS"in e?E({},e.FORBID_CONTENTS):He,Ae="FORBID_TAGS"in e?E({},e.FORBID_TAGS):{},Ne="FORBID_ATTR"in e?E({},e.FORBID_ATTR):{},ze="USE_PROFILES"in e&&e.USE_PROFILES,je=!1!==e.ALLOW_ARIA_ATTR,Te=!1!==e.ALLOW_DATA_ATTR,Ce=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Ie=e.SAFE_FOR_TEMPLATES||!1,Oe=e.WHOLE_DOCUMENT||!1,Re=e.RETURN_DOM||!1,De=e.RETURN_DOM_FRAGMENT||!1,Fe=!1!==e.RETURN_DOM_IMPORT,Le=e.RETURN_TRUSTED_TYPE||!1,Me=e.FORCE_BODY||!1,Pe=!1!==e.SANITIZE_DOM,Ue=!1!==e.KEEP_CONTENT,$e=e.IN_PLACE||!1,be=e.ALLOWED_URI_REGEXP||be,Xe=e.NAMESPACE||Ye,Ie&&(Te=!1),De&&(Re=!0),ze&&(we=E({},[].concat(G(k))),Ee=[],!0===ze.html&&(E(we,N),E(Ee,M)),!0===ze.svg&&(E(we,j),E(Ee,R),E(Ee,F)),!0===ze.svgFilters&&(E(we,T),E(Ee,R),E(Ee,F)),!0===ze.mathMl&&(E(we,I),E(Ee,D),E(Ee,F))),e.ADD_TAGS&&(we===Se&&(we=x(we)),E(we,e.ADD_TAGS)),e.ADD_ATTR&&(Ee===xe&&(Ee=x(Ee)),E(Ee,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&E(We,e.ADD_URI_SAFE_ATTR),e.FORBID_CONTENTS&&(Be===He&&(Be=x(Be)),E(Be,e.FORBID_CONTENTS)),Ue&&(we["#text"]=!0),Oe&&E(we,["html","head","body"]),we.table&&(E(we,["tbody"]),delete Ae.tbody),s&&s(e),Ze=e)},nt=E({},["mi","mo","mn","ms","mtext"]),rt=E({},["foreignobject","desc","title","annotation-xml"]),it=E({},j);E(it,T),E(it,C);var st=E({},I);E(st,O);var ot=function(e){var t=ne(e);t&&t.tagName||(t={namespaceURI:Ye,tagName:"template"});var n=g(e.tagName),r=g(t.tagName);if(e.namespaceURI===Ve)return t.namespaceURI===Ye?"svg"===n:t.namespaceURI===Qe?"svg"===n&&("annotation-xml"===r||nt[r]):Boolean(it[n]);if(e.namespaceURI===Qe)return t.namespaceURI===Ye?"math"===n:t.namespaceURI===Ve?"math"===n&&rt[r]:Boolean(st[n]);if(e.namespaceURI===Ye){if(t.namespaceURI===Ve&&!rt[r])return!1;if(t.namespaceURI===Qe&&!nt[r])return!1;var i=E({},["title","style","font","a","script"]);return!st[n]&&(i[n]||!it[n])}return!1},at=function(e){p(n.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=se}catch(t){e.remove()}}},ct=function(e,t){try{p(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){p(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!Ee[e])if(Re||De)try{at(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},ut=function(e){var t=void 0,n=void 0;if(Me)e="<remove></remove>"+e;else{var r=m(e,/^[\r\n\t ]+/);n=r&&r[0]}var s=ie?ie.createHTML(e):e;if(Xe===Ye)try{t=(new Y).parseFromString(s,"text/html")}catch(e){}if(!t||!t.documentElement){t=ae.createDocument(Xe,"template",null);try{t.documentElement.innerHTML=Ke?"":s}catch(e){}}var o=t.body||t.documentElement;return e&&n&&o.insertBefore(i.createTextNode(n),o.childNodes[0]||null),Xe===Ye?de.call(t,Oe?"html":"body")[0]:Oe?t.documentElement:o},dt=function(e){return ce.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT,null,!1)},lt=function(e){return!(e instanceof Q||e instanceof V||"string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof S&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI&&"function"==typeof e.insertBefore)},ht=function(e){return"object"===(void 0===c?"undefined":q(c))?e instanceof c:e&&"object"===(void 0===e?"undefined":q(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},ft=function(e,t,r){fe[e]&&h(fe[e],(function(e){e.call(n,t,r,Ze)}))},pt=function(e){var t=void 0;if(ft("beforeSanitizeElements",e,null),lt(e))return at(e),!0;if(m(e.nodeName,/[\u0080-\uFFFF]/))return at(e),!0;var r=g(e.nodeName);if(ft("uponSanitizeElement",e,{tagName:r,allowedTags:we}),!ht(e.firstElementChild)&&(!ht(e.content)||!ht(e.content.firstElementChild))&&b(/<[/\w]/g,e.innerHTML)&&b(/<[/\w]/g,e.textContent))return at(e),!0;if("select"===r&&b(/<template/i,e.innerHTML))return at(e),!0;if(!we[r]||Ae[r]){if(Ue&&!Be[r]){var i=ne(e)||e.parentNode,s=te(e)||e.childNodes;if(s&&i)for(var o=s.length-1;o>=0;--o)i.insertBefore(Z(s[o],!0),ee(e))}return at(e),!0}return e instanceof u&&!ot(e)?(at(e),!0):"noscript"!==r&&"noembed"!==r||!b(/<\/no(script|embed)/i,e.innerHTML)?(Ie&&3===e.nodeType&&(t=e.textContent,t=v(t,pe," "),t=v(t,ge," "),e.textContent!==t&&(p(n.removed,{element:e.cloneNode()}),e.textContent=t)),ft("afterSanitizeElements",e,null),!1):(at(e),!0)},gt=function(e,t,n){if(Pe&&("id"===t||"name"===t)&&(n in i||n in et))return!1;if(Te&&!Ne[t]&&b(me,t));else if(je&&b(ve,t));else{if(!Ee[t]||Ne[t])return!1;if(We[t]);else if(b(be,v(n,ye,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==_(n,"data:")||!qe[e])if(Ce&&!b(_e,v(n,ye,"")));else if(n)return!1}return!0},mt=function(e){var t=void 0,r=void 0,i=void 0,s=void 0;ft("beforeSanitizeAttributes",e,null);var o=e.attributes;if(o){var a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ee};for(s=o.length;s--;){var c=t=o[s],u=c.name,d=c.namespaceURI;if(r=y(t.value),i=g(u),a.attrName=i,a.attrValue=r,a.keepAttr=!0,a.forceKeepAttr=void 0,ft("uponSanitizeAttribute",e,a),r=a.attrValue,!a.forceKeepAttr&&(ct(u,e),a.keepAttr))if(b(/\/>/i,r))ct(u,e);else{Ie&&(r=v(r,pe," "),r=v(r,ge," "));var l=e.nodeName.toLowerCase();if(gt(l,i,r))try{d?e.setAttributeNS(d,u,r):e.setAttribute(u,r),f(n.removed)}catch(e){}}}ft("afterSanitizeAttributes",e,null)}},vt=function e(t){var n=void 0,r=dt(t);for(ft("beforeSanitizeShadowDOM",t,null);n=r.nextNode();)ft("uponSanitizeShadowNode",n,null),pt(n)||(n.content instanceof o&&e(n.content),mt(n));ft("afterSanitizeShadowDOM",t,null)};return n.sanitize=function(e,i){var s=void 0,a=void 0,u=void 0,d=void 0,l=void 0;if((Ke=!e)&&(e="\x3c!--\x3e"),"string"!=typeof e&&!ht(e)){if("function"!=typeof e.toString)throw w("toString is not a function");if("string"!=typeof(e=e.toString()))throw w("dirty is not a string, aborting")}if(!n.isSupported){if("object"===q(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof e)return t.toStaticHTML(e);if(ht(e))return t.toStaticHTML(e.outerHTML)}return e}if(ke||tt(i),n.removed=[],"string"==typeof e&&($e=!1),$e);else if(e instanceof c)1===(a=(s=ut("\x3c!----\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===a.nodeName||"HTML"===a.nodeName?s=a:s.appendChild(a);else{if(!Re&&!Ie&&!Oe&&-1===e.indexOf("<"))return ie&&Le?ie.createHTML(e):e;if(!(s=ut(e)))return Re?null:se}s&&Me&&at(s.firstChild);for(var h=dt($e?e:s);u=h.nextNode();)3===u.nodeType&&u===d||pt(u)||(u.content instanceof o&&vt(u.content),mt(u),d=u);if(d=null,$e)return e;if(Re){if(De)for(l=ue.call(s.ownerDocument);s.firstChild;)l.appendChild(s.firstChild);else l=s;return Fe&&(l=le.call(r,l,!0)),l}var f=Oe?s.outerHTML:s.innerHTML;return Ie&&(f=v(f,pe," "),f=v(f,ge," ")),ie&&Le?ie.createHTML(f):f},n.setConfig=function(e){tt(e),ke=!0},n.clearConfig=function(){Ze=null,ke=!1},n.isValidAttribute=function(e,t,n){Ze||tt({});var r=g(e),i=g(t);return gt(r,i,n)},n.addHook=function(e,t){"function"==typeof t&&(fe[e]=fe[e]||[],p(fe[e],t))},n.removeHook=function(e){fe[e]&&f(fe[e])},n.removeHooks=function(e){fe[e]&&(fe[e]=[])},n.removeAllHooks=function(){fe={}},n}()}()},6755:function(e){e.exports=function(){"use strict";var e=/^(b|B)$/,t={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},n={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]},r={floor:Math.floor,ceil:Math.ceil};function i(i){var s,o,a,c,u,d,l,h,f,p,g,m,v,_,y,b,w,S,E,x,A,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=[],T=0;if(isNaN(i))throw new TypeError("Invalid number");if(a=!0===N.bits,y=!0===N.unix,m=!0===N.pad,o=N.base||2,v=void 0!==N.round?N.round:y?1:2,l=void 0!==N.locale?N.locale:"",h=N.localeOptions||{},b=void 0!==N.separator?N.separator:"",w=void 0!==N.spacer?N.spacer:y?"":" ",E=N.symbols||{},S=2===o&&N.standard||"jedec",g=N.output||"string",u=!0===N.fullform,d=N.fullforms instanceof Array?N.fullforms:[],s=void 0!==N.exponent?N.exponent:-1,x=r[N.roundingMethod]||Math.round,f=(p=Number(i))<0,c=o>2?1e3:1024,A=!1===isNaN(N.precision)?parseInt(N.precision,10):0,f&&(p=-p),(-1===s||isNaN(s))&&(s=Math.floor(Math.log(p)/Math.log(c)))<0&&(s=0),s>8&&(A>0&&(A+=8-s),s=8),"exponent"===g)return s;if(0===p)j[0]=0,_=j[1]=y?"":t[S][a?"bits":"bytes"][s];else{T=p/(2===o?Math.pow(2,10*s):Math.pow(1e3,s)),a&&(T*=8)>=c&&s<8&&(T/=c,s++);var C=Math.pow(10,s>0?v:0);j[0]=x(T*C)/C,j[0]===c&&s<8&&void 0===N.exponent&&(j[0]=1,s++),_=j[1]=10===o&&1===s?a?"kb":"kB":t[S][a?"bits":"bytes"][s],y&&(j[1]="jedec"===S?j[1].charAt(0):s>0?j[1].replace(/B$/,""):j[1],e.test(j[1])&&(j[0]=Math.floor(j[0]),j[1]=""))}if(f&&(j[0]=-j[0]),A>0&&(j[0]=j[0].toPrecision(A)),j[1]=E[j[1]]||j[1],!0===l?j[0]=j[0].toLocaleString():l.length>0?j[0]=j[0].toLocaleString(l,h):b.length>0&&(j[0]=j[0].toString().replace(".",b)),m&&!1===Number.isInteger(j[0])&&v>0){var I=b||".",O=j[0].toString().split(I),k=O[1]||"",M=k.length,R=v-M;j[0]="".concat(O[0]).concat(I).concat(k.padEnd(M+R,"0"))}return u&&(j[1]=d[s]?d[s]:n[S][s]+(a?"bit":"byte")+(1===j[0]?"":"s")),"array"===g?j:"object"===g?{value:j[0],symbol:j[1],exponent:s,unit:_}:j.join(w)}return i.partial=function(e){return function(t){return i(t,e)}},i}()},5705:(e,t,n)=>{"use strict";var r,i,s=n.g.MutationObserver||n.g.WebKitMutationObserver;if(s){var o=0,a=new s(l),c=n.g.document.createTextNode("");a.observe(c,{characterData:!0}),r=function(){c.data=o=++o%2}}else if(n.g.setImmediate||void 0===n.g.MessageChannel)r="document"in n.g&&"onreadystatechange"in n.g.document.createElement("script")?function(){var e=n.g.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},n.g.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var u=new n.g.MessageChannel;u.port1.onmessage=l,r=function(){u.port2.postMessage(0)}}var d=[];function l(){var e,t;i=!0;for(var n=d.length;n;){for(t=d,d=[],e=-1;++e<n;)t[e]();n=d.length}i=!1}e.exports=function(e){1!==d.push(e)||i||r()}},2353:function(e,t){!function(n,r){var i=Array.prototype,s=Object.prototype,o=i.slice,a=s.hasOwnProperty,c=i.forEach,u={},d={forEach:function(e,t,n){var r,i,s;if(null!==e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e)===u)return}else for(s in e)if(a.call(e,s)&&t.call(n,e[s],s,e)===u)return},extend:function(e){return this.forEach(o.call(arguments,1),(function(t){for(var n in t)e[n]=t[n]})),e}},l=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=d.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return l.PF.compile(e||"nplurals=2; plural=(n != 1);")}function f(e,t){this._key=e,this._i18n=t}l.context_delimiter=String.fromCharCode(4),d.extend(f.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?l.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),d.extend(l.prototype,{translate:function(e){return new f(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,r,r,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,r,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,r,t)},ngettext:function(e,t,n){return this.dcnpgettext.call(this,r,r,e,t,n)},dngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,r,t,n,i)},dcngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,r,t,n,i)},pgettext:function(e,t){return this.dcnpgettext.call(this,r,e,t)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,t,n,i){return this.dcnpgettext.call(this,r,e,t,n,i)},dnpgettext:function(e,t,n,r,i){return this.dcnpgettext.call(this,e,t,n,r,i)},dcnpgettext:function(e,t,n,r,i){var s;if(r=r||n,e=e||this._textdomain,!this.options)return(s=new l).dcnpgettext.call(s,void 0,void 0,n,r,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");var o,a,c,u=t?t+l.context_delimiter+n:n,d=this.options.locale_data,f=d[e],p=(d.messages||this.defaults.locale_data.messages)[""],g=f[""].plural_forms||f[""]["Plural-Forms"]||f[""]["plural-forms"]||p.plural_forms||p["Plural-Forms"]||p["plural-forms"];if(void 0===i)c=0;else{if("number"!=typeof i&&(i=parseInt(i,10),isNaN(i)))throw new Error("The number that was passed in is not a number.");c=h(g)(i)}if(!f)throw new Error("No domain named `"+e+"` could be found.");return!(o=f[u])||c>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(u,e),a=[n,r],!0===this.options.debug&&console.log(a[h(g)(i)]),a[h()(i)]):(a=o[c])||(a=[n,r])[h()(i)]}});var p,g=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var i,s,o,a,c,u,d,l=1,h=n.length,f="",p=[];for(s=0;s<h;s++)if("string"===(f=e(n[s])))p.push(n[s]);else if("array"===f){if((a=n[s])[2])for(i=r[l],o=0;o<a[2].length;o++){if(!i.hasOwnProperty(a[2][o]))throw g('[sprintf] property "%s" does not exist',a[2][o]);i=i[a[2][o]]}else i=a[1]?r[a[1]]:r[l++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw g("[sprintf] expecting number but found %s",e(i));switch(null==i&&(i=""),a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,u=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",d=a[6]-String(i).length,c=a[6]?t(u,d):"",p.push(a[5]?i+c:c+i)}return p.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){i|=1;var s=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(s.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))s.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";s.push(a[1])}n[2]=s}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}(),m=function(e,t){return t.unshift(e),g.apply(null,t)};l.parse_plural=function(e,t){return e=e.replace(/n/g,t),l.parse_expression(e)},l.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?m(e,[].slice.call(t)):g.apply(this,[].slice.call(arguments))},l.prototype.sprintf=function(){return l.sprintf.apply(this,arguments)},(l.PF={}).parse=function(e){var t=l.PF.extractPluralExpr(e);return l.PF.parser.parse.call(l.PF.parser,t)},l.PF.compile=function(e){var t=l.PF.parse(e);return function(e){return!0===(n=l.PF.interpreter(t)(e))?1:n||0;var n}},l.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return l.PF.interpreter(e.expr)(t);case"TERNARY":return l.PF.interpreter(e.expr)(t)?l.PF.interpreter(e.truthy)(t):l.PF.interpreter(e.falsey)(t);case"OR":return l.PF.interpreter(e.left)(t)||l.PF.interpreter(e.right)(t);case"AND":return l.PF.interpreter(e.left)(t)&&l.PF.interpreter(e.right)(t);case"LT":return l.PF.interpreter(e.left)(t)<l.PF.interpreter(e.right)(t);case"GT":return l.PF.interpreter(e.left)(t)>l.PF.interpreter(e.right)(t);case"LTE":return l.PF.interpreter(e.left)(t)<=l.PF.interpreter(e.right)(t);case"GTE":return l.PF.interpreter(e.left)(t)>=l.PF.interpreter(e.right)(t);case"EQ":return l.PF.interpreter(e.left)(t)==l.PF.interpreter(e.right)(t);case"NEQ":return l.PF.interpreter(e.left)(t)!=l.PF.interpreter(e.right)(t);case"MOD":return l.PF.interpreter(e.left)(t)%l.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},l.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,n=/nplurals\=(\d+);/,r=e.match(n);if(!(r.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(r[1],!((t=(e=e.replace(n,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},l.PF.parser=((p={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,n,r,i,s,o){var a=s.length-1;switch(i){case 1:return{type:"GROUP",expr:s[a-1]};case 2:this.$={type:"TERNARY",expr:s[a-4],truthy:s[a-2],falsey:s[a]};break;case 3:this.$={type:"OR",left:s[a-2],right:s[a]};break;case 4:this.$={type:"AND",left:s[a-2],right:s[a]};break;case 5:this.$={type:"LT",left:s[a-2],right:s[a]};break;case 6:this.$={type:"LTE",left:s[a-2],right:s[a]};break;case 7:this.$={type:"GT",left:s[a-2],right:s[a]};break;case 8:this.$={type:"GTE",left:s[a-2],right:s[a]};break;case 9:this.$={type:"NEQ",left:s[a-2],right:s[a]};break;case 10:this.$={type:"EQ",left:s[a-2],right:s[a]};break;case 11:this.$={type:"MOD",left:s[a-2],right:s[a]};break;case 12:this.$={type:"GROUP",expr:s[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],r=[null],i=[],s=this.table,o="",a=0,c=0,u=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;function l(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}i.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,f,p,g,m,v,_,y,b,w={};;){if(p=n[n.length-1],this.defaultActions[p]?g=this.defaultActions[p]:(null==h&&(h=l()),g=s[p]&&s[p][h]),void 0===g||!g.length||!g[0]){if(!u){for(v in b=[],s[p])this.terminals_[v]&&v>2&&b.push("'"+this.terminals_[v]+"'");var S="";S=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:b})}if(3==u){if(1==h)throw new Error(S||"Parsing halted.");c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,h=l()}for(;!(2..toString()in s[p]);){if(0==p)throw new Error(S||"Parsing halted.");1,n.length=n.length-2,r.length=r.length-1,i.length=i.length-1,p=n[n.length-1]}f=h,h=2,g=s[p=n[n.length-1]]&&s[p][2],u=3}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+h);switch(g[0]){case 1:n.push(h),r.push(this.lexer.yytext),i.push(this.lexer.yylloc),n.push(g[1]),h=null,f?(h=f,f=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,u>0&&u--);break;case 2:if(_=this.productions_[g[1]][1],w.$=r[r.length-_],w._$={first_line:i[i.length-(_||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(_||1)].first_column,last_column:i[i.length-1].last_column},void 0!==(m=this.performAction.call(w,o,c,a,this.yy,g[1],r,i)))return m;_&&(n=n.slice(0,-1*_*2),r=r.slice(0,-1*_),i=i.slice(0,-1*_)),n.push(this.productions_[g[1]][0]),r.push(w.$),i.push(w._$),y=s[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}}).lexer={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),r=0;r<n.length;r++)if(e=this._input.match(this.rules[n[r]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,n[r],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,n,r){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}},p),e.exports&&(t=e.exports=l),t.Jed=l}()},3389:(e,t,n)=>{"use strict";var r=n(5705);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}var o=p((function(){t(i,r)}));"error"===o.status&&r(o.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?l(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){s.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:s.resolve(new this(i),e)},u.reject=function(e){var t=new this(i);return s.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,u=new this(i);++c<n;)d(e[c],c);return u;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(u,o))}),(function(e){r||(r=!0,s.reject(u,e))}))}},u.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var r,o=-1,a=new this(i);++o<t;)r=e[o],this.resolve(r).then((function(e){n||(n=!0,s.resolve(a,e))}),(function(e){n||(n=!0,s.reject(a,e))}));return a}},9236:(e,t,n)=>{"use strict";"function"!=typeof n.g.Promise&&(n.g.Promise=n(3389))},3245:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t=/^~~local_forage_type~([^~]+)~/,n="__lfsc__:".length,r=n+"arbf".length,i=Object.prototype.toString;function s(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var r=new ArrayBuffer(t),i=new Uint8Array(r),s=0,o=0;s<n;s+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+1]),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|u>>2,i[o++]=(3&u)<<6|63&d}return r}function o(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[r]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[r])<<4|t[r+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[r+1])<<2|t[r+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function a(e){var t,n;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var r=e instanceof Date?new Date(e):e.constructor();try{for(var i=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(Object.keys(e)),s=i.next();!s.done;s=i.next()){var o=s.value;Object.prototype.hasOwnProperty.call(e,o)&&(e.isActiveClone=null,r[o]=a(e[o]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function c(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function l(e,t){var n=this;if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(c(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var f={bufferToString:o,deserialize:function(e){if("__lfsc__:"!==e.substring(0,n))return JSON.parse(e);var i,o=e.substring(r),a=e.substring(n,r);if("blob"===a&&t.test(o)){var c=o.match(t);i=c[1],o=o.substring(c[0].length)}var u=s(o);switch(a){case"arbf":return u;case"blob":return function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}([u],{type:i});case"si08":return new Int8Array(u);case"ui08":return new Uint8Array(u);case"uic8":return new Uint8ClampedArray(u);case"si16":return new Int16Array(u);case"ur16":return new Uint16Array(u);case"si32":return new Int32Array(u);case"ui32":return new Uint32Array(u);case"fl32":return new Float32Array(u);case"fl64":return new Float64Array(u);default:throw new Error("Unkown type: "+a)}},serialize:function(e,t){var n="";if(e&&(n=i.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===i.call(e.buffer))){var r=void 0,s="__lfsc__:";e instanceof ArrayBuffer?(r=e,s+="arbf"):(r=e.buffer,"[object Int8Array]"===n?s+="si08":"[object Uint8Array]"===n?s+="ui08":"[object Uint8ClampedArray]"===n?s+="uic8":"[object Int16Array]"===n?s+="si16":"[object Uint16Array]"===n?s+="ur16":"[object Int32Array]"===n?s+="si32":"[object Uint32Array]"===n?s+="ui32":"[object Float32Array]"===n?s+="fl32":"[object Float64Array]"===n?s+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(s+o(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n="~~local_forage_type~"+e.type+"~"+o(this.result);t("__lfsc__:blob"+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},stringToBuffer:s},p={},g=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return p[t]||(p[t]=new e(t)),p[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete p[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();e._support=!0,e._driver="localforage-driver-memory",e._initStorage=function(e){var t=e?a(e):{},n=c(t,this._defaultConfig),r=g.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=f,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=r,Promise.resolve()},e.clear=function(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return u(n,e),n},e.dropInstance=function(e,t){var n=l.apply(this,arguments),r=n.promise,i=n.callback;return u(r.then((function(e){g.resolve(e).drop()})),i),r},e.getItem=function(e,t){var n=this;e=h(e);var r=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return u(r,t),r},e.iterate=function(e,t){var n=this,r=this.ready().then((function(){for(var t=n._dbInfo.mStore,r=t.keys(),i=0;i<r.length;i++){var s=t.get(r[i]);if(s&&(s=n._dbInfo.serializer.deserialize(s)),void 0!==(s=e(s,r[i],i+1)))return s}}));return u(r,t),r},e.key=function(e,t){var n=this,r=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return u(r,t),r},e.keys=function(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return u(n,e),n},e.length=function(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t},e.removeItem=function(e,t){var n=this;e=h(e);var r=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return u(r,t),r},e.setItem=function(e,t,n){var r=this;e=h(e);var i=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(i,s){r._dbInfo.serializer.serialize(t,(function(t,o){if(o)s(o);else try{r._dbInfo.mStore.set(e,t),i(n)}catch(e){s(e)}}))}))}));return u(i,n),i},Object.defineProperty(e,"__esModule",{value:!0})}(t)},1459:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function r(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,n,r){function i(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var s=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),n=i(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];s.push(r(t(c),n(c)))}}else for(var u in e)e.hasOwnProperty(u)&&s.push(r(u,e[u]));return s}function s(e,t,n,s){var o=this,a=o.ready().then((function(){return new Promise((function(r,s){var a,c=o._dbInfo,u=c.db.transaction(c.storeName,"readwrite"),d=u.objectStore(c.storeName);function l(e){var t=e.target||this;a=t.error||t.transaction.error,s(a)}u.oncomplete=function(){r(e)},u.onabort=u.onerror=function(e){s(a||e.target)},i(e,t,n,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=l}))}))}));return r(a,s),a}function o(e,t,s,o){var a=this,c=new Promise((function(r,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var u="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=i(e,t,s,(function(e,t){return new Promise((function(r,i){n.serialize(t,(function(t,n){n?i(n):a.executeSql(u,[e,t],(function(){r()}),(function(e,t){i(t)}))}))}))}));Promise.all(d).then((function(){r(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return r(c,o),c}function a(e,t,n,s){var o=this,a=i(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return r(c,s),c}function c(e,t,n,r){var i=this,c=i.driver();return c===i.INDEXEDDB?s.call(i,e,t,n,r):c===i.WEBSQL?o.call(i,e,t,n,r):a.call(i,e,t,n,r)}function u(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return s.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=u(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=u,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(9483))},7715:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(8106)),i=u(n(8902)),s=u(n(4942)),o=u(n(6803)),a=u(n(6593));t.default=function(e,t){var n=(0,c.getStorage)(),u=!(!n||!n[t]),d=u?n[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},l=d.clear.bind(d),h=d.get.bind(d),f=d.remove.bind(d),p=d.set.bind(d);return{_driver:e,_support:u,_initStorage:function(){return a.default.resolve()},clear:function(e){var t=this;return(0,o.default)(s.default.mark((function n(){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l(),e&&e();case 2:case"end":return t.stop()}}),n,t)})))()},iterate:function(e,t){var n=this;return(0,o.default)(s.default.mark((function r(){var o;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,c.usePromise)(h,null);case 2:o=n.sent,(0,i.default)(o).forEach((function(t,n){return e(o[t],t,n)})),t&&t();case 6:case"end":return n.stop()}}),r,n)})))()},getItem:function(e,t){var n=this;return(0,o.default)(s.default.mark((function r(){var i;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,c.usePromise)(h,e);case 3:return i=n.sent,i=void 0===(i="string"==typeof e?i[e]:i)?null:i,t&&t(null,i),n.abrupt("return",i);case 10:throw n.prev=10,n.t0=n.catch(0),t&&t(n.t0),n.t0;case 14:case"end":return n.stop()}}),r,n,[[0,10]])})))()},key:function(e,t){var n=this;return(0,o.default)(s.default.mark((function r(){var o,a;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,c.usePromise)(h,null);case 2:return o=n.sent,a=(0,i.default)(o)[e],t&&t(a),n.abrupt("return",a);case 6:case"end":return n.stop()}}),r,n)})))()},keys:function(e){var t=this;return(0,o.default)(s.default.mark((function n(){var r,o;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.usePromise)(h,null);case 2:return r=t.sent,o=(0,i.default)(r),e&&e(o),t.abrupt("return",o);case 6:case"end":return t.stop()}}),n,t)})))()},length:function(e){var t=this;return(0,o.default)(s.default.mark((function n(){var r,o;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.usePromise)(h,null);case 2:return r=t.sent,o=(0,i.default)(r).length,e&&e(o),t.abrupt("return",o);case 6:case"end":return t.stop()}}),n,t)})))()},removeItem:function(e,t){var n=this;return(0,o.default)(s.default.mark((function r(){return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,c.usePromise)(f,e);case 2:t&&t();case 3:case"end":return n.stop()}}),r,n)})))()},setItem:function(e,t,n){var i=this;return(0,o.default)(s.default.mark((function o(){return s.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,c.usePromise)(p,(0,r.default)({},e,t));case 2:n&&n();case 3:case"end":return i.stop()}}),o,i)})))()}}};var c=n(4639);function u(e){return e&&e.__esModule?e:{default:e}}},7002:(e,t,n)=>{"use strict";var r,i=(r=n(7715))&&r.__esModule?r:{default:r};t.Z=(0,i.default)("webExtensionLocalStorage","local")},1063:(e,t,n)=>{"use strict";var r,i=(r=n(7715))&&r.__esModule?r:{default:r};t.Z=(0,i.default)("webExtensionSyncStorage","sync")},4639:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=(r=n(6593))&&r.__esModule?r:{default:r};function s(){return window.browser&&browser.storage||window.chrome&&chrome.storage}t.getStorage=s,t.usePromise=function(e,t){return function(){var e=s();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}()?e(t):new i.default((function(n){e(t,(function(){n.apply(void 0,arguments)}))}))}},9483:(e,t,n)=>{e.exports=function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,(function(e){return i(t[o][1][e]||e)}),u,u.exports,e,t,n,r)}return n[o].exports}for(var s=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,o=new i(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,n=function(){c.port2.postMessage(0)}}var u=[];function d(){var e,t;r=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}r=!1}t.exports=function(e){1!==u.push(e)||r||n()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}var o=p((function(){t(i,r)}));"error"===o.status&&r(o.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?l(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){s.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:s.resolve(new this(i),e)},u.reject=function(e){var t=new this(i);return s.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,u=new this(i);++c<n;)d(e[c],c);return u;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(u,o))}),(function(e){r||(r=!0,s.reject(u,e))}))}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n,r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=-1,c=new this(i);++a<r;)n=e[a],t.resolve(n).then((function(e){o||(o=!0,s.resolve(c,e))}),(function(e){o||(o=!0,s.reject(c,e))}));return c}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function s(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function u(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var l="local-forage-detect-blob-support",h=void 0,f={},p=Object.prototype.toString,g="readonly",m="readwrite";function v(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function _(e){return"boolean"==typeof h?o.resolve(h):function(e){return new o((function(t){var n=e.transaction(l,m),r=s([""]);n.objectStore(l).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return h=e}))}function y(e){var t=f[e.name],n={};n.promise=new o((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function b(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function w(e,t){var n=f[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function S(e,t){return new o((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);y(e),e.db.close()}var s=[e.name];t&&s.push(e.version);var o=i.open.apply(i,s);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(l)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},n(t),b(e)}}))}function E(e){return S(e,!1)}function x(e){return S(e,!0)}function A(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function N(e){return s([v(atob(e.data))],{type:e.type})}function j(e){return e&&e.__local_forage_encoded_blob}function T(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function C(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return o.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),x(e)})).then((function(){return function(e){y(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,E(e).then((function(t){return e.db=t,A(e)?x(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw w(e,t),t}))}(e).then((function(){C(e,t,n,r-1)}))})).catch(n);n(i)}}var I={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=f[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=T);var s=[];function a(){return o.resolve()}for(var c=0;c<i.forages.length;c++){var u=i.forages[c];u!==t&&s.push(u._initReady().catch(a))}var d=i.forages.slice(0);return o.all(s).then((function(){return n.db=i.db,E(n)})).then((function(e){return n.db=e,A(n,t._defaultConfig.version)?x(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<d.length;r++){var s=d[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){C(n._dbInfo,g,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;j(r)&&(r=N(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=new o((function(t,r){n.ready().then((function(){C(n._dbInfo,g,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),j(e)&&(e=N(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=u(e);var i=new o((function(n,i){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===p.call(t)?_(s.db).then((function(e){return e?t:(n=t,new o((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){C(r._dbInfo,m,(function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return a(i,n),i},removeItem:function(e,t){var n=this;e=u(e);var r=new o((function(t,r){n.ready().then((function(){C(n._dbInfo,m,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(o.error)},s.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){C(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){C(t._dbInfo,g,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){e<0?t(null):n.ready().then((function(){C(n._dbInfo,g,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){C(t._dbInfo,g,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var t=s.result;t?(o.push(t.key),t.continue()):e(o)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;if(e.name){var c=e.name===n.name&&s._dbInfo.db?o.resolve(s._dbInfo.db):E(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?c.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;y(e);var r=f[e.name],s=r.forages;t.close();for(var a=0;a<s.length;a++){var c=s[a];c._dbInfo.db=null,c._dbInfo.version=n}return new o((function(t,r){var s=i.open(e.name,n);s.onerror=function(e){s.result.close(),r(e)},s.onupgradeneeded=function(){s.result.deleteObjectStore(e.storeName)},s.onsuccess=function(){var e=s.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<s.length;t++){var n=s[t];n._dbInfo.db=e,b(n._dbInfo)}})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}})):c.then((function(t){y(e);var n=f[e.name],r=n.forages;t.close();for(var s=0;s<r.length;s++)r[s]._dbInfo.db=null;return new o((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)b(r[t]._dbInfo)})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}))}else r=o.reject("Invalid arguments");return a(r,t),r}};var O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=/^~~local_forage_type~([^~]+)~/,M="__lfsc__:",R=M.length,D="arbf",F="blob",L="si08",P="ui08",U="uic8",$="si16",z="si32",B="ur16",H="ui32",q="fl32",G="fl64",W=R+D.length,J=Object.prototype.toString;function Q(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),d=new Uint8Array(u);for(t=0;t<a;t+=4)n=O.indexOf(e[t]),r=O.indexOf(e[t+1]),i=O.indexOf(e[t+2]),s=O.indexOf(e[t+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&s;return u}function V(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=O[n[t]>>2],r+=O[(3&n[t])<<4|n[t+1]>>4],r+=O[(15&n[t+1])<<2|n[t+2]>>6],r+=O[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var Y={serialize:function(e,t){var n="";if(e&&(n=J.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===J.call(e.buffer))){var r,i=M;e instanceof ArrayBuffer?(r=e,i+=D):(r=e.buffer,"[object Int8Array]"===n?i+=L:"[object Uint8Array]"===n?i+=P:"[object Uint8ClampedArray]"===n?i+=U:"[object Int16Array]"===n?i+=$:"[object Uint16Array]"===n?i+=B:"[object Int32Array]"===n?i+=z:"[object Uint32Array]"===n?i+=H:"[object Float32Array]"===n?i+=q:"[object Float64Array]"===n?i+=G:t(new Error("Failed to get type for BinaryArray"))),t(i+V(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+V(this.result);t("__lfsc__:blob"+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,R)!==M)return JSON.parse(e);var t,n=e.substring(W),r=e.substring(R,W);if(r===F&&k.test(n)){var i=n.match(k);t=i[1],n=n.substring(i[0].length)}var o=Q(n);switch(r){case D:return o;case F:return s([o],{type:t});case L:return new Int8Array(o);case P:return new Uint8Array(o);case U:return new Uint8ClampedArray(o);case $:return new Int16Array(o);case B:return new Uint16Array(o);case z:return new Int32Array(o);case H:return new Uint32Array(o);case q:return new Float32Array(o);case G:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}},stringToBuffer:Q,bufferToString:V};function X(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function K(e,t,n,r,i,s){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?s(e,o):X(e,t,(function(){e.executeSql(n,r,i,s)}),s)}),s):s(e,o)}),s)}function Z(e,t,n,r){var i=this;e=u(e);var s=new o((function(s,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,u){u?o(u):c.db.transaction((function(n){K(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){s(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(Z.apply(i,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return a(s,n),s}function ee(e){return new o((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var te={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new o((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){X(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=Y,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){K(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var c=s.item(a),u=c.value;if(u&&(u=i.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){K(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){return Z.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=u(e);var r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){K(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){K(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){K(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){K(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){K(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return a(r=e.name?new o((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(ee(r))})).then((function(e){return new o((function(t,n){e.db.transaction((function(r){function i(e){return new o((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var s=[],a=0,c=e.storeNames.length;a<c;a++)s.push(i(e.storeNames[a]));o.all(s).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):o.reject("Invalid arguments"),t),r}};function ne(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function re(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var ie={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=ne(e,this._defaultConfig),re()?(this._dbInfo=t,t.serializer=Y,o.resolve()):o.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(i),o++)))return u}}}));return a(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=u(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new o((function(i,s){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return a(i,n),i},removeItem:function(e,t){var n=this;e=u(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return a(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return a(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r}));return a(n,e),n},dropInstance:function(e,t){if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return a(r=e.name?new o((function(t){e.storeName?t(ne(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):o.reject("Invalid arguments"),t),r}},se=function(e,t){for(var n=e.length,r=0;r<n;){if((i=e[r])===(s=t)||"number"==typeof i&&"number"==typeof s&&isNaN(i)&&isNaN(s))return!0;r++}var i,s;return!1},oe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ae={},ce={},ue={INDEXEDDB:I,WEBSQL:te,LOCALSTORAGE:ie},de=[ue.INDEXEDDB._driver,ue.WEBSQL._driver,ue.LOCALSTORAGE._driver],le=["dropInstance"],he=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(le),fe={description:"",driver:de.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function pe(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ge(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(oe(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var me=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ue)if(ue.hasOwnProperty(n)){var r=ue[n],i=r._driver;this[n]=i,ae[i]||this.defineDriver(r)}this._defaultConfig=ge({},fe),this._config=ge({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new o((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var s=he.concat("_initStorage"),c=0,u=s.length;c<u;c++){var d=s[c];if((!se(le,d)||e[d])&&"function"!=typeof e[d])return void n(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=o.reject(t);return a(n,arguments[arguments.length-1]),n}},n=0,r=le.length;n<r;n++){var i=le[n];e[i]||(e[i]=t(i))}}();var l=function(n){ae[r]&&console.info("Redefining LocalForage driver: "+r),ae[r]=e,ce[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(l,n):l(!!e._support):l(!0)}catch(e){n(e)}}));return c(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=ae[e]?o.resolve(ae[e]):o.reject(new Error("Driver not found."));return c(r,t,n),r},e.prototype.getSerializer=function(e){var t=o.resolve(Y);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;oe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function a(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}var u=null!==this._driverSet?this._driverSet.catch((function(){return o.resolve()})):o.resolve();return this._driverSet=u.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(a).catch(n)}s();var c=new Error("No available storage method found.");return r._driverSet=o.reject(c),r._driverSet}()}}(i)}))})).catch((function(){s();var e=new Error("No available storage method found.");return r._driverSet=o.reject(e),r._driverSet})),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!ce[e]},e.prototype._extend=function(e){ge(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=he.length;e<t;e++)pe(this,he[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=me},{3:3}]},{},[4])(4)},1271:(e,t,n)=>{var r;!function(i){var s,o,a,c,u,d,l,h,f,p,g,m,v,_,y,b,w,S,E,x="sizzle"+1*new Date,A=i.document,N=0,j=0,T=he(),C=he(),I=he(),O=he(),k=function(e,t){return e===t&&(g=!0),0},M={}.hasOwnProperty,R=[],D=R.pop,F=R.push,L=R.push,P=R.slice,U=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},$="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",z="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",H="\\[[\\x20\\t\\r\\n\\f]*("+B+")(?:"+z+"*([*^$|!~]?=)"+z+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+z+"*\\]",q=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+H+")*)|.*)\\)|)",G=new RegExp(z+"+","g"),W=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),J=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),Q=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),V=new RegExp(z+"|>"),Y=new RegExp(q),X=new RegExp("^"+B+"$"),K={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+H),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+$+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,ne=/^[^{]+\{\s*\[native \w/,re=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ie=/[+~]/,se=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ue=function(){m()},de=xe((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{L.apply(R=P.call(A.childNodes),A.childNodes),R[A.childNodes.length].nodeType}catch(e){L={apply:R.length?function(e,t){F.apply(e,P.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function le(e,t,n,r){var i,s,a,c,u,l,f,p=t&&t.ownerDocument,g=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==g&&9!==g&&11!==g)return n;if(!r&&(m(t),t=t||v,y)){if(11!==g&&(u=re.exec(e)))if(i=u[1]){if(9===g){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(p&&(a=p.getElementById(i))&&E(t,a)&&a.id===i)return n.push(a),n}else{if(u[2])return L.apply(n,t.getElementsByTagName(e)),n;if((i=u[3])&&o.getElementsByClassName&&t.getElementsByClassName)return L.apply(n,t.getElementsByClassName(i)),n}if(o.qsa&&!O[e+" "]&&(!b||!b.test(e))&&(1!==g||"object"!==t.nodeName.toLowerCase())){if(f=e,p=t,1===g&&(V.test(e)||Q.test(e))){for((p=ie.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=x)),s=(l=d(e)).length;s--;)l[s]=(c?"#"+c:":scope")+" "+Ee(l[s]);f=l.join(",")}try{return L.apply(n,p.querySelectorAll(f)),n}catch(t){O(e,!0)}finally{c===x&&t.removeAttribute("id")}}}return h(e.replace(W,"$1"),t,n,r)}function he(){var e=[];return function t(n,r){return e.push(n+" ")>a.cacheLength&&delete t[e.shift()],t[n+" "]=r}}function fe(e){return e[x]=!0,e}function pe(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ge(e,t){for(var n=e.split("|"),r=n.length;r--;)a.attrHandle[n[r]]=t}function me(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function _e(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ye(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&de(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function be(e){return fe((function(t){return t=+t,fe((function(n,r){for(var i,s=e([],n.length,t),o=s.length;o--;)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(s in o=le.support={},u=le.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},m=le.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:A;return r!=v&&9===r.nodeType&&r.documentElement?(_=(v=r).documentElement,y=!u(v),A!=v&&(n=v.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",ue,!1):n.attachEvent&&n.attachEvent("onunload",ue)),o.scope=pe((function(e){return _.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.attributes=pe((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=pe((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=ne.test(v.getElementsByClassName),o.getById=pe((function(e){return _.appendChild(e).id=x,!v.getElementsByName||!v.getElementsByName(x).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(se,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(a.filter.ID=function(e){var t=e.replace(se,oe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,r,i,s=t.getElementById(e);if(s){if((n=s.getAttributeNode("id"))&&n.value===e)return[s];for(i=t.getElementsByName(e),r=0;s=i[r++];)if((n=s.getAttributeNode("id"))&&n.value===e)return[s]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){for(;n=s[i++];)1===n.nodeType&&r.push(n);return r}return s},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},w=[],b=[],(o.qsa=ne.test(v.querySelectorAll))&&(pe((function(e){var t;_.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&b.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||b.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+$+")"),e.querySelectorAll("[id~="+x+"-]").length||b.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||b.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll(":checked").length||b.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||b.push(".#.+[+~]"),e.querySelectorAll("\\\f"),b.push("[\\r\\n\\f]")})),pe((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&b.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&b.push(":enabled",":disabled"),_.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&b.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),b.push(",.*:")}))),(o.matchesSelector=ne.test(S=_.matches||_.webkitMatchesSelector||_.mozMatchesSelector||_.oMatchesSelector||_.msMatchesSelector))&&pe((function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",q)})),b=b.length&&new RegExp(b.join("|")),w=w.length&&new RegExp(w.join("|")),t=ne.test(_.compareDocumentPosition),E=t||ne.test(_.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return g=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===n?e==v||e.ownerDocument==A&&E(A,e)?-1:t==v||t.ownerDocument==A&&E(A,t)?1:p?U(p,e)-U(p,t):0:4&n?-1:1)}:function(e,t){if(e===t)return g=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,o=[e],a=[t];if(!i||!s)return e==v?-1:t==v?1:i?-1:s?1:p?U(p,e)-U(p,t):0;if(i===s)return me(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;o[r]===a[r];)r++;return r?me(o[r],a[r]):o[r]==A?-1:a[r]==A?1:0},v):v},le.matches=function(e,t){return le(e,null,null,t)},le.matchesSelector=function(e,t){if(m(e),o.matchesSelector&&y&&!O[t+" "]&&(!w||!w.test(t))&&(!b||!b.test(t)))try{var n=S.call(e,t);if(n||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){O(t,!0)}return le(t,v,null,[e]).length>0},le.contains=function(e,t){return(e.ownerDocument||e)!=v&&m(e),E(e,t)},le.attr=function(e,t){(e.ownerDocument||e)!=v&&m(e);var n=a.attrHandle[t.toLowerCase()],r=n&&M.call(a.attrHandle,t.toLowerCase())?n(e,t,!y):void 0;return void 0!==r?r:o.attributes||!y?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},le.escape=function(e){return(e+"").replace(ae,ce)},le.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},le.uniqueSort=function(e){var t,n=[],r=0,i=0;if(g=!o.detectDuplicates,p=!o.sortStable&&e.slice(0),e.sort(k),g){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return p=null,e},c=le.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=c(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=c(t);return n},(a=le.selectors={cacheLength:50,createPseudo:fe,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(se,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(se,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||le.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&le.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Y.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(se,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"("+z+"|$)"))&&T(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var i=le.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(G," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var u,d,l,h,f,p,g=s!==o?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),_=!c&&!a,y=!1;if(m){if(s){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;p=g="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?m.firstChild:m.lastChild],o&&_){for(y=(f=(u=(d=(l=(h=m)[x]||(h[x]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]||[])[0]===N&&u[1])&&u[2],h=f&&m.childNodes[f];h=++f&&h&&h[g]||(y=f=0)||p.pop();)if(1===h.nodeType&&++y&&h===t){d[e]=[N,f,y];break}}else if(_&&(y=f=(u=(d=(l=(h=t)[x]||(h[x]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]||[])[0]===N&&u[1]),!1===y)for(;(h=++f&&h&&h[g]||(y=f=0)||p.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++y||(_&&((d=(l=h[x]||(h[x]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]=[N,y]),h!==t)););return(y-=i)===r||y%r==0&&y/r>=0}}},PSEUDO:function(e,t){var n,r=a.pseudos[e]||a.setFilters[e.toLowerCase()]||le.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?fe((function(e,n){for(var i,s=r(e,t),o=s.length;o--;)e[i=U(e,s[o])]=!(n[i]=s[o])})):function(e){return r(e,0,n)}):r}},pseudos:{not:fe((function(e){var t=[],n=[],r=l(e.replace(W,"$1"));return r[x]?fe((function(e,t,n,i){for(var s,o=r(e,null,i,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,i,s){return t[0]=e,r(t,null,s,n),t[0]=null,!n.pop()}})),has:fe((function(e){return function(t){return le(e,t).length>0}})),contains:fe((function(e){return e=e.replace(se,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:fe((function(e){return X.test(e||"")||le.error("unsupported lang: "+e),e=e.replace(se,oe).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===_},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:be((function(){return[0]})),last:be((function(e,t){return[t-1]})),eq:be((function(e,t,n){return[n<0?n+t:n]})),even:be((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:be((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:be((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:be((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}}).pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[s]=ve(s);for(s in{submit:!0,reset:!0})a.pseudos[s]=_e(s);function Se(){}function Ee(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function xe(e,t,n){var r=t.dir,i=t.next,s=i||r,o=n&&"parentNode"===s,a=j++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var u,d,l,h=[N,a];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(d=(l=t[x]||(t[x]={}))[t.uniqueID]||(l[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((u=d[s])&&u[0]===N&&u[1]===a)return h[2]=u[2];if(d[s]=h,h[2]=e(t,n,c))return!0}return!1}}function Ae(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Ne(e,t,n,r,i){for(var s,o=[],a=0,c=e.length,u=null!=t;a<c;a++)(s=e[a])&&(n&&!n(s,r,i)||(o.push(s),u&&t.push(a)));return o}function je(e,t,n,r,i,s){return r&&!r[x]&&(r=je(r)),i&&!i[x]&&(i=je(i,s)),fe((function(s,o,a,c){var u,d,l,h=[],f=[],p=o.length,g=s||function(e,t,n){for(var r=0,i=t.length;r<i;r++)le(e,t[r],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!s&&t?g:Ne(g,h,e,a,c),v=n?i||(s?e:p||r)?[]:o:m;if(n&&n(m,v,a,c),r)for(u=Ne(v,f),r(u,[],a,c),d=u.length;d--;)(l=u[d])&&(v[f[d]]=!(m[f[d]]=l));if(s){if(i||e){if(i){for(u=[],d=v.length;d--;)(l=v[d])&&u.push(m[d]=l);i(null,v=[],u,c)}for(d=v.length;d--;)(l=v[d])&&(u=i?U(s,l):h[d])>-1&&(s[u]=!(o[u]=l))}}else v=Ne(v===o?v.splice(p,v.length):v),i?i(null,o,v,c):L.apply(o,v)}))}function Te(e){for(var t,n,r,i=e.length,s=a.relative[e[0].type],o=s||a.relative[" "],c=s?1:0,u=xe((function(e){return e===t}),o,!0),d=xe((function(e){return U(t,e)>-1}),o,!0),l=[function(e,n,r){var i=!s&&(r||n!==f)||((t=n).nodeType?u(e,n,r):d(e,n,r));return t=null,i}];c<i;c++)if(n=a.relative[e[c].type])l=[xe(Ae(l),n)];else{if((n=a.filter[e[c].type].apply(null,e[c].matches))[x]){for(r=++c;r<i&&!a.relative[e[r].type];r++);return je(c>1&&Ae(l),c>1&&Ee(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(W,"$1"),n,c<r&&Te(e.slice(c,r)),r<i&&Te(e=e.slice(r)),r<i&&Ee(e))}l.push(n)}return Ae(l)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,d=le.tokenize=function(e,t){var n,r,i,s,o,c,u,d=C[e+" "];if(d)return t?0:d.slice(0);for(o=e,c=[],u=a.preFilter;o;){for(s in n&&!(r=J.exec(o))||(r&&(o=o.slice(r[0].length)||o),c.push(i=[])),n=!1,(r=Q.exec(o))&&(n=r.shift(),i.push({value:n,type:r[0].replace(W," ")}),o=o.slice(n.length)),a.filter)!(r=K[s].exec(o))||u[s]&&!(r=u[s](r))||(n=r.shift(),i.push({value:n,type:s,matches:r}),o=o.slice(n.length));if(!n)break}return t?o.length:o?le.error(e):C(e,c).slice(0)},l=le.compile=function(e,t){var n,r=[],i=[],s=I[e+" "];if(!s){for(t||(t=d(e)),n=t.length;n--;)(s=Te(t[n]))[x]?r.push(s):i.push(s);(s=I(e,function(e,t){var n=t.length>0,r=e.length>0,i=function(i,s,o,c,u){var d,l,h,p=0,g="0",_=i&&[],b=[],w=f,S=i||r&&a.find.TAG("*",u),E=N+=null==w?1:Math.random()||.1,x=S.length;for(u&&(f=s==v||s||u);g!==x&&null!=(d=S[g]);g++){if(r&&d){for(l=0,s||d.ownerDocument==v||(m(d),o=!y);h=e[l++];)if(h(d,s||v,o)){c.push(d);break}u&&(N=E)}n&&((d=!h&&d)&&p--,i&&_.push(d))}if(p+=g,n&&g!==p){for(l=0;h=t[l++];)h(_,b,s,o);if(i){if(p>0)for(;g--;)_[g]||b[g]||(b[g]=D.call(c));b=Ne(b)}L.apply(c,b),u&&!i&&b.length>0&&p+t.length>1&&le.uniqueSort(c)}return u&&(N=E,f=w),_};return n?fe(i):i}(i,r))).selector=e}return s},h=le.select=function(e,t,n,r){var i,s,o,c,u,h="function"==typeof e&&e,f=!r&&d(e=h.selector||e);if(n=n||[],1===f.length){if((s=f[0]=f[0].slice(0)).length>2&&"ID"===(o=s[0]).type&&9===t.nodeType&&y&&a.relative[s[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(se,oe),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(s.shift().value.length)}for(i=K.needsContext.test(e)?0:s.length;i--&&(o=s[i],!a.relative[c=o.type]);)if((u=a.find[c])&&(r=u(o.matches[0].replace(se,oe),ie.test(s[0].type)&&we(t.parentNode)||t))){if(s.splice(i,1),!(e=r.length&&Ee(s)))return L.apply(n,r),n;break}}return(h||l(e,f))(r,t,!y,n,!t||ie.test(e)&&we(t.parentNode)||t),n},o.sortStable=x.split("").sort(k).join("")===x,o.detectDuplicates=!!g,m(),o.sortDetached=pe((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),pe((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ge("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&pe((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ge("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),pe((function(e){return null==e.getAttribute("disabled")}))||ge($,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}));var Ce=i.Sizzle;le.noConflict=function(){return i.Sizzle===le&&(i.Sizzle=Ce),le},void 0===(r=function(){return le}.call(t,n,t,e))||(e.exports=r)}(window)},7026:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},647:(e,t,n)=>{function r(e){this.options=e||{locator:{}}}function i(){this.cdata=!1}function s(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function o(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function a(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function c(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}r.prototype.parseFromString=function(e,t){var n=this.options,r=new l,s=n.domBuilder||new i,a=n.errorHandler,c=n.locator,d=n.xmlns||{},h=/\/x?html?$/.test(t),f=h?u.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return c&&s.setDocumentLocator(c),r.errorHandler=function(e,t,n){if(!e){if(t instanceof i)return t;e=t}var r={},s=e instanceof Function;function a(t){var i=e[t];!i&&s&&(i=2==e.length?function(n){e(t,n)}:e),r[t]=i&&function(e){i("[xmldom "+t+"]\t"+e+o(n))}||function(){}}return n=n||{},a("warning"),a("error"),a("fatalError"),r}(a,s,c),r.domBuilder=n.domBuilder||s,h&&(d[""]="http://www.w3.org/1999/xhtml"),d.xml=d.xml||"http://www.w3.org/XML/1998/namespace",e&&"string"==typeof e?r.parse(e,d,f):r.errorHandler.error("invalid doc source"),s.doc},i.prototype={startDocument:function(){this.doc=(new f).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var i=this.doc,o=i.createElementNS(e,n||t),a=r.length;c(this,o),this.currentElement=o,this.locator&&s(this.locator,o);for(var u=0;u<a;u++){e=r.getURI(u);var d=r.getValue(u),l=(n=r.getQName(u),i.createAttributeNS(e,n));this.locator&&s(r.getLocator(u),l),l.value=l.nodeValue=d,o.setAttributeNode(l)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName,this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&s(this.locator,n),c(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=a.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(e);else r=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(e)&&this.doc.appendChild(r),this.locator&&s(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=a.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&s(this.locator,r),c(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var i=r.createDocumentType(e,t,n);this.locator&&s(this.locator,i),c(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,o(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,o(this.locator))},fatalError:function(e){throw new h(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){i.prototype[e]=function(){return null}}));var u=n(3791),d=n(8275),l=d.XMLReader,h=d.ParseError,f=t.DOMImplementation=n(9034).DOMImplementation;n(9034),t.a=r},9034:(e,t)=>{function n(e,t){for(var n in e)t[n]=e[n]}function r(e,t){var r=e.prototype;if(!(r instanceof t)){function i(){}i.prototype=t.prototype,n(r,i=new i),e.prototype=r=i}r.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),r.constructor=e)}var i={},s=i.ELEMENT_NODE=1,o=i.ATTRIBUTE_NODE=2,a=i.TEXT_NODE=3,c=i.CDATA_SECTION_NODE=4,u=i.ENTITY_REFERENCE_NODE=5,d=i.ENTITY_NODE=6,l=i.PROCESSING_INSTRUCTION_NODE=7,h=i.COMMENT_NODE=8,f=i.DOCUMENT_NODE=9,p=i.DOCUMENT_TYPE_NODE=10,g=i.DOCUMENT_FRAGMENT_NODE=11,m=i.NOTATION_NODE=12,v={},_={},y=(v.INDEX_SIZE_ERR=(_[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(_[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(_[3]="Hierarchy request error",3)),b=(v.WRONG_DOCUMENT_ERR=(_[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(_[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(_[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(_[7]="No modification allowed",7),v.NOT_FOUND_ERR=(_[8]="Not found",8)),w=(v.NOT_SUPPORTED_ERR=(_[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(_[10]="Attribute in use",10));function S(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,_[e]),this.message=_[e],Error.captureStackTrace&&Error.captureStackTrace(this,S);return n.code=e,t&&(this.message=this.message+": "+t),n}function E(){}function x(e,t){this._node=e,this._refresh=t,A(this)}function A(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);ne(e,"length",r.length),n(r,e),e._inc=t}}function N(){}function j(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function T(e,t,n,r){if(r?t[j(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(r&&D(i,e,r),function(e,t,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(i,e,n))}}function C(e,t,n){var r=j(t,n);if(!(r>=0))throw S(b,new Error(e.tagName+"@"+n));for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var s=e.ownerDocument;s&&(D(s,e,n),n.ownerElement=null)}}function I(e){if(this._features={},e)for(var t in e)this._features=e[t]}function O(){}function k(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function M(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(M(e,t))return!0}while(e=e.nextSibling)}function R(){}function D(e,t,n,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function F(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var i=t.firstChild,s=0;i;)r[s++]=i,i=i.nextSibling;r.length=s}}}function L(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,F(e.ownerDocument,e),t}function P(e,t,n){var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===g){var i=t.firstChild;if(null==i)return t;var s=t.lastChild}else i=s=t;var o=n?n.previousSibling:e.lastChild;i.previousSibling=o,s.nextSibling=n,o?o.nextSibling=i:e.firstChild=i,null==n?e.lastChild=s:n.previousSibling=s;do{i.parentNode=e}while(i!==s&&(i=i.nextSibling));return F(e.ownerDocument||e,e),t.nodeType==g&&(t.firstChild=t.lastChild=null),t}function U(){this._nsMap={}}function $(){}function z(){}function B(){}function H(){}function q(){}function G(){}function W(){}function J(){}function Q(){}function V(){}function Y(){}function X(e,t){var n=[],r=9==this.nodeType&&this.documentElement||this,i=r.prefix,s=r.namespaceURI;if(s&&null==i&&null==(i=r.lookupPrefix(s)))var o=[{namespace:s,prefix:null}];return Z(this,n,e,t,o),n.join("")}function K(e,t,n){var r=e.prefix||"",i=e.namespaceURI;if(!r&&!i)return!1;if("xml"===r&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var s=n.length;s--;){var o=n[s];if(o.prefix==r)return o.namespace!=i}return!0}function Z(e,t,n,r,i){if(r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case s:i||(i=[]),i.length;var d=e.attributes,m=d.length,v=e.firstChild,_=e.tagName;n="http://www.w3.org/1999/xhtml"===e.namespaceURI||n,t.push("<",_);for(var y=0;y<m;y++)"xmlns"==(b=d.item(y)).prefix?i.push({prefix:b.localName,namespace:b.value}):"xmlns"==b.nodeName&&i.push({prefix:"",namespace:b.value});for(y=0;y<m;y++){var b;if(K(b=d.item(y),0,i)){var w=b.prefix||"",S=b.namespaceURI,E=w?" xmlns:"+w:" xmlns";t.push(E,'="',S,'"'),i.push({prefix:w,namespace:S})}Z(b,t,n,r,i)}if(K(e,0,i)&&(w=e.prefix||"",S=e.namespaceURI,E=w?" xmlns:"+w:" xmlns",t.push(E,'="',S,'"'),i.push({prefix:w,namespace:S})),v||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(_)){if(t.push(">"),n&&/^script$/i.test(_))for(;v;)v.data?t.push(v.data):Z(v,t,n,r,i),v=v.nextSibling;else for(;v;)Z(v,t,n,r,i),v=v.nextSibling;t.push("</",_,">")}else t.push("/>");return;case f:case g:for(v=e.firstChild;v;)Z(v,t,n,r,i),v=v.nextSibling;return;case o:return t.push(" ",e.name,'="',e.value.replace(/[&"]/g,k),'"');case a:return t.push(e.data.replace(/[<&]/g,k).replace(/]]>/g,"]]&gt;"));case c:return t.push("<![CDATA[",e.data,"]]>");case h:return t.push("\x3c!--",e.data,"--\x3e");case p:var x=e.publicId,A=e.systemId;if(t.push("<!DOCTYPE ",e.name),x)t.push(" PUBLIC ",x),A&&"."!=A&&t.push(" ",A),t.push(">");else if(A&&"."!=A)t.push(" SYSTEM ",A,">");else{var N=e.internalSubset;N&&t.push(" [",N,"]"),t.push(">")}return;case l:return t.push("<?",e.target," ",e.data,"?>");case u:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ee(e,t,n){var r;switch(t.nodeType){case s:(r=t.cloneNode(!1)).ownerDocument=e;case g:break;case o:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var i=t.firstChild;i;)r.appendChild(ee(e,i,n)),i=i.nextSibling;return r}function te(e,t,n){var r=new t.constructor;for(var i in t){var a=t[i];"object"!=typeof a&&a!=r[i]&&(r[i]=a)}switch(t.childNodes&&(r.childNodes=new E),r.ownerDocument=e,r.nodeType){case s:var c=t.attributes,u=r.attributes=new N,d=c.length;u._ownerElement=r;for(var l=0;l<d;l++)r.setAttributeNode(te(e,c.item(l),!0));break;case o:n=!0}if(n)for(var h=t.firstChild;h;)r.appendChild(te(e,h,n)),h=h.nextSibling;return r}function ne(e,t,n){e[t]=n}v.INVALID_STATE_ERR=(_[11]="Invalid state",11),v.SYNTAX_ERR=(_[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(_[13]="Invalid modification",13),v.NAMESPACE_ERR=(_[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(_[15]="Invalid access",15),S.prototype=Error.prototype,n(v,S),E.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)Z(this[r],n,e,t);return n.join("")}},x.prototype.item=function(e){return A(this),this[e]},r(x,E),N.prototype={length:0,item:E.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new S(w);var n=this.getNamedItem(e.nodeName);return T(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new S(w);return t=this.getNamedItemNS(e.namespaceURI,e.localName),T(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return C(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return C(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},I.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var r=new R;if(r.implementation=this,r.childNodes=new E,r.doctype=n,n&&r.appendChild(n),t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},createDocumentType:function(e,t,n){var r=new G;return r.name=e,r.nodeName=e,r.publicId=t,r.systemId=n,r}},O.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return P(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return L(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return te(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==a&&e.nodeType==a?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(n[r]==e)return r;t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},n(i,O),n(i,O.prototype),R.prototype={nodeName:"#document",nodeType:f,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==g){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return null==this.documentElement&&e.nodeType==s&&(this.documentElement=e),P(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),L(this,e)},importNode:function(e,t){return ee(this,e,t)},getElementById:function(e){var t=null;return M(this.documentElement,(function(n){if(n.nodeType==s&&n.getAttribute("id")==e)return t=n,!0})),t},getElementsByClassName:function(e){var t=new RegExp("(^|\\s)"+e+"(\\s|$)");return new x(this,(function(e){var n=[];return M(e.documentElement,(function(r){r!==e&&r.nodeType==s&&t.test(r.getAttribute("class"))&&n.push(r)})),n}))},createElement:function(e){var t=new U;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new E,(t.attributes=new N)._ownerElement=t,t},createDocumentFragment:function(){var e=new V;return e.ownerDocument=this,e.childNodes=new E,e},createTextNode:function(e){var t=new B;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new H;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new q;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new Y;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new $;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new Q;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new U,r=t.split(":"),i=n.attributes=new N;return n.childNodes=new E,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new $,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},r(R,O),U.prototype={nodeType:s,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===g?this.insertBefore(e,null):function(e,t){var n=t.parentNode;if(n){var r=e.lastChild;n.removeChild(t),r=e.lastChild}return r=e.lastChild,t.parentNode=e,t.previousSibling=r,t.nextSibling=null,r?r.nextSibling=t:e.firstChild=t,e.lastChild=t,F(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new x(this,(function(t){var n=[];return M(t,(function(r){r===t||r.nodeType!=s||"*"!==e&&r.tagName!=e||n.push(r)})),n}))},getElementsByTagNameNS:function(e,t){return new x(this,(function(n){var r=[];return M(n,(function(i){i===n||i.nodeType!==s||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||r.push(i)})),r}))}},R.prototype.getElementsByTagName=U.prototype.getElementsByTagName,R.prototype.getElementsByTagNameNS=U.prototype.getElementsByTagNameNS,r(U,O),$.prototype.nodeType=o,r($,O),z.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(_[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},r(z,O),B.prototype={nodeName:"#text",nodeType:a,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},r(B,z),H.prototype={nodeName:"#comment",nodeType:h},r(H,z),q.prototype={nodeName:"#cdata-section",nodeType:c},r(q,z),G.prototype.nodeType=p,r(G,O),W.prototype.nodeType=m,r(W,O),J.prototype.nodeType=d,r(J,O),Q.prototype.nodeType=u,r(Q,O),V.prototype.nodeName="#document-fragment",V.prototype.nodeType=g,r(V,O),Y.prototype.nodeType=l,r(Y,O),O.prototype.toString=X;try{if(Object.defineProperty){function re(e){switch(e.nodeType){case s:case g:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(re(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(x.prototype,"length",{get:function(){return A(this),this.$$length}}),Object.defineProperty(O.prototype,"textContent",{get:function(){return re(this)},set:function(e){switch(this.nodeType){case s:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ne=function(e,t,n){e["$$"+t]=n}}}catch(e){}t.DOMImplementation=I},3791:(e,t)=>{t.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}},8275:(e,t)=>{var n=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,r=new RegExp("[\\-\\.0-9"+n.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+n.source+r.source+"*(?::"+n.source+r.source+"*)?$");function s(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,s)}function o(){}function a(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function c(e,t,n,r,i,s){function o(e,t,r){e in n.attributeNames&&s.fatalError("Attribute "+e+" redefined"),n.addValue(e,t,r)}for(var a,c=++t,u=0;;){var d=e.charAt(c);switch(d){case"=":if(1===u)a=e.slice(t,c),u=3;else{if(2!==u)throw new Error("attribute equal must after attrName");u=3}break;case"'":case'"':if(3===u||1===u){if(1===u&&(s.warning('attribute value must after "="'),a=e.slice(t,c)),t=c+1,!((c=e.indexOf(d,t))>0))throw new Error("attribute value no end '"+d+"' match");o(a,l=e.slice(t,c).replace(/&#?\w+;/g,i),t-1),u=5}else{if(4!=u)throw new Error('attribute value must after "="');o(a,l=e.slice(t,c).replace(/&#?\w+;/g,i),t),s.warning('attribute "'+a+'" missed start quot('+d+")!!"),t=c+1,u=5}break;case"/":switch(u){case 0:n.setTagName(e.slice(t,c));case 5:case 6:case 7:u=7,n.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),0==u&&n.setTagName(e.slice(t,c)),c;case">":switch(u){case 0:n.setTagName(e.slice(t,c));case 5:case 6:case 7:break;case 4:case 1:"/"===(l=e.slice(t,c)).slice(-1)&&(n.closed=!0,l=l.slice(0,-1));case 2:2===u&&(l=a),4==u?(s.warning('attribute "'+l+'" missed quot(")!'),o(a,l.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===r[""]&&l.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+l+'" missed value!! "'+l+'" instead!!'),o(l,l,t));break;case 3:throw new Error("attribute value missed!!")}return c;case"":d=" ";default:if(d<=" ")switch(u){case 0:n.setTagName(e.slice(t,c)),u=6;break;case 1:a=e.slice(t,c),u=2;break;case 4:var l=e.slice(t,c).replace(/&#?\w+;/g,i);s.warning('attribute "'+l+'" missed quot(")!!'),o(a,l,t);case 5:u=6}else switch(u){case 2:n.tagName,"http://www.w3.org/1999/xhtml"===r[""]&&a.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),o(a,a,t),t=c,u=1;break;case 5:s.warning('attribute space is required"'+a+'"!!');case 6:u=1,t=c;break;case 3:u=4,t=c;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function u(e,t,n){for(var r=e.tagName,i=null,s=e.length;s--;){var o=e[s],a=o.qName,c=o.value;if((f=a.indexOf(":"))>0)var u=o.prefix=a.slice(0,f),d=a.slice(f+1),l="xmlns"===u&&d;else d=a,u=null,l="xmlns"===a&&"";o.localName=d,!1!==l&&(null==i&&(i={},h(n,n={})),n[l]=i[l]=c,o.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(l,c))}for(s=e.length;s--;)(u=(o=e[s]).prefix)&&("xml"===u&&(o.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(o.uri=n[u||""]));var f;(f=r.indexOf(":"))>0?(u=e.prefix=r.slice(0,f),d=e.localName=r.slice(f+1)):(u=null,d=e.localName=r);var p=e.uri=n[u||""];if(t.startElement(p,d,r,e),!e.closed)return e.currentNSMap=n,e.localNSMap=i,!0;if(t.endElement(p,d,r),i)for(u in i)t.endPrefixMapping(u)}function d(e,t,n,r,i){if(/^(?:script|textarea)$/i.test(n)){var s=e.indexOf("</"+n+">",t),o=e.substring(t+1,s);if(/[&<]/.test(o))return/^script$/i.test(n)?(i.characters(o,0,o.length),s):(o=o.replace(/&#?\w+;/g,r),i.characters(o,0,o.length),s)}return t+1}function l(e,t,n,r){var i=r[n];return null==i&&((i=e.lastIndexOf("</"+n+">"))<t&&(i=e.lastIndexOf("</"+n)),r[n]=i),i<t}function h(e,t){for(var n in e)t[n]=e[n]}function f(e,t,n,r){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(i=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,i-t-4),i+3):(r.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,i-t-9),n.endCDATA(),i+3}var s=function(e,t){var n,r=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(e);n=i.exec(e);)if(r.push(n),n[1])return r}(e,t),o=s.length;if(o>1&&/!doctype/i.test(s[0][0])){var a=s[1][0],c=!1,u=!1;o>3&&(/^public$/i.test(s[2][0])?(c=s[3][0],u=o>4&&s[4][0]):/^system$/i.test(s[2][0])&&(u=s[3][0]));var d=s[o-1];return n.startDTD(a,c,u),n.endDTD(),d.index+d[0].length}}return-1}function p(e,t,n){var r=e.indexOf("?>",t);if(r){var i=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return i?(i[0].length,n.processingInstruction(i[1],i[2]),r+2):-1}return-1}function g(){this.attributeNames={}}s.prototype=new Error,s.prototype.name=s.name,o.prototype={parse:function(e,t,n){var r=this.domBuilder;r.startDocument(),h(t,t={}),function(e,t,n,r,i){function o(e){var t=e.slice(1,-1);return t in n?n[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function h(t){if(t>E){var n=e.substring(E,t).replace(/&#?\w+;/g,o);b&&m(E),r.characters(n,0,t-E),E=t}}function m(t,n){for(;t>=_&&(n=y.exec(e));)v=n.index,_=v+n[0].length,b.lineNumber++;b.columnNumber=t-v+1}for(var v=0,_=0,y=/.*(?:\r\n?|\n)|.*$/g,b=r.locator,w=[{currentNSMap:t}],S={},E=0;;){try{var x=e.indexOf("<",E);if(x<0){if(!e.substr(E).match(/^\s*$/)){var A=r.doc,N=A.createTextNode(e.substr(E));A.appendChild(N),r.currentElement=N}return}switch(x>E&&h(x),e.charAt(x+1)){case"/":var j=e.indexOf(">",x+3),T=e.substring(x+2,j),C=w.pop();j<0?(T=e.substring(x+2).replace(/[\s<].*/,""),i.error("end tag name: "+T+" is not complete:"+C.tagName),j=x+1+T.length):T.match(/\s</)&&(T=T.replace(/[\s<].*/,""),i.error("end tag name: "+T+" maybe not complete"),j=x+1+T.length);var I=C.localNSMap,O=C.tagName==T;if(O||C.tagName&&C.tagName.toLowerCase()==T.toLowerCase()){if(r.endElement(C.uri,C.localName,T),I)for(var k in I)r.endPrefixMapping(k);O||i.fatalError("end tag name: "+T+" is not match the current start tagName:"+C.tagName)}else w.push(C);j++;break;case"?":b&&m(x),j=p(e,x,r);break;case"!":b&&m(x),j=f(e,x,r,i);break;default:b&&m(x);var M=new g,R=w[w.length-1].currentNSMap,D=(j=c(e,x,M,R,o,i),M.length);if(!M.closed&&l(e,j,M.tagName,S)&&(M.closed=!0,n.nbsp||i.warning("unclosed xml attribute")),b&&D){for(var F=a(b,{}),L=0;L<D;L++){var P=M[L];m(P.offset),P.locator=a(b,{})}r.locator=F,u(M,r,R)&&w.push(M),r.locator=b}else u(M,r,R)&&w.push(M);"http://www.w3.org/1999/xhtml"!==M.uri||M.closed?j++:j=d(e,j,M.tagName,o,r)}}catch(e){if(e instanceof s)throw e;i.error("element parse error: "+e),j=-1}j>E?E=j:h(Math.max(x,E)+1)}}(e,t,n,r,this.errorHandler),r.endDocument()}},g.prototype={setTagName:function(e){if(!i.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!i.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=o,t.ParseError=s},7521:(e,t,n)=>{var r={"./af/LC_MESSAGES/converse.po":[4328,5830],"./ar/LC_MESSAGES/converse.po":[4136,4469],"./bg/LC_MESSAGES/converse.po":[1988,2551],"./ca/LC_MESSAGES/converse.po":[4391,1553],"./cs/LC_MESSAGES/converse.po":[4602,5301],"./da/LC_MESSAGES/converse.po":[2669,1163],"./de/LC_MESSAGES/converse.po":[4319,2895],"./el/LC_MESSAGES/converse.po":[4422,5524],"./eo/LC_MESSAGES/converse.po":[859,2433],"./es/LC_MESSAGES/converse.po":[106,8269],"./eu/LC_MESSAGES/converse.po":[4773,3103],"./fa/LC_MESSAGES/converse.po":[6427,321],"./fi/LC_MESSAGES/converse.po":[3901,7618],"./fr/LC_MESSAGES/converse.po":[3980,5129],"./gl/LC_MESSAGES/converse.po":[2313,777],"./he/LC_MESSAGES/converse.po":[2412,4363],"./hi/LC_MESSAGES/converse.po":[3561,4468],"./hu/LC_MESSAGES/converse.po":[9342,6239],"./id/LC_MESSAGES/converse.po":[5748,6678],"./it/LC_MESSAGES/converse.po":[812,3719],"./ja/LC_MESSAGES/converse.po":[9867,6249],"./lt/LC_MESSAGES/converse.po":[3976,513],"./mr/LC_MESSAGES/converse.po":[8388,1784],"./nb/LC_MESSAGES/converse.po":[5403,473],"./nl/LC_MESSAGES/converse.po":[9862,2473],"./nl_BE/LC_MESSAGES/converse.po":[1995,8131],"./oc/LC_MESSAGES/converse.po":[670,5500],"./pl/LC_MESSAGES/converse.po":[6838,3606],"./pt/LC_MESSAGES/converse.po":[1415,6227],"./pt_BR/LC_MESSAGES/converse.po":[4754,1455],"./ro/LC_MESSAGES/converse.po":[1175,3539],"./ru/LC_MESSAGES/converse.po":[4228,7917],"./sv/LC_MESSAGES/converse.po":[3147,8859],"./th/LC_MESSAGES/converse.po":[5414,457],"./tr/LC_MESSAGES/converse.po":[1092,4195],"./uk/LC_MESSAGES/converse.po":[4,7979],"./vi/LC_MESSAGES/converse.po":[8335,2110],"./zh_CN/LC_MESSAGES/converse.po":[8926,3325],"./zh_TW/LC_MESSAGES/converse.po":[7034,1458]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,3)))}i.keys=()=>Object.keys(r),i.id=7521,e.exports=i}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var i=Object.create(null);o.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,o.d(i,s),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>({52:"locales/dayjs/de-js",102:"locales/dayjs/ca-js",145:"locales/dayjs/me-js",265:"locales/dayjs/pt-js",280:"locales/dayjs/bn-js",321:"locales/fa-LC_MESSAGES-converse-po",457:"locales/th-LC_MESSAGES-converse-po",473:"locales/nb-LC_MESSAGES-converse-po",485:"locales/dayjs/ar-sa-js",513:"locales/lt-LC_MESSAGES-converse-po",535:"locales/dayjs/en-js",555:"locales/dayjs/tet-js",559:"locales/dayjs/ru-js",578:"locales/dayjs/bg-js",631:"locales/dayjs/lv-js",646:"locales/dayjs/nb-js",688:"locales/dayjs/ga-js",760:"locales/dayjs/br-js",777:"locales/gl-LC_MESSAGES-converse-po",825:"locales/dayjs/gom-latn-js",882:"locales/dayjs/ms-my-js",911:"locales/dayjs/es-pr-js",1107:"locales/dayjs/ja-js",1110:"locales/dayjs/uz-latn-js",1163:"locales/da-LC_MESSAGES-converse-po",1194:"locales/dayjs/is-js",1204:"locales/dayjs/lo-js",1211:"locales/dayjs/pl-js",1298:"locales/dayjs/sd-js",1396:"locales/dayjs/eu-js",1455:"locales/pt_BR-LC_MESSAGES-converse-po",1458:"locales/zh_TW-LC_MESSAGES-converse-po",1520:"locales/dayjs/nl-js",1553:"locales/ca-LC_MESSAGES-converse-po",1606:"locales/dayjs/el-js",1619:"locales/dayjs/uk-js",1679:"locales/dayjs/de-ch-js",1729:"locales/dayjs/th-js",1735:"locales/dayjs/en-sg-js",1784:"locales/mr-LC_MESSAGES-converse-po",1880:"locales/dayjs/it-js",1910:"locales/dayjs/fr-js",1942:"locales/dayjs/se-js",2110:"locales/vi-LC_MESSAGES-converse-po",2130:"locales/dayjs/fi-js",2263:"locales/dayjs/bm-js",2433:"locales/eo-LC_MESSAGES-converse-po",2446:"locales/dayjs/tg-js",2473:"locales/nl-LC_MESSAGES-converse-po",2475:"locales/dayjs/km-js",2548:"locales/dayjs/da-js",2551:"locales/bg-LC_MESSAGES-converse-po",2814:"locales/dayjs/tlh-js",2843:"locales/dayjs/tzl-js",2895:"locales/de-LC_MESSAGES-converse-po",2984:"locales/dayjs/bi-js",3103:"locales/eu-LC_MESSAGES-converse-po",3153:"locales/dayjs/uz-js",3155:"locales/dayjs/nl-be-js",3208:"locales/dayjs/es-us-js",3221:"locales/dayjs/rw-js",3325:"locales/zh_CN-LC_MESSAGES-converse-po",3411:"locales/dayjs/es-js",3435:"locales/dayjs/sr-cyrl-js",3446:"locales/dayjs/ko-js",3463:"locales/dayjs/en-il-js",3521:"locales/dayjs/ar-ly-js",3539:"locales/ro-LC_MESSAGES-converse-po",3606:"locales/pl-LC_MESSAGES-converse-po",3623:"locales/dayjs/gu-js",3719:"locales/it-LC_MESSAGES-converse-po",3755:"locales/dayjs/zh-hk-js",3933:"locales/dayjs/tzm-latn-js",4035:"locales/dayjs/en-ca-js",4153:"locales/dayjs/et-js",4195:"locales/tr-LC_MESSAGES-converse-po",4305:"locales/dayjs/jv-js",4342:"locales/dayjs/tzm-js",4363:"locales/he-LC_MESSAGES-converse-po",4423:"locales/dayjs/x-pseudo-js",4468:"locales/hi-LC_MESSAGES-converse-po",4469:"locales/ar-LC_MESSAGES-converse-po",4481:"locales/dayjs/cv-js",4610:"emojis",4951:"locales/dayjs/mk-js",4963:"locales/dayjs/az-js",5050:"locales/dayjs/gd-js",5055:"locales/dayjs/ky-js",5073:"locales/dayjs/am-js",5121:"locales/dayjs/eo-js",5129:"locales/fr-LC_MESSAGES-converse-po",5166:"locales/dayjs/my-js",5186:"locales/dayjs/ka-js",5206:"locales/dayjs/kk-js",5215:"locales/dayjs/lb-js",5256:"locales/dayjs/tk-js",5274:"locales/dayjs/pt-br-js",5301:"locales/cs-LC_MESSAGES-converse-po",5313:"locales/dayjs/ar-ma-js",5407:"locales/dayjs/hy-am-js",5485:"locales/dayjs/en-au-js",5500:"locales/oc-LC_MESSAGES-converse-po",5524:"locales/el-LC_MESSAGES-converse-po",5544:"locales/dayjs/fa-js",5569:"locales/dayjs/dv-js",5600:"locales/dayjs/mr-js",5818:"locales/dayjs/gl-js",5822:"locales/dayjs/ht-js",5830:"locales/af-LC_MESSAGES-converse-po",5850:"locales/dayjs/pa-in-js",6010:"locales/dayjs/it-ch-js",6031:"locales/dayjs/en-gb-js",6105:"locales/dayjs/en-tt-js",6227:"locales/pt-LC_MESSAGES-converse-po",6239:"locales/hu-LC_MESSAGES-converse-po",6249:"locales/ja-LC_MESSAGES-converse-po",6376:"locales/dayjs/fy-js",6678:"locales/id-LC_MESSAGES-converse-po",6740:"locales/dayjs/cy-js",6755:"locales/dayjs/ar-js",6776:"locales/dayjs/zh-tw-js",6783:"locales/dayjs/sk-js",6890:"locales/dayjs/ug-cn-js",6898:"locales/dayjs/en-in-js",7024:"locales/dayjs/ku-js",7050:"locales/dayjs/nn-js",7175:"locales/dayjs/de-at-js",7203:"locales/dayjs/oc-lnc-js",7363:"locales/dayjs/fr-ca-js",7390:"locales/dayjs/sr-js",7400:"locales/dayjs/cs-js",7419:"locales/dayjs/hr-js",7454:"locales/dayjs/mi-js",7523:"locales/dayjs/kn-js",7618:"locales/fi-LC_MESSAGES-converse-po",7645:"locales/dayjs/ta-js",7679:"locales/dayjs/ml-js",7714:"locales/dayjs/te-js",7899:"locales/dayjs/lt-js",7917:"locales/ru-LC_MESSAGES-converse-po",7952:"locales/dayjs/fr-ch-js",7979:"locales/uk-LC_MESSAGES-converse-po",8010:"locales/dayjs/hi-js",8022:"locales/dayjs/ro-js",8040:"locales/dayjs/ar-tn-js",8073:"locales/dayjs/vi-js",8129:"locales/dayjs/en-ie-js",8131:"locales/nl_BE-LC_MESSAGES-converse-po",8214:"locales/dayjs/hu-js",8269:"locales/es-LC_MESSAGES-converse-po",8458:"locales/dayjs/zh-js",8547:"locales/dayjs/en-nz-js",8603:"locales/dayjs/sq-js",8618:"locales/dayjs/mn-js",8665:"locales/dayjs/tr-js",8692:"locales/dayjs/yo-js",8745:"locales/dayjs/fo-js",8758:"locales/dayjs/es-do-js",8859:"locales/sv-LC_MESSAGES-converse-po",9030:"locales/dayjs/ne-js",9095:"locales/dayjs/ms-js",9210:"locales/dayjs/af-js",9238:"locales/dayjs/ss-js",9333:"locales/dayjs/si-js",9372:"locales/dayjs/he-js",9406:"locales/dayjs/ar-dz-js",9443:"locales/dayjs/tl-ph-js",9478:"locales/dayjs/be-js",9513:"locales/dayjs/id-js",9568:"locales/dayjs/ur-js",9625:"locales/dayjs/sl-js",9630:"locales/dayjs/zh-cn-js",9652:"locales/dayjs/sv-js",9665:"locales/dayjs/mt-js",9733:"locales/dayjs/sw-js",9833:"locales/dayjs/bs-js",9897:"locales/dayjs/ar-kw-js",9950:"locales/dayjs/bo-js",9997:"locales/dayjs/sv-fi-js"}[e]+".js"),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},r="converse.js:",o.l=(e,t,i,s)=>{if(n[e])n[e].push(t);else{var a,c;if(void 0!==i)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var l=u[d];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==r+i){a=l;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",r+i),a.src=e),n[e]=[t];var h=(t,r)=>{a.onerror=a.onload=null,clearTimeout(f);var i=n[e];if(delete n[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(r))),t)return t(r)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={179:0};o.f.j=(t,n)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var s=o.p+o.u(t),a=new Error;o.l(s,(n=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,i,[s,a,c]=n,u=0;for(r in a)o.o(a,r)&&(o.m[r]=a[r]);for(c&&c(o),t&&t(n);u<s.length;u++)i=s[u],o.o(e,i)&&e[i]&&e[i][0](),e[s[u]]=0},n=self.webpackChunkconverse_js=self.webpackChunkconverse_js||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";var e=o(5215),t=o.n(e),n=o(4223);const r={initialize(){},__:(...e)=>(0,n.sprintf)(...e)},i=function(e){return null!=e&&"object"==typeof e},s="object"==typeof global&&global&&global.Object===Object&&global;var a="object"==typeof self&&self&&self.Object===Object&&self;const c=s||a||Function("return this")(),u=c.Symbol;var d=Object.prototype,l=d.hasOwnProperty,h=d.toString,f=u?u.toStringTag:void 0;var p=Object.prototype.toString;var g=u?u.toStringTag:void 0;const m=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":g&&g in Object(e)?function(e){var t=l.call(e,f),n=e[f];try{e[f]=void 0;var r=!0}catch(e){}var i=h.call(e);return r&&(t?e[f]=n:delete e[f]),i}(e):function(e){return p.call(e)}(e)},v=function(e,t){return function(n){return e(t(n))}},_=v(Object.getPrototypeOf,Object);var y=Function.prototype,b=Object.prototype,w=y.toString,S=b.hasOwnProperty,E=w.call(Object);const x=function(e){if(!i(e)||"[object Object]"!=m(e))return!1;var t=_(e);if(null===t)return!0;var n=S.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&w.call(n)==E},A=function(e){return i(e)&&1===e.nodeType&&!x(e)};var N,j,T,C;const I={debug:0,info:1,warn:2,error:3,fatal:4},O=Object.assign({debug:null!==(N=console)&&void 0!==N&&N.log?console.log.bind(console):function(){},error:null!==(j=console)&&void 0!==j&&j.log?console.log.bind(console):function(){},info:null!==(T=console)&&void 0!==T&&T.log?console.log.bind(console):function(){},warn:null!==(C=console)&&void 0!==C&&C.log?console.log.bind(console):function(){}},console),k={setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t,n=""){if(I[t]<I[this.loglevel])return;"error"===t||"fatal"===t?n=n||"color: maroon":"debug"===t&&(n=n||"color: green"),e instanceof Error?e=e.stack:A(e)&&(e=e.outerHTML);const r=n?"%c":"";"error"===t?O.error(`${r} ERROR: ${e}`,n):"warn"===t?O.warn(`${r} ${(new Date).toISOString()} WARNING: ${e}`,n):"fatal"===t?O.error(`${r} FATAL: ${e}`,n):"debug"===t?O.debug(`${r} ${(new Date).toISOString()} DEBUG: ${e}`,n):O.info(`${r} ${(new Date).toISOString()} INFO: ${e}`,n)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}},M=function(){let e=o.g.WebSocket;if(void 0===e)try{e=o(7026)}catch(e){throw new Error('You must install the "ws" package to use Strophe in nodejs.')}return e}(),R=function(){let e=o.g.DOMParser;if(void 0===e)try{e=o(647).a}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}return e}();const D=function(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},F=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");const t=[];for(let n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},L=function(e,t,n,r,i,s){return D((o=D(D(t,e),D(r,s)))<<(a=i)|o>>>32-a,n);var o,a},P=function(e,t,n,r,i,s,o){return L(t&n|~t&r,e,t,i,s,o)},U=function(e,t,n,r,i,s,o){return L(t&r|n&~r,e,t,i,s,o)},$=function(e,t,n,r,i,s,o){return L(t^n^r,e,t,i,s,o)},z=function(e,t,n,r,i,s,o){return L(n^(t|~r),e,t,i,s,o)},B=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let n,r,i,s,o=1732584193,a=-271733879,c=-1732584194,u=271733878;for(let t=0;t<e.length;t+=16)n=o,r=a,i=c,s=u,o=P(o,a,c,u,e[t+0],7,-680876936),u=P(u,o,a,c,e[t+1],12,-389564586),c=P(c,u,o,a,e[t+2],17,606105819),a=P(a,c,u,o,e[t+3],22,-1044525330),o=P(o,a,c,u,e[t+4],7,-176418897),u=P(u,o,a,c,e[t+5],12,1200080426),c=P(c,u,o,a,e[t+6],17,-1473231341),a=P(a,c,u,o,e[t+7],22,-45705983),o=P(o,a,c,u,e[t+8],7,1770035416),u=P(u,o,a,c,e[t+9],12,-1958414417),c=P(c,u,o,a,e[t+10],17,-42063),a=P(a,c,u,o,e[t+11],22,-1990404162),o=P(o,a,c,u,e[t+12],7,1804603682),u=P(u,o,a,c,e[t+13],12,-40341101),c=P(c,u,o,a,e[t+14],17,-1502002290),a=P(a,c,u,o,e[t+15],22,1236535329),o=U(o,a,c,u,e[t+1],5,-165796510),u=U(u,o,a,c,e[t+6],9,-1069501632),c=U(c,u,o,a,e[t+11],14,643717713),a=U(a,c,u,o,e[t+0],20,-373897302),o=U(o,a,c,u,e[t+5],5,-701558691),u=U(u,o,a,c,e[t+10],9,38016083),c=U(c,u,o,a,e[t+15],14,-660478335),a=U(a,c,u,o,e[t+4],20,-405537848),o=U(o,a,c,u,e[t+9],5,568446438),u=U(u,o,a,c,e[t+14],9,-1019803690),c=U(c,u,o,a,e[t+3],14,-187363961),a=U(a,c,u,o,e[t+8],20,1163531501),o=U(o,a,c,u,e[t+13],5,-1444681467),u=U(u,o,a,c,e[t+2],9,-51403784),c=U(c,u,o,a,e[t+7],14,1735328473),a=U(a,c,u,o,e[t+12],20,-1926607734),o=$(o,a,c,u,e[t+5],4,-378558),u=$(u,o,a,c,e[t+8],11,-2022574463),c=$(c,u,o,a,e[t+11],16,1839030562),a=$(a,c,u,o,e[t+14],23,-35309556),o=$(o,a,c,u,e[t+1],4,-1530992060),u=$(u,o,a,c,e[t+4],11,1272893353),c=$(c,u,o,a,e[t+7],16,-155497632),a=$(a,c,u,o,e[t+10],23,-1094730640),o=$(o,a,c,u,e[t+13],4,681279174),u=$(u,o,a,c,e[t+0],11,-358537222),c=$(c,u,o,a,e[t+3],16,-722521979),a=$(a,c,u,o,e[t+6],23,76029189),o=$(o,a,c,u,e[t+9],4,-640364487),u=$(u,o,a,c,e[t+12],11,-421815835),c=$(c,u,o,a,e[t+15],16,530742520),a=$(a,c,u,o,e[t+2],23,-995338651),o=z(o,a,c,u,e[t+0],6,-198630844),u=z(u,o,a,c,e[t+7],10,1126891415),c=z(c,u,o,a,e[t+14],15,-1416354905),a=z(a,c,u,o,e[t+5],21,-57434055),o=z(o,a,c,u,e[t+12],6,1700485571),u=z(u,o,a,c,e[t+3],10,-1894986606),c=z(c,u,o,a,e[t+10],15,-1051523),a=z(a,c,u,o,e[t+1],21,-2054922799),o=z(o,a,c,u,e[t+8],6,1873313359),u=z(u,o,a,c,e[t+15],10,-30611744),c=z(c,u,o,a,e[t+6],15,-1560198380),a=z(a,c,u,o,e[t+13],21,1309151649),o=z(o,a,c,u,e[t+4],6,-145523070),u=z(u,o,a,c,e[t+11],10,-1120210379),c=z(c,u,o,a,e[t+2],15,718787259),a=z(a,c,u,o,e[t+9],21,-343485551),o=D(o,n),a=D(a,r),c=D(c,i),u=D(u,s);return[o,a,c,u]},H={hexdigest:function(e){return function(e){const t="0123456789abcdef";let n="";for(let r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n}(B(F(e),8*e.length))},hash:function(e){return function(e){let t="";for(let n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(B(F(e),8*e.length))}};class q{constructor(e,t,n){this.mechname=e,this.isClientFirst=t,this.priority=n}test(){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}}const G=function(e){var t,n,r="",i=e.length;for(t=0;t<i;t++)(n=e.charCodeAt(t))>=0&&n<=127?r+=e.charAt(t):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r};function W(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,r,i,s,o,a,c,u,d=new Array(80),l=1732584193,h=-271733879,f=-1732584194,p=271733878,g=-1009589776;for(n=0;n<e.length;n+=16){for(s=l,o=h,a=f,c=p,u=g,r=0;r<80;r++)d[r]=r<16?e[n+r]:X(d[r-3]^d[r-8]^d[r-14]^d[r-16],1),i=Y(Y(X(l,5),J(r,h,f,p)),Y(Y(g,d[r]),Q(r))),g=p,p=f,f=X(h,30),h=l,l=i;l=Y(l,s),h=Y(h,o),f=Y(f,a),p=Y(p,c),g=Y(g,u)}return[l,h,f,p,g]}function J(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function Q(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function V(e,t){var n=K(e);n.length>16&&(n=W(n,8*e.length));for(var r=new Array(16),i=new Array(16),s=0;s<16;s++)r[s]=909522486^n[s],i[s]=1549556828^n[s];var o=W(r.concat(K(t)),512+8*t.length);return W(i.concat(o),672)}function Y(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function X(e,t){return e<<t|e>>>32-t}function K(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function Z(e){for(var t,n,r="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return r}function ee(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}const te={b64_hmac_sha1:function(e,t){return Z(V(e,t))},b64_sha1:function(e){return Z(W(K(e),8*e.length))},binb2str:ee,core_hmac_sha1:V,str_hmac_sha1:function(e,t){return ee(V(e,t))},str_sha1:function(e){return ee(W(K(e),8*e.length))}};var ne=o(9494);function re(e,t){return new ae.Builder(e,t)}function ie(e){return new ae.Builder("message",e)}function se(e){return new ae.Builder("iq",e)}function oe(e){return new ae.Builder("presence",e)}const ae={VERSION:"1.4.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag(e){for(let t=0;t<ae.XHTML.tags.length;t++)if(e===ae.XHTML.tags[t])return!0;return!1},validAttribute(e,t){if(void 0!==ae.XHTML.attributes[e]&&ae.XHTML.attributes[e].length>0)for(let n=0;n<ae.XHTML.attributes[e].length;n++)if(t===ae.XHTML.attributes[e][n])return!0;return!1},validCSS(e){for(let t=0;t<ae.XHTML.css.length;t++)if(e===ae.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace(e,t){ae.NS[e]=t},forEachChild(e,t,n){for(let r=0;r<e.childNodes.length;r++){const i=e.childNodes[r];i.nodeType!==ae.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}},isTagEqual:(e,t)=>e.tagName===t,_xmlGenerator:null,xmlGenerator:()=>(ae._xmlGenerator||(ae._xmlGenerator=function(){if("undefined"==typeof document)try{return(new(0,o(647).DOMImplementation)).createDocument("jabber:client","strophe",null)}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}if(void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10){const e=function(){const e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];for(let t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}();return e.appendChild(e.createElement("strophe")),e}return document.implementation.createDocument("jabber:client","strophe",null)}()),ae._xmlGenerator),xmlElement(e){if(!e)return null;const t=ae.xmlGenerator().createElement(e);for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)if("string"==typeof n||"number"==typeof n)t.appendChild(ae.xmlTextNode(n));else if("object"==typeof n&&"function"==typeof n.sort)for(let e=0;e<n.length;e++){const r=n[e];"object"==typeof r&&"function"==typeof r.sort&&void 0!==r[1]&&null!==r[1]&&t.setAttribute(r[0],r[1])}else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&void 0!==n[e]&&null!==n[e]&&t.setAttribute(e,n[e])}return t},xmlescape:e=>(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;"),xmlunescape:e=>(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"'),xmlTextNode:e=>ae.xmlGenerator().createTextNode(e),xmlHtmlNode(e){let t;return R?t=(new R).parseFromString(e,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t},getText(e){if(!e)return null;let t="";0===e.childNodes.length&&e.nodeType===ae.ElementType.TEXT&&(t+=e.nodeValue);for(let n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===ae.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return ae.xmlescape(t)},copyElement(e){let t;if(e.nodeType===ae.ElementType.NORMAL){t=ae.xmlElement(e.tagName);for(let n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(let n=0;n<e.childNodes.length;n++)t.appendChild(ae.copyElement(e.childNodes[n]))}else e.nodeType===ae.ElementType.TEXT&&(t=ae.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml(e){let t;if(e.nodeType===ae.ElementType.NORMAL){const n=e.nodeName.toLowerCase();if(ae.XHTML.validTag(n))try{t=ae.xmlElement(n);for(let r=0;r<ae.XHTML.attributes[n].length;r++){const i=ae.XHTML.attributes[n][r];let s=e.getAttribute(i);if(null!=s&&""!==s&&!1!==s&&0!==s)if("style"===i&&"object"==typeof s&&void 0!==s.cssText&&(s=s.cssText),"style"===i){const e=[],n=s.split(";");for(let t=0;t<n.length;t++){const r=n[t].split(":"),i=r[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(ae.XHTML.validCSS(i)){const t=r[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(s=e.join("; "),t.setAttribute(i,s))}else t.setAttribute(i,s)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(ae.createHtml(e.childNodes[n]))}catch(e){t=ae.xmlTextNode("")}else{t=ae.xmlGenerator().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(ae.createHtml(e.childNodes[n]))}}else if(e.nodeType===ae.ElementType.FRAGMENT){t=ae.xmlGenerator().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(ae.createHtml(e.childNodes[n]))}else e.nodeType===ae.ElementType.TEXT&&(t=ae.xmlTextNode(e.nodeValue));return t},escapeNode:e=>"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40"),unescapeNode:e=>"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\"),getNodeFromJid:e=>e.indexOf("@")<0?null:e.split("@")[0],getDomainFromJid(e){const t=ae.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}},getResourceFromJid(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:e=>e?e.split("/")[0]:null,_handleError(e){void 0!==e.stack&&ae.fatal(e.stack),e.sourceURL?ae.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?ae.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):ae.fatal("error: "+e.message)},log(e,t){var n;e===this.LogLevel.FATAL&&(null===(n=console)||void 0===n||n.error(t))},debug(e){this.log(this.LogLevel.DEBUG,e)},info(e){this.log(this.LogLevel.INFO,e)},warn(e){this.log(this.LogLevel.WARN,e)},error(e){this.log(this.LogLevel.ERROR,e)},fatal(e){this.log(this.LogLevel.FATAL,e)},serialize(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());const t=[...Array(e.attributes.length).keys()].map((t=>e.attributes[t].nodeName));t.sort();let n=t.reduce(((t,n)=>`${t} ${n}="${ae.xmlescape(e.attributes.getNamedItem(n).value)}"`),`<${e.nodeName}`);if(e.childNodes.length>0){n+=">";for(let t=0;t<e.childNodes.length;t++){const r=e.childNodes[t];switch(r.nodeType){case ae.ElementType.NORMAL:n+=ae.serialize(r);break;case ae.ElementType.TEXT:n+=ae.xmlescape(r.nodeValue);break;case ae.ElementType.CDATA:n+="<![CDATA["+r.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin(e,t){ae._connectionPlugins[e]=t},Builder:class{constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=ae.NS.CLIENT:t||(t={xmlns:ae.NS.CLIENT})),this.nodeTree=ae.xmlElement(e,t),this.node=this.nodeTree}tree(){return this.nodeTree}toString(){return ae.serialize(this.nodeTree)}up(){return this.node=this.node.parentNode,this}root(){return this.node=this.nodeTree,this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this}c(e,t,n){const r=ae.xmlElement(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this}cnode(e){let t;const n=ae.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}const r=t?n.importNode(e,!0):ae.copyElement(e);return this.node.appendChild(r),this.node=r,this}t(e){const t=ae.xmlTextNode(e);return this.node.appendChild(t),this}h(e){const t=ae.xmlGenerator().createElement("body");t.innerHTML=e;const n=ae.createHtml(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},Handler:function(e,t,n,r,i,s,o){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(ae.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=s?ae.getBareJidFromJid(s):null:this.from=s,this.user=!0}};ae.Handler.prototype={getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch(e){let t=!1;return!this.ns||(ae.forEachChild(e,null,(e=>{this.getNamespace(e)===this.ns&&(t=!0)})),t||this.getNamespace(e)===this.ns)},isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=ae.getBareJidFromJid(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!ae.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run(e){let t=null;try{t=this.handler(e)}catch(e){throw ae._handleError(e),e}return t},toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},ae.TimedHandler=class{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},ae.Connection=class{constructor(e,t){this.service=e,this.options=t||{},this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),function(e){e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",r="",i="";const s=e[t],o="object"==typeof s,a=escape(unescape(o?s.value:s));o&&(n=s.expires?";expires="+s.expires:"",r=s.domain?";domain="+s.domain:"",i=s.path?";path="+s.path:""),document.cookie=t+"="+a+n+r+i}}(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(const e in ae._connectionPlugins)if(Object.prototype.hasOwnProperty.call(ae._connectionPlugins,e)){const t=function(){};t.prototype=ae._connectionPlugins[e],this[e]=new t,this[e].init(this)}}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new ae.WorkerWebsocket(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new ae.Websocket(this):this._proto=new ae.Bosh(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,n){this.protocolErrorHandlers[e][t]=n}connect(e,t,n,r,i,s,o){this.jid=e,this.authzid=ae.getBareJidFromJid(this.jid),this.authcid=o||ae.getNodeFromJid(this.jid),this.pass=t,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=ae.getDomainFromJid(this.jid),this._changeConnectStatus(ae.Status.CONNECTING,null),this._proto._connect(r,i,s)}attach(e,t,n,r,i,s,o){if(this._proto._attach)return this._proto._attach(e,t,n,r,i,s,o);{const e=new Error('The "attach" method is not available for your connection protocol');throw e.name="StropheSessionError",e}}restore(e,t,n,r,i){if(!this._sessionCachingSupported()){const e=new Error('The "restore" method can only be used with a BOSH connection.');throw e.name="StropheSessionError",e}this._proto._restore(e,t,n,r,i)}_sessionCachingSupported(){if(this._proto instanceof ae.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if("function"==typeof e.sort)for(let t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,n,r){let i=null;"function"==typeof e.tree&&(e=e.tree());let s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)}),null,"presence",null,s);r&&(i=this.addTimedHandler(r,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(e),s}sendIQ(e,t,n,r){let i=null;"function"==typeof e.tree&&(e=e.tree());let s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i);const r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){const e=new Error(`Got bad IQ type of ${r}`);throw e.name="StropheError",e}n&&n(e)}}),null,"iq",["error","result"],s);r&&(i=this.addTimedHandler(r,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(e),s}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const n=new ae.TimedHandler(e,t);return this.addTimeds.push(n),n}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,n,r,i,s,o){const a=new ae.Handler(e,t,n,r,i,s,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e=e||[ae.SASLAnonymous,ae.SASLExternal,ae.SASLOAuthBearer,ae.SASLXOAuth2,ae.SASLPlain,ae.SASLSHA1]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(ae.Status.DISCONNECTING,e),e?ae.warn("Disconnect was called because: "+e):ae.info("Disconnect was called"),this.connected){let e=!1;this.disconnecting=!0,this.authenticated&&(e=oe({xmlns:ae.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else ae.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,n){for(const n in ae._connectionPlugins)if(Object.prototype.hasOwnProperty.call(ae._connectionPlugins,n)){const r=this[n];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){ae.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){ae._handleError(e),ae.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),ae.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(ae.Status.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const n=this._proto._reqToData(e);if(null===n)return;for(this.xmlInput!==ae.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==ae.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(ae.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const r=n.getAttribute("type");if(null!==r&&"terminate"===r){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(ae.Status.CONNFAIL,e)):this._changeConnectStatus(ae.Status.CONNFAIL,ae.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(e)}ae.forEachChild(n,null,(e=>{const t=this.handlers;this.handlers=[];for(let n=0;n<t.length;n++){const r=t[n];try{(!r.isMatch(e)||!this.authenticated&&r.user||r.run(e))&&this.handlers.push(r)}catch(e){ae.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}}))}_connect_cb(e,t,n){let r,i;ae.debug("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(e)}catch(e){if(e.name!==ae.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(ae.Status.CONNFAIL,ae.ErrorCondition.BAD_FORMAT),this._doDisconnect(ae.ErrorCondition.BAD_FORMAT)}if(!r)return;if(this.xmlInput!==ae.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==ae.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(ae.serialize(r))),this._proto._connect_cb(r)===ae.Status.CONNFAIL)return;if(i=r.getElementsByTagNameNS?r.getElementsByTagNameNS(ae.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const s=Array.from(r.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==s.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(s):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let n=t;for(let r=t+1;r<e.length;++r)e[r].priority>e[n].priority&&(n=r);if(n!==t){const r=e[t];e[t]=e[n],e[n]=r}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);const r=re("auth",{xmlns:ae.NS.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);r.t((0,ne.btoa)(e))}this.send(r.tree()),t=!0;break}return t}_sasl_challenge_cb(e){const t=(0,ne.atob)(ae.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),r=re("response",{xmlns:ae.NS.SASL});return""!==n&&r.t((0,ne.btoa)(n)),this.send(r.tree()),!0}_attemptLegacyAuth(){null===ae.getNodeFromJid(this.jid)?(this._changeConnectStatus(ae.Status.CONNFAIL,ae.ErrorCondition.MISSING_JID_NODE),this.disconnect(ae.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(ae.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(se({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:ae.NS.AUTH}).c("username",{}).t(ae.getNodeFromJid(this.jid)).tree()))}_onLegacyAuthIQResult(e){const t=se({type:"set",id:"_auth_2"}).c("query",{xmlns:ae.NS.AUTH}).c("username",{}).t(ae.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return ae.getResourceFromJid(this.jid)||(this.jid=ae.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(ae.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,r=(0,ne.atob)(ae.getText(e)).match(n);if("v"===r[1]&&(t=r[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}ae.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>n(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>n(t,e)),ae.NS.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(ae.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(ae.Status.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void ae.log(ae.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=ae.getResourceFromJid(this.jid);e?this.send(se({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:ae.NS.BIND}).c("resource",{}).t(e).tree()):this.send(se({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:ae.NS.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){let t;return ae.warn("Resource binding failed."),e.getElementsByTagName("conflict").length>0&&(t=ae.ErrorCondition.CONFLICT),this._changeConnectStatus(ae.Status.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return ae.warn("Resource binding failed."),this._changeConnectStatus(ae.Status.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=ae.getText(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(ae.Status.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Strophe.Connection.prototype._establishSession called but apparently ${ae.NS.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(se({type:"set",id:"_session_auth_2"}).c("session",{xmlns:ae.NS.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(ae.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,ae.warn("Session creation failed."),this._changeConnectStatus(ae.Status.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(ae.Status.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(ae.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(ae.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const n=new ae.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n}_addSysHandler(e,t,n,r,i){const s=new ae.Handler(e,t,n,r,i);return s.user=!1,this.addHandlers.push(s),s}_onDisconnectTimeout(){return ae.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(ae.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const r=this.timedHandlers[n];!this.authenticated&&r.user||(r.lastCalled+r.period-e<=0?r.run()&&t.push(r):t.push(r))}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}},ae.SASLMechanism=q,ae.SASLAnonymous=class extends q{constructor(e="ANONYMOUS",t=!1,n=20){super(e,t,n)}test(e){return null===e.authcid}},ae.SASLPlain=class extends q{constructor(e="PLAIN",t=!0,n=50){super(e,t,n)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:n,domain:r,pass:i}=e;if(!r)throw new Error("SASLPlain onChallenge: domain is not defined!");let s=n!==`${t}@${r}`?n:"";return s+="\0",s+=t,s+="\0",s+=i,G(s)}},ae.SASLSHA1=class extends q{constructor(e="SCRAM-SHA-1",t=!0,n=60){super(e,t,n)}test(e){return null!==e.authcid}onChallenge(e,t){let n,r,i,s,o,a,c,u,d="c=biws,",l=`${e._sasl_data["client-first-message-bare"]},${t},`;const h=e._sasl_data.cnonce,f=/([a-z]+)=([^,]+)(,|$)/;for(;t.match(f);){const e=t.match(f);switch(t=t.replace(e[0],""),e[1]){case"r":n=e[2];break;case"s":r=e[2];break;case"i":i=e[2]}}if(n.substr(0,h.length)!==h)return e._sasl_data={},e._sasl_failure_cb();d+="r="+n,l+=d,r=atob(r),r+="\0\0\0";const p=G(e.pass);for(s=a=te.core_hmac_sha1(p,r),c=1;c<i;c++){for(o=te.core_hmac_sha1(p,te.binb2str(a)),u=0;u<5;u++)s[u]^=o[u];a=o}s=te.binb2str(s);const g=te.core_hmac_sha1(s,"Client Key"),m=te.str_hmac_sha1(s,"Server Key"),v=te.core_hmac_sha1(te.str_sha1(te.binb2str(g)),l);for(e._sasl_data["server-signature"]=te.b64_hmac_sha1(m,l),u=0;u<5;u++)g[u]^=v[u];return d+=",p="+btoa(te.binb2str(g)),d}clientChallenge(e,t){const n=t||H.hexdigest(""+1234567890*Math.random());let r="n="+G(e.authcid);return r+=",r=",r+=n,e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=r,r="n,,"+r,r}},ae.SASLOAuthBearer=class extends q{constructor(e="OAUTHBEARER",t=!0,n=40){super(e,t,n)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",G(t)}},ae.SASLExternal=class extends q{constructor(e="EXTERNAL",t=!0,n=10){super(e,t,n)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}},ae.SASLXOAuth2=class extends q{constructor(e="X-OAUTH2",t=!0,n=30){super(e,t,n)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,G(t)}};const ce={Strophe:ae,$build:re,$iq:se,$msg:ie,$pres:oe,SHA1:te,MD5:H,b64_hmac_sha1:te.b64_hmac_sha1,b64_sha1:te.b64_sha1,str_hmac_sha1:te.str_hmac_sha1,str_sha1:te.str_sha1};ae.Request=class{constructor(e,t,n,r){this.id=++ae._requestId,this.xmlData=e,this.data=ae.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()}getResponse(){let e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw ae.error("invalid response received"),ae.error("responseText: "+this.xhr.responseText),ae.error("responseXML: "+ae.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(ae.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=(new R).parseFromString(this.xhr.responseText,"application/xml").documentElement,!e)throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){ae.error("invalid response received: "+e.querySelector("parsererror").textContent),ae.error("responseText: "+this.xhr.responseText);const t=new Error;throw t.name=ae.ErrorCondition.BAD_FORMAT,t}}return e}_newXHR(){let e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},ae.Bosh=class e{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]}_buildBody(){const e=re("body",{rid:this.rid++,xmlns:ae.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":ae.NS.BOSH});n&&r.attrs({route:n});const i=this._conn._connect_cb;this._requests.push(new ae.Request(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()}_attach(e,t,n,r,i,s,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=ae.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=s||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(ae.Status.ATTACHED,null)}_restore(e,t,n,r,i){const s=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=s&&s.rid&&s.sid&&s.jid&&(null==e||ae.getBareJidFromJid(s.jid)===ae.getBareJidFromJid(e)||null===ae.getNodeFromJid(e)&&ae.getDomainFromJid(s.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(s.jid,s.sid,s.rid,t,n,r,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");ae.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(ae.Status.CONNFAIL,t)):this._conn._changeConnectStatus(ae.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(t),ae.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const r=e.getAttribute("hold");r&&(this.hold=parseInt(r,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const s=e.getAttribute("inactivity");s&&(this.inactivity=parseInt(s,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(t){const n=e._getRequestStatus(t),r=this._conn.protocolErrorHandlers.HTTP[n];r&&r.call(this,n)}_hitError(e){this.errors++,ae.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){ae.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new ae.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(ae.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":ae.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new ae.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(ae.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(ae.TIMEOUT*this.wait)&&(ae.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(ae.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){ae.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n}_onRequestStateChange(t,n){if(ae.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4!==n.xhr.readyState)return;const r=e._getRequestStatus(n);if(this.lastResponseHeaders=n.xhr.getAllResponseHeaders(),this._conn.disconnecting&&r>=400)return this._hitError(r),void this._callProtocolErrorHandlers(n);const i=r>0&&r<500,s=n.sends>this._conn.maxRetries;if((i||s)&&(this._removeRequest(n),ae.debug("request id "+n.id+" should now be removed")),200===r){const e=this._requests[0]===n;(this._requests[1]===n||e&&this._requests.length>0&&this._requests[0].age()>Math.floor(ae.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),ae.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0}else 0===r||r>=400&&r<600||r>=12e3?(ae.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(n),r>=400&&r<500&&(this._conn._changeConnectStatus(ae.Status.DISCONNECTING,null),this._conn._doDisconnect())):ae.error("request id "+n.id+"."+n.sends+" error "+r+" happened");i||s?s&&!this._conn.connected&&this._conn._changeConnectStatus(ae.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(t){let n=this._requests[t];const r=e._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const i=n.age(),s=!isNaN(i)&&i>Math.floor(ae.TIMEOUT*this.wait),o=null!==n.dead&&n.timeDead()>Math.floor(ae.SECONDARY_TIMEOUT*this.wait),a=4===n.xhr.readyState&&(r<1||r>=500);if((s||o||a)&&(o&&ae.error(`Request ${this._requests[t].id} timed out (secondary), restarting`),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[t]=new ae.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[t]),0===n.xhr.readyState){ae.debug("request id "+n.id+"."+n.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return ae.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(ae.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(n.date=new Date,this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.xhr.setRequestHeader(t,e[t])}n.xhr.send(n.data)};if(n.sends>1){const t=1e3*Math.min(Math.floor(ae.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout((function(){e()}),t)}else e();n.sends++,this._conn.xmlOutput!==ae.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==ae.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else ae.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+n.xhr.readyState)}_removeRequest(e){ae.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){ae.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());const n=new ae.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?ae.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):ae.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},ae.Bosh.prototype.strip=null,ae.Websocket=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}}_buildStream(){return re("open",{xmlns:ae.NS.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(ae.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const r=n[0];let i="",s="";for(let e=0;e<r.childNodes.length;e++){const t=r.childNodes[e];if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break;"text"===t.nodeName?s=t.textContent:i=t.nodeName}let o="WebSocket stream error: ";return o+=i||"unknown",s&&(o+=" - "+s),ae.error(o),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new M(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,ae.Status.CONNFAIL))return ae.Status.CONNFAIL}_handleStreamStart(e){let t=!1;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==ae.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);const r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(ae.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new R).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new R).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(ae.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(ae.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),n=(new R).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(n,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==M.CLOSED){e&&this._conn.send(e);const t=re("close",{xmlns:ae.NS.FRAMING});this._conn.xmlOutput(t.tree());const n=ae.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){ae.warn("Couldn't send <close /> tag.")}}setTimeout((()=>this._conn._doDisconnect),0)}_doDisconnect(){ae.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){ae.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(ae.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(ae.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(ae.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):ae.debug("Websocket closed")}_no_auth_received(e){ae.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(ae.Status.CONNFAIL,ae.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){ae.error("Websocket error "+e),this._conn._changeConnectStatus(ae.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){let n;n="restart"===e[t]?this._buildStream().tree():e[t];const r=ae.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}}_onMessage(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new R).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new R).parseFromString(n,"text/xml").documentElement}return this._checkStreamError(t,ae.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(ae.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){ae.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=ae.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_reqToData(e){return e}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const ue={};ue.debug=ae.LogLevel.DEBUG,ue.info=ae.LogLevel.INFO,ue.warn=ae.LogLevel.WARN,ue.error=ae.LogLevel.ERROR,ue.fatal=ae.LogLevel.FATAL,ae.WorkerWebsocket=class extends ae.Websocket{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{var t;null===(t=console)||void 0===t||t.error(e),ae.log(ae.LogLevel.ERROR,`Shared Worker Error: ${e}`)}}get socket(){return{send:e=>this.worker.port.postMessage(["send",e])}}_connect(){this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===ae.Status.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(ae.Status.ATTACHED)):e===ae.Status.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(ae.Status.ATTACHFAIL))}_disconnect(e,t){t&&this._conn.send(t);const n=re("close",{xmlns:ae.NS.FRAMING});this._conn.xmlOutput(n.tree());const r=ae.serialize(n);this._conn.rawOutput(r),this.worker.port.postMessage(["send",r]),this._conn._doDisconnect()}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(ae.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected?(ae.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(ae.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):ae.debug("Websocket closed")}_closeSocket(){this.worker.port.postMessage(["_closeSocket"])}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){ae.log(ae.LogLevel.ERROR,e)}else if("log"===n){const e=t[1],n=t[2];ae.log(ue[e],n)}else ae.log(ae.LogLevel.ERROR,`Found unhandled service worker message: ${t}`)}},o.g.$build=ce.$build,o.g.$iq=ce.$iq,o.g.$msg=ce.$msg,o.g.$pres=ce.$pres,o.g.Strophe=ce.Strophe;const{b64_sha1:de}=te,le={};le[ae.Status.ATTACHED]="ATTACHED",le[ae.Status.AUTHENTICATING]="AUTHENTICATING",le[ae.Status.AUTHFAIL]="AUTHFAIL",le[ae.Status.CONNECTED]="CONNECTED",le[ae.Status.CONNECTING]="CONNECTING",le[ae.Status.CONNFAIL]="CONNFAIL",le[ae.Status.DISCONNECTED]="DISCONNECTED",le[ae.Status.DISCONNECTING]="DISCONNECTING",le[ae.Status.ERROR]="ERROR",le[ae.Status.RECONNECTING]="RECONNECTING",le[ae.Status.REDIRECT]="REDIRECT";const he=["converse-adhoc","converse-bookmarks","converse-bosh","converse-caps","converse-carbons","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],fe={start:/(\b|_)(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi},pe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},ge=function(e){if(!pe(e))return!1;var t=m(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},me=c["__core-js_shared__"];var ve,_e=(ve=/[^.]+$/.exec(me&&me.keys&&me.keys.IE_PROTO||""))?"Symbol(src)_1."+ve:"";var ye=Function.prototype.toString;const be=function(e){if(null!=e){try{return ye.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var we=/^\[object .+?Constructor\]$/,Se=Function.prototype,Ee=Object.prototype,xe=Se.toString,Ae=Ee.hasOwnProperty,Ne=RegExp("^"+xe.call(Ae).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const je=function(e){return!(!pe(e)||(t=e,_e&&_e in t))&&(ge(e)?Ne:we).test(be(e));var t},Te=function(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return je(n)?n:void 0},Ce=function(){try{var e=Te(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Ie=function(e,t,n){"__proto__"==t&&Ce?Ce(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Oe=function(e,t){return e===t||e!=e&&t!=t};var ke=Object.prototype.hasOwnProperty;const Me=function(e,t,n){var r=e[t];ke.call(e,t)&&Oe(r,n)&&(void 0!==n||t in e)||Ie(e,t,n)},Re=function(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?Ie(n,a,c):Me(n,a,c)}return n},De=function(e){return e},Fe=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Le=Math.max;const Pe=function(e,t,n){return t=Le(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Le(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),Fe(e,this,a)}},Ue=function(e){return function(){return e}},$e=Ce?function(e,t){return Ce(e,"toString",{configurable:!0,enumerable:!1,value:Ue(t),writable:!0})}:De;var ze=Date.now;const Be=(He=$e,qe=0,Ge=0,function(){var e=ze(),t=16-(e-Ge);if(Ge=e,t>0){if(++qe>=800)return arguments[0]}else qe=0;return He.apply(void 0,arguments)});var He,qe,Ge;const We=function(e,t){return Be(Pe(e,t,De),e+"")},Je=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Qe=function(e){return null!=e&&Je(e.length)&&!ge(e)};var Ve=/^(?:0|[1-9]\d*)$/;const Ye=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Ve.test(e))&&e>-1&&e%1==0&&e<t},Xe=function(e,t,n){if(!pe(n))return!1;var r=typeof t;return!!("number"==r?Qe(n)&&Ye(t,n.length):"string"==r&&t in n)&&Oe(n[t],e)},Ke=function(e){return We((function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,o&&Xe(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t}))},Ze=function(e){return i(e)&&"[object Arguments]"==m(e)};var et=Object.prototype,tt=et.hasOwnProperty,nt=et.propertyIsEnumerable;const rt=Ze(function(){return arguments}())?Ze:function(e){return i(e)&&tt.call(e,"callee")&&!nt.call(e,"callee")},it=Array.isArray;var st="object"==typeof exports&&exports&&!exports.nodeType&&exports,ot=st&&"object"==typeof module&&module&&!module.nodeType&&module,at=ot&&ot.exports===st?c.Buffer:void 0;const ct=(at?at.isBuffer:void 0)||function(){return!1};var ut={};ut["[object Float32Array]"]=ut["[object Float64Array]"]=ut["[object Int8Array]"]=ut["[object Int16Array]"]=ut["[object Int32Array]"]=ut["[object Uint8Array]"]=ut["[object Uint8ClampedArray]"]=ut["[object Uint16Array]"]=ut["[object Uint32Array]"]=!0,ut["[object Arguments]"]=ut["[object Array]"]=ut["[object ArrayBuffer]"]=ut["[object Boolean]"]=ut["[object DataView]"]=ut["[object Date]"]=ut["[object Error]"]=ut["[object Function]"]=ut["[object Map]"]=ut["[object Number]"]=ut["[object Object]"]=ut["[object RegExp]"]=ut["[object Set]"]=ut["[object String]"]=ut["[object WeakMap]"]=!1;const dt=function(e){return function(t){return e(t)}};var lt="object"==typeof exports&&exports&&!exports.nodeType&&exports,ht=lt&&"object"==typeof module&&module&&!module.nodeType&&module,ft=ht&&ht.exports===lt&&s.process;const pt=function(){try{return ht&&ht.require&&ht.require("util").types||ft&&ft.binding&&ft.binding("util")}catch(e){}}();var gt=pt&&pt.isTypedArray;const mt=gt?dt(gt):function(e){return i(e)&&Je(e.length)&&!!ut[m(e)]};var vt=Object.prototype.hasOwnProperty;const _t=function(e,t){var n=it(e),r=!n&&rt(e),i=!n&&!r&&ct(e),s=!n&&!r&&!i&&mt(e),o=n||r||i||s,a=o?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=a.length;for(var u in e)!t&&!vt.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ye(u,c))||a.push(u);return a};var yt=Object.prototype;const bt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||yt)};var wt=Object.prototype.hasOwnProperty;const St=function(e){if(!pe(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=bt(e),n=[];for(var r in e)("constructor"!=r||!t&&wt.call(e,r))&&n.push(r);return n},Et=function(e){return Qe(e)?_t(e,!0):St(e)},xt=Ke((function(e,t){Re(t,Et(t),e)})),At=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Nt=function(e,t){for(var n=e.length;n--;)if(Oe(e[n][0],t))return n;return-1};var jt=Array.prototype.splice;function Tt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Tt.prototype.clear=function(){this.__data__=[],this.size=0},Tt.prototype.delete=function(e){var t=this.__data__,n=Nt(t,e);return!(n<0||(n==t.length-1?t.pop():jt.call(t,n,1),--this.size,0))},Tt.prototype.get=function(e){var t=this.__data__,n=Nt(t,e);return n<0?void 0:t[n][1]},Tt.prototype.has=function(e){return Nt(this.__data__,e)>-1},Tt.prototype.set=function(e,t){var n=this.__data__,r=Nt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};const Ct=Tt,It=Te(c,"Map"),Ot=Te(Object,"create");var kt=Object.prototype.hasOwnProperty;var Mt=Object.prototype.hasOwnProperty;function Rt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Rt.prototype.clear=function(){this.__data__=Ot?Ot(null):{},this.size=0},Rt.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Rt.prototype.get=function(e){var t=this.__data__;if(Ot){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return kt.call(t,e)?t[e]:void 0},Rt.prototype.has=function(e){var t=this.__data__;return Ot?void 0!==t[e]:Mt.call(t,e)},Rt.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ot&&void 0===t?"__lodash_hash_undefined__":t,this};const Dt=Rt,Ft=function(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map};function Lt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Lt.prototype.clear=function(){this.size=0,this.__data__={hash:new Dt,map:new(It||Ct),string:new Dt}},Lt.prototype.delete=function(e){var t=Ft(this,e).delete(e);return this.size-=t?1:0,t},Lt.prototype.get=function(e){return Ft(this,e).get(e)},Lt.prototype.has=function(e){return Ft(this,e).has(e)},Lt.prototype.set=function(e,t){var n=Ft(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};const Pt=Lt;function Ut(e){var t=this.__data__=new Ct(e);this.size=t.size}Ut.prototype.clear=function(){this.__data__=new Ct,this.size=0},Ut.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ut.prototype.get=function(e){return this.__data__.get(e)},Ut.prototype.has=function(e){return this.__data__.has(e)},Ut.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ct){var r=n.__data__;if(!It||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Pt(r)}return n.set(e,t),this.size=n.size,this};const $t=Ut;function zt(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Pt;++t<n;)this.add(e[t])}zt.prototype.add=zt.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},zt.prototype.has=function(e){return this.__data__.has(e)};const Bt=zt,Ht=function(e,t){return e.has(t)},qt=function(e,t,n,r,i,s){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),d=s.get(t);if(u&&d)return u==t&&d==e;var l=-1,h=!0,f=2&n?new Bt:void 0;for(s.set(e,t),s.set(t,e);++l<a;){var p=e[l],g=t[l];if(r)var m=o?r(g,p,l,t,e,s):r(p,g,l,e,t,s);if(void 0!==m){if(m)continue;h=!1;break}if(f){if(!At(t,(function(e,t){if(!Ht(f,t)&&(p===e||i(p,e,n,r,s)))return f.push(t)}))){h=!1;break}}else if(p!==g&&!i(p,g,n,r,s)){h=!1;break}}return s.delete(e),s.delete(t),h},Gt=c.Uint8Array,Wt=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},Jt=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var Qt=u?u.prototype:void 0,Vt=Qt?Qt.valueOf:void 0;const Yt=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Xt=function(e,t,n){var r=t(e);return it(e)?r:Yt(r,n(e))},Kt=function(){return[]};var Zt=Object.prototype.propertyIsEnumerable,en=Object.getOwnPropertySymbols;const tn=en?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}(en(e),(function(t){return Zt.call(e,t)})))}:Kt,nn=v(Object.keys,Object);var rn=Object.prototype.hasOwnProperty;const sn=function(e){if(!bt(e))return nn(e);var t=[];for(var n in Object(e))rn.call(e,n)&&"constructor"!=n&&t.push(n);return t},on=function(e){return Qe(e)?_t(e):sn(e)},an=function(e){return Xt(e,on,tn)};var cn=Object.prototype.hasOwnProperty;const un=Te(c,"DataView"),dn=Te(c,"Promise"),ln=Te(c,"Set"),hn=Te(c,"WeakMap");var fn="[object Map]",pn="[object Promise]",gn="[object Set]",mn="[object WeakMap]",vn="[object DataView]",_n=be(un),yn=be(It),bn=be(dn),wn=be(ln),Sn=be(hn),En=m;(un&&En(new un(new ArrayBuffer(1)))!=vn||It&&En(new It)!=fn||dn&&En(dn.resolve())!=pn||ln&&En(new ln)!=gn||hn&&En(new hn)!=mn)&&(En=function(e){var t=m(e),n="[object Object]"==t?e.constructor:void 0,r=n?be(n):"";if(r)switch(r){case _n:return vn;case yn:return fn;case bn:return pn;case wn:return gn;case Sn:return mn}return t});const xn=En;var An="[object Arguments]",Nn="[object Array]",jn="[object Object]",Tn=Object.prototype.hasOwnProperty;const Cn=function(e,t,n,r,i,s){var o=it(e),a=it(t),c=o?Nn:xn(e),u=a?Nn:xn(t),d=(c=c==An?jn:c)==jn,l=(u=u==An?jn:u)==jn,h=c==u;if(h&&ct(e)){if(!ct(t))return!1;o=!0,d=!1}if(h&&!d)return s||(s=new $t),o||mt(e)?qt(e,t,n,r,i,s):function(e,t,n,r,i,s,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new Gt(e),new Gt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Oe(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Wt;case"[object Set]":var c=1&r;if(a||(a=Jt),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=2,o.set(e,t);var d=qt(a(e),a(t),r,i,s,o);return o.delete(e),d;case"[object Symbol]":if(Vt)return Vt.call(e)==Vt.call(t)}return!1}(e,t,c,n,r,i,s);if(!(1&n)){var f=d&&Tn.call(e,"__wrapped__"),p=l&&Tn.call(t,"__wrapped__");if(f||p){var g=f?e.value():e,m=p?t.value():t;return s||(s=new $t),i(g,m,n,r,s)}}return!!h&&(s||(s=new $t),function(e,t,n,r,i,s){var o=1&n,a=an(e),c=a.length;if(c!=an(t).length&&!o)return!1;for(var u=c;u--;){var d=a[u];if(!(o?d in t:cn.call(t,d)))return!1}var l=s.get(e),h=s.get(t);if(l&&h)return l==t&&h==e;var f=!0;s.set(e,t),s.set(t,e);for(var p=o;++u<c;){var g=e[d=a[u]],m=t[d];if(r)var v=o?r(m,g,d,t,e,s):r(g,m,d,e,t,s);if(!(void 0===v?g===m||i(g,m,n,r,s):v)){f=!1;break}p||(p="constructor"==d)}if(f&&!p){var _=e.constructor,y=t.constructor;_==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y||(f=!1)}return s.delete(e),s.delete(t),f}(e,t,n,r,i,s))},In=function e(t,n,r,s,o){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:Cn(t,n,r,s,e,o))},On=function(e,t,n,r){var i=n.length,s=i,o=!r;if(null==e)return!s;for(e=Object(e);i--;){var a=n[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){var c=(a=n[i])[0],u=e[c],d=a[1];if(o&&a[2]){if(void 0===u&&!(c in e))return!1}else{var l=new $t;if(r)var h=r(u,d,c,e,t,l);if(!(void 0===h?In(d,u,3,r,l):h))return!1}}return!0},kn=function(e){return e==e&&!pe(e)},Mn=function(e){for(var t=on(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,kn(i)]}return t},Rn=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},Dn=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==m(e)};var Fn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ln=/^\w*$/;const Pn=function(e,t){if(it(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Dn(e))||Ln.test(e)||!Fn.test(e)||null!=t&&e in Object(t)};function Un(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Un.Cache||Pt),n}Un.Cache=Pt;var $n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zn=/\\(\\)?/g;const Bn=(Hn=Un((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace($n,(function(e,n,r,i){t.push(r?i.replace(zn,"$1"):n||e)})),t}),(function(e){return 500===qn.size&&qn.clear(),e})),qn=Hn.cache,Hn);var Hn,qn;const Gn=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var Wn=u?u.prototype:void 0,Jn=Wn?Wn.toString:void 0;const Qn=function e(t){if("string"==typeof t)return t;if(it(t))return Gn(t,e)+"";if(Dn(t))return Jn?Jn.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n},Vn=function(e){return null==e?"":Qn(e)},Yn=function(e,t){return it(e)?e:Pn(e,t)?[e]:Bn(Vn(e))},Xn=function(e){if("string"==typeof e||Dn(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},Kn=function(e,t){for(var n=0,r=(t=Yn(t,e)).length;null!=e&&n<r;)e=e[Xn(t[n++])];return n&&n==r?e:void 0},Zn=function(e,t){return null!=e&&t in Object(e)},er=function(e,t,n){for(var r=-1,i=(t=Yn(t,e)).length,s=!1;++r<i;){var o=Xn(t[r]);if(!(s=null!=e&&n(e,o)))break;e=e[o]}return s||++r!=i?s:!!(i=null==e?0:e.length)&&Je(i)&&Ye(o,i)&&(it(e)||rt(e))},tr=function(e,t){return null!=e&&er(e,t,Zn)},nr=function(e,t){return Pn(e)&&kn(t)?Rn(Xn(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:Kn(e,t);return void 0===r?n:r}(n,e);return void 0===r&&r===t?tr(n,e):In(t,r,3)}},rr=function(e){return Pn(e)?(t=Xn(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return Kn(t,e)}}(e);var t},ir=function(e){return"function"==typeof e?e:null==e?De:"object"==typeof e?it(e)?nr(e[0],e[1]):1==(n=Mn(t=e)).length&&n[0][2]?Rn(n[0][0],n[0][1]):function(e){return e===t||On(e,t,n)}:rr(e);var t,n},sr=function(e,t,n){for(var r=-1,i=Object(e),s=n(e),o=s.length;o--;){var a=s[++r];if(!1===t(i[a],a,i))break}return e},or=function(e,t){return e&&sr(e,t,on)},ar=(cr=or,function(e,t){if(null==e)return e;if(!Qe(e))return cr(e,t);for(var n=e.length,r=-1,i=Object(e);++r<n&&!1!==t(i[r],r,i););return e});var cr;const ur=function(e,t){var n;return ar(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},dr=function(e,t,n){var r=it(e)?At:ur;return n&&Xe(e,t,n)&&(t=void 0),r(e,ir(t))};var lr=Object.prototype.hasOwnProperty;const hr=function(e){if(null==e)return!0;if(Qe(e)&&(it(e)||"string"==typeof e||"function"==typeof e.splice||ct(e)||mt(e)||rt(e)))return!e.length;var t=xn(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(bt(e))return!sn(e).length;for(var n in e)if(lr.call(e,n))return!1;return!0};var fr=/\s/;var pr=/^\s+/;const gr=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&fr.test(e.charAt(t)););return t}(e)+1).replace(pr,""):e};var mr=/^[-+]0x[0-9a-f]+$/i,vr=/^0b[01]+$/i,_r=/^0o[0-7]+$/i,yr=parseInt;const br=function(e){if("number"==typeof e)return e;if(Dn(e))return NaN;if(pe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=pe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=gr(e);var n=vr.test(e);return n||_r.test(e)?yr(e.slice(2),n?2:8):mr.test(e)?NaN:+e};const wr=function(e){var t=function(e){return e?1/0===(e=br(e))||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),n=t%1;return t==t?n?t-n:t:0},Sr=function(e){return function(e,t){var n;if("function"!=typeof t)throw new TypeError("Expected a function");return e=wr(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}(2,e)};var Er=0;const xr=function(e){var t=++Er;return Vn(e)+t},Ar={},Nr=/\s+/;let jr;const Tr=function(e,t,n,r,i){let s,o=0;if(n&&"object"==typeof n){void 0!==r&&"context"in i&&void 0===i.context&&(i.context=r);for(s=on(n);o<s.length;o++)t=Tr(e,t,s[o],n[s[o]],i)}else if(n&&Nr.test(n))for(s=n.split(Nr);o<s.length;o++)t=e(t,s[o],r,i);else t=e(t,n,r,i);return t};Ar.on=function(e,t,n){return this._events=Tr(Cr,this._events||{},e,t,{context:n,ctx:this,listening:jr}),jr&&((this._listeners||(this._listeners={}))[jr.id]=jr,jr.interop=!1),this},Ar.listenTo=function(e,t,n){if(!e)return this;const r=e._listenId||(e._listenId=xr("l")),i=this._listeningTo||(this._listeningTo={});let s=jr=i[r];s||(this._listenId||(this._listenId=xr("l")),s=jr=i[r]=new Dr(this,e));const o=Ir(e,t,n,this);if(jr=void 0,o)throw o;return s.interop&&s.on(t,n),this};const Cr=function(e,t,n,r){if(n){const i=e[t]||(e[t]=[]),s=r.context,o=r.ctx,a=r.listening;a&&a.count++,i.push({callback:n,context:s,ctx:s||o,listening:a})}return e},Ir=function(e,t,n,r){try{e.on(t,n,r)}catch(e){return e}};Ar.off=function(e,t,n){return this._events?(this._events=Tr(Or,this._events,e,t,{context:n,listeners:this._listeners}),this):this},Ar.stopListening=function(e,t,n){const r=this._listeningTo;if(!r)return this;const i=e?[e._listenId]:on(r);for(let e=0;e<i.length;e++){const s=r[i[e]];if(!s)break;s.obj.off(t,n,this),s.interop&&s.off(t,n)}return hr(r)&&(this._listeningTo=void 0),this};const Or=function(e,t,n,r){if(!e)return;const i=r.context,s=r.listeners;let o,a=0;if(t||i||n){for(o=t?[t]:on(e);a<o.length;a++){const r=e[t=o[a]];if(!r)break;const s=[];for(let e=0;e<r.length;e++){const o=r[e];if(n&&n!==o.callback&&n!==o.callback._callback||i&&i!==o.context)s.push(o);else{const e=o.listening;e&&e.off(t,n)}}s.length?e[t]=s:delete e[t]}return e}for(o=on(s);a<o.length;a++)s[o[a]].cleanup()};Ar.once=function(e,t,n){const r=Tr(kr,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(r,t,n)},Ar.listenToOnce=function(e,t,n){const r=Tr(kr,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,r)};const kr=function(e,t,n,r){if(n){const i=e[t]=Sr((function(){r(t,i),n.apply(this,arguments)}));i._callback=n}return e};Ar.trigger=function(e){if(!this._events)return this;const t=Math.max(0,arguments.length-1),n=Array(t);for(let e=0;e<t;e++)n[e]=arguments[e+1];return Tr(Mr,this._events,e,void 0,n),this};const Mr=function(e,t,n,r){if(e){const n=e[t];let i=e.all;n&&i&&(i=i.slice()),n&&Rr(n,r),i&&Rr(i,[t].concat(r))}return e},Rr=function(e,t){let n,r=-1;const i=e.length,s=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s,o,a);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t);return}},Dr=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};Dr.prototype.on=Ar.on,Dr.prototype.off=function(e,t){let n;this.interop?(this._events=Tr(Or,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},Dr.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},Ar.bind=Ar.on,Ar.unbind=Ar.off;const Fr=function(e,t){return e&&Re(t,on(t),e)};var Lr=Object.create;const Pr=function(){function e(){}return function(t){if(!pe(t))return{};if(Lr)return Lr(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var Ur=Object.prototype.hasOwnProperty;const $r=function(e,t){return null!=e&&Ur.call(e,t)},zr=function(e,t){return null!=e&&er(e,t,$r)},Br=function(e,t,n){var r=-1,i=(t=Yn(t,e)).length;for(i||(i=1,e=void 0);++r<i;){var s=null==e?void 0:e[Xn(t[r])];void 0===s&&(r=i,s=n),e=ge(s)?s.call(e):s}return e};function Hr(e,t){const n=this;let r;return r=e&&zr(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},xt(r,n,t),r.prototype=function(e,t){var n=Pr(e);return null==t?n:Fr(n,t)}(n.prototype,e),r.prototype.constructor=r,r.__super__=n.prototype,r}function qr(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function Gr(){throw new Error('A "url" property or function must be specified')}function Wr(e,t){const n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}}Error;const Jr={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function Qr(e){const t=Br(e,"browserStorage")||Br(e.collection,"browserStorage");return t?t.sync():Vr}function Vr(e,t,n={}){const r={type:Jr[e],dataType:"json"};n.url||(r.url=Br(t,"url")||Gr()),null!=n.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(r.contentType="application/json",r.data=JSON.stringify(n.attrs||t.toJSON(n))),"GET"!==r.type&&(r.processData=!1);const i=n.error;n.error=function(e,t,r){n.textStatus=t,n.errorThrown=r,i&&i.call(n.context,e,t,r)};const s=n.xhr=function(){return fetch.apply(this,arguments)}(xt(r,n));return t.trigger("request",t,s,n),s}const Yr=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)};Yr.extend=Hr;const Xr=/^[#\/]|\s+$/g,Kr=/^\/+|\/+$/g,Zr=/#.*$/;Yr.started=!1,Object.assign(Yr.prototype,Ar,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){const e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){const t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){const e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(Xr,"")},start:function(e){if(Yr.started)throw new Error("history has already been started");if(Yr.started=!0,this.options=xt({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(Kr,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){const e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;const e=document.body,t=e.insertBefore(this.iframe,e.firstChild).contentWindow;t.document.open(),t.document.close(),t.location.hash="#"+this.fragment}if(this._usePushState?addEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?addEventListener("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){this._usePushState?removeEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&removeEventListener("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),Yr.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){let t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),dr(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!Yr.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");let n=this.root;""!==e&&"?"!==e.charAt(0)||(n=n.slice(0,-1)||"/");const r=n+e;e=e.replace(Zr,"");const i=this.decodeFragment(e);if(this.fragment!==i){if(this.fragment=i,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){const n=this.iframe.contentWindow;t.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){const n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}});const ei=Yr;var ti=pt&&pt.isRegExp;const ni=ti?dt(ti):function(e){return i(e)&&"[object RegExp]"==m(e)},ri=function(e={}){this.history=e.history||new ei,this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};ri.extend=Hr;const ii=/\((.*?)\)/g,si=/(\(\?)?:\w+/g,oi=/\*\w+/g,ai=/[\-{}\[\]+?.,\\\^$|#\s]/g;Object.assign(ri.prototype,Ar,{preinitialize:function(){},initialize:function(){},route:function(e,t,n){return ni(e)||(e=this._routeToRegExp(e)),ge(t)&&(n=t,t=""),n||(n=this[t]),this.history.route(e,(r=>{const i=this._extractParameters(e,r);!1!==this.execute(n,i,t)&&(this.trigger.apply(this,["route:"+t].concat(i)),this.trigger("route",t,i),this.history.trigger("route",this,t,i))})),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,t){return this.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;let e;this.routes=Br(this,"routes");const t=on(this.routes);for(;null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(ai,"\\$&").replace(ii,"(?:$1)?").replace(si,(function(e,t){return t?e:"([^/?]+)"})).replace(oi,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){const n=e.exec(t).slice(1);return n.map((function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});class ci extends Error{}const ui=function(e,t,n){(void 0!==n&&!Oe(e[t],n)||void 0===n&&!(t in e))&&Ie(e,t,n)};var di="object"==typeof exports&&exports&&!exports.nodeType&&exports,li=di&&"object"==typeof module&&module&&!module.nodeType&&module,hi=li&&li.exports===di?c.Buffer:void 0,fi=hi?hi.allocUnsafe:void 0;const pi=function(e,t){if(t)return e.slice();var n=e.length,r=fi?fi(n):new e.constructor(n);return e.copy(r),r},gi=function(e){var t=new e.constructor(e.byteLength);return new Gt(t).set(new Gt(e)),t},mi=function(e,t){var n=t?gi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},vi=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},_i=function(e){return"function"!=typeof e.constructor||bt(e)?{}:Pr(_(e))},yi=function(e){return i(e)&&Qe(e)},bi=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},wi=function(e,t,n,r,i,s,o){var a,c=bi(e,n),u=bi(t,n),d=o.get(u);if(d)ui(e,n,d);else{var l=s?s(c,u,n+"",e,t,o):void 0,h=void 0===l;if(h){var f=it(u),p=!f&&ct(u),g=!f&&!p&&mt(u);l=u,f||p||g?it(c)?l=c:yi(c)?l=vi(c):p?(h=!1,l=pi(u,!0)):g?(h=!1,l=mi(u,!0)):l=[]:x(u)||rt(u)?(l=c,rt(c)?l=Re(a=c,Et(a)):pe(c)&&!ge(c)||(l=_i(u))):h=!1}h&&(o.set(u,l),i(l,u,r,s,o),o.delete(u)),ui(e,n,l)}},Si=function e(t,n,r,i,s){t!==n&&sr(n,(function(o,a){if(s||(s=new $t),pe(o))wi(t,n,a,r,e,i,s);else{var c=i?i(bi(t,a),o,a+"",t,n,s):void 0;void 0===c&&(c=o),ui(t,a,c)}}),Et)},Ei=Ke((function(e,t,n){Si(e,t,n)})),xi=Ke((function(e,t,n,r){Si(e,t,n,r)})),Ai=function(){return c.Date.now()};function Ni(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}const ji=Math.max,Ti=Math.min,Ci=function(e,t,n={}){let r,i,s,o,a,c,u=0,d=!1,l=n.promise?Ni():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const s=r,a=i;return r=i=void 0,u=t,o=e.apply(a,s),n.promise&&(l.resolve(o),l=Ni()),n.promise?l:o}function f(e){return u=e,a=setTimeout(g,t),n.promise?l:o}function p(e){const n=e-c;return void 0===c||n>=t||n<0||d&&e-u>=s}function g(){const e=Ai();if(p(e))return m(e);a=setTimeout(g,function(e){const n=t-(e-c);return d?Ti(n,s-(e-u)):n}(e))}function m(e){return a=void 0,r?h(e):(r=i=void 0,n.promise?l:o)}function v(e,t){if(Array.isArray(e)&&Array.isArray(t))return null!=n&&n.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function _(e){var t;return null!==(t=r)&&void 0!==t&&t.length?e.length?null!=n&&n.concatArrays||null!=n&&n.dedupeArrays?xi(r,e,v):Ei(r,e):r:e||[]}function y(){const e=Ai(),s=p(e);if(r=_(Array.from(arguments)),i=this,c=e,s){if(void 0===a)return f(c);if(d)return clearTimeout(a),a=setTimeout(g,t),h(c)}return void 0===a&&(a=setTimeout(g,t)),n.promise?l:o}return t=br(t)||0,pe(n)&&(d="maxWait"in n,s=d?ji(br(n.maxWait)||0,t):s),y.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=c=i=a=void 0},y.flush=function(){return void 0===a?o:m(Ai())},y},Ii=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}(),Oi=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}};"undefined"==typeof Promise&&o(9236);const ki=Promise,Mi=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))},Ri=function(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)};function Di(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function Fi(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const Li="local-forage-detect-blob-support";let Pi;const Ui={},$i=Object.prototype.toString,zi="readonly",Bi="readwrite";function Hi(e){var t=Ui[e.name],n={};n.promise=new ki((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function qi(e){var t=Ui[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function Gi(e,t){var n=Ui[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function Wi(e,t){return new ki((function(n,r){if(Ui[e.name]=Ui[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);Hi(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=Ii.open.apply(Ii,i);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(Li)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),qi(e)}}))}function Ji(e){return Wi(e,!1)}function Qi(e){return Wi(e,!0)}function Vi(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function Yi(e){var t=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(atob(e.data));return Oi([t],{type:e.type})}function Xi(e){return e&&e.__local_forage_encoded_blob}function Ki(e){var t=this,n=t._initReady().then((function(){var e=Ui[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return Ri(n,e,e),n}function Zi(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return ki.resolve().then((()=>{if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),Qi(e)})).then((()=>function(e){Hi(e);for(var t=Ui[e.name],n=t.forages,r=0;r<n.length;r++){const e=n[r];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return e.db=null,Ji(e).then((t=>(e.db=t,Vi(e)?Qi(e):t))).then((r=>{e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((t=>{throw Gi(e,t),t}))}(e).then((function(){Zi(e,t,n,r-1)})))).catch(n);n(i)}}const es={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=Ui[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},Ui[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=Ki);var s=[];function o(){return ki.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&s.push(c._initReady().catch(o))}var u=i.forages.slice(0);return ki.all(s).then((function(){return n.db=i.db,Ji(n)})).then((function(e){return n.db=e,Vi(n,t._defaultConfig.version)?Qi(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var s=u[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))},_support:function(){try{if(!Ii||!Ii.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new ki((function(t,r){n.ready().then((function(){Zi(n._dbInfo,zi,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;Xi(r)&&(r=Yi(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return Mi(r,t),r},getItem:function(e,t){var n=this;e=Di(e);var r=new ki((function(t,r){n.ready().then((function(){Zi(n._dbInfo,zi,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),Xi(e)&&(e=Yi(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return Mi(r,t),r},setItem:function(e,t,n){var r=this;e=Di(e);var i=new ki((function(n,i){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===$i.call(t)?(e=s.db,"boolean"==typeof Pi?ki.resolve(Pi):function(e){return new ki((function(t){var n=e.transaction(Li,Bi),r=Oi([""]);n.objectStore(Li).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return Pi=e,Pi}))).then((function(e){return e?t:(n=t,new ki((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t;var e})).then((function(t){Zi(r._dbInfo,Bi,(function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return Mi(i,n),i},removeItem:function(e,t){var n=this;e=Di(e);var r=new ki((function(t,r){n.ready().then((function(){Zi(n._dbInfo,Bi,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(o.error)},s.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return Mi(r,t),r},clear:function(e){var t=this,n=new ki((function(e,n){t.ready().then((function(){Zi(t._dbInfo,Bi,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return Mi(n,e),n},length:function(e){var t=this,n=new ki((function(e,n){t.ready().then((function(){Zi(t._dbInfo,zi,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return Mi(n,e),n},key:function(e,t){var n=this,r=new ki((function(t,r){e<0?t(null):n.ready().then((function(){Zi(n._dbInfo,zi,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return Mi(r,t),r},keys:function(e){var t=this,n=new ki((function(e,n){t.ready().then((function(){Zi(t._dbInfo,zi,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var t=s.result;t?(o.push(t.key),t.continue()):e(o)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return Mi(n,e),n},dropInstance:function(e,t){t=Fi.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){const t=e.name===n.name&&i._dbInfo.db?ki.resolve(i._dbInfo.db):Ji(e).then((t=>{const n=Ui[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?t.then((t=>{if(!t.objectStoreNames.contains(e.storeName))return;const n=t.version+1;Hi(e);const r=Ui[e.name],i=r.forages;t.close();for(let e=0;e<i.length;e++){const t=i[e];t._dbInfo.db=null,t._dbInfo.version=n}return new ki(((t,r)=>{const i=Ii.open(e.name,n);i.onerror=e=>{i.result.close(),r(e)},i.onupgradeneeded=()=>{i.result.deleteObjectStore(e.storeName)},i.onsuccess=()=>{const e=i.result;e.close(),t(e)}})).then((e=>{r.db=e;for(let t=0;t<i.length;t++){const n=i[t];n._dbInfo.db=e,qi(n._dbInfo)}})).catch((t=>{throw(Gi(e,t)||ki.resolve()).catch((()=>{})),t}))})):t.then((t=>{Hi(e);const n=Ui[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;return new ki(((t,n)=>{var r=Ii.deleteDatabase(e.name);r.onerror=()=>{const e=r.result;e&&e.close(),n(r.error)},r.onblocked=()=>{console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=()=>{const e=r.result;e&&e.close(),t(e)}})).then((e=>{n.db=e;for(var t=0;t<r.length;t++)qi(r[t]._dbInfo)})).catch((t=>{throw(Gi(e,t)||ki.resolve()).catch((()=>{})),t}))}))}else r=ki.reject("Invalid arguments");return Mi(r,t),r}};var ts="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ns=/^~~local_forage_type~([^~]+)~/,rs="__lfsc__:",is=rs.length,ss="arbf",os="blob",as="si08",cs="ui08",us="uic8",ds="si16",ls="si32",hs="ur16",fs="ui32",ps="fl32",gs="fl64",ms=is+ss.length,vs=Object.prototype.toString;function _s(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),d=new Uint8Array(u);for(t=0;t<a;t+=4)n=ts.indexOf(e[t]),r=ts.indexOf(e[t+1]),i=ts.indexOf(e[t+2]),s=ts.indexOf(e[t+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&s;return u}function ys(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=ts[n[t]>>2],r+=ts[(3&n[t])<<4|n[t+1]>>4],r+=ts[(15&n[t+1])<<2|n[t+2]>>6],r+=ts[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}const bs={serialize:function(e,t){var n="";if(e&&(n=vs.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===vs.call(e.buffer))){var r,i=rs;e instanceof ArrayBuffer?(r=e,i+=ss):(r=e.buffer,"[object Int8Array]"===n?i+=as:"[object Uint8Array]"===n?i+=cs:"[object Uint8ClampedArray]"===n?i+=us:"[object Int16Array]"===n?i+=ds:"[object Uint16Array]"===n?i+=hs:"[object Int32Array]"===n?i+=ls:"[object Uint32Array]"===n?i+=fs:"[object Float32Array]"===n?i+=ps:"[object Float64Array]"===n?i+=gs:t(new Error("Failed to get type for BinaryArray"))),t(i+ys(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+ys(this.result);t("__lfsc__:blob"+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,is)!==rs)return JSON.parse(e);var t,n=e.substring(ms),r=e.substring(is,ms);if(r===os&&ns.test(n)){var i=n.match(ns);t=i[1],n=n.substring(i[0].length)}var s=_s(n);switch(r){case ss:return s;case os:return Oi([s],{type:t});case as:return new Int8Array(s);case cs:return new Uint8Array(s);case us:return new Uint8ClampedArray(s);case ds:return new Int16Array(s);case hs:return new Uint16Array(s);case ls:return new Int32Array(s);case fs:return new Uint32Array(s);case ps:return new Float32Array(s);case gs:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}},stringToBuffer:_s,bufferToString:ys};function ws(e,t,n,r){e.executeSql(`CREATE TABLE IF NOT EXISTS ${t.storeName} (id INTEGER PRIMARY KEY, key unique, value)`,[],n,r)}function Ss(e,t,n,r,i,s){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?s(e,o):ws(e,t,(function(){e.executeSql(n,r,i,s)}),s)}),s):s(e,o)}),s)}function Es(e,t,n,r){var i=this;e=Di(e);var s=new ki((function(s,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,u){u?o(u):c.db.transaction((function(n){Ss(n,c,`INSERT OR REPLACE INTO ${c.storeName} (key, value) VALUES (?, ?)`,[e,t],(function(){s(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(Es.apply(i,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return Mi(s,n),s}function xs(e){return new ki((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}const As={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new ki((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){ws(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=bs,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new ki((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ss(n,i,`SELECT * FROM ${i.storeName}`,[],(function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var c=s.item(a),u=c.value;if(u&&(u=i.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return Mi(r,t),r},getItem:function(e,t){var n=this;e=Di(e);var r=new ki((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ss(n,i,`SELECT * FROM ${i.storeName} WHERE key = ? LIMIT 1`,[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return Mi(r,t),r},setItem:function(e,t,n){return Es.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=Di(e);var r=new ki((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ss(n,i,`DELETE FROM ${i.storeName} WHERE key = ?`,[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return Mi(r,t),r},clear:function(e){var t=this,n=new ki((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Ss(t,r,`DELETE FROM ${r.storeName}`,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return Mi(n,e),n},length:function(e){var t=this,n=new ki((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Ss(t,r,`SELECT COUNT(key) as c FROM ${r.storeName}`,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return Mi(n,e),n},key:function(e,t){var n=this,r=new ki((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ss(n,i,`SELECT key FROM ${i.storeName} WHERE id = ? LIMIT 1`,[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return Mi(r,t),r},keys:function(e){var t=this,n=new ki((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Ss(t,r,`SELECT key FROM ${r.storeName}`,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return Mi(n,e),n},dropInstance:function(e,t){t=Fi.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return r=e.name?new ki((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(xs(r))})).then((function(e){return new ki((function(t,n){e.db.transaction((function(r){function i(e){return new ki((function(t,n){r.executeSql(`DROP TABLE IF EXISTS ${e}`,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var s=[],o=0,a=e.storeNames.length;o<a;o++)s.push(i(e.storeNames[o]));ki.all(s).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):ki.reject("Invalid arguments"),Mi(r,t),r}};function Ns(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const js={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=Ns(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0?(this._dbInfo=t,t.serializer=bs,ki.resolve()):ki.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(i),o++)))return u}}}));return Mi(r,t),r},getItem:function(e,t){var n=this;e=Di(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return Mi(r,t),r},setItem:function(e,t,n){var r=this;e=Di(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new ki((function(i,s){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return Mi(i,n),i},removeItem:function(e,t){var n=this;e=Di(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return Mi(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return Mi(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return Mi(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return Mi(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r}));return Mi(n,e),n},dropInstance:function(e,t){if(t=Fi.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new ki((function(t){e.storeName?t(Ns(e,i._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):ki.reject("Invalid arguments"),Mi(r,t),r}},Ts=(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),Cs=(e,t)=>{const n=e.length;let r=0;for(;r<n;){if(Ts(e[r],t))return!0;r++}return!1},Is=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Os={},ks={},Ms={INDEXEDDB:es,WEBSQL:As,LOCALSTORAGE:js},Rs=[Ms.INDEXEDDB._driver,Ms.WEBSQL._driver,Ms.LOCALSTORAGE._driver],Ds=["dropInstance"],Fs=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ds),Ls={description:"",driver:Rs.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ps(e,t){e[t]=function(){const n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Us(){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(t)for(let e in t)t.hasOwnProperty(e)&&(Is(t[e])?arguments[0][e]=t[e].slice():arguments[0][e]=t[e])}return arguments[0]}class $s{constructor(e){for(let e in Ms)if(Ms.hasOwnProperty(e)){const t=Ms[e],n=t._driver;this[e]=n,Os[n]||this.defineDriver(t)}this._defaultConfig=Us({},Ls),this._config=Us({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}))}config(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config}defineDriver(e,t,n){const r=new ki((function(t,n){try{const r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);const s=Fs.concat("_initStorage");for(let t=0,r=s.length;t<r;t++){const r=s[t];if((!Cs(Ds,r)||e[r])&&"function"!=typeof e[r])return void n(i)}!function(){const t=function(e){return function(){const t=new Error(`Method ${e} is not implemented by the current driver`),n=ki.reject(t);return Mi(n,arguments[arguments.length-1]),n}};for(let n=0,r=Ds.length;n<r;n++){const r=Ds[n];e[r]||(e[r]=t(r))}}();const o=function(n){Os[r]&&console.info(`Redefining LocalForage driver: ${r}`),Os[r]=e,ks[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(o,n):o(!!e._support):o(!0)}catch(e){n(e)}}));return Ri(r,t,n),r}driver(){return this._driver||null}getDriver(e,t,n){const r=Os[e]?ki.resolve(Os[e]):ki.reject(new Error("Driver not found."));return Ri(r,t,n),r}getSerializer(e){const t=ki.resolve(bs);return Ri(t,e),t}ready(e){const t=this,n=t._driverSet.then((()=>(null===t._ready&&(t._ready=t._initDriver()),t._ready)));return Ri(n,e,e),n}setDriver(e,t,n){const r=this;Is(e)||(e=[e]);const i=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function o(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>ki.resolve())):ki.resolve();return this._driverSet=a.then((()=>{const e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((e=>{r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){let t=0;return function n(){for(;t<e.length;){let i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o).catch(n)}s();const i=new Error("No available storage method found.");return r._driverSet=ki.reject(i),r._driverSet}()}}(i)}))})).catch((()=>{s();const e=new Error("No available storage method found.");return r._driverSet=ki.reject(e),r._driverSet})),Ri(this._driverSet,t,n),this._driverSet}supports(e){return!!ks[e]}_extend(e){Us(this,e)}_getSupportedDrivers(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];this.supports(r)&&t.push(r)}return t}_wrapLibraryMethodsWithReady(){for(let e=0,t=Fs.length;e<t;e++)Ps(this,Fs[e])}createInstance(e){return new $s(e)}}const zs=new $s;var Bs=o(3245);const Hs=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Yt(t,tn(e)),e=_(e);return t}:Kt,qs=function(e){return Xt(e,Et,Hs)};var Gs=Object.prototype.hasOwnProperty;var Ws=/\w*$/;var Js=u?u.prototype:void 0,Qs=Js?Js.valueOf:void 0;const Vs=function(e,t,n){var r,i=e.constructor;switch(t){case"[object ArrayBuffer]":return gi(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return function(e,t){var n=t?gi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return mi(e,n);case"[object Map]":return new i;case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,Ws.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Set]":return new i;case"[object Symbol]":return r=e,Qs?Object(Qs.call(r)):{}}};var Ys=pt&&pt.isMap;const Xs=Ys?dt(Ys):function(e){return i(e)&&"[object Map]"==xn(e)};var Ks=pt&&pt.isSet;const Zs=Ks?dt(Ks):function(e){return i(e)&&"[object Set]"==xn(e)};var eo="[object Arguments]",to="[object Function]",no={};no[eo]=no["[object Array]"]=no["[object ArrayBuffer]"]=no["[object DataView]"]=no["[object Boolean]"]=no["[object Date]"]=no["[object Float32Array]"]=no["[object Float64Array]"]=no["[object Int8Array]"]=no["[object Int16Array]"]=no["[object Int32Array]"]=no["[object Map]"]=no["[object Number]"]=no["[object Object]"]=no["[object RegExp]"]=no["[object Set]"]=no["[object String]"]=no["[object Symbol]"]=no["[object Uint8Array]"]=no["[object Uint8ClampedArray]"]=no["[object Uint16Array]"]=no["[object Uint32Array]"]=!0,no["[object Error]"]=no[to]=no["[object WeakMap]"]=!1;const ro=function e(t,n,r,i,s,o){var a,c=1&n,u=2&n,d=4&n;if(r&&(a=s?r(t,i,s,o):r(t)),void 0!==a)return a;if(!pe(t))return t;var l=it(t);if(l){if(a=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Gs.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(t),!c)return vi(t,a)}else{var h=xn(t),f=h==to||"[object GeneratorFunction]"==h;if(ct(t))return pi(t,c);if("[object Object]"==h||h==eo||f&&!s){if(a=u||f?{}:_i(t),!c)return u?function(e,t){return Re(e,Hs(e),t)}(t,function(e,t){return e&&Re(t,Et(t),e)}(a,t)):function(e,t){return Re(e,tn(e),t)}(t,Fr(a,t))}else{if(!no[h])return s?t:{};a=Vs(t,h,c)}}o||(o=new $t);var p=o.get(t);if(p)return p;o.set(t,a),Zs(t)?t.forEach((function(i){a.add(e(i,n,r,i,t,o))})):Xs(t)&&t.forEach((function(i,s){a.set(s,e(i,n,r,s,t,o))}));var g=l?void 0:(d?u?qs:an:u?Et:on)(t);return function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););}(g||t,(function(i,s){g&&(i=t[s=i]),Me(a,s,e(i,n,r,s,t,o))})),a},io=function(e){return"string"==typeof e||!it(e)&&i(e)&&"[object String]"==m(e)};function so(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const oo={serializer:{serialize:bs.serialize,deserialize:bs.deserialize}},ao={_driver:"sessionStorageWrapper",_initStorage:function(e){if(oo.keyPrefix=so(e,this._defaultConfig),e)for(const t in e)oo[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const n=this.ready().then((function(){const t=oo.keyPrefix,n=t.length,r=sessionStorage.length;let i=1;for(let s=0;s<r;s++){const r=sessionStorage.key(s);if(0!==r.indexOf(t))continue;let o=sessionStorage.getItem(r);if(o&&(o=oo.serializer.deserialize(o)),o=e(o,r.substring(n),i++),void 0!==o)return o}}));return Mi(n,t),n},getItem:function(e,t){e=Di(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(oo.keyPrefix+e);return t&&(t=oo.serializer.deserialize(t)),t}));return Mi(n,t),n},setItem:function(e,t,n){e=Di(e);const r=this.ready().then((function(){void 0===t&&(t=null);const n=t;return new Promise((function(r,i){oo.serializer.serialize(t,(function(t,s){if(s)i(s);else try{sessionStorage.setItem(oo.keyPrefix+e,t),r(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}}))}))}));return Mi(r,n),r},removeItem:function(e,t){e=Di(e);const n=this.ready().then((function(){sessionStorage.removeItem(oo.keyPrefix+e)}));return Mi(n,t),n},clear:function(e){const t=this.ready().then((function(){const e=oo.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return Mi(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return Mi(t,e),t},key:function(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(oo.keyPrefix.length)),t}));return Mi(n,t),n},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(oo.keyPrefix)&&t.push(e.substring(oo.keyPrefix.length))}return t}));return Mi(t,e),t},dropInstance:function(e,t){if(t=Fi.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let r;return r=e.name?new Promise((function(t){e.storeName?t(so(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),Mi(r,t),r}};var co=o(1459);const uo=Bs._driver;function lo(){return(65536*(1+Math.random())|0).toString(16).substring(1)}zs.defineDriver(Bs),(0,co.extendPrototype)(zs);class ho{constructor(e,t,n=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");io(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=Ci((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)zs.setDriver(ao._driver);else if("local"===e)await zs.config({driver:zs.LOCALSTORAGE});else if("in_memory"===e)zs.config({driver:uo});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=zs,t&&(this.store.debouncedSetItems=Ci((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){var e;return null===(e=this.store.debouncedSetItems)||void 0===e?void 0:e.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(e){const t=this;async function n(e,n,r){let i,s,o,a;const c=n.collection;var u;["patch","update"].includes(e)&&(u=n.attributes,a=ro(u,5)),await t.storeInitialized;try{const s=n.attributes;switch(e){case"read":i=void 0!==n.id?await t.find(n):await t.findAll();break;case"create":i=await t.create(n,r);break;case"patch":case"update":r.wait&&(n.attributes=a),o=t.update(n,r),r.wait&&(n.attributes=s),i=await o;break;case"delete":i=await t.destroy(n,c)}}catch(e){s=22===e.code&&0===t.getStorageSize()?"Private browsing is unsupported":e.message}if(i){if(r&&r.success){const t="read"===e?i:null;r.success(t,r)}}else s=s||"Record Not Found",r&&r.error&&r.error(s)}return n.__name__="localSync",n}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),r=this.getItemName(e.id);return n.includes(r)||n.push(r),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const r={};return r[this.name]=t,r}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),n}}create(e,t){return e.id||(e.id=lo()+lo()+"-"+lo()+"-"+lo()+"-"+lo()+"-"+lo()+lo()+lo(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);return e&&e.length?Promise.all(e.map((e=>this.store.getItem(e)))):[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}ho.sessionStorageInitialized=zs.defineDriver(ao),ho.localForage=zs;const fo=ho;function po(){return ma.config.get("trusted")?"sessionStorage"===yu.settings.get("persistent_store")?"session":"persistent":"session"}function go(e){return"persistent"===e&&"IndexedDB"===yu.settings.get("persistent_store")}function mo(e,t){const n=t||po(),r=ma.storage[n];if(void 0===r)throw new TypeError(`createStore: Could not find store for ${e}`);return new fo(e,r,go(t))}function vo(e,t,n){const r=n||po();if(e.browserStorage=mo(t,r),go(r)){const t=()=>e.browserStorage.flush();window.addEventListener(ma.unloadevent,t),e.on("destroy",(()=>window.removeEventListener(ma.unloadevent,t))),e.listenTo(ma,"beforeLogout",t)}}const _o=function(e,t){return In(e,t)},yo=function(e,t,n,r){if(!pe(e))return e;for(var i=-1,s=(t=Yn(t,e)).length,o=s-1,a=e;null!=a&&++i<s;){var c=Xn(t[i]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var d=a[c];void 0===(u=r?r(d,c,a):void 0)&&(u=pe(d)?d:Ye(t[i+1])?[]:{})}Me(a,c,u),a=a[c]}return e},bo=function(e,t){return function(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Kn(e,o);n(a,o)&&yo(s,Yn(o,e),a)}return s}(e,t,(function(t,n){return tr(e,n)}))};var wo=u?u.isConcatSpreadable:void 0;const So=function(e){return it(e)||rt(e)||!!(wo&&e&&e[wo])},Eo=function e(t,n,r,i,s){var o=-1,a=t.length;for(r||(r=So),s||(s=[]);++o<a;){var c=t[o];n>0&&r(c)?n>1?e(c,n-1,r,i,s):Yt(s,c):i||(s[s.length]=c)}return s},xo=function(e){return null!=e&&e.length?Eo(e,1):[]},Ao=function(e){return Be(Pe(e,void 0,xo),e+"")},No=Ao((function(e,t){return null==e?{}:bo(e,t)}));var jo=o(7856),To=o.n(jo);const Co=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var Io=o(1271),Oo=o.n(Io);const ko=function(e){return ro(e,4)};var Mo=Object.prototype,Ro=Mo.hasOwnProperty;const Do=We((function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Xe(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Et(s),a=-1,c=o.length;++a<c;){var u=o[a],d=e[u];(void 0===d||Oe(d,Mo[u])&&!Ro.call(e,u))&&(e[u]=s[u])}return e})),Fo=We((function(e,t){return function(e,t,n){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,n)}),t)}(e,1,t)})),Lo=(Po={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(e){return null==Po?void 0:Po[e]});var Po,Uo=/[&<>"']/g,$o=RegExp(Uo.source);var zo=Object.prototype.toString;const Bo=(Ho=function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=zo.call(t)),e[t]=n},qo=Ue(De),function(e,t){return function(e,t,n,r){return or(e,(function(e,i,s){t(r,n(e),i,s)})),r}(e,Ho,qo(t),{})});var Ho,qo;const Go=function(e,t){return t.length<2?e:Kn(e,function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}(t,0,-1))},Wo=function(e,t){return t=Yn(t,e),null==(e=Go(e,t))||delete e[Xn(Co(t))]},Jo=function(e){return x(e)?void 0:e},Qo=Ao((function(e,t){var n={};if(null==e)return n;var r=!1;t=Gn(t,(function(t){return t=Yn(t,e),r||(r=t.length>1),t})),Re(e,qs(e),n),r&&(n=ro(n,7,Jo));for(var i=t.length;i--;)Wo(n,t[i]);return n})),Vo=function(e,t){let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=xr(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const r=Br(this,"defaults");n=Do(xt({},r,n),r),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};Vo.extend=Hr,Object.assign(Vo.prototype,Ar,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return ko(this.attributes)},sync:function(e,t,n){return Qr(this)(e,t,n)},get:function(e){return this.attributes[e]},keys:function(){return Object.keys(this.attributes)},values:function(){return Object.values(this.attributes)},pairs:function(){return this.entries()},entries:function(){return Object.entries(this.attributes)},invert:function(){return Bo(this.attributes)},pick:function(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),No(this.attributes,e)},omit:function(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),Qo(this.attributes,e)},isEmpty:function(){return hr(this.attributes)},escape:function(e){return t=this.get(e),(t=Vn(t))&&$o.test(t)?t.replace(Uo,Lo):t;var t},has:function(e){return null!=this.get(e)},matches:function(e){return!!function(e){return ir("function"==typeof e?e:ro(e,1))}(e)(this.attributes)},set:function(e,t,n){if(null==e)return this;let r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;const i=n.unset,s=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=ko(this.attributes),this.changed={});const c=this.attributes,u=this.changed,d=this._previousAttributes;for(const e in r)t=r[e],_o(c[e],t)||o.push(e),_o(d[e],t)?delete u[e]:u[e]=t,i?delete c[e]:c[e]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){o.length&&(this._pending=n);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],n)}if(a)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,xt({},t,{unset:!0}))},clear:function(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,xt({},e,{unset:!0}))},hasChanged:function(e){return null==e?!hr(this.changed):zr(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&ko(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let r;for(const i in e){const s=e[i];_o(t[i],s)||(n[i]=s,r=!0)}return!!r&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return ko(this._previousAttributes)},fetch:function(e){e=xt({parse:!0},e);const t=this,n=e.success;return e.success=function(r){const i=e.parse?t.parse(r,e):r;if(!t.set(i,e))return!1;n&&n.call(e.context,t,r,e),t.trigger("sync",t,r,e)},Wr(this,e),this.sync("read",this,e)},save:function(e,t,n){let r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t;const i=(n=xt({validate:!0,parse:!0},n)).wait,s=n.promise,o=s&&qr();if(r&&!i){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;const a=this,c=n.success,u=n.error,d=this.attributes;n.success=function(e){a.attributes=d;let t=n.parse?a.parse(e,n):e;if(i&&(t=xt({},r,t)),t&&!a.set(t,n))return!1;c&&c.call(n.context,a,e,n),a.trigger("sync",a,e,n),s&&o.resolve()},n.error=function(e,t,n){u&&u.call(n.context,e,t,n),s&&o.reject(t)},Wr(this,n),r&&i&&(this.attributes=xt({},d,r));const l=this.isNew()?"create":n.patch?"patch":"update";"patch"!==l||n.attrs||(n.attrs=r);const h=this.sync(l,this,n);return this.attributes=d,s?o:h},destroy:function(e){e=e?ko(e):{};const t=this,n=e.success,r=e.wait,i=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(s){r&&i(),n&&n.call(e.context,t,s,e),t.isNew()||t.trigger("sync",t,s,e)};let s=!1;return this.isNew()?Fo(e.success):(Wr(this,e),s=this.sync("delete",this,e)),r||i(),s},url:function(){const e=Br(this,"urlRoot")||Br(this.collection,"url")||Gr();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},xt({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=xt({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,xt(t,{validationError:n})),!1)}});const Yo={extend:e=>function(e){ca.merge(ua,e);const t=Object.keys(No(e,Object.keys(ua))),n=No(ha,t),r=xt(No(e,t),n);ca.merge(da,r)}(e),update(e){return k.warn("The api.settings.update method has been deprecated and will be removed. Please use api.settings.extend instead."),this.extend(e)},get:e=>function(e){if(Object.keys(ua).includes(e))return da[e]}(e),set(e,t){!function(e,t){if(null==e)return this;let n;pe(e)?n=e:"string"==typeof e&&(n={},n[e]=t);const r=Object.keys(No(n,Object.keys(ua))),i={};r.forEach((e=>{const t=n[e];_o(da[e],t)||(i[e]=t,da[e]=t)})),Object.keys(i).forEach((e=>da.trigger("change:"+e,i[e]))),da.trigger("change",i)}(e,t)},listen:{on(e,t,n){!function(e,t,n){da.on(e,t,n)}(e,t,n)},not(e,t){!function(e,t){da.off(e,t)}(e,t)}}},Xo={getModel:()=>pa(),async get(e,t){const n=await pa();return void 0===n.get(e)?t:n.get(e)},set(e,t){if(pe(e))return ga(e,{promise:!0});{const n={};return n[e]=t,ga(n,{promise:!0})}},clear:()=>async function(){return await fa(),la.clear()}()};function Ko(e){return e instanceof Vo&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message)}function Zo(){return["mobile","fullscreen","embedded"].includes(Yo.get("view_mode"))}const ea={isTagEqual:function(e,t){if(e.nodeTree)return ea.isTagEqual(e.nodeTree,t);if(e instanceof Element)return ae.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")}},ta=new DOMParser,na=ta.parseFromString("invalid","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;function ra(e,t,n){ea.isPersistableModel(e)?e.save(t,n):e.set(t,n)}function ia(e,t){clearTimeout(e),clearInterval(t)}function sa(e){const t=ma.promises[e];if(!t)throw new Error(`Tried to replace non-existing promise: ${e}`);if(t.replace){const n=Ni();n.replace=t.replace,ma.promises[e]=n}else k.debug(`Not replacing promise "${e}"`)}ea.getJIDFromURI=function(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e},ea.toStanza=function(e){const t=ta.parseFromString(e,"text/xml");if(t.getElementsByTagNameNS(na,"parsererror").length)throw new Error(`Parser Error: ${e}`);return t.firstElementChild},ea.getLongestSubstring=function(e,t){return t.reduce((function(t,n){return e.startsWith(n)&&n.length>t.length?n:t}),"")},ea.prefixMentions=function(e){let t=e.get("message");return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},ea.isValidJID=function(e){return"string"==typeof e&&2===function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}(e.split("@")).length&&!e.startsWith("@")&&!e.endsWith("@")},ea.isValidMUCJID=function(e){return!e.startsWith("@")&&!e.endsWith("@")},ea.isSameBareJID=function(e,t){return"string"==typeof e&&"string"==typeof t&&ae.getBareJidFromJid(e).toLowerCase()===ae.getBareJidFromJid(t).toLowerCase()},ea.isSameDomain=function(e,t){return"string"==typeof e&&"string"==typeof t&&ae.getDomainFromJid(e).toLowerCase()===ae.getDomainFromJid(t).toLowerCase()},ea.isNewMessage=function(e){return e instanceof Element?!(Oo()(`result[xmlns="${ae.NS.MAM}"]`,e).length&&Oo()(`delay[xmlns="${ae.NS.DELAY}"]`,e).length):(e instanceof Vo&&(e=e.attributes),!(e.is_delayed&&e.is_archived))},ea.shouldCreateMessage=function(e){return e.retracted||!Ko(e)},ea.shouldCreateGroupchatMessage=function(e){return e.nick&&(ea.shouldCreateMessage(e)||e.is_tombstone)},ea.isChatRoom=function(e){return e&&"chatroom"===e.get("type")},ea.isErrorObject=function(e){return e instanceof Error},ea.isErrorStanza=function(e){return!!A(e)&&"error"===e.getAttribute("type")},ea.isForbiddenError=function(e){return!!A(e)&&Oo()(`error[type="auth"] forbidden[xmlns="${ae.NS.STANZAS}"]`,e).length>0},ea.isServiceUnavailableError=function(e){return!!A(e)&&Oo()(`error[type="cancel"] service-unavailable[xmlns="${ae.NS.STANZAS}"]`,e).length>0},ea.merge=function e(t,n){for(const r in n)pe(t[r])?e(t[r],n[r]):t[r]=n[r]},ea.getOuterWidth=function(e,t=!1){let n=e.offsetWidth;if(!t)return n;const r=window.getComputedStyle(e);return n+=parseInt(r.marginLeft?r.marginLeft:0,10)+parseInt(r.marginRight?r.marginRight:0,10),n},ea.stringToElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},ea.matchesSelector=function(e,t){const n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return!!n&&n.call(e,t)},ea.queryChildren=function(e,t){return Array.from(e.childNodes).filter((e=>ea.matchesSelector(e,t)))},ea.contains=function(e,t){const n=(e,n)=>e.get(n).toLowerCase().includes(t.toLowerCase());return function(t){if("object"==typeof e)return Object.keys(e).reduce(((e,r)=>e||n(t,r)),!1);if("string"==typeof e)return n(t,e);throw new TypeError("contains: wrong attribute type. Must be string or array.")}},ea.isOfType=function(e,t){return t.get("type")==e},ea.isInstance=function(e,t){return t instanceof e},ea.getAttribute=function(e,t){return t.get(e)},ea.contains.not=function(e,t){return function(n){return!ea.contains(e,t)(n)}},ea.rootContains=function(e,t){return e!==document||e.contains?e.contains?e.contains(t):window.HTMLElement.prototype.contains.call(e,t):document.head.contains(t)||document.body.contains(t)},ea.createFragmentFromText=function(e){var t,n=document.createDocumentFragment(),r=document.createElement("body");for(r.innerHTML=e;t=r.firstChild;)n.appendChild(t);return n},ea.isPersistableModel=function(e){return e.collection&&e.collection.browserStorage},ea.getResolveablePromise=Ni,ea.getOpenPromise=Ni,ea.interpolate=function(e,t){return e.replace(/{{{([^{}]*)}}}/g,((e,n)=>{var r=t[n];return"string"==typeof r||"number"==typeof r?r:e}))},ea.onMultipleEvents=function(e=[],t){let n=[];function r(r){n.push(r),e.length===n.length&&(t(n),n=[])}e.forEach((e=>e.object.on(e.event,r)))},ea.safeSave=ra,ea.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},ea.getCurrentWord=function(e,t,n){t||(t=e.selectionEnd||void 0);let[r]=e.value.slice(0,t).split(/\s/).slice(-1);return n&&([r]=r.split(n).slice(-1)),r},ea.isMentionBoundary=e=>"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e),ea.replaceCurrentWord=function(e,t){const n=e.selectionEnd||void 0,r=Co(e.value.slice(0,n).split(/\s/)),i=e.value,s=ea.isMentionBoundary(r[0])?r[0]:"";e.value=i.slice(0,n-r.length)+s+`${t} `+i.slice(n);const o=n-r.length+t.length+1;e.selectionEnd=s?o+1:o},ea.triggerEvent=function(e,t,n="Event",r=!0,i=!0){const s=document.createEvent(n);s.initEvent(t,r,i),e.dispatchEvent(s)},ea.getSelectValues=function(e){const t=[],n=e&&e.options;for(var r=0,i=n.length;r<i;r++){const e=n[r];e.selected&&t.push(e.value||e.text)}return t},ea.getRandomInt=function(e){return Math.floor(Math.random()*Math.floor(e))},ea.placeCaretAtEnd=function(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),this.scrollTop=999999},ea.getUniqueId=function(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t},ea.httpToGeoUri=function(e){return e.replace(Yo.get("geouri_regex"),"geo:$1,$2")},ea.waitUntil=function(e,t=300,n=3){try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const r=Ni(),i=new Error,s=setInterval((function(){try{const t=e();t&&(ia(o,s),r.resolve(t))}catch(e){ia(o,s),r.reject(e)}}),n),o=setTimeout((function(){ia(o,s);const e=`Wait until promise timed out: \n\n${i.stack}`;console.trace(),k.error(e),r.reject(new Error(e))}),t);return r};const oa=document.createElement("div");function aa(e){return e&&"string"==typeof e&&(oa.innerHTML=To().sanitize(e),e=oa.textContent,oa.textContent=""),e}const ca=Object.assign({isEmptyMessage:Ko},ea),ua={allow_non_roster_messaging:!1,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,discover_connection_methods:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,idle_presence_timeout:300,jid:void 0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","eo","es","eu","en","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","nb","nl","mr","oc","pl","pt","pt_BR","ro","ru","sv","th","tr","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,view_mode:"overlayed",websocket_url:void 0,whitelisted_plugins:[]};let da,la,ha={};function fa(){var e;if(!ma.bare_jid){const e="No JID to fetch user settings for";throw k.error(e),Error(e)}if(null===(e=la)||void 0===e||!e.fetched){const e=`converse.user-settings.${ma.bare_jid}`;la=new Vo({id:e}),vo(la,e),la.fetched=la.fetch({promise:!0})}return la.fetched}async function pa(){return await fa(),la}async function ga(e,t){return await fa(),la.save(e,t)}const ma={log:k,CONNECTION_STATUS:le,templates:{},promises:{initialized:Ni()},STATUS_WEIGHTS:{offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},ANONYMOUS:"anonymous",CLOSED:"closed",EXTERNAL:"external",LOGIN:"login",LOGOUT:"logout",OPENED:"opened",PREBIND:"prebind",STANZA_TIMEOUT:1e4,SUCCESS:"success",FAILURE:"failure",DEFAULT_IMAGE_TYPE:"image/svg+xml",DEFAULT_IMAGE:"PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCI+CiA8cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzU1NSIvPgogPGNpcmNsZSBjeD0iNjQiIGN5PSI0MSIgcj0iMjQiIGZpbGw9IiNmZmYiLz4KIDxwYXRoIGQ9Im0yOC41IDExMiB2LTEyIGMwLTEyIDEwLTI0IDI0LTI0IGgyMyBjMTQgMCAyNCAxMiAyNCAyNCB2MTIiIGZpbGw9IiNmZmYiLz4KPC9zdmc+Cg==",TIMEOUTS:{PAUSED:1e4,INACTIVE:9e4},INACTIVE:"inactive",ACTIVE:"active",COMPOSING:"composing",PAUSED:"paused",GONE:"gone",PRIVATE_CHAT_TYPE:"chatbox",CHATROOMS_TYPE:"chatroom",HEADLINES_TYPE:"headline",CONTROLBOX_TYPE:"controlbox",default_connection_options:{explicitResourceBinding:!0},router:new ri,TimeoutError:ci,isTestEnv:()=>"montague.lit/http-bind"===ha.bosh_service_url,getDefaultStore:po,createStore:mo,__:(...e)=>r.__(...e),___:e=>e};var va=o(8734),_a=o.n(va),ya=o(7484),ba=o.n(ya);const wa=We((function(e,t,n){t=Yn(t,e);var r=null==(e=Go(e,t))?e:e[Xn(Co(t))];return null==r?void 0:Fe(r,e,n)}));function Sa(e,t,n,r,...i){return"function"==typeof n&&(void 0===this.__super__&&(this.__super__=r),this.__super__[e]=n.bind(this)),t.apply(this,i)}class Ea{constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}_overrideAttribute(e,t){const n=t.overrides[e];if("function"==typeof n){const t={};t[this.name]=this.plugged;const r=this.plugged[e];this.plugged[e]=function(...i){return Sa.apply(this,[e,n,r,t,...i])}}else this.plugged[e]=n}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[n,r]of Object.entries(t))if("events"===n)e.prototype[n]=Object.assign(r,e.prototype[n]);else if("function"==typeof r){const t={};t[this.name]=this.plugged;const i=e.prototype[n];e.prototype[n]=function(...e){return Sa.apply(this,[n,r,i,t,...e])}}else e.prototype[n]=r}loadPluginDependencies(e){var t;null===(t=e.dependencies)||void 0===t||t.forEach((t=>{const n=this.plugins[t];if(n){var r;if(null!==(r=n.dependencies)&&void 0!==r&&r.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(n)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const n=e.overrides[t];"object"==typeof n?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)}))}initializePlugin(e){var t;Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||null!==(t=e.enabled)&&void 0!==t&&t.call(e,this.plugged)||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(e={},t=[],n=[]){if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,r]of Object.entries(this.plugins))t.length&&!t.includes(e)||n.includes(e)||(this.allowed_plugins[e]=r);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}}const xa=function(e,t,n){return void 0===n&&(n="pluginSocket"),void 0===t&&(t="plugged"),e[n]=new Ea(e,t),e},Aa=function(e,t,n,r){for(var i=-1,s=null==e?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r},Na=function(e,t,n,r){return ar(e,(function(e,i,s){t(r,e,n(e),s)})),r},ja=function(e,t){return function(n,r){var i=it(n)?Aa:Na,s=t?t():{};return i(n,e,ir(r),s)}};var Ta=Object.prototype.hasOwnProperty;const Ca=ja((function(e,t,n){Ta.call(e,n)?++e[n]:Ie(e,n,1)})),Ia=function(e,t,n,r){for(var i=e.length,s=n+(r?1:-1);r?s--:++s<i;)if(t(e[s],s,e))return s;return-1},Oa=function(e){return e!=e},ka=function(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):Ia(e,Oa,n)},Ma=function(e,t){return!(null==e||!e.length)&&ka(e,t,0)>-1},Ra=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},Da=We((function(e,t){return yi(e)?function(e,t,n,r){var i=-1,s=Ma,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;n&&(t=Gn(t,dt(n))),r?(s=Ra,o=!1):t.length>=200&&(s=Ht,o=!1,t=new Bt(t));e:for(;++i<a;){var d=e[i],l=null==n?d:n(d);if(d=r||0!==d?d:0,o&&l==l){for(var h=u;h--;)if(t[h]===l)continue e;c.push(d)}else s(t,l,r)||c.push(d)}return c}(e,Eo(t,1,yi,!0)):[]})),Fa=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0},La=function(e,t){var n=!0;return ar(e,(function(e,r,i){return n=!!t(e,r,i)})),n};var Pa=Math.max;var Ua=Math.max,$a=Math.min;var za=Object.prototype.hasOwnProperty;const Ba=ja((function(e,t,n){za.call(e,n)?e[n].push(t):Ie(e,n,[t])}));var Ha=Math.max;const qa=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:wr(n);return i<0&&(i=Ha(r+i,0)),ka(e,t,i)},Ga=ja((function(e,t,n){Ie(e,n,t)}));var Wa=Math.max,Ja=Math.min;const Qa=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e==e,s=Dn(e),o=void 0!==t,a=null===t,c=t==t,u=Dn(t);if(!a&&!u&&!s&&e>t||s&&o&&c&&!a&&!u||r&&o&&c||!n&&c||!i)return 1;if(!r&&!s&&!u&&e<t||u&&n&&i&&!r&&!s||a&&n&&i||!o&&i||!c)return-1}return 0},Va=function(e,t,n){t=t.length?Gn(t,(function(e){return it(e)?function(t){return Kn(t,1===e.length?e[0]:e)}:e})):[De];var r=-1;return t=Gn(t,dt(ir)),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(function(e,t){var n=-1,r=Qe(e)?Array(e.length):[];return ar(e,(function(e,i,s){r[++n]=t(e,i,s)})),r}(e,(function(e,n,i){return{criteria:Gn(t,(function(t){return t(e)})),index:++r,value:e}})),(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,s=t.criteria,o=i.length,a=n.length;++r<o;){var c=Qa(i[r],s[r]);if(c)return r>=a?c:c*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))},Ya=We((function(e,t){if(null==e)return[];var n=t.length;return n>1&&Xe(e,t[0],t[1])?t=[]:n>2&&Xe(t[0],t[1],t[2])&&(t=[t[0]]),Va(e,Eo(t,1),[])})),Xa=Array.prototype.slice,Ka=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,xt({silent:!0},t))};Ka.extend=Hr;const Za={add:!0,remove:!0,merge:!0},ec={add:!0,remove:!1},tc=function(e,t,n){n=Math.min(Math.max(n,0),e.length);const r=Array(e.length-n),i=t.length;let s;for(s=0;s<r.length;s++)r[s]=e[s+n];for(s=0;s<i;s++)e[s+n]=t[s];for(s=0;s<r.length;s++)e[s+i+n]=r[s]};Object.assign(Ka.prototype,Ar,{model:Vo,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(e,t,n){return Qr(this)(e,t,n)},add:function(e,t){return this.set(e,xt({merge:!1},t,ec))},remove:function(e,t){t=xt({},t);const n=!Array.isArray(e);e=n?[e]:e.slice();const r=this._removeModels(e,t);return!t.silent&&r.length&&(t.changes={added:[],merged:[],removed:r},this.trigger("update",this,t)),n?r[0]:r},set:function(e,t){if(null==e)return;(t=xt({},Za,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!Array.isArray(e);e=n?[e]:e.slice();let r=t.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);const i=[],s=[],o=[],a=[],c={},u=t.add,d=t.merge,l=t.remove;let h=!1;const f=this.comparator&&null==r&&!1!==t.sort,p=io(this.comparator)?this.comparator:null;let g,m;for(m=0;m<e.length;m++){g=e[m];const n=this.get(g);if(n){if(d&&g!==n){let e=this._isModel(g)?g.attributes:g;t.parse&&(e=n.parse(e,t)),n.set(e,t),o.push(n),f&&!h&&(h=n.hasChanged(p))}c[n.cid]||(c[n.cid]=!0,i.push(n)),e[m]=n}else u&&(g=e[m]=this._prepareModel(g,t),g&&(s.push(g),this._addReference(g,t),c[g.cid]=!0,i.push(g)))}if(l){for(m=0;m<this.length;m++)g=this.models[m],c[g.cid]||a.push(g);a.length&&this._removeModels(a,t)}let v=!1;const _=!f&&u&&l;if(i.length&&_?(v=this.length!==i.length||dr(this.models,((e,t)=>e!==i[t])),this.models.length=0,tc(this.models,i,0),this.length=this.models.length):s.length&&(f&&(h=!0),tc(this.models,s,null==r?this.length:r),this.length=this.models.length),h&&this.sort({silent:!0}),!t.silent){for(m=0;m<s.length;m++)null!=r&&(t.index=r+m),g=s[m],g.trigger("add",g,this,t);(h||v)&&this.trigger("sort",this,t),(s.length||a.length||o.length)&&(t.changes={added:s,removed:a,merged:o},this.trigger("update",this,t))}return n?e[0]:e},clearStore:async function(e={},t=(e=>e)){await Promise.all(this.models.filter(t).map((t=>new Promise((n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))))),await this.browserStorage.clear(),this.reset()},reset:function(e,t){t=t?ko(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,xt({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,xt({at:this.length},t))},pop:function(e){const t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,xt({at:0},t))},shift:function(e){const t=this.at(0);return this.remove(t,e)},slice:function(){return Xa.apply(this.models,arguments)},filter:function(e,t){return this.models.filter(ge(e)?e:t=>t.matches(e),t)},every:function(e){return function(e,t,n){var r=it(e)?Fa:La;return n&&Xe(e,t,n)&&(t=void 0),r(e,ir(t))}(this.models.map((e=>e.attributes)),e)},difference:function(e){return Da(this.models,e)},max:function(){return Math.max.apply(Math,this.models)},min:function(){return Math.min.apply(Math,this.models)},drop:function(e=1){return this.models.slice(e)},some:function(e){return dr(this.models.map((e=>e.attributes)),e)},sortBy:function(e){return Ya(this.models,ge(e)?e:t=>io(e)?t.get(e):t.matches(e))},isEmpty:function(){return hr(this.models)},keyBy:function(e){return Ga(this.models,e)},each:function(e,t){return this.forEach(e,t)},forEach:function(e,t){return this.models.forEach(e,t)},includes:function(e){return this.models.includes(e)},size:function(){return this.models.length},countBy:function(e){return Ca(this.models,ge(e)?e:t=>io(e)?t.get(e):t.matches(e))},groupBy:function(e){return Ba(this.models,ge(e)?e:t=>io(e)?t.get(e):t.matches(e))},indexOf:function(e){return qa(this.models,e)},findLastIndex:function(e,t){return function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return void 0!==n&&(i=wr(n),i=n<0?Ua(r+i,0):$a(i,r-1)),Ia(e,ir(t),i,!0)}(this.models,ge(e)?e:t=>io(e)?t.get(e):t.matches(e),t)},lastIndexOf:function(e){return function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return void 0!==n&&(i=(i=wr(n))<0?Wa(r+i,0):Ja(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):Ia(e,Oa,i,!0)}(this.models,e)},findIndex:function(e){return function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:wr(n);return i<0&&(i=Pa(r+i,0)),Ia(e,ir(t),i)}(this.models,ge(e)?e:t=>io(e)?t.get(e):t.matches(e))},last:function(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0},head:function(){return this.models[0]},first:function(){return this.head()},map:function(e,t){return this.models.map(ge(e)?e:t=>io(e)?t.get(e):t.matches(e),t)},reduce:function(e,t){return this.models.reduce(e,t||this.models[0])},reduceRight:function(e,t){return this.models.reduceRight(e,t||this.models[0])},toArray:function(){return Array.from(this.models)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},find:function(e,t){const n=ge(e)?e:t=>t.matches(e);return this.models.find(n,t)},sort:function(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return ge(t)&&(t=t.bind(this)),1===n||io(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){const t=(e=xt({parse:!0},e)).success,n=this,r=e.promise&&qr();return e.success=function(i){const s=e.reset?"reset":"set";n[s](i,e),t&&t.call(e.context,n,i,e),r&&r.resolve(),n.trigger("sync",n,i,e)},Wr(this,e),r||this.sync("read",this,e)},create:function(e,t){const n=(t=t?ko(t):{}).wait,r=t.promise,i=r&&qr();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const s=this,o=t.success,a=t.error;return t.success=function(e,t,a){n&&s.add(e,a),o&&o.call(a.context,e,t,a),r&&i.resolve(e)},t.error=function(e,t,n){a&&a.call(n.context,e,t,n),r&&i.reject(t)},e.save(null,Object.assign(t,{promise:!1})),r?i:e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){var t;return e[(null===(t=this.model.prototype)||void 0===t?void 0:t.idAttribute)||"id"]},values:function(){return new rc(this,ic)},keys:function(){return new rc(this,sc)},entries:function(){return new rc(this,oc)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?ko(t):{}).collection=this;const n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){const n=[];for(let r=0;r<e.length;r++){const i=this.get(e[r]);if(!i)continue;const s=this.indexOf(i);this.models.splice(s,1),this.length--,delete this._byId[i.cid];const o=this.modelId(i.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=s,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n},_isModel:function(e){return e instanceof Vo},_addReference:function(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,r),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}});const nc="function"==typeof Symbol&&Symbol.iterator;nc&&(Ka.prototype[nc]=Ka.prototype.values);const rc=function(e,t){this._collection=e,this._kind=t,this._index=0},ic=1,sc=2,oc=3;nc&&(rc.prototype[nc]=function(){return this}),rc.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===ic)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===sc?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var ac=Math.max,cc=Math.min;const uc=function(e,t,n){var r,i,s,o,a,c,u=0,d=!1,l=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,s=i;return r=i=void 0,u=t,o=e.apply(s,n)}function p(e){return u=e,a=setTimeout(m,t),d?f(e):o}function g(e){var n=e-c;return void 0===c||n>=t||n<0||l&&e-u>=s}function m(){var e=Ai();if(g(e))return v(e);a=setTimeout(m,function(e){var n=t-(e-c);return l?cc(n,s-(e-u)):n}(e))}function v(e){return a=void 0,h&&r?f(e):(r=i=void 0,o)}function _(){var e=Ai(),n=g(e);if(r=arguments,i=this,c=e,n){if(void 0===a)return p(c);if(l)return clearTimeout(a),a=setTimeout(m,t),f(c)}return void 0===a&&(a=setTimeout(m,t)),o}return t=br(t)||0,pe(n)&&(d=!!n.leading,s=(l="maxWait"in n)?ac(br(n.maxWait)||0,t):s,h="trailing"in n?!!n.trailing:h),_.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=c=i=a=void 0},_.flush=function(){return void 0===a?o:v(Ai())},_};class dc extends ae.Connection{constructor(e,t){super(e,t),this.debouncedReconnect=uc(this.reconnect,2e3)}static generateResource(){return`/converse.js-${Math.floor(139749528*Math.random()).toString()}`}async bind(){await yu.trigger("beforeResourceBinding",{synchronous:!0}),super.bind()}async onDomainDiscovered(e){const t=await e.text(),n=(new window.DOMParser).parseFromString(t,"text/xml").firstElementChild;if("XRD"!=n.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=n.namespaceURI)return k.warn("Could not discover XEP-0156 connection methods");const r=Oo()('Link[rel="urn:xmpp:alt-connections:xbosh"]',n),i=Oo()('Link[rel="urn:xmpp:alt-connections:websocket"]',n),s=r.map((e=>e.getAttribute("href"))),o=i.map((e=>e.getAttribute("href")));0===s.length&&0===o.length?k.warn("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(yu.settings.set("websocket_url",o.pop()),yu.settings.set("bosh_service_url",s.pop()),this.service=yu.settings.get("websocket_url")||yu.settings.get("bosh_service_url"),this.setProtocol())}async discoverConnectionMethods(e){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},n=`https://${e}/.well-known/host-meta`;let r;try{r=await fetch(n,t)}catch(e){return k.error(`Failed to discover alternative connection methods at ${n}`),void k.error(e)}r.status>=200&&r.status<400?await this.onDomainDiscovered(r):k.warn("Could not discover XEP-0156 connection methods")}async connect(e,t,n){if(yu.settings.get("discover_connection_methods")){const t=ae.getDomainFromJid(e);await this.discoverConnectionMethods(t)}super.connect(e,t,n||this.onConnectStatusChanged,59)}async reconnect(){const{__:e}=ma;return k.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.setConnectionStatus(ae.Status.RECONNECTING,e("The connection has dropped, attempting to reconnect.")),yu.trigger("will-reconnect"),this.reconnecting=!0,await bu(),yu.user.login()}async onConnected(e){delete this.reconnecting,this.flush(),await ma.setUserJID(this.jid),await yu.trigger("afterResourceBinding",e,{synchronous:!0}),e?yu.trigger("reconnected"):yu.trigger("connected")}setDisconnectionCause(e,t,n){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||n)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,ma.connfeedback.set({connection_status:e,message:t})}async finishDisconnection(){k.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),bu(),await wu(),delete ma.connection,yu.trigger("disconnected")}onDisconnected(){if(!yu.settings.get("auto_reconnect"))return this.finishDisconnection();{const e=this.disconnection_reason;if(this.disconnection_cause===ae.Status.AUTHFAIL)return yu.settings.get("credentials_url")||yu.settings.get("authentication")===ma.ANONYMOUS?yu.connection.reconnect():this.finishDisconnection();if(this.disconnection_cause===ma.LOGOUT||e===ae.ErrorCondition.NO_AUTH_MECH||"host-unknown"===e||"remote-connection-failed"===e)return this.finishDisconnection();yu.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:n}=ma;var r;if(k.debug(`Status changed to: ${ma.CONNECTION_STATUS[e]}`),e===ae.Status.ATTACHFAIL)this.setConnectionStatus(e),null===(r=this.worker_attach_promise)||void 0===r||r.resolve(!1);else if(e===ae.Status.CONNECTED||e===ae.Status.ATTACHED){var i,s;if(null!==(i=this.worker_attach_promise)&&void 0!==i&&i.isResolved&&this.status===ae.Status.ATTACHED)return;this.setConnectionStatus(e),null===(s=this.worker_attach_promise)||void 0===s||s.resolve(!0),ma.send_initial_presence=!0,this.setDisconnectionCause(),this.reconnecting?(k.debug(e===ae.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(k.debug(e===ae.Status.CONNECTED?"Connected":"Attached"),this.restored&&(ma.send_initial_presence=!1),this.onConnected())}else if(e===ae.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===ae.Status.BINDREQUIRED)this.bind();else if(e===ae.Status.ERROR)this.setConnectionStatus(e,n("An error occurred while connecting to the chat server."));else if(e===ae.Status.CONNECTING)this.setConnectionStatus(e);else if(e===ae.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===ae.Status.AUTHFAIL)t||(t=n("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===ae.Status.CONNFAIL){var o;let r=t;"host-unknown"===t||"remote-connection-failed"==t?r=n("Sorry, we could not connect to the XMPP host with domain: %1$s",`"${ae.getDomainFromJid(this.jid)}"`):void 0!==t&&t===(null==ae||null===(o=ae.ErrorCondition)||void 0===o?void 0:o.NO_AUTH_MECH)&&(r=n("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,r),this.setDisconnectionCause(e,t)}else e===ae.Status.DISCONNECTING&&this.setDisconnectionCause(e,t)}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof ae.Websocket:"bosh"===e.toLowerCase()?ae.Bosh&&this._proto instanceof ae.Bosh:void 0}hasResumed(){var e;return null!==(e=yu.settings.get("connection_options"))&&void 0!==e&&e.worker||this.isType("bosh")?ma.connfeedback.get("connection_status")===ae.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=Ni(),this.worker_attach_promise}}class lc extends dc{constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=ae.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(ae.Status.BINDREQUIRED)}}_processRequest(){}sendIQ(e,t,n){A(e)||(e=e.nodeTree),this.IQ_stanzas.push(e);const r=super.sendIQ(e,t,n);return this.IQ_ids.push(r),r}send(e){return A(e)?this.sent_stanzas.push(e):this.sent_stanzas.push(e.nodeTree),super.send(e)}async bind(){await yu.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,ma.no_connection_on_bind||this._changeConnectStatus(ae.Status.CONNECTED)}}const hc=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,fc=Symbol();class pc{constructor(e,t){if(t!==fc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return hc&&void 0===this.t&&(this.t=new CSSStyleSheet,this.t.replaceSync(this.cssText)),this.t}toString(){return this.cssText}}const gc=new Map,mc=e=>{let t=gc.get(e);return void 0===t&&gc.set(e,t=new pc(e,fc)),t},vc=hc?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>mc("string"==typeof e?e:e+""))(t)})(e):e;var _c,yc,bc,wc;const Sc={toAttribute(e,t){switch(t){case Boolean:e=e?"":null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},Ec=(e,t)=>t!==e&&(t==t||e==e),xc={attribute:!0,type:String,converter:Sc,reflect:!1,hasChanged:Ec};class Ac extends HTMLElement{constructor(){super(),this.Πi=new Map,this.Πo=void 0,this.Πl=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this.Πh=null,this.u()}static addInitializer(e){var t;null!==(t=this.v)&&void 0!==t||(this.v=[]),this.v.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,n)=>{const r=this.Πp(n,t);void 0!==r&&(this.Πm.set(r,n),e.push(r))})),e}static createProperty(e,t=xc){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,n,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(r){const i=this[e];this[t]=r,this.requestUpdate(e,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||xc}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this.Πm=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const n of t)this.createProperty(n,e[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(vc(e))}else void 0!==e&&t.push(vc(e));return t}static Πp(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this.Πg=new Promise((e=>this.enableUpdating=e)),this.L=new Map,this.Π_(),this.requestUpdate(),null===(e=this.constructor.v)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(t=this.ΠU)&&void 0!==t?t:this.ΠU=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(n=e.hostConnected)||void 0===n||n.call(e))}removeController(e){var t;null===(t=this.ΠU)||void 0===t||t.splice(this.ΠU.indexOf(e)>>>0,1)}Π_(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this.Πi.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{hc?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const n=document.createElement("style");n.textContent=t.cssText,e.appendChild(n)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this.ΠU)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)})),this.Πl&&(this.Πl(),this.Πo=this.Πl=void 0)}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this.ΠU)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)})),this.Πo=new Promise((e=>this.Πl=e))}attributeChangedCallback(e,t,n){this.K(e,n)}Πj(e,t,n=xc){var r,i;const s=this.constructor.Πp(e,n);if(void 0!==s&&!0===n.reflect){const o=(null!==(i=null===(r=n.converter)||void 0===r?void 0:r.toAttribute)&&void 0!==i?i:Sc.toAttribute)(t,n.type);this.Πh=e,null==o?this.removeAttribute(s):this.setAttribute(s,o),this.Πh=null}}K(e,t){var n,r,i;const s=this.constructor,o=s.Πm.get(e);if(void 0!==o&&this.Πh!==o){const e=s.getPropertyOptions(o),a=e.converter,c=null!==(i=null!==(r=null===(n=a)||void 0===n?void 0:n.fromAttribute)&&void 0!==r?r:"function"==typeof a?a:null)&&void 0!==i?i:Sc.fromAttribute;this.Πh=o,this[o]=c(t,e.type),this.Πh=null}}requestUpdate(e,t,n){let r=!0;void 0!==e&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||Ec)(this[e],t)?(this.L.has(e)||this.L.set(e,t),!0===n.reflect&&this.Πh!==e&&(void 0===this.Πk&&(this.Πk=new Map),this.Πk.set(e,n))):r=!1),!this.isUpdatePending&&r&&(this.Πg=this.Πq())}async Πq(){this.isUpdatePending=!0;try{for(await this.Πg;this.Πo;)await this.Πo}catch(e){Promise.reject(e)}const e=this.performUpdate();return null!=e&&await e,!this.isUpdatePending}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this.Πi&&(this.Πi.forEach(((e,t)=>this[t]=e)),this.Πi=void 0);let t=!1;const n=this.L;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(e=this.ΠU)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this.Π$()}catch(e){throw t=!1,this.Π$(),e}t&&this.E(n)}willUpdate(e){}E(e){var t;null===(t=this.ΠU)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}Π$(){this.L=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this.Πg}shouldUpdate(e){return!0}update(e){void 0!==this.Πk&&(this.Πk.forEach(((e,t)=>this.Πj(t,this[t],e))),this.Πk=void 0),this.Π$()}updated(e){}firstUpdated(e){}}var Nc,jc,Tc,Cc;Ac.finalized=!0,Ac.elementProperties=new Map,Ac.elementStyles=[],Ac.shadowRootOptions={mode:"open"},null===(yc=(_c=globalThis).reactiveElementPlatformSupport)||void 0===yc||yc.call(_c,{ReactiveElement:Ac}),(null!==(bc=(wc=globalThis).reactiveElementVersions)&&void 0!==bc?bc:wc.reactiveElementVersions=[]).push("1.0.0-rc.2");const Ic=globalThis.trustedTypes,Oc=Ic?Ic.createPolicy("lit-html",{createHTML:e=>e}):void 0,kc=`lit$${(Math.random()+"").slice(9)}$`,Mc="?"+kc,Rc=`<${Mc}>`,Dc=document,Fc=(e="")=>Dc.createComment(e),Lc=e=>null===e||"object"!=typeof e&&"function"!=typeof e,Pc=Array.isArray,Uc=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,$c=/-->/g,zc=/>/g,Bc=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,Hc=/'/g,qc=/"/g,Gc=/^(?:script|style|textarea)$/i,Wc=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),Jc=Wc(1),Qc=(Wc(2),Symbol.for("lit-noChange")),Vc=Symbol.for("lit-nothing"),Yc=new WeakMap,Xc=Dc.createTreeWalker(Dc,129,null,!1);class Kc{constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let i=0,s=0;const o=e.length-1,a=this.parts,[c,u]=((e,t)=>{const n=e.length-1,r=[];let i,s=2===t?"<svg>":"",o=Uc;for(let t=0;t<n;t++){const n=e[t];let a,c,u=-1,d=0;for(;d<n.length&&(o.lastIndex=d,c=o.exec(n),null!==c);)d=o.lastIndex,o===Uc?"!--"===c[1]?o=$c:void 0!==c[1]?o=zc:void 0!==c[2]?(Gc.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=Bc):void 0!==c[3]&&(o=Bc):o===Bc?">"===c[0]?(o=null!=i?i:Uc,u=-1):void 0===c[1]?u=-2:(u=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?Bc:'"'===c[3]?qc:Hc):o===qc||o===Hc?o=Bc:o===$c||o===zc?o=Uc:(o=Bc,i=void 0);const l=o===Bc&&e[t+1].startsWith("/>")?" ":"";s+=o===Uc?n+Rc:u>=0?(r.push(a),n.slice(0,u)+"$lit$"+n.slice(u)+kc+l):n+kc+(-2===u?(r.push(void 0),t):l)}const a=s+(e[n]||"<?>")+(2===t?"</svg>":"");return[void 0!==Oc?Oc.createHTML(a):a,r]})(e,t);if(this.el=Kc.createElement(c,n),Xc.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(r=Xc.nextNode())&&a.length<o;){if(1===r.nodeType){if(r.hasAttributes()){const e=[];for(const t of r.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(kc)){const n=u[s++];if(e.push(t),void 0!==n){const e=r.getAttribute(n.toLowerCase()+"$lit$").split(kc),t=/([.?@])?(.*)/.exec(n);a.push({type:1,index:i,name:t[2],strings:e,ctor:"."===t[1]?ru:"?"===t[1]?iu:"@"===t[1]?su:nu})}else a.push({type:6,index:i})}for(const t of e)r.removeAttribute(t)}if(Gc.test(r.tagName)){const e=r.textContent.split(kc),t=e.length-1;if(t>0){r.textContent=Ic?Ic.emptyScript:"";for(let n=0;n<t;n++)r.append(e[n],Fc()),Xc.nextNode(),a.push({type:2,index:++i});r.append(e[t],Fc())}}}else if(8===r.nodeType)if(r.data===Mc)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=r.data.indexOf(kc,e+1));)a.push({type:7,index:i}),e+=kc.length-1}i++}}static createElement(e,t){const n=Dc.createElement("template");return n.innerHTML=e,n}}function Zc(e,t,n=e,r){var i,s,o,a;if(t===Qc)return t;let c=void 0!==r?null===(i=n.Σi)||void 0===i?void 0:i[r]:n.Σo;const u=Lc(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==u&&(null===(s=null==c?void 0:c.O)||void 0===s||s.call(c,!1),void 0===u?c=void 0:(c=new u(e),c.T(e,n,r)),void 0!==r?(null!==(o=(a=n).Σi)&&void 0!==o?o:a.Σi=[])[r]=c:n.Σo=c),void 0!==c&&(t=Zc(e,c.S(e,t.values),c,r)),t}class eu{constructor(e,t){this.l=[],this.N=void 0,this.D=e,this.M=t}u(e){var t;const{el:{content:n},parts:r}=this.D,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:Dc).importNode(n,!0);Xc.currentNode=i;let s=Xc.nextNode(),o=0,a=0,c=r[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new tu(s,s.nextSibling,this,e):1===c.type?t=new c.ctor(s,c.name,c.strings,this,e):6===c.type&&(t=new ou(s,this,e)),this.l.push(t),c=r[++a]}o!==(null==c?void 0:c.index)&&(s=Xc.nextNode(),o++)}return i}v(e){let t=0;for(const n of this.l)void 0!==n&&(void 0!==n.strings?(n.I(e,n,t),t+=n.strings.length-2):n.I(e[t])),t++}}class tu{constructor(e,t,n,r){this.type=2,this.N=void 0,this.A=e,this.B=t,this.M=n,this.options=r}setConnected(e){var t;null===(t=this.P)||void 0===t||t.call(this,e)}get parentNode(){return this.A.parentNode}get startNode(){return this.A}get endNode(){return this.B}I(e,t=this){e=Zc(this,e,t),Lc(e)?e===Vc||null==e||""===e?(this.H!==Vc&&this.R(),this.H=Vc):e!==this.H&&e!==Qc&&this.m(e):void 0!==e._$litType$?this._(e):void 0!==e.nodeType?this.$(e):(e=>{var t;return Pc(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])})(e)?this.g(e):this.m(e)}k(e,t=this.B){return this.A.parentNode.insertBefore(e,t)}$(e){this.H!==e&&(this.R(),this.H=this.k(e))}m(e){const t=this.A.nextSibling;null!==t&&3===t.nodeType&&(null===this.B?null===t.nextSibling:t===this.B.previousSibling)?t.data=e:this.$(Dc.createTextNode(e)),this.H=e}_(e){var t;const{values:n,_$litType$:r}=e,i="number"==typeof r?this.C(e):(void 0===r.el&&(r.el=Kc.createElement(r.h,this.options)),r);if((null===(t=this.H)||void 0===t?void 0:t.D)===i)this.H.v(n);else{const e=new eu(i,this),t=e.u(this.options);e.v(n),this.$(t),this.H=e}}C(e){let t=Yc.get(e.strings);return void 0===t&&Yc.set(e.strings,t=new Kc(e)),t}g(e){Pc(this.H)||(this.H=[],this.R());const t=this.H;let n,r=0;for(const i of e)r===t.length?t.push(n=new tu(this.k(Fc()),this.k(Fc()),this,this.options)):n=t[r],n.I(i),r++;r<t.length&&(this.R(n&&n.B.nextSibling,r),t.length=r)}R(e=this.A.nextSibling,t){var n;for(null===(n=this.P)||void 0===n||n.call(this,!1,!0,t);e&&e!==this.B;){const t=e.nextSibling;e.remove(),e=t}}}class nu{constructor(e,t,n,r,i){this.type=1,this.H=Vc,this.N=void 0,this.V=void 0,this.element=e,this.name=t,this.M=r,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this.H=Array(n.length-1).fill(Vc),this.strings=n):this.H=Vc}get tagName(){return this.element.tagName}I(e,t=this,n,r){const i=this.strings;let s=!1;if(void 0===i)e=Zc(this,e,t,0),s=!Lc(e)||e!==this.H&&e!==Qc,s&&(this.H=e);else{const r=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=Zc(this,r[n+o],t,o),a===Qc&&(a=this.H[o]),s||(s=!Lc(a)||a!==this.H[o]),a===Vc?e=Vc:e!==Vc&&(e+=(null!=a?a:"")+i[o+1]),this.H[o]=a}s&&!r&&this.W(e)}W(e){e===Vc?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class ru extends nu{constructor(){super(...arguments),this.type=3}W(e){this.element[this.name]=e===Vc?void 0:e}}class iu extends nu{constructor(){super(...arguments),this.type=4}W(e){e&&e!==Vc?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class su extends nu{constructor(){super(...arguments),this.type=5}I(e,t=this){var n;if((e=null!==(n=Zc(this,e,t,0))&&void 0!==n?n:Vc)===Qc)return;const r=this.H,i=e===Vc&&r!==Vc||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==Vc&&(r===Vc||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this.H=e}handleEvent(e){var t,n;"function"==typeof this.H?this.H.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this.H.handleEvent(e)}}class ou{constructor(e,t,n){this.element=e,this.type=6,this.N=void 0,this.V=void 0,this.M=t,this.options=n}I(e){Zc(this,e)}}var au,cu,uu,du,lu,hu;null===(jc=(Nc=globalThis).litHtmlPlatformSupport)||void 0===jc||jc.call(Nc,Kc,tu),(null!==(Tc=(Cc=globalThis).litHtmlVersions)&&void 0!==Tc?Tc:Cc.litHtmlVersions=[]).push("2.0.0-rc.3"),(null!==(au=(hu=globalThis).litElementVersions)&&void 0!==au?au:hu.litElementVersions=[]).push("3.0.0-rc.2");class fu extends Ac{constructor(){super(...arguments),this.renderOptions={host:this},this.Φt=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();super.update(e),this.Φt=((e,t,n)=>{var r,i;const s=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:t;let o=s._$litPart$;if(void 0===o){const e=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:null;s._$litPart$=o=new tu(t.insertBefore(Fc(),e),e,void 0,n)}return o.I(e),o})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this.Φt)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.Φt)||void 0===e||e.setConnected(!1)}render(){return Qc}}fu.finalized=!0,fu._$litElement$=!0,null===(uu=(cu=globalThis).litElementHydrateSupport)||void 0===uu||uu.call(cu,{LitElement:fu}),null===(lu=(du=globalThis).litElementPlatformSupport)||void 0===lu||lu.call(du,{LitElement:fu});var pu=o(7002),gu=o(1063);function mu(e,t){t=e.session.get("jid")||t,e.api.settings.get("authentication")===e.ANONYMOUS||ae.getResourceFromJid(t)||(t=t.toLowerCase()+dc.generateResource()),e.jid=t,e.bare_jid=ae.getBareJidFromJid(t),e.resource=ae.getResourceFromJid(t),e.domain=ae.getDomainFromJid(t),e.session.save({jid:t,bare_jid:e.bare_jid,resource:e.resource,domain:e.domain,active:!0}),e.connection.jid=t}function vu(e=0){return new Promise(uc((async(e,t)=>{let n=new XMLHttpRequest;n.open("GET",ma.api.settings.get("credentials_url"),!0),n.setRequestHeader("Accept","application/json, text/javascript"),n.onload=()=>{if(n.status>=200&&n.status<400){const t=JSON.parse(n.responseText);ma.setUserJID(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${n.status}: ${n.responseText}`))},n.onerror=t,n=await ma.api.hook("beforeFetchLoginCredentials",this,n),n.send()}),e))}function _u(e){if([ma.ANONYMOUS,ma.EXTERNAL].includes(ma.api.settings.get("authentication"))){if(!ma.jid)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");ma.connection.reconnecting||ma.connection.reset(),ma.connection.connect(ma.jid.toLowerCase())}else if(ma.api.settings.get("authentication")===ma.LOGIN){var t;const n=e?e.password:(null===(t=ma.connection)||void 0===t?void 0:t.pass)||ma.api.settings.get("password");if(!n){if(ma.api.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return ma.connection.setDisconnectionCause(ae.Status.AUTHFAIL,void 0,!0),void ma.api.connection.disconnect()}ma.connection.reconnecting||ma.connection.reset(),ma.connection.connect(ma.jid,n)}}ba().extend(_a()),ae.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),ae.addNamespace("CARBONS","urn:xmpp:carbons:2"),ae.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),ae.addNamespace("CSI","urn:xmpp:csi:0"),ae.addNamespace("DELAY","urn:xmpp:delay"),ae.addNamespace("EME","urn:xmpp:eme:0"),ae.addNamespace("FASTEN","urn:xmpp:fasten:0"),ae.addNamespace("FORWARD","urn:xmpp:forward:0"),ae.addNamespace("HINTS","urn:xmpp:hints"),ae.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),ae.addNamespace("IDLE","urn:xmpp:idle:1"),ae.addNamespace("MAM","urn:xmpp:mam:2"),ae.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),ae.addNamespace("MENTIONS","urn:xmpp:mmn:0"),ae.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),ae.addNamespace("MODERATE","urn:xmpp:message-moderate:0"),ae.addNamespace("NICK","http://jabber.org/protocol/nick"),ae.addNamespace("OCCUPANTID","urn:xmpp:occupant-id:0"),ae.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),ae.addNamespace("OUTOFBAND","jabber:x:oob"),ae.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),ae.addNamespace("RAI","urn:xmpp:rai:0"),ae.addNamespace("RECEIPTS","urn:xmpp:receipts"),ae.addNamespace("REFERENCE","urn:xmpp:reference:0"),ae.addNamespace("REGISTER","jabber:iq:register"),ae.addNamespace("RETRACT","urn:xmpp:message-retract:0"),ae.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),ae.addNamespace("RSM","http://jabber.org/protocol/rsm"),ae.addNamespace("SID","urn:xmpp:sid:0"),ae.addNamespace("SPOILER","urn:xmpp:spoiler:0"),ae.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),ae.addNamespace("STYLING","urn:xmpp:styling:0"),ae.addNamespace("VCARD","vcard-temp"),ae.addNamespace("VCARDUPDATE","vcard-temp:x:update"),ae.addNamespace("XFORM","jabber:x:data"),ae.addNamespace("XHTML","http://www.w3.org/1999/xhtml"),ma.VERSION_NAME="v9.0.0",Object.assign(ma,Ar),xa(ma,"_converse","pluggable");const yu=ma.api={connection:{connected(){var e;return(null==ma||null===(e=ma.connection)||void 0===e?void 0:e.connected)&&!0},disconnect(){ma.connection&&ma.connection.disconnect()},async reconnect(){var e;const t=ma.connfeedback.get("connection_status");if(yu.settings.get("authentication")===ma.ANONYMOUS&&(await bu(),await wu()),t===ae.Status.CONNFAIL?yu.connection.isType("websocket")&&yu.settings.get("bosh_service_url")?(await ma.setUserJID(ma.bare_jid),ma.connection._proto._doDisconnect(),ma.connection._proto=new ae.Bosh(ma.connection),ma.connection.service=yu.settings.get("bosh_service_url")):yu.connection.isType("bosh")&&yu.settings.get("websocket_url")&&(yu.settings.get("authentication")===ma.ANONYMOUS?await ma.setUserJID(yu.settings.get("jid")):await ma.setUserJID(ma.bare_jid),ma.connection._proto._doDisconnect(),ma.connection._proto=new ae.Websocket(ma.connection),ma.connection.service=yu.settings.get("websocket_url")):t===ae.Status.AUTHFAIL&&yu.settings.get("authentication")===ma.ANONYMOUS&&await ma.setUserJID(yu.settings.get("jid")),null===(e=ma.connection)||void 0===e||!e.reconnecting)return ma.connection.reconnect();ma.connection.debouncedReconnect()},isType:e=>ma.connection.isType(e)},async trigger(e){if(!ma._events)return;const t=Array.from(arguments),n=t.pop();if(n&&n.synchronous){const n=ma._events[e]||[],r=t.splice(1);await Promise.all(n.map((e=>e.callback.apply(e.ctx,r))))}else ma.trigger.apply(ma,arguments);const r=ma.promises[e];void 0!==r&&r.resolve()},hook(e,t,n){const r=ma._events[e]||[];if(r.length){const e=r.reduce(((e,n)=>e.then((e=>n.callback(t,e)))),Promise.resolve(n));return e.catch((e=>{throw k.error(e),e})),e}return n},user:{settings:Xo,jid:()=>ma.connection.jid,async login(e,t,n=!1){var r,i;if(e=e||yu.settings.get("jid"),(null===(r=ma.connection)||void 0===r||!r.jid||e&&!ca.isSameDomain(ma.connection.jid,e))&&await ma.initConnection(),null!==(i=yu.settings.get("connection_options"))&&void 0!==i&&i.worker&&await ma.connection.restoreWorkerSession())return;e&&(e=await ma.setUserJID(e));const s=ma.pluggable.plugins["converse-bosh"];if(s&&s.enabled()){if(await ma.restoreBOSHSession())return;if(yu.settings.get("authentication")===ma.PREBIND&&(!n||yu.settings.get("auto_login")))return ma.startNewPreboundBOSHSession()}t=t||yu.settings.get("password"),async function(e,t){const{api:n}=ma;n.settings.get("authentication")===ma.LOGIN?e?_u(e):ma.api.settings.get("credentials_url")?_u(await async function(){let e,t=0;for(;!e;){try{e=await vu(t)}catch(e){k.error("Could not fetch login credentials"),k.error(e)}t=2e3}return e}()):ma.jid&&(ma.api.settings.get("password")||ma.connection.pass)?_u():!ma.isTestEnv()&&"credentials"in navigator?_u(await async function(){try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&ea.isValidJID(e.id))return await ma.setUserJID(e.id),{jid:e.id,password:e.password}}catch(e){k.error(e)}}()):!ma.isTestEnv()&&k.warn("attemptNonPreboundSession: Couldn't find credentials to log in with"):![ma.ANONYMOUS,ma.EXTERNAL].includes(ma.api.settings.get("authentication"))||t&&!ma.api.settings.get("auto_login")||_u()}(e&&t?{jid:e,password:t}:null,n)},async logout(){await yu.trigger("beforeLogout",{synchronous:!0});const e=Ni(),t=()=>{Object.keys(ma.promises).forEach(sa),delete ma.jid,yu.trigger("logout"),e.resolve()};return ma.connection.setDisconnectionCause(ma.LOGOUT,void 0,!0),void 0!==ma.connection?(yu.listen.once("disconnected",(()=>t())),ma.connection.disconnect()):t(),e}},settings:Yo,promises:{add(e,t=!0){(e=Array.isArray(e)?e:[e]).forEach((e=>{const n=Ni();n.replace=t,ma.promises[e]=n}))}},listen:{once:ma.once.bind(ma),on:ma.on.bind(ma),not:ma.off.bind(ma),stanza(e,t,n){ge(t)?(n=t,t={}):t=t||{},ma.connection.addHandler(n,t.ns,e,t.type,t.id,t.from,t)}},waitUntil(e){if(ge(e))return ca.waitUntil(e);{const t=ma.promises[e];return void 0===t?null:t}},send(e){var t;return yu.connection.connected()?("string"==typeof e?e=ca.toStanza(e):null!==(t=e)&&void 0!==t&&t.nodeTree&&(e=e.nodeTree),"iq"===e.tagName?yu.sendIQ(e):(ma.connection.send(e),void yu.trigger("send",e))):(k.warn("Not sending stanza because we're not connected!"),void k.warn(ae.serialize(e)))},sendIQ(e,t=ma.STANZA_TIMEOUT,n=!0){var r;let i;return e=(null===(r=e)||void 0===r?void 0:r.nodeTree)??e,["get","set"].includes(e.getAttribute("type"))?(t=t||ma.STANZA_TIMEOUT,n?(i=new Promise(((n,r)=>ma.connection.sendIQ(e,n,r,t))),i.catch((n=>{if(null===n)throw new ci(`Timeout error after ${t}ms for the following IQ stanza: ${ae.serialize(e)}`)}))):i=new Promise((n=>ma.connection.sendIQ(e,n,n,t)))):(ma.connection.sendIQ(e),i=Promise.resolve()),yu.trigger("send",e),i}};async function bu(){return await ma.api.trigger("beforeTearDown",{synchronous:!0}),window.removeEventListener("click",ma.onUserActivity),window.removeEventListener("focus",ma.onUserActivity),window.removeEventListener("keypress",ma.onUserActivity),window.removeEventListener("mousemove",ma.onUserActivity),window.removeEventListener(ma.unloadevent,ma.onUserActivity),window.clearInterval(ma.everySecondTrigger),ma.api.trigger("afterTearDown"),ma}function wu(){var e;return null===(e=ma.session)||void 0===e||e.destroy(),delete ma.session,ma.shouldClearCache()&&ma.api.user.settings.clear(),ma.api.trigger("clearSession",{synchronous:!0})}ma.shouldClearCache=()=>!ma.config.get("trusted")||yu.settings.get("clear_cache_on_logout")||ma.isTestEnv(),ma.initConnection=function(){const e=ma.api;if(!e.settings.get("bosh_service_url")){if(e.settings.get("authentication")===ma.PREBIND)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");if(!e.settings.get("websocket_url"))throw new Error("initConnection: you must supply a value for either the bosh_service_url or websocket_url or both.")}const t=ma.isTestEnv()?lc:dc;if(("WebSocket"in window||"MozWebSocket"in window)&&e.settings.get("websocket_url"))ma.connection=new t(e.settings.get("websocket_url"),Object.assign(ma.default_connection_options,e.settings.get("connection_options")));else{if(!e.settings.get("bosh_service_url"))throw new Error("initConnection: this browser does not support websockets and bosh_service_url wasn't specified.");ma.connection=new t(e.settings.get("bosh_service_url"),Object.assign(ma.default_connection_options,e.settings.get("connection_options"),{keepalive:e.settings.get("keepalive")}))}!function(){const e={};e[ae.LogLevel.DEBUG]="debug",e[ae.LogLevel.INFO]="info",e[ae.LogLevel.WARN]="warn",e[ae.LogLevel.ERROR]="error",e[ae.LogLevel.FATAL]="fatal",ae.log=(t,n)=>k.log(n,e[t]),ae.error=e=>k.error(e),ma.connection.xmlInput=e=>k.debug(e.outerHTML,"color: darkgoldenrod"),ma.connection.xmlOutput=e=>k.debug(e.outerHTML,"color: darkcyan")}(),e.trigger("connectionInitialized")},ma.setUserJID=async function(e){return await async function(e,t){var n;const r=e.api.settings.get("connection_options").worker,i=ae.getBareJidFromJid(t).toLowerCase(),s=`converse.session-${i}`;(null===(n=e.session)||void 0===n?void 0:n.get("id"))!==s?(function(e,t){if("sessionStorage"===e.api.settings.get("persistent_store"))return;if("BrowserExtLocal"===e.api.settings.get("persistent_store"))return fo.localForage.defineDriver(pu.Z).then((()=>fo.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage.persistent=fo.localForage);if("BrowserExtSync"===e.api.settings.get("persistent_store"))return fo.localForage.defineDriver(gu.Z).then((()=>fo.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage.persistent=fo.localForage);const n={name:e.isTestEnv()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===e.api.settings.get("persistent_store")?(n.description="localStorage instance",n.driver=[fo.localForage.LOCALSTORAGE]):"IndexedDB"===e.api.settings.get("persistent_store")&&(n.description="indexedDB instance",n.driver=[fo.localForage.INDEXEDDB]),e.storage.persistent=fo.localForage.createInstance(n)}(e,i),e.session=new Vo({id:s}),vo(e.session,s,r?"persistent":"session"),await new Promise((t=>e.session.fetch({success:t,error:t}))),!r&&e.session.get("active")&&(e.session.clear(),e.session.save({id:s})),mu(e,t),e.api.trigger("userSessionInitialized")):mu(e,t)}(ma,e),ma.api.trigger("setUserJID"),e},ma.saveWindowState=function(e){let t;const n={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};t=(e=e||document.createEvent("Events")).type in n?n[e.type]:document.hidden?"hidden":"visible",ma.windowState=t,yu.trigger("windowStateChanged",{state:t})},ma.ConnectionFeedback=Vo.extend({defaults:{connection_status:ae.Status.DISCONNECTED,message:""},initialize(){this.on("change",(()=>yu.trigger("connfeedback",ma.connfeedback)))}});const Su=window.converse||{};Object.assign(Su,{CHAT_STATES:["active","composing","gone","inactive","paused"],keycodes:{TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,FORWARD_SLASH:47,AT:50,META:91,META_RIGHT:93},async initialize(e){if(await async function(e){var t;const{api:n}=e;await n.trigger("cleanup",{synchronous:!0}),e.router.history.stop(),function(e){const{api:t}=e;document.removeEventListener("visibilitychange",e.saveWindowState),t.trigger("unregisteredGlobalEventHandlers")}(e),null===(t=e.connection)||void 0===t||t.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&n.promises.add("initialized")}(ma),"onpagehide"in window?ma.unloadevent="pagehide":"onbeforeunload"in window?ma.unloadevent="beforeunload":"onunload"in window&&(ma.unloadevent="unload"),function(e){ha=e,da={},Object.assign(da,Ar);const t=No(e,Object.keys(ua));xt(da,ua,t)}(e),ma.strict_plugin_dependencies=e.strict_plugin_dependencies,k.setLogLevel(yu.settings.get("loglevel")),yu.settings.get("authentication")===ma.ANONYMOUS&&yu.settings.get("auto_login")&&!yu.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");var t;ma.router.route(/^converse\?loglevel=(debug|info|warn|error|fatal)$/,"loglevel",(e=>k.setLogLevel(e))),ma.connfeedback=new ma.ConnectionFeedback,ma.send_initial_presence=!0,await async function(e){await fo.sessionStorageInitialized,e.storage={session:fo.localForage.createInstance({name:e.isTestEnv()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}}(ma),await async function(e){const t="converse.client-config";e.config=new Vo({id:t,trusted:!0}),e.config.browserStorage=mo(t,"session"),await new Promise((t=>e.config.fetch({success:t,error:t}))),e.api.trigger("clientConfigInitialized")}(ma),await r.initialize(),function(e){e.pluggable.initialized_plugins=[];const t=he.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}(ma),yu.elements.register(),t=ma,document.addEventListener("visibilitychange",t.saveWindowState),t.saveWindowState({type:document.hidden?"blur":"focus"}),t.api.trigger("registeredGlobalEventHandlers");try{!History.started&&ma.router.history.start()}catch(e){k.error(e)}yu.settings.get("idle_presence_timeout")>0&&yu.listen.on("addClientFeatures",(()=>yu.disco.own.features.add(ae.NS.IDLE)));const n=ma.pluggable.plugins;if((yu.settings.get("auto_login")||yu.settings.get("keepalive")&&wa(n["converse-bosh"],"enabled"))&&await yu.user.login(null,null,!0),yu.trigger("initialized"),ma.isTestEnv())return ma},plugins:{add(e,t){if(t.__name__=e,void 0!==ma.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);ma.pluggable.plugins[e]=t}},env:{$build:re,$iq:se,$msg:ie,$pres:oe,utils:ca,Collection:Ka,Model:Vo,Promise,Strophe:ae,URI:t(),dayjs:ba(),html:Jc,log:k,sizzle:Oo(),sprintf:n.sprintf,u:ca}});const Eu=Su.env.utils;function xu(e,t){yu.send(ie({to:e.getAttribute("from"),type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("not-allowed",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).t(t)),k.warn(`Rejecting message stanza with the following reason: ${t}`),k.warn(e)}function Au(e,t,n,r){const i=ie({from:ma.connection.jid,id:Eu.getUniqueId(),to:e,type:r||"chat"}).c(n,{xmlns:ae.NS.MARKERS,id:t});yu.send(i)}function Nu(e,n){const r=function(e){try{return e instanceof t()?e:new(t())(e)}catch(e){return k.debug(e),null}}(n);if(null===r||!function(e){const t=e.protocol().toLowerCase();return"http:"===window.location.protocol||"https:"===window.location.protocol&&["https","aesgcm"].includes(t)}(r))return!1;const i=r.filename().toLowerCase();return!!e.filter((e=>i.endsWith(e))).length}function ju(e){return Nu([".mp4",".webm"],e)}function Tu(e){const t=yu.settings.get("image_urls_regex");return(null==t?void 0:t.test(e))||function(e){return Nu([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}(e)}function Cu(e){return e.startsWith("aesgcm://")}const{NS:Iu}=ae;class Ou extends Error{constructor(e,t){super(e,t),this.name="StanzaParseError",this.stanza=t}}function ku(e,t){const n={},r=Oo()(`stanza-id[xmlns="${ae.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{});Object.assign(n,r);const i=Oo()(`message > result[xmlns="${ae.NS.MAM}"]`,t).pop();i&&(n[`stanza_id ${t.getAttribute("from")||ma.bare_jid}`]=i.getAttribute("id"));const s=Oo()(`origin-id[xmlns="${ae.NS.SID}"]`,e).pop();return s&&(n.origin_id=s.getAttribute("id")),n}function Mu(e){const t=Oo()(`encryption[xmlns="${ae.NS.EME}"]`,e).pop(),n=null==t?void 0:t.getAttribute("namespace"),r={};return n?(r.is_encrypted=!0,r.encryption_namespace=n):Oo()(`encrypted[xmlns="${ae.NS.OMEMO}"]`,e).pop()&&(r.is_encrypted=!0,r.encryption_namespace=ae.NS.OMEMO),r}function Ru(e,t){const n=Oo()(`> apply-to[xmlns="${ae.NS.FASTEN}"]`,e).pop();if(n){const e=n.getAttribute("id");if(Oo()(`> retract[xmlns="${ae.NS.RETRACT}"]`,n).pop()){const n=Oo()(`delay[xmlns="${ae.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:n?ba()(n.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}else{const t=Oo()(`> retracted[xmlns="${ae.NS.RETRACT}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp")}}return{}}function Du(e,t){const n=Oo()(`replace[xmlns="${ae.NS.MESSAGE_CORRECT}"]`,e).pop();if(n){const e=n.getAttribute("id"),r=e;if(e){const n=Oo()(`delay[xmlns="${ae.NS.DELAY}"]`,t).pop();return{msgid:r,replace_id:e,edited:n?ba()(n.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function Fu(e){const n=[];if(!e)return{};try{t().withinString(e,((e,t,r)=>(e.startsWith("_")&&(e=e.slice(1),t+=1),e.endsWith("_")&&(e=e.slice(0,e.length-1),r-=1),n.push({url:e,start:t,end:r}),e)),fe)}catch(e){k.debug(e)}const r=n.map((e=>{return{end:e.end,is_audio:(t=e.url,Nu([".ogg",".mp3",".m4a"],t)),is_image:Tu(e.url),is_video:ju(e.url),is_encrypted:Cu(e.url),start:e.start};var t}));return r.length?{media_urls:r}:{}}function Lu(e){const t=Oo()(`spoiler[xmlns="${ae.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:null==t?void 0:t.textContent}}function Pu(e){const t=Oo()(`x[xmlns="${ae.NS.OUTOFBAND}"]`,e).pop();var n,r;return t?{oob_url:null===(n=t.querySelector("url"))||void 0===n?void 0:n.textContent,oob_desc:null===(r=t.querySelector("desc"))||void 0===r?void 0:r.textContent}:{}}function Uu(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),n=Oo()(`text[xmlns="${ae.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:null==n?void 0:n.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName}}return{}}function $u(e){return Oo()(`reference[xmlns="${ae.NS.REFERENCE}"]`,e).map((t=>{var n;const r=t.getAttribute("anchor"),i=null===(n=e.querySelector(r?`#${r}`:"body"))||void 0===n?void 0:n.textContent;if(!i)return k.warn(`Could not find referenced text for ${t}`),null;const s=t.getAttribute("begin"),o=t.getAttribute("end");return{begin:s,end:o,type:t.getAttribute("type"),value:i.slice(s,o),uri:t.getAttribute("uri")}})).filter((e=>e))}function zu(e){const t=Oo()(`received[xmlns="${ae.NS.RECEIPTS}"]`,e).pop();return null==t?void 0:t.getAttribute("id")}function Bu(e){const t=ae.NS.CARBONS;return Oo()(`message > received[xmlns="${t}"]`,e).length>0||Oo()(`message > sent[xmlns="${t}"]`,e).length>0}function Hu(e){var t;return null===(t=Oo()(`\n        composing[xmlns="${Iu.CHATSTATES}"],\n        paused[xmlns="${Iu.CHATSTATES}"],\n        inactive[xmlns="${Iu.CHATSTATES}"],\n        active[xmlns="${Iu.CHATSTATES}"],\n        gone[xmlns="${Iu.CHATSTATES}"]`,e).pop())||void 0===t?void 0:t.nodeName}function qu(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&Oo()(`request[xmlns="${ae.NS.RECEIPTS}"]`,e).length}function Gu(e){if(Oo()(`message > forwarded[xmlns="${ae.NS.FORWARD}"]`,e).length){xu(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new Ou(`Ignoring unencapsulated forwarded message from ${t}`,e)}}function Wu(e){return Oo()(`\n        acknowledged[xmlns="${ae.NS.MARKERS}"],\n        displayed[xmlns="${ae.NS.MARKERS}"],\n        received[xmlns="${ae.NS.MARKERS}"]`,e).pop()}function Ju(e){return"headline"===e.getAttribute("type")}function Qu(e){if(Oo()(`mentions[xmlns="${ae.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function Vu(e){return!!Oo()(`message > result[xmlns="${ae.NS.MAM}"]`,e).pop()}function Yu(e){return e.getAttributeNames().reduce(((t,n)=>(t[n]=ae.xmlunescape(e.getAttribute(n)),t)),{})}const{Strophe:Xu}=Su.env;let Ku,Zu;Xu.addNamespace("ADHOC","http://jabber.org/protocol/commands");const ed={adhoc:{async getCommands(e){let t=[];try{n=await Zu.disco.items(e,Xu.NS.ADHOC),t=Oo()(`query[xmlns="${Xu.NS.DISCO_ITEMS}"][node="${Xu.NS.ADHOC}"] item`,n).map(Yu)}catch(t){null===t?k.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(k.error(`Error while fetching ad-hoc commands for ${e}`),k.error(t))}var n;return t}}};Su.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){Ku=this._converse,Zu=Ku.api,Object.assign(Zu,ed)}});const td=Vo.extend({initialize(){this.rosterContactAdded=Ni()},async setRosterContact(e){const t=await yu.contacts.get(e);t&&(this.contact=t,this.set("nickname",t.get("nickname")),this.rosterContactAdded.resolve())}});var nd=o(6755),rd=o.n(nd);const{u:id}=Su.env;function sd(e){const t=yu.settings.get("prune_messages_above");if(t&&"number"==typeof t&&e.messages.length>t){const n=e.messages.filter((e=>!id.isEmptyMessage(e)));if(n.length>t){for(;n.length>t;)n.shift().destroy();yu.trigger("historyPruned",e)}}}const od=uc(sd,250),{Strophe:ad,sizzle:cd}=Su.env;async function ud(e,t){var n,r,i,s,o,a;Gu(e);let c=e.getAttribute("to");const u=ad.getResourceFromJid(c);if(yu.settings.get("filter_by_resource")&&u&&u!==t.resource)return new Ou(`Ignoring incoming message intended for a different resource: ${c}`,e);const d=e;let l=e.getAttribute("from")||t.bare_jid;if(Bu(e)){if(l!==t.bare_jid)return xu(e,"Rejecting carbon from invalid JID"),new Ou(`Rejecting carbon from invalid JID ${c}`,e);{const t=`[xmlns="${ad.NS.CARBONS}"] > forwarded[xmlns="${ad.NS.FORWARD}"] > message`;c=(e=cd(t,e).pop()).getAttribute("to"),l=e.getAttribute("from")}}const h=Vu(e);if(h){if(l!==t.bare_jid)return new Ou(`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`,e);{const t=`[xmlns="${ad.NS.MAM}"] > forwarded[xmlns="${ad.NS.FORWARD}"] > message`;c=(e=cd(t,e).pop()).getAttribute("to"),l=e.getAttribute("from")}}const f=ad.getBareJidFromJid(l),p=f===t.bare_jid;if(p&&null===c)return new Ou(`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`,e);const g=Ju(e),m=Qu(e);let v,_;if(!g&&!m&&(_=p?ad.getBareJidFromJid(c):f,v=await yu.contacts.get(_),void 0===v&&!yu.settings.get("allow_non_roster_messaging")))return k.error(e),new Ou("Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.",e);const y=cd(`delay[xmlns="${ad.NS.DELAY}"]`,d).pop(),b=Wu(e),w=(new Date).toISOString();let S=Object.assign({contact_jid:_,is_archived:h,is_headline:g,is_server_message:m,body:null===(n=e.querySelector("body"))||void 0===n||null===(r=n.textContent)||void 0===r?void 0:r.trim(),chat_state:Hu(e),from:ad.getBareJidFromJid(e.getAttribute("from")),is_carbon:Bu(d),is_delayed:!!y,is_markable:!!cd(`markable[xmlns="${ad.NS.MARKERS}"]`,e).length,is_marker:!!b,is_unstyled:!!cd(`unstyled[xmlns="${ad.NS.STYLING}"]`,e).length,marker_id:b&&b.getAttribute("id"),msgid:e.getAttribute("id")||d.getAttribute("id"),nick:null===(i=v)||void 0===i||null===(s=i.attributes)||void 0===s?void 0:s.nickname,receipt_id:zu(e),received:(new Date).toISOString(),references:$u(e),sender:p?"me":"them",subject:null===(o=e.querySelector("subject"))||void 0===o?void 0:o.textContent,thread:null===(a=e.querySelector("thread"))||void 0===a?void 0:a.textContent,time:y?ba()(y.getAttribute("stamp")).toISOString():w,to:e.getAttribute("to"),type:e.getAttribute("type")},Uu(e),Pu(e),Lu(e),Du(e,d),ku(e,d),Ru(e,d),Mu(e));if(S.is_archived){const n=d.getAttribute("from");if(n&&n!==t.bare_jid)return new Ou(`Invalid Stanza: Forged MAM message from ${n}`,e)}return await yu.emojis.initialize(),S=Object.assign({message:S.body||S.error,is_only_emojis:!!S.body&&ca.isOnlyEmojis(S.body),is_valid_receipt_request:qu(e,S)},S),S.id=S.origin_id||S[`stanza_id ${S.from}`]||ca.getUniqueId(),S=await yu.hook("parseMessage",e,S),Object.assign(S,Fu(S.is_encrypted?S.plaintext:S.body))}const{Strophe:dd,$msg:ld}=Su.env,hd=Su.env.utils,fd=td.extend({defaults(){return{bookmarked:!1,chat_state:void 0,hidden:Zo()&&!yu.settings.get("singleton"),message_type:"chat",nickname:void 0,num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:ma.PRIVATE_CHAT_TYPE,url:""}},async initialize(){this.initialized=Ni(),td.prototype.initialize.apply(this,arguments);const e=this.get("jid");e&&(this.set({box_id:`box-${e}`}),this.initNotifications(),this.initUI(),this.initMessages(),this.get("type")===ma.PRIVATE_CHAT_TYPE&&(this.presence=ma.presences.findWhere({jid:e})||ma.presences.create({jid:e}),await this.setRosterContact(e),this.presence.on("change:show",(e=>this.onPresenceChanged(e)))),this.on("change:chat_state",this.sendChatState,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.fetchMessages(),await yu.trigger("chatBoxInitialized",this,{Synchronous:!0}),this.initialized.resolve())},getMessagesCollection:()=>new ma.Messages,getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${ma.bare_jid}`},initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=Ni(),this.messages.fetched.then((()=>{this.pruneHistoryWhenScrolledDown(),yu.trigger("afterMessagesFetched",this)})),this.messages.chatbox=this,vo(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"change:upload",this.onMessageUploadChanged,this),this.listenTo(this.messages,"add",this.onMessageAdded,this)},initUI(){this.ui=new Vo},initNotifications(){this.notifications=new Vo},getNotificationsText(){var e,t,n;const{__:r}=ma;return(null===(e=this.notifications)||void 0===e?void 0:e.get("chat_state"))===ma.COMPOSING?r("%1$s is typing",this.getDisplayName()):(null===(t=this.notifications)||void 0===t?void 0:t.get("chat_state"))===ma.PAUSED?r("%1$s has stopped typing",this.getDisplayName()):(null===(n=this.notifications)||void 0===n?void 0:n.get("chat_state"))===ma.GONE?r("%1$s has gone away",this.getDisplayName()):""},afterMessagesFetched(){yu.trigger("afterMessagesFetched",this)},fetchMessages(){if(this.messages.fetched_flag)return void k.info(`Not re-fetching messages for ${this.get("jid")}`);this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:t=>{this.afterMessagesFetched(t),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched},async handleErrorMessageStanza(e){const{__:t}=ma,n=await ud(e,ma);if(!await this.shouldShowErrorMessage(n))return;const r=this.getMessageReferencedByError(n);if(r){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===r.get("retraction_id")?(e.retraction_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to send a message."):e.error=t("Sorry, an error occurred while trying to send your message.")),r.save(e)}else this.createMessage(n)},queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>k.error(e))),this.msg_chain},async onMessage(e){if(e=await e,hd.isErrorObject(e))return e.stanza&&k.error(e.stanza),k.error(e.message);const t=this.getDuplicateMessage(e);if(t)this.updateMessage(t,e);else if(!this.handleReceipt(e)&&!this.handleChatMarker(e)&&!await this.handleRetraction(e)&&(this.setEditable(e,e.time),e.chat_state&&"them"===e.sender&&this.notifications.set("chat_state",e.chat_state),hd.shouldCreateMessage(e))){const t=this.handleCorrection(e)||await this.createMessage(e);this.notifications.set({chat_state:null}),this.handleUnreadMessage(t)}},async onMessageUploadChanged(e){if(e.get("upload")===ma.SUCCESS){const t={body:e.get("message"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};await this.sendMessage(t),e.destroy()}},onMessageAdded(e){!yu.settings.get("prune_messages_above")||"scrolled"!==yu.settings.get("pruning_behavior")&&this.ui.get("scrolled")||hd.isEmptyMessage(e)||od(this)},async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),k.error(e)}finally{delete this.msg_chain,delete this.messages.fetched_flag,this.messages.fetched=Ni()}},async close(){yu.connection.connected()&&(this.setChatState(ma.INACTIVE),this.sendChatState());try{await new Promise(((e,t)=>this.destroy({success:e,error:(e,n)=>t(n)})))}catch(e){k.error(e)}finally{yu.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}yu.trigger("chatBoxClosed",this)},announceReconnection(){yu.trigger("chatReconnected",this)},async onReconnection(){yu.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()},onPresenceChanged(e){const{__:t}=ma,n=e.get("show"),r=this.getDisplayName();let i;"offline"===n?i=t("%1$s has gone offline",r):"away"===n?i=t("%1$s has gone away",r):"dnd"===n?i=t("%1$s is busy",r):"online"===n&&(i=t("%1$s is online",r)),i&&this.createMessage({message:i,type:"info"})},onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())},pruneHistoryWhenScrolledDown(){yu.settings.get("prune_messages_above")&&"unscrolled"===yu.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&sd(this)},validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=yu.settings.get("auto_join_rooms").map((e=>pe(e)?e.jid:e)),n=yu.settings.get("auto_join_private_chats").concat(t);if(yu.settings.get("singleton")&&!n.includes(e.jid)&&!yu.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return k.warn(t),t}},getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("jid")},async createMessageFromError(e){e instanceof ma.TimeoutError&&((await this.createMessage({type:"error",message:e.message,retry_event_id:e.retry_event_id})).error=e)},editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const n=this.messages.at(t);if(n.get("editable")){e=n;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),e&&e.save("correcting",!0)},editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const n=this.messages.at(t);if(n.get("editable")){e=n,e.save("correcting",!0);break}}return e},getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}},getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}},getUpdatedMessageAttributes:(e,t)=>(({is_archived:e})=>({is_archived:e}))(t),updateMessage(e,t){const n=this.getUpdatedMessageAttributes(e,t);n&&e.save(n)},setChatState(e,t){return void 0!==this.chat_state_timeout&&(window.clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===ma.COMPOSING?this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),ma.TIMEOUTS.PAUSED,ma.PAUSED):e===ma.PAUSED&&(this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),ma.TIMEOUTS.INACTIVE,ma.INACTIVE)),this.set("chat_state",e,t),this},getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))},shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||!e.chat_state)return!0},isSameUser:(e,t)=>hd.isSameBareJID(e,t),findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((({attributes:t})=>t.retracted_id===e.origin_id&&t.from===e.from&&!t.moderated_by))}},async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;const n=this.messages.findWhere({origin_id:e.retracted_id,from:e.from});return n?(n.save(No(e,t)),!0):(e.dangling_retraction=!0,await this.createMessage(e),!0)}{const n=this.findDanglingRetraction(e);if(n){const r=No(n.attributes,t),i=Object.assign({dangling_retraction:!1},e,r);return delete i.id,n.save(i),!0}}return!1},handleCorrection(e){if(!e.replace_id||!e.from)return;const t=this.messages.findWhere({msgid:e.replace_id,from:e.from});if(!t)return;const n=t.get("older_versions")||{};return e.time<t.get("time")&&t.get("edited")?(n[e.time]=e.message,t.save({older_versions:n})):(Object.keys(n).length?n[t.get("edited")]=t.get("message"):n[t.get("time")]=t.get("message"),delete(e=Object.assign(e,{older_versions:n})).id,e.time=t.get("time"),t.save(e)),t},getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.reduce(((t,n)=>t||function(e,t){return e===t||On(e,t,Mn(t))}(e.attributes,n)),!1)))},getOriginIdQueryAttrs:e=>e.origin_id&&{origin_id:e.origin_id,from:e.from},getStanzaIdQueryAttrs:e=>Object.keys(e).filter((e=>e.startsWith("stanza_id "))).map((t=>{const n={};return n[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],n})),getMessageBodyQueryAttrs(e){if(e.message&&e.msgid){const t={from:e.from,msgid:e.msgid};return e.is_encrypted||(t.message=e.message),t}},retractOwnMessage(e){this.sendRetractionMessage(e),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:e.get("id"),is_ephemeral:!0,editable:!1})},sendRetractionMessage(e){const t=e.get("origin_id");if(!t)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=ld({id:hd.getUniqueId(),to:this.get("jid"),type:"chat"}).c("store",{xmlns:dd.NS.HINTS}).up().c("apply-to",{id:t,xmlns:dd.NS.FASTEN}).c("retract",{xmlns:dd.NS.RETRACT});return ma.connection.send(n)},sendMarkerForLastMessage(e="displayed",t=!1){const n=Array.from(this.messages.models);n.reverse();const r=n.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));r&&this.sendMarkerForMessage(r,e,t)},sendMarkerForMessage(e,t="displayed",n=!1){e&&yu.settings.get("send_chat_markers").includes(t)&&(null!=e&&e.get("is_markable")||n)&&Au(dd.getBareJidFromJid(e.get("from")),e.get("msgid"),t,e.get("type"))},handleChatMarker(e){if(dd.getBareJidFromJid(e.to)!==ma.bare_jid)return!1;if(e.is_markable)return!this.contact||e.is_archived||e.is_carbon||Au(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),n=`marker_${e.marker}`;return t&&!t.get(n)&&t.save({field_name:(new Date).toISOString()}),!0}},sendReceiptStanza(e,t){const n=ld({from:ma.connection.jid,id:hd.getUniqueId(),to:e,type:"chat"}).c("received",{xmlns:dd.NS.RECEIPTS,id:t}).up().c("store",{xmlns:dd.NS.HINTS}).up();yu.send(n)},handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)this.sendReceiptStanza(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1},createMessageStanza(e){const t=ld({from:ma.connection.jid,to:this.get("jid"),type:this.get("message_type"),id:e.get("edited")&&hd.getUniqueId()||e.get("msgid")}).c("body").t(e.get("message")).up().c(ma.ACTIVE,{xmlns:dd.NS.CHATSTATES}).root();return"chat"===e.get("type")&&t.c("request",{xmlns:dd.NS.RECEIPTS}).root(),e.get("is_spoiler")&&(e.get("spoiler_hint")?t.c("spoiler",{xmlns:dd.NS.SPOILER},e.get("spoiler_hint")).root():t.c("spoiler",{xmlns:dd.NS.SPOILER}).root()),(e.get("references")||[]).forEach((e=>{const n={xmlns:dd.NS.REFERENCE,begin:e.begin,end:e.end,type:e.type};e.uri&&(n.uri=e.uri),t.c("reference",n).root()})),e.get("oob_url")&&t.c("x",{xmlns:dd.NS.OUTOFBAND}).c("url").t(e.get("oob_url")).root(),e.get("edited")&&t.c("replace",{xmlns:dd.NS.MESSAGE_CORRECT,id:e.get("msgid")}).root(),e.get("origin_id")&&t.c("origin-id",{xmlns:dd.NS.SID,id:e.get("origin_id")}).root(),t},getOutgoingMessageAttributes(e){const t=!!this.get("composing_spoiler"),n=hd.getUniqueId(),r=null==e?void 0:e.body,i=r?hd.httpToGeoUri(hd.shortnamesToUnicode(r),ma):void 0;return Object.assign({},e,{from:ma.bare_jid,fullname:ma.xmppstatus.get("fullname"),id:n,is_only_emojis:!!r&&hd.isOnlyEmojis(r),jid:this.get("jid"),message:i,msgid:n,nickname:this.get("nickname"),sender:"me",time:(new Date).toISOString(),type:this.get("message_type"),body:i,is_spoiler:t,origin_id:n},Fu(r))},setEditable(e,t){if(!e.is_headline&&!hd.isEmptyMessage(e)&&"me"===e.sender)if("all"===yu.settings.get("allow_message_corrections"))e.editable=!(e.file||e.retracted||"oob_url"in e);else if("last"===yu.settings.get("allow_message_corrections")&&t>this.get("time_sent")){this.set({time_sent:t});const n=this.messages.findWhere({editable:!0});n&&n.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)}},async createMessage(e,t){return e.time=e.time||(new Date).toISOString(),await this.messages.fetched,this.messages.create(e,t)},async sendMessage(e){e=this.getOutgoingMessageAttributes(e);let t=this.messages.findWhere("correcting");if(t){const n=t.get("older_versions")||{};n[t.get("time")]=t.get("message"),t.save({correcting:!1,edited:(new Date).toISOString(),message:e.message,older_versions:n,references:e.references,is_only_emojis:e.is_only_emojis,origin_id:hd.getUniqueId(),received:void 0})}else this.setEditable(e,(new Date).toISOString()),t=await this.createMessage(e);return yu.send(this.createMessageStanza(t)),yu.trigger("sendMessage",{chatbox:this,message:t}),t},sendChatState(){if(yu.settings.get("send_chat_state_notifications")&&this.get("chat_state")){const e=yu.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;yu.send(ld({id:hd.getUniqueId(),to:this.get("jid"),type:"chat"}).c(this.get("chat_state"),{xmlns:dd.NS.CHATSTATES}).up().c("no-store",{xmlns:dd.NS.HINTS}).up().c("no-permanent-store",{xmlns:dd.NS.HINTS}))}},async sendFiles(e){var t;const{__:n}=ma,r=(await yu.disco.features.get(dd.NS.HTTPUPLOAD,ma.domain)).pop();if(!r)return void this.createMessage({message:n("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const i=r.dataforms.where({FORM_TYPE:{value:dd.NS.HTTPUPLOAD,type:"hidden"}}).pop(),s=window.parseInt(null===(t=((null==i?void 0:i.attributes)||{})["max-file-size"])||void 0===t?void 0:t.value),o=null==r?void 0:r.id;o?Array.from(e).forEach((async e=>{if(e=await yu.hook("beforeFileUpload",this,e),!window.isNaN(s)&&window.parseInt(e.size)>s)return this.createMessage({message:n("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,rd()(s)),type:"error",is_ephemeral:!0});{const t=Object.assign(this.getOutgoingMessageAttributes(),{file:!0,progress:0,slot_request_url:o});this.setEditable(t,(new Date).toISOString());const n=await this.createMessage(t,{silent:!0});n.file=e,this.messages.trigger("add",n),n.getRequestSlotURL()}})):this.createMessage({message:n("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})},maybeShow(e){if(!Zo())return hd.safeSave(this,{hidden:!1}),this.trigger("show"),this;{const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),n=ma.chatboxes.filter(t);(e||0===n.length)&&(n.forEach((e=>hd.safeSave(e,{hidden:!0}))),hd.safeSave(this,{hidden:!1}))}},isHidden(){return this.get("hidden")||this.isScrolledUp()||"hidden"===ma.windowState},handleUnreadMessage(e){null!=e&&e.get("body")&&hd.isNewMessage(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))},incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)},clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),hd.safeSave(this,{num_unread:0})},isScrolledUp(){return this.ui.get("scrolled")}}),{Strophe:pd,sizzle:gd,u:md}=Su.env,vd={defaults:()=>({msgid:md.getUniqueId(),time:(new Date).toISOString(),is_ephemeral:!1}),async initialize(){this.checkValidity()&&(this.initialized=Ni(),"chat"===this.get("type")&&(td.prototype.initialize.apply(this,arguments),this.setRosterContact(pd.getBareJidFromJid(this.get("from")))),this.get("file")&&this.on("change:put",this.uploadFile,this),this.setTimerForEphemeralMessage(),await yu.trigger("messageInitialized",this,{Synchronous:!0}),this.initialized.resolve())},setTimerForEphemeralMessage(){const e=()=>{this.ephemeral_timer=window.setTimeout(this.safeDestroy.bind(this),1e4)};return this.isEphemeral()?(e(),!0):(this.on("change:is_ephemeral",(()=>this.isEphemeral()?e():clearTimeout(this.ephemeral_timer))),!1)},checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)},mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(yu.settings.get("allow_message_retraction"))},safeDestroy(){try{this.destroy()}catch(e){k.error(e)}},isEphemeral(){return this.get("is_ephemeral")},isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")},isFollowup(){const e=this.collection.models,t=e.indexOf(this),n=t?e[t-1]:null;if(null===n)return!1;const r=ba()(this.get("time"));return this.get("from")===n.get("from")&&!this.isMeCommand()&&!n.isMeCommand()&&"info"!==this.get("type")&&"info"!==n.get("type")&&r.isBefore(ba()(n.get("time")).add(10,"minutes"))&&!!this.get("is_encrypted")==!!n.get("is_encrypted")},getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")},getMessageText(){const{__:e}=ma;return this.get("is_encrypted")?this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message"):this.get("message")},sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=Su.env.$iq({from:ma.jid,to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:pd.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return yu.sendIQ(e)},getUploadRequestMetadata:e=>({headers:gd(`slot[xmlns="${pd.NS.HTTPUPLOAD}"] put header`,e).map((e=>({name:e.getAttribute("name"),value:e.textContent}))).filter((e=>["Authorization","Expires"].includes(e.name)))}),async getRequestSlotURL(){const{__:e}=ma;let t;try{t=await this.sendSlotRequestStanza()}catch(t){return k.error(t),this.save({type:"error",message:e("Sorry, could not determine upload URL."),is_ephemeral:!0})}const n=gd(`slot[xmlns="${pd.NS.HTTPUPLOAD}"]`,t).pop();if(!n)return this.save({type:"error",message:e("Sorry, could not determine file upload URL."),is_ephemeral:!0});this.upload_metadata=this.getUploadRequestMetadata(t),this.save({get:n.querySelector("get").getAttribute("url"),put:n.querySelector("put").getAttribute("url")})},uploadFile(){var e;const t=new XMLHttpRequest;t.onreadystatechange=async()=>{if(t.readyState===XMLHttpRequest.DONE)if(k.info("Status: "+t.status),200===t.status||201===t.status){let e={upload:ma.SUCCESS,oob_url:this.get("get"),message:this.get("get"),body:this.get("get")};e=await yu.hook("afterFileUploaded",this,e),this.save(e)}else t.onerror()},t.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),t.onerror=()=>{const{__:e}=ma;let n;n=t.responseText?e('Sorry, could not succesfully upload your file. Your server’s response: "%1$s"',t.responseText):e("Sorry, could not succesfully upload your file."),this.save({type:"error",upload:ma.FAILURE,message:n,is_ephemeral:!0})},t.open("PUT",this.get("put"),!0),t.setRequestHeader("Content-type",this.file.type),null===(e=this.upload_metadata.headers)||void 0===e||e.forEach((e=>t.setRequestHeader(e.name,e.value))),t.send(this.file)}},_d={chats:{async create(e,t){if("string"==typeof e){if(t&&(null==t||!t.fullname)){var n;const r=await yu.contacts.get(e);t.fullname=null==r||null===(n=r.attributes)||void 0===n?void 0:n.fullname}return yu.chats.get(e,t,!0)||void k.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.forEach((async n=>{var r;const i=await yu.contacts.get(e);return t.fullname=null==i||null===(r=i.attributes)||void 0===r?void 0:r.fullname,yu.chats.get(n,t,!0).maybeShow()}))):(k.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,n){if("string"==typeof e){const r=await yu.chats.get(e,t,!0);return r?r.maybeShow(n):r}if(Array.isArray(e))return Promise.all(e.map((e=>yu.chats.get(e,t,!0).then((e=>e&&e.maybeShow(n))))).filter((e=>e)));const r="chats.open: You need to provide at least one JID";throw k.error(r),new Error(r)},async get(e,t={},n=!1){async function r(e){let r=await yu.chatboxes.get(e);return!r&&n?r=await yu.chatboxes.create(e,t,ma.ChatBox):(r=r&&r.get("type")===ma.PRIVATE_CHAT_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}return await yu.waitUntil("chatBoxesFetched"),void 0===e?(await yu.chatboxes.get()).filter((e=>e.get("type")===ma.PRIVATE_CHAT_TYPE)):"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}},{Strophe:yd,sizzle:bd,u:wd}=Su.env;function Sd(e){if(!wd.isValidJID(e))return k.warn(`Invalid JID "${e}" provided in URL fragment`);yu.chats.open(e)}async function Ed(){if(ma.shouldClearCache()){await Promise.all(ma.chatboxes.map((e=>e.messages&&e.messages.clearStore({silent:!0}))));const e=e=>e.get("type")!==ma.CONTROLBOX_TYPE;ma.chatboxes.clearStore({silent:!0},e)}}function xd(){yu.settings.get("auto_join_private_chats").forEach((e=>{ma.chatboxes.where({jid:e}).length||("string"==typeof e?yu.chats.open(e):k.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),yu.trigger("privateChatsAutoJoined")}function Ad(){ma.connection.addHandler((e=>bd(`message > result[xmlns="${yd.NS.MAM}"]`,e).pop()?(k.warn('Received a MAM message with type "chat".'),!0):(ma.handleMessageStanza(e),!0)),null,"message","chat"),ma.connection.addHandler((e=>(null!==e.getAttribute("type")||ma.handleMessageStanza(e),!0)),yd.NS.RECEIPTS,"message"),ma.connection.addHandler((e=>(async function(e){const t=yd.getBareJidFromJid(e.getAttribute("from"));if(wd.isSameBareJID(t,ma.bare_jid))return;const n=await yu.chatboxes.get(t);n.get("type")===ma.PRIVATE_CHAT_TYPE&&(null==n||n.handleErrorMessageStanza(e))}(e),!0)),null,"message","error")}async function Nd(e){if(Qu(e)){const t=e.getAttribute("from");return k.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}const t=await ud(e,ma);if(wd.isErrorObject(t))return t.stanza&&k.error(t.stanza),k.error(t.message);const n=!!bd(`body, encrypted[xmlns="${yd.NS.OMEMO}"]`,e).length,r=await yu.chats.get(t.contact_jid,{nickname:t.nick},n);await(null==r?void 0:r.queueMessage(t));const i={stanza:e,attrs:t,chatbox:r};yu.trigger("message",i)}Su.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){yu.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0}),ma.Message=td.extend(vd),ma.Messages=Ka.extend({model:ma.Message,comparator:"time"}),Object.assign(ma,{ChatBox:fd,handleMessageStanza:Nd}),Object.assign(yu,_d),ma.router.route("converse/chat?jid=:jid",Sd),yu.listen.on("chatBoxesFetched",xd),yu.listen.on("presencesInitialized",Ad),yu.listen.on("clearSession",Ed)}});const{Strophe:jd}=Su.env,Td=Vo.extend({idAttribute:"jid",initialize(e,t){this.waitUntilFeaturesDiscovered=Ni(),this.dataforms=new Ka;let n=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=ma.createStore(n,"session"),this.features=new Ka,n=`converse.features-${this.get("jid")}`,this.features.browserStorage=ma.createStore(n,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new Ka,n=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=ma.createStore(n,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.identities=new Ka,n=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=ma.createStore(n,"session"),this.fetchFeatures(t),this.items=new ma.DiscoEntities,n=`converse.disco-items-${this.get("jid")}`,this.items.browserStorage=ma.createStore(n,"session"),this.items.fetch()},async getIdentity(e,t){return await this.waitUntilFeaturesDiscovered,this.identities.findWhere({category:e,type:t})},async hasFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this},onFeatureAdded(e){e.entity=this,yu.trigger("serviceDiscovered",e)},onFieldAdded(e){e.entity=this,yu.trigger("discoExtensionFieldDiscovered",e)},async fetchFeatures(e){if(e.ignore_cache)this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);t&&0===t.length||null===t?this.queryInfo():(this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),this.identities.fetch({add:!0}))}},async queryInfo(){let e;try{e=await yu.disco.info(this.get("jid"),null)}catch(e){return null===e?k.error(`Timeout for disco#info query for ${this.get("jid")}`):k.error(e),void this.waitUntilFeaturesDiscovered.resolve(this)}this.onInfo(e)},onDiscoItems(e){Oo()(`query[xmlns="${jd.NS.DISCO_ITEMS}"] item`,e).forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid");if(void 0===this.items.get(t)){const e=ma.disco_entities.get(t);e?this.items.add(e):this.items.create({jid:t})}}))},async queryForItems(){if(0===this.identities.where({category:"server"}).length)return;const e=await yu.disco.items(this.get("jid"));this.onDiscoItems(e)},onInfo(e){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),Oo()(`x[type="result"][xmlns="${jd.NS.XFORM}"]`,e).forEach((e=>{const t={};Oo()("field",e).forEach((e=>{var n;t[e.getAttribute("var")]={value:null===(n=e.querySelector("value"))||void 0===n?void 0:n.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${jd.NS.DISCO_ITEMS}"]`)&&this.queryForItems(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),Oo()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{var n;this.fields.create({var:t.getAttribute("var"),value:null===(n=t.querySelector("value"))||void 0===n?void 0:n.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),Cd=Ka.extend({model:Td,fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,n){k.error(n),t(new Error("Could not fetch disco entities"))}})}))}}),{Strophe:Id,$iq:Od}=Su.env;async function kd(){yu.disco.own.identities.add("client","web","Converse"),yu.disco.own.features.add(Id.NS.CHATSTATES),yu.disco.own.features.add(Id.NS.DISCO_INFO),yu.disco.own.features.add(Id.NS.ROSTERX),yu.settings.get("message_carbons")&&yu.disco.own.features.add(Id.NS.CARBONS),yu.trigger("addClientFeatures"),ma.connection.addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:Id.NS.DISCO_INFO};t&&(n.node=t);const r=Od({type:"result",id:e.getAttribute("id")}),i=e.getAttribute("from");return null!==i&&r.attrs({to:i}),r.c("query",n),ma.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),r.c("identity",t).up()})),ma.disco._features.forEach((e=>r.c("feature",{var:e}).up())),yu.send(r.tree()),!0}(e)),Id.NS.DISCO_INFO,"iq","get",null,null),ma.disco_entities=new ma.DiscoEntities;const e=`converse.disco-entities-${ma.bare_jid}`;ma.disco_entities.browserStorage=ma.createStore(e,"session");const t=await ma.disco_entities.fetchEntities();0!==t.length&&t.get(ma.domain)||ma.disco_entities.create({jid:ma.domain}),yu.trigger("discoInitialized")}function Md(){if(!ma.stream_features){const e=`converse.stream-features-${Id.getBareJidFromJid(ma.jid)}`;yu.promises.add("streamFeaturesAdded"),ma.stream_features=new Ka,ma.stream_features.browserStorage=ma.createStore(e,"session")}}function Rd(){yu.trigger("streamFeaturesAdded")}function Dd(){Md(),Array.from(ma.connection.features.childNodes).forEach((e=>{ma.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),Rd()}function Fd(){var e,t,n,r,i;null===(e=ma.disco_entities)||void 0===e||e.forEach((e=>e.features.clearStore())),null===(t=ma.disco_entities)||void 0===t||t.forEach((e=>e.identities.clearStore())),null===(n=ma.disco_entities)||void 0===n||n.forEach((e=>e.dataforms.clearStore())),null===(r=ma.disco_entities)||void 0===r||r.forEach((e=>e.fields.clearStore())),null===(i=ma.disco_entities)||void 0===i||i.clearStore(),delete ma.disco_entities}const{Strophe:Ld,$iq:Pd}=Su.env,Ud={disco:{stream:{async getFeature(e,t){if(await yu.waitUntil("streamFeaturesAdded"),!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==ma.stream_features||yu.connection.connected())return ma.stream_features.findWhere({name:e,xmlns:t});{const n=`Tried to get feature ${e} ${t} but _converse.stream_features has been torn down`;k.warn(n)}}},own:{identities:{add(e,t,n,r){for(var i=0;i<ma.disco._identities.length;i++)if(ma.disco._identities[i].category==e&&ma.disco._identities[i].type==t&&ma.disco._identities[i].name==n&&ma.disco._identities[i].lang==r)return!1;ma.disco._identities.push({category:e,type:t,name:n,lang:r})},clear(){ma.disco._identities=[]},get:()=>ma.disco._identities},features:{add(e){for(var t=0;t<ma.disco._features.length;t++)if(ma.disco._features[t]==e)return!1;ma.disco._features.push(e)},clear(){ma.disco._features=[]},get:()=>ma.disco._features}},info(e,t){const n={xmlns:Ld.NS.DISCO_INFO};t&&(n.node=t);const r=Pd({from:ma.connection.jid,to:e,type:"get"}).c("query",n);return yu.sendIQ(r)},items(e,t){const n={xmlns:Ld.NS.DISCO_ITEMS};return t&&(n.node=t),yu.sendIQ(Pd({from:ma.connection.jid,to:e,type:"get"}).c("query",n))},entities:{async get(e,t=!1){if(await yu.waitUntil("discoInitialized"),!e)return ma.disco_entities;if(void 0===ma.disco_entities){const t=`Tried to look up entity ${e} but _converse.disco_entities has been torn down`;return void k.warn(t)}const n=ma.disco_entities.get(e);return n||!t?n:yu.disco.entities.create(e)},create:(e,t)=>ma.disco_entities.create({jid:e},t)},features:{async get(e,t){if(!t)throw new TypeError("You need to provide an entity JID");await yu.waitUntil("discoInitialized");let n=await yu.disco.entities.get(t,!0);if(void 0===ma.disco_entities&&!yu.connection.connected()){const n=`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`;return void k.warn(n)}n=await n.waitUntilFeaturesDiscovered;const r=[...n.items.map((t=>t.hasFeature(e))),n.hasFeature(e)];return(await Promise.all(r)).filter(pe)}},supports:async(e,t)=>(await yu.disco.features.get(e,t)||[]).length>0,async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await yu.waitUntil("discoInitialized");let t=await yu.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=Ni()),t.queryInfo()):t=await yu.disco.entities.create(e,{ignore_cache:!0}),t.waitUntilFeaturesDiscovered},refreshFeatures:e=>yu.refresh(e),async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await yu.waitUntil("discoInitialized");let t=await yu.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await yu.waitUntil("discoInitialized");let t=await yu.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,n){const r=await yu.disco.entities.get(n,!0);if(void 0!==r||yu.connection.connected())return r.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${n} but _converse.disco_entities has been torn down`;k.warn(t)}}}},{Strophe:$d}=Su.env;Su.plugins.add("converse-disco",{initialize(){Object.assign(yu,Ud),yu.promises.add("discoInitialized"),yu.promises.add("streamFeaturesAdded"),ma.DiscoEntity=Td,ma.DiscoEntities=Cd,ma.disco={_identities:[],_features:[]},yu.listen.on("userSessionInitialized",(async()=>{Md(),ma.connfeedback.get("connection_status")===$d.Status.ATTACHED&&(await new Promise(((e,t)=>ma.stream_features.fetch({success:e,error:t}))),Rd())})),yu.listen.on("beforeResourceBinding",Dd),yu.listen.on("reconnected",kd),yu.listen.on("connected",kd),yu.listen.on("beforeTearDown",(async()=>{yu.promises.add("streamFeaturesAdded"),ma.stream_features&&(await ma.stream_features.clearStore(),delete ma.stream_features)})),yu.listen.on("will-reconnect",Fd),yu.listen.on("clearSession",Fd)}});const zd=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Þ|\\:\\-Þ|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Þ|\\:Þ|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),Bd=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,Hd=Su.env.utils;Su.emojis={initialized:!1,initialized_promise:Ni()};const qd={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Þ":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Þ":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function Gd(e){if(e.indexOf("-")>-1){const t=[],n=e.split("-");for(let e=0;e<n.length;e++){let r=parseInt(n[e],16);if(r>=65536&&r<=1114111){const e=Math.floor((r-65536)/1024)+55296,t=(r-65536)%1024+56320;r=String.fromCharCode(e)+String.fromCharCode(t)}else r=String.fromCharCode(r);t.push(r)}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function Wd(e){if(!Su.emojis.initialized)throw new Error("getShortnameReferences called before emojis are initialized. To avoid this problem, first await the converse.emojis.initilaized_promise.");return[...e.matchAll(Su.emojis.shortnames_regex)].filter((e=>e[0].length>0)).map((e=>{const t=Su.emojis.by_sn[e[0]].cp;return{cp:t,begin:e.index,end:e.index+e[0].length,shortname:e[0],emoji:t?Gd(t):null}}))}function Jd(e){const t=[];return function(e,n){const r=/\uFE0F/g,i=String.fromCharCode(8205);String(e).replace(Bd,((e,n,s)=>{const o=function(e){const t=[];let n=0,r=0;for(;r<e.length;){const i=e.charCodeAt(r++);n?(t.push((65536+(n-55296<<10)+(i-56320)).toString(16)),n=0):55296<=i&&i<=56319?n=i:t.push(i.toString(16))}return t.join("-")}(e.indexOf(i)<0?e.replace(r,""):e);o&&((e,n,r)=>{var i;t.push({begin:r,cp:e,emoji:n,end:r+n.length,shortname:(null===(i=Hd.getEmojisByAtrribute("cp")[e])||void 0===i?void 0:i.sn)||""})})(o,e,s)}))}(e),t}Su.plugins.add("converse-emoji",{initialize(){const{___:e}=ma;yu.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}}),ma.EmojiPicker=Vo.extend({defaults:{current_category:"smileys",current_skintone:"",scroll_position:0}});const t={};Object.assign(Hd,{shortnamesToEmojis:(e,t={unicode_only:!1,add_title_wrapper:!1})=>function(e,t){let n=[e];return[...Wd(e),...Jd(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const r=n.shift(),i=function(e,t={unicode_only:!1,add_title_wrapper:!1}){const n=e.emoji,r=e.shortname;if(n){if(t.unicode_only)return n;if(yu.settings.get("use_system_emojis"))return t.add_title_wrapper&&r?Jc`<span title="${r}">${n}</span>`:n;{const t=yu.settings.get("emoji_image_path");return Jc`<img class="emoji"
                draggable="false"
                title="${r}"
                alt="${n}"
                src="${t}/72x72/${e.cp}.png"/>`}}return t.unicode_only?r:Jc`<img class="emoji"
            draggable="false"
            title="${r}"
            alt="${r}"
            src="${Su.emojis.by_sn[r].url}">`}(e,t);n="string"==typeof i?[r.slice(0,e.begin)+i+r.slice(e.end),...n]:[r.slice(0,e.begin),i,r.slice(e.end),...n]})),n}(e=function(e){return e.replace(zd,((e,t,n,r)=>void 0!==r&&""!==r&&Hd.unescapeHTML(r)in qd?(r=Hd.unescapeHTML(r),n+Gd(qd[r].toUpperCase())):e))}(e),t),shortnamesToUnicode:e=>Hd.shortnamesToEmojis(e,{unicode_only:!0})[0],isOnlyEmojis(e){const t=e.trim().split(/\s+/);return!(0===t.length||t.length>3)&&t.filter((e=>{const t=Jd(Hd.shortnamesToUnicode(e));return 1===t.length&&(e===t[0].shortname||e===t[0].emoji)})).length===t.length},getEmojisByAtrribute(e){if(t[e])return t[e];if("category"===e)return Su.emojis.json;const n=Su.emojis.list.map((t=>t[e])).filter(((e,t,n)=>n.indexOf(e)==t));return t[e]={},n.forEach((n=>t[e][n]=Su.emojis.list.find((t=>t[e]===n)))),t[e]}}),Object.assign(yu,{emojis:{async initialize(){if(!Su.emojis.initialized){Su.emojis.initialized=!0;const{default:t}=await o.e(4610).then(o.t.bind(o,7530,19));Su.emojis.json=t,Su.emojis.by_sn=Object.keys(t).reduce(((e,n)=>Object.assign(e,t[n])),{}),Su.emojis.list=Object.values(Su.emojis.by_sn),Su.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),Su.emojis.shortnames=Su.emojis.list.map((e=>e.sn));const n=()=>Su.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");Su.emojis.shortnames_regex=new RegExp(n(),"gi"),Su.emojis.toned=(Su.emojis.toned||(Su.emojis.toned=(e=Object.values(Su.emojis.json.people).filter((e=>e.sn.includes("_tone"))).map((e=>e.sn.replace(/_tone[1-5]/,""))),[...new Set(e)])),Su.emojis.toned),Su.emojis.initialized_promise.resolve()}var e;return Su.emojis.initialized_promise}}})}});const Qd={initialize(){this.checkValidity()&&(this.get("file")&&this.on("change:put",this.uploadFile,this),this.setTimerForEphemeralMessage()||this.setOccupant(),yu.trigger("chatRoomMessageInitialized",this))},getDisplayName(){var e;return(null===(e=this.occupant)||void 0===e?void 0:e.getDisplayName())||this.get("nick")},mayBeModerated(){if(void 0!==this.get("from_muc"))return["all","moderator"].includes(yu.settings.get("allow_message_retraction"))&&this.get(`stanza_id ${this.get("from_muc")}`)&&this.collection.chatbox.canModerateMessages()},checkValidity(){const e=ma.Message.prototype.checkValidity.call(this);return!e&&this.collection.chatbox.debouncedRejoin(),e},onOccupantRemoved(){var e;this.stopListening(this.occupant),delete this.occupant;const t=null==this||null===(e=this.collection)||void 0===e?void 0:e.chatbox;if(!t)return k.error(`Could not get collection.chatbox for message: ${JSON.stringify(this.toJSON())}`);this.listenTo(t.occupants,"add",this.onOccupantAdded)},onOccupantAdded(e){var t;if(this.get("occupant_id")){if(e.get("occupant_id")!==this.get("occupant_id"))return}else if(e.get("nick")!==ae.getResourceFromJid(this.get("from")))return;this.occupant=e,this.trigger("occupantAdded"),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved);const n=null==this||null===(t=this.collection)||void 0===t?void 0:t.chatbox;if(!n)return k.error(`Could not get collection.chatbox for message: ${JSON.stringify(this.toJSON())}`);this.stopListening(n.occupants,"add",this.onOccupantAdded)},setOccupant(){var e;if("groupchat"!==this.get("type"))return;const t=null==this||null===(e=this.collection)||void 0===e?void 0:e.chatbox;if(!t)return k.error(`Could not get collection.chatbox for message: ${JSON.stringify(this.toJSON())}`);const n=ae.getResourceFromJid(this.get("from"));if(this.occupant=t.occupants.findOccupant({nick:n,occupant_id:this.get("occupant_id")}),!this.occupant&&yu.settings.get("muc_send_probes")){this.occupant=t.occupants.create({nick:n,type:"unavailable"});const e=`${t.get("jid")}/${n}`;yu.user.presence.send("probe",e)}this.occupant?this.listenTo(this.occupant,"destroy",this.onOccupantRemoved):this.listenTo(t.occupants,"add",this.onOccupantAdded)}},Vd={},Yd=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);Vd.escapeCharacters=e=>t=>e.split("").reduce(Yd,t),Vd.escapeRegexString=Vd.escapeCharacters("[\\^$.?*+(){}|"),Vd.findFirstMatchInArray=e=>t=>{for(let n=0;n<e.length;n++)if(0===t.localeCompare(e[n],void 0,{sensitivity:"base"}))return e[n];return null};const Xd=([e,t],n,r)=>{let i=e,{begin:s,end:o}=n;const{value:a}=n;return s-=r,o=o-r-1,i=`${i.slice(0,s)}${a}${i.slice(o+1)}`,[i,[...t,{...n,begin:s,end:o}]]};Vd.reduceTextFromReferences=(e,t)=>t.reduce(Xd,[e,[]]);const Kd=Vd;ca.webForm2xForm=function(e){const t=e.getAttribute("name");if(!t)return null;let n;return n="checkbox"===e.getAttribute("type")?e.checked?1:0:"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?ca.getSelectValues(e):e.value,ca.toStanza(`\n        <field var="${t}">\n            ${n.constructor===Array?n.map((e=>`<value>${e}</value>`)):`<value>${n}</value>`}\n        </field>`)};const Zd=ca,el=function(e,t){return function(e,t,n){for(var r=-1,i=e.length,s=t.length,o={};++r<i;){var a=r<s?t[r]:void 0;n(o,e[r],a)}return o}(e||[],t||[],Me)},{Strophe:tl,sizzle:nl,u:rl}=Su.env,{NS:il}=tl;function sl(e){const t=nl(`items[node="${tl.NS.CONFINFO}"]`,e).pop();if(!t)return null;const n=e.getAttribute("from"),r=e.getAttribute("id"),i=`item conference-info[xmlns="${tl.NS.CONFINFO}"] activity[xmlns="${tl.NS.ACTIVITY}"]`;return nl(i,t).map((t=>{var i;const s=null===(i=t.querySelector("text"))||void 0===i?void 0:i.textContent;if(s){var o;const i=$u(e),a=null===(o=t.querySelector("reason"))||void 0===o?void 0:o.textContent;return{from:n,msgid:r,message:s,reason:a,references:i,type:"mep"}}return{}}))}function ol(e,t){var n;if(t.features.get(tl.NS.OCCUPANTID))return null===(n=nl(`occupant-id[xmlns="${tl.NS.OCCUPANTID}"]`,e).pop())||void 0===n?void 0:n.getAttribute("id")}async function al(e,t,n){var r,i,s,o,a;Gu(e);const c=`[xmlns="${il.MAM}"] > forwarded[xmlns="${il.FORWARD}"] > message`,u=e;if(e=nl(c,e).pop()||e,nl(`message > forwarded[xmlns="${tl.NS.FORWARD}"]`,e).length)return new Ou(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e);const d=nl(`delay[xmlns="${tl.NS.DELAY}"]`,u).pop(),l=e.getAttribute("from"),h=tl.getBareJidFromJid(l),f=tl.unescapeNode(tl.getResourceFromJid(l)),p=Wu(e),g=(new Date).toISOString();let m=Object.assign({from:l,from_muc:h,nick:f,is_forwarded:!!e.querySelector("forwarded"),activities:sl(e),body:null===(r=e.querySelector("body"))||void 0===r||null===(i=r.textContent)||void 0===i?void 0:i.trim(),chat_state:Hu(e),is_archived:Vu(u),is_carbon:Bu(u),is_delayed:!!d,is_headline:Ju(e),is_markable:!!nl(`markable[xmlns="${tl.NS.MARKERS}"]`,e).length,is_marker:!!p,is_unstyled:!!nl(`unstyled[xmlns="${tl.NS.STYLING}"]`,e).length,marker_id:p&&p.getAttribute("id"),msgid:e.getAttribute("id")||u.getAttribute("id"),occupant_id:ol(e,t),receipt_id:zu(e),received:(new Date).toISOString(),references:$u(e),subject:null===(s=e.querySelector("subject"))||void 0===s?void 0:s.textContent,thread:null===(o=e.querySelector("thread"))||void 0===o?void 0:o.textContent,time:d?ba()(d.getAttribute("stamp")).toISOString():g,to:e.getAttribute("to"),type:e.getAttribute("type")},Uu(e),Pu(e),Lu(e),Du(e,u),ku(e,u),function(e){const t=Oo()(`> apply-to[xmlns="${ae.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=Oo()(`> meta[xmlns="${ae.NS.XHTML}"]`,t);if(n.length){const t=yu.settings.get("message_limit"),r=n.reduce(((e,n)=>{const r=n.getAttribute("property");if(r){let i=aa(n.getAttribute("content")||"");t&&"og:description"===r&&i.length>=t&&(i=`${i.slice(0,t)}${aa("&#8230;")}`),e[r]=i}return e}),{ogp_for_id:e});if("og:description"in r||"og:title"in r||"og:image"in r)return r}}return{}}(e),Ru(e,u),function(e){const t=nl(`apply-to[xmlns="${tl.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),r=nl(`moderated[xmlns="${tl.NS.MODERATE}"]`,t).pop();var n;if(r&&nl(`retract[xmlns="${tl.NS.RETRACT}"]`,r).pop())return{editable:!1,moderated:"retracted",moderated_by:r.getAttribute("by"),moderated_id:e,moderation_reason:null===(n=r.querySelector("reason"))||void 0===n?void 0:n.textContent}}else{const t=nl(`> moderated[xmlns="${tl.NS.MODERATE}"]`,e).pop();var r;if(t&&nl(`retracted[xmlns="${tl.NS.RETRACT}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:null===(r=t.querySelector("reason"))||void 0===r?void 0:r.textContent}}return{}}(e),Mu(e));await yu.emojis.initialize();const v=m.is_archived&&function(e){const t=nl(`x[xmlns="${tl.NS.MUC_USER}"] item`,e).pop();return null==t?void 0:t.getAttribute("jid")}(e)||(null===(a=t.occupants.findOccupant(m))||void 0===a?void 0:a.get("jid"));return m=Object.assign({from_real_jid:v,is_only_emojis:!!m.body&&rl.isOnlyEmojis(m.body),is_valid_receipt_request:qu(e,m),message:m.body||m.error,sender:m.nick===t.get("nick")?"me":"them"},m),m.is_archived&&u.getAttribute("from")!==m.from_muc?new Ou(`Invalid Stanza: Forged MAM message from ${u.getAttribute("from")}`,e):m.is_archived&&u.getAttribute("from")!==t.get("jid")?new Ou(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e):m.is_carbon?new Ou("Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied",e):(m.id=m.origin_id||m[`stanza_id ${m.from_muc||m.from}`]||rl.getUniqueId(),m=await yu.hook("parseMUCMessage",e,m),Object.assign(m,Fu(m.is_encrypted?m.plaintext:m.body)))}const{Strophe:cl,$iq:ul,u:dl}=Su.env;async function ll(e,t){const{__:n}=ma,r=ul({to:t,type:"get"}).c("query",{xmlns:cl.NS.MUC_ADMIN}).c("item",{affiliation:e}),i=await yu.sendIQ(r,null,!1);if(null===i){const r=n("Error: timeout while fetching %1s list for MUC %2s",e,t),s=new Error(r);return k.warn(r),k.warn(i),s}if(dl.isErrorStanza(i)){const r=n("Error: not allowed to fetch %1s list for MUC %2s",e,t),s=new Error(r);return k.warn(r),k.warn(i),s}return function(e){return nl(`query[xmlns="${tl.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},n=e.getAttribute("jid");rl.isValidJID(n)?t.jid=n:t.nick=n;const r=e.getAttribute("nick");return r&&(t.nick=r),e.getAttribute("role")&&(t.role=r),t}))}(i).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))}function hl(e,t){const n=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(n.map((n=>{return r=n,i=e,s=t,Array.isArray(i)||(i=[i]),s=s.filter((e=>[void 0,r].includes(e.affiliation))),Promise.all(i.reduce(((e,t)=>[...e,...s.map((e=>function(e,t,n){const r=ul({to:t,type:"set"}).c("query",{xmlns:cl.NS.MUC_ADMIN}).c("item",{affiliation:n.affiliation||e,nick:n.nick,jid:n.jid});return void 0!==n.reason&&r.c("reason",n.reason),yu.sendIQ(r)}(r,t,e)))]),[]));var r,i,s})))}function fl(e,t,n,r){const i=n.map((e=>e.jid)),s=r.map((e=>e.jid));let o=Da(i,s).map((e=>n[qa(i,e)]));return e||(o=o.concat(n.filter((e=>{const t=qa(s,e.jid);return t>=0&&e.affiliation!==r[t].affiliation})))),t&&(o=o.concat(Da(s,i).map((e=>({jid:e,affiliation:"none"}))))),o}ma.getAssignableAffiliations=function(e){let t=yu.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?Hl:[]),"owner"===e.get("affiliation")?Hl.filter((e=>!t.includes(e))):"admin"===e.get("affiliation")?Hl.filter((e=>!["owner","admin",...t].includes(e))):[]};const pl=["owner"],gl=["admin","ban","deop","destroy","member","op","revoke"],ml=["kick","mute","voice","modtools"],vl=["nick"],_l=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],yl=["301","303","333","307","321","322"],bl=Vo.extend({defaults:()=>({connection_status:Su.ROOMSTATUS.DISCONNECTED})}),wl={defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:Zo()&&!yu.settings.get("singleton"),hidden_occupants:!!yu.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:ma.CHATROOMS_TYPE}},async initialize(){this.initialized=Ni(),this.debouncedRejoin=uc(this.rejoin,250),this.set("box_id",`box-${this.get("jid")}`),this.initNotifications(),this.initMessages(),this.initUI(),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:show",this.onOccupantShowChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage),await this.restoreFromCache()||this.join(),await yu.trigger("chatRoomInitialized",this,{Synchronous:!0}),this.initialized.resolve()},async restoreFromCache(){return this.session.get("connection_status")===Su.ROOMSTATUS.ENTERED&&await this.isJoined()?(await new Promise((e=>this.features.fetch({success:e,error:e}))),await this.fetchOccupants().catch((e=>k.error(e))),await this.fetchMessages().catch((e=>k.error(e))),!0):(this.session.save("connection_status",Su.ROOMSTATUS.DISCONNECTED),this.clearOccupantsCache(),!1)},async join(e,t){return this.session.get("connection_status")===Su.ROOMSTATUS.ENTERED?this:(this.session.save("connection_status",Su.ROOMSTATUS.CONNECTING),await this.refreshDiscoInfo(),(e=await this.getAndPersistNickname(e))?(yu.send(await this.constructPresence(t)),this):(Zd.safeSave(this.session,{connection_status:Su.ROOMSTATUS.NICKNAME_REQUIRED}),yu.settings.get("muc_show_logs_before_join")&&await this.fetchMessages(),this))},rejoin(){return this.session.save("connection_status",Su.ROOMSTATUS.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()},async constructPresence(e){let t=oe({from:ma.connection.jid,to:this.getRoomJIDAndNick()}).c("x",{xmlns:ae.NS.MUC}).c("history",{maxstanzas:this.features.get("mam_enabled")?0:yu.settings.get("muc_history_max_stanzas")}).up();return(e=e||this.get("password"))&&t.cnode(ae.xmlElement("password",[],e)),t=await yu.hook("constructedMUCPresence",null,t),t},clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()},sendMarkerForMessage(e,t="displayed",n=!1){if(e&&yu.settings.get("send_chat_markers").includes(t)&&"groupchat"===(null==e?void 0:e.get("type"))&&(null!=e&&e.get("is_markable")||n)){const n=`stanza_id ${this.get("jid")}`,r=e.get(n);if(!r)return void k.error(`Can't send marker for message without stanza ID: ${n}`);Au(ae.getBareJidFromJid(e.get("from")),r,t,e.get("type"))}},enableRAI(){if(yu.settings.get("muc_subscribe_to_rai")){const e=ae.getDomainFromJid(this.get("jid"));yu.user.presence.send(null,e,null,re("rai",{xmlns:ae.NS.RAI}))}},async onHiddenChange(){const e=Su.ROOMSTATUS,t=this.session.get("connection_status");this.get("hidden")?t===e.ENTERED&&yu.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()&&(t!==e.DISCONNECTED&&t!==e.CLOSING&&(this.sendMarkerForLastMessage("received",!0),await this.leave()),this.enableRAI()):(t===e.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())},onOccupantAdded(e){ma.isInfoVisible(Su.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===Su.ROOMSTATUS.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),Su.MUC_TRAFFIC_STATES.ENTERED)},onOccupantRemoved(e){ma.isInfoVisible(Su.MUC_TRAFFIC_STATES.EXITED)&&this.session.get("connection_status")===Su.ROOMSTATUS.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),Su.MUC_TRAFFIC_STATES.EXITED)},onOccupantShowChanged(e){e.get("states").includes("303")||("offline"===e.get("show")&&ma.isInfoVisible(Su.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),Su.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("show")&&ma.isInfoVisible(Su.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),Su.MUC_TRAFFIC_STATES.ENTERED))},async onRoomEntered(){await this.occupants.fetchMembers(),yu.settings.get("clear_messages_on_reconnection")?(await this.messages.clearStore(),this.messages.fetched.resolve()):await this.fetchMessages(),yu.trigger("enteredNewRoom",this),yu.settings.get("auto_register_muc_nickname")&&await yu.disco.supports(ae.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname()},async onConnectionStatusChanged(){if(this.session.get("connection_status")===Su.ROOMSTATUS.ENTERED)if(this.get("hidden")&&yu.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()){try{await this.leave()}catch(e){k.error(e)}this.enableRAI()}else await this.onRoomEntered()},async onReconnection(){await this.rejoin(),this.announceReconnection()},getMessagesCollection:()=>new ma.ChatRoomMessages,restoreSession(){const e=`muc.session-${ma.bare_jid}-${this.get("jid")}`;return this.session=new bl({id:e}),vo(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))},initDiscoModels(){let e=`converse.muc-features-${ma.bare_jid}-${this.get("jid")}`;this.features=new Vo(Object.assign({id:e},el(Su.ROOM_FEATURES,Su.ROOM_FEATURES.map((()=>!1))))),this.features.browserStorage=ma.createStore(e,"session"),this.features.listenTo(ma,"beforeLogout",(()=>this.features.browserStorage.flush())),e=`converse.muc-config-{_converse.bare_jid}-${this.get("jid")}`,this.config=new Vo,this.config.browserStorage=ma.createStore(e,"session"),this.config.listenTo(ma,"beforeLogout",(()=>this.config.browserStorage.flush()))},initOccupants(){this.occupants=new ma.ChatRoomOccupants;const e=`converse.occupants-${ma.bare_jid}${this.get("jid")}`;this.occupants.browserStorage=ma.createStore(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(ma,"beforeLogout",(()=>this.occupants.browserStorage.flush()))},fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched},handleAffiliationChangedMessage(e){const t=Oo()(`x[xmlns="${ae.NS.MUC_USER}"] item`,e).pop();if(t){const n=e.getAttribute("from"),r=e.getAttribute("type"),i=t.getAttribute("affiliation"),s=t.getAttribute("jid"),o={from:n,type:r,affiliation:i,states:[],show:"unavailable"==r?"offline":"online",role:t.getAttribute("role"),jid:ae.getBareJidFromJid(s),resource:ae.getResourceFromJid(s)},a=this.occupants.findOccupant({jid:o.jid});a?a.save(o):this.occupants.create(o)}},async handleErrorMessageStanza(e){const{__:t}=ma,n=await al(e,this);if(!await this.shouldShowErrorMessage(n))return;const r=this.getMessageReferencedByError(n);if(r){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===r.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===n.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===n.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),r.save(e)}else this.createMessage(n)},handleMessageFromMUCHost(e){if(this.session.get("connection_status")===Su.ROOMSTATUS.ENTERED)return;const t=Oo()(`rai[xmlns="${ae.NS.RAI}"]`,e).pop();Array.from((null==t?void 0:t.querySelectorAll("activity"))||[]).map((e=>e.textContent)).includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})},handleForwardedMentions(e){if(this.session.get("connection_status")===Su.ROOMSTATUS.ENTERED)return;const t=Oo()(`mentions[xmlns="${ae.NS.MENTIONS}"] forwarded[xmlns="${ae.NS.FORWARD}"] message[type="groupchat"]`,e),n=this.get("jid"),r=t.filter((e=>ae.getBareJidFromJid(e.getAttribute("from"))===n));r.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+r.length}),r.forEach((async e=>{const t={stanza:e,attrs:await al(e,this),chatbox:this};yu.trigger("message",t)})))},async handleMessageStanza(e){const t=e.getAttribute("type");if("error"===t)return this.handleErrorMessageStanza(e);if("groupchat"===t){if(Vu(e))return k.warn('Received a MAM message with type "groupchat"');this.createInfoMessages(e),this.fetchFeaturesIfConfigurationChanged(e)}else if(!t)return this.handleForwardedMentions(e);let n;try{n=await al(e,this)}catch(e){return k.error(e.message)}const r={stanza:e,attrs:n,chatbox:this};return yu.trigger("message",r),n&&this.queueMessage(n)},registerHandlers(){const e=this.get("jid"),t=ae.getDomainFromJid(e);this.removeHandlers(),this.presence_handler=ma.connection.addHandler((e=>this.onPresence(e)||!0),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=ma.connection.addHandler((e=>this.onPresenceFromMUCHost(e)||!0),null,"presence",null,null,t),this.message_handler=ma.connection.addHandler((e=>!!this.handleMessageStanza(e)||!0),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=ma.connection.addHandler((e=>this.handleMessageFromMUCHost(e)||!0),null,"message",null,null,t),this.affiliation_message_handler=ma.connection.addHandler((e=>this.handleAffiliationChangedMessage(e)||!0),ae.NS.MUC_USER,"message",null,null,e)},removeHandlers(){return this.message_handler&&(ma.connection&&ma.connection.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(ma.connection&&ma.connection.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(ma.connection&&ma.connection.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(ma.connection&&ma.connection.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(ma.connection&&ma.connection.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this},invitesAllowed(){return yu.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())},getDisplayName(){return this.get("name")||("hidden"===yu.settings.get("locked_muc_domain")?ae.getNodeFromJid(this.get("jid")):this.get("jid"))},sendTimedMessage(e){"function"==typeof e.tree&&(e=e.tree());let t=e.getAttribute("id");t||(t=this.getUniqueId("sendIQ"),e.setAttribute("id",t));const n=Ni(),r=ma.connection.addTimedHandler(ma.STANZA_TIMEOUT,(()=>{ma.connection.deleteHandler(i);const e=new ma.TimeoutError("Timeout Error: No response from server");return n.resolve(e),!1})),i=ma.connection.addHandler((e=>{r&&ma.connection.deleteTimedHandler(r),n.resolve(e)}),null,"message",["error","groupchat"],t);return yu.send(e),n},async retractOwnMessage(e){const t=ma.__,n=e.get("origin_id");if(!n)throw new Error("Can't retract message without a XEP-0359 Origin ID");const r=e.get("editable"),i=ie({id:Zd.getUniqueId(),to:this.get("jid"),type:"groupchat"}).c("store",{xmlns:ae.NS.HINTS}).up().c("apply-to",{id:n,xmlns:ae.NS.FASTEN}).c("retract",{xmlns:ae.NS.RETRACT});e.set({retracted:(new Date).toISOString(),retracted_id:n,retraction_id:i.nodeTree.getAttribute("id"),editable:!1});const s=await this.sendTimedMessage(i);Zd.isErrorStanza(s)?k.error(s):s instanceof ma.TimeoutError&&(k.error(s),e.save({editable:r,error_type:"timeout",error:t("A timeout happened while while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))},async retractOtherMessage(e,t){const n=e.get("editable");e.save({moderated:"retracted",moderated_by:ma.bare_jid,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const r=await this.sendRetractionIQ(e,t);return(null===r||Zd.isErrorStanza(r))&&e.save({editable:n,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),r},sendRetractionIQ(e,t){const n=se({to:this.get("jid"),type:"set"}).c("apply-to",{id:e.get(`stanza_id ${this.get("jid")}`),xmlns:ae.NS.FASTEN}).c("moderate",{xmlns:ae.NS.MODERATE}).c("retract",{xmlns:ae.NS.RETRACT}).up().c("reason").t(t||"");return yu.sendIQ(n,null,!1)},sendDestroyIQ(e,t){const n=re("destroy");t&&n.attrs({jid:t});const r=se({to:this.get("jid"),type:"set"}).c("query",{xmlns:ae.NS.MUC_OWNER}).cnode(n.node);return e&&e.length>0&&r.c("reason",e),yu.sendIQ(r)},async leave(e){var t;yu.connection.connected()&&yu.user.presence.send("unavailable",this.getRoomJIDAndNick(),e),this.features&&await new Promise((e=>this.features.destroy({success:e,error:(t,n)=>{k.error(n),e()}})));const n=null===(t=ma.disco_entities)||void 0===t?void 0:t.get(this.get("jid"));n&&await new Promise((e=>n.destroy({success:e,error:(t,n)=>{k.error(n),e()}}))),Zd.safeSave(this.session,{connection_status:Su.ROOMSTATUS.DISCONNECTED})},async close(e){return Zd.safeSave(this.session,{connection_status:Su.ROOMSTATUS.CLOSING}),this.sendMarkerForLastMessage("received",!0),await this.unregisterNickname(),await this.leave(),this.occupants.clearStore(),"closeAllChatBoxes"!==(null==e?void 0:e.name)&&yu.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),await new Promise((e=>this.session.destroy({success:e,error:(t,n)=>{k.error(n),e()}}))),ma.ChatBox.prototype.close.call(this)},canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&yu.disco.supports(ae.NS.MODERATE,this.get("jid"))},getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))},getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>Kd.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")},getOccupantByJID(e){return this.occupants.findOccupant({jid:e})},getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})},parseTextForReferences(e){if(!e||!/(\p{P}|\p{Z}|^)([@][\w_-]+(?:\.\w+)*)/giu.test(e))return[e,[]];const t=Kd.findFirstMatchInArray(this.getAllKnownNicknames()),n=e=>{const t=this.get("jid"),n=this.getOccupant(e)||this.getOccupant(t),r=this.features.get("nonanonymous")&&(null==n?void 0:n.get("jid"))||`${t}/${e}`;return encodeURI(`xmpp:${r}`)},r=this.getAllKnownNicknamesRegex(),i=[...e.matchAll(r)].filter((e=>!e[0].startsWith("/"))).map((e=>{let r=e[0].indexOf("@");"@"===e[0][r+1]&&(r+=1);const i=e.index+r,s=i+e[0].length-r,o=t(e[1]);return{begin:i,end:s,value:o,type:"mention",uri:n(o)}})),[s,o]=Kd.reduceTextFromReferences(e,i);return[s,o]},getOutgoingMessageAttributes(e){const t=this.get("composing_spoiler");let n,r="";null!=e&&e.body&&([r,n]=this.parseTextForReferences(e.body));const i=Zd.getUniqueId(),s=r?Zd.httpToGeoUri(Zd.shortnamesToUnicode(r),ma):void 0;return Object.assign({},e,{body:s,is_spoiler:t,origin_id:i,references:n,id:i,msgid:i,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),is_only_emojis:!!r&&Zd.isOnlyEmojis(r),message:s,nick:this.get("nick"),sender:"me",type:"groupchat"},Fu(r))},getRoomJIDAndNick(){const e=this.get("nick");return ae.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")},sendChatState(){if(!yu.settings.get("send_chat_state_notifications")||!this.get("chat_state")||this.session.get("connection_status")!==Su.ROOMSTATUS.ENTERED||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=yu.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==ma.GONE&&yu.send(ie({to:this.get("jid"),type:"groupchat"}).c(t,{xmlns:ae.NS.CHATSTATES}).up().c("no-store",{xmlns:ae.NS.HINTS}).up().c("no-permanent-store",{xmlns:ae.NS.HINTS}))},directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const n={xmlns:"jabber:x:conference",jid:this.get("jid")};null!==t&&(n.reason=t),this.get("password")&&(n.password=this.get("password"));const r=ie({from:ma.connection.jid,to:e,id:Zd.getUniqueId()}).c("x",n);yu.send(r),yu.trigger("roomInviteSent",{room:this,recipient:e,reason:t})},refreshDiscoInfo(){return yu.disco.refresh(this.get("jid")).then((()=>this.getDiscoInfo())).catch((e=>k.error(e)))},getDiscoInfo(){return yu.disco.getIdentity("conference","text",this.get("jid")).then((e=>this.save({name:null==e?void 0:e.get("name")}))).then((()=>this.getDiscoInfoFields())).then((()=>this.getDiscoInfoFeatures())).catch((e=>k.error(e)))},async getDiscoInfoFields(){const e=(await yu.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const n=t.get("var");return n&&n.startsWith("muc#roominfo_")&&(e[n.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e)},async getDiscoInfoFeatures(){const e=await yu.disco.getFeatures(this.get("jid")),t=Object.assign(el(Su.ROOM_FEATURES,Su.ROOM_FEATURES.map((()=>!1))),{fetched:(new Date).toISOString()});e.each((e=>{const n=e.get("var");n.startsWith("muc_")?t[n.replace("muc_","")]=!0:n===ae.NS.MAM?t.mam_enabled=!0:t[n]=!0})),this.features.save(t)},addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const n=e.getAttribute("var").replace("muc#roomconfig_",""),r=this.get("roomconfig");if(n in r){let i;switch(t){case"boolean":i=[r[n]?1:0];break;case"list-multi":i=r[n];break;default:i=[r[n]]}e.innerHTML=i.map((e=>re("value").t(e))).join("")}return e},async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=Oo()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)},fetchRoomConfiguration(){return yu.sendIQ(se({to:this.get("jid"),type:"get"}).c("query",{xmlns:ae.NS.MUC_OWNER}))},sendConfiguration(e=[]){const t=se({to:this.get("jid"),type:"set"}).c("query",{xmlns:ae.NS.MUC_OWNER}).c("x",{xmlns:ae.NS.XFORM,type:"submit"});return e.forEach((e=>t.cnode(e).up())),yu.sendIQ(t)},onCommandError(e){const{__:t}=ma;k.fatal(e);const n=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:n,type:"error"})},getNickOrJIDFromCommandArgs(e){const{__:t}=ma;if(Zd.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const[n,r]=this.parseTextForReferences(e);if(!r.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(r.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const i=r.pop().value,s=e.split(i,2)[1];if(!s||s.startsWith(" "))return i;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}},validateRoleOrAffiliationChangeArgs(e,t){const{__:n}=ma;if(!t){const t=n('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0},getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=this.occupants.findWhere({jid:ma.bare_jid});return this.verifyAffiliations(["owner"],t,!1)?e=e.concat(pl).concat(gl):this.verifyAffiliations(["admin"],t,!1)&&(e=e.concat(gl)),this.verifyRoles(["moderator"],t,!1)?e=e.concat(ml).concat(vl):this.verifyRoles(["visitor","participant","moderator"],t,!1)||(e=e.concat(vl)),e.sort(),Array.isArray(yu.settings.get("muc_disable_slash_commands"))?e.filter((e=>!yu.settings.get("muc_disable_slash_commands").includes(e))):e},verifyAffiliations(e,t,n=!0){const{__:r}=ma;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:ma.bare_jid})){const n=t.get("affiliation");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1},verifyRoles(e,t,n=!0){const{__:r}=ma;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:ma.bare_jid})){const n=t.get("role");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error"})}return!1},getOwnRole(){var e,t;return null===(e=this.getOwnOccupant())||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.role},getOwnAffiliation(){var e,t;return(null===(e=this.getOwnOccupant())||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.affiliation)||"none"},getOwnOccupant(){return this.occupants.getOwnOccupant()},async setNickname(e){if(yu.settings.get("auto_register_muc_nickname")&&await yu.disco.supports(ae.NS.MUC_REGISTER,this.get("jid"))){const t=this.get("nick");this.set({nick:e});try{await this.registerNickname()}catch(e){const{__:n}=ma;k.error(e);const r=n("Error: couldn't register new nickname in members only room");return this.createMessage({message:r,type:"error"}),void this.set({nick:t})}}const t=ae.getBareJidFromJid(this.get("jid"));yu.send(oe({from:ma.connection.jid,to:`${t}/${e}`,id:Zd.getUniqueId()}).tree())},setRole(e,t,n,r,i){const s=re("item",{nick:e.get("nick"),role:t}),o=se({to:this.get("jid"),type:"set"}).c("query",{xmlns:ae.NS.MUC_ADMIN}).cnode(s.node);return null!==n&&o.c("reason",n),yu.sendIQ(o).then(r).catch(i)},getOccupant(e){return Zd.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)},getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))},getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))},getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,n)=>t.get(e)<n.get(e)?-1:t.get(e)>n.get(e)?1:0))},async updateMemberLists(e){const t=this.get("jid"),n=(await Promise.all(["member","admin","owner"].map((e=>ll(e,t))))).reduce(((e,t)=>Zd.isErrorObject(t)?e:[...t,...e]),[]);await hl(t,fl(!0,!1,e,n)),await this.occupants.fetchMembers()},async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||ma.getDefaultMUCNickname())&&this.save({nick:e},{silent:!0}),e},async getReservedNick(){const e=se({to:this.get("jid"),from:ma.connection.jid,type:"get"}).c("query",{xmlns:ae.NS.DISCO_INFO,node:"x-roomuser-item"}),t=await yu.sendIQ(e,null,!1);if(Zd.isErrorObject(t))throw t;const n=null==t?void 0:t.querySelector('query[node="x-roomuser-item"] identity');return n?n.getAttribute("name"):null},async registerNickname(){const{__:e}=ma,t=this.get("nick"),n=this.get("jid");let r,i;try{r=await yu.sendIQ(se({to:n,type:"get"}).c("query",{xmlns:ae.NS.MUC_REGISTER}))}catch(t){return Oo()(`not-allowed[xmlns="${ae.NS.STANZAS}"]`,t).length?i=e("You're not allowed to register yourself in this groupchat."):Oo()(`registration-required[xmlns="${ae.NS.STANZAS}"]`,t).length&&(i=e("You're not allowed to register in this groupchat because it's members-only.")),k.error(t),i}const s=Oo()("field required",r).map((e=>e.parentElement));if(s.length>1&&"muc#register_roomnick"!==s[0].getAttribute("var"))return k.error(`Can't register the user register in the groupchat ${n} due to the required fields`);try{await yu.sendIQ(se({to:n,type:"set"}).c("query",{xmlns:ae.NS.MUC_REGISTER}).c("x",{xmlns:ae.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up().c("field",{var:"muc#register_roomnick"}).c("value").t(t))}catch(t){return Oo()(`service-unavailable[xmlns="${ae.NS.STANZAS}"]`,t).length?i=e("Can't register your nickname in this groupchat, it doesn't support registration."):Oo()(`bad-request[xmlns="${ae.NS.STANZAS}"]`,t).length&&(i=e("Can't register your nickname in this groupchat, invalid data form supplied.")),k.error(i),k.error(t),i}},async unregisterNickname(){if("unregister"===yu.settings.get("auto_register_muc_nickname"))try{await yu.disco.supports(ae.NS.MUC_REGISTER,this.get("jid"))&&await this.sendUnregistrationIQ()}catch(e){k.error(e)}},sendUnregistrationIQ(){const e=se({to:this.get("jid"),type:"set"}).c("query",{xmlns:ae.NS.MUC_REGISTER}).c("remove");return yu.sendIQ(e).catch((e=>k.error(e)))},updateOccupantsOnPresence(e){var t,n;const r=function(e,t){const n=e.getAttribute("from"),r=e.getAttribute("type"),i={from:n,occupant_id:ol(e,t),nick:tl.getResourceFromJid(n),type:r,states:[],hats:[],show:"unavailable"!==r?"online":"offline"};return Array.from(e.children).forEach((e=>{if(e.matches("status"))i.status=e.textContent||null;else if(e.matches("show"))i.show=e.textContent||"online";else if(e.matches("x")&&e.getAttribute("xmlns")===tl.NS.MUC_USER)Array.from(e.children).forEach((e=>{"item"===e.nodeName?(i.affiliation=e.getAttribute("affiliation"),i.role=e.getAttribute("role"),i.jid=e.getAttribute("jid"),i.nick=e.getAttribute("nick")||i.nick):"status"==e.nodeName&&e.getAttribute("code")&&i.states.push(e.getAttribute("code"))}));else if(e.matches("x")&&e.getAttribute("xmlns")===tl.NS.VCARDUPDATE){var t;i.image_hash=null===(t=e.querySelector("photo"))||void 0===t?void 0:t.textContent}else e.matches("hats")&&e.getAttribute("xmlns")===tl.NS.MUC_HATS&&(i.hats=Array.from(e.children).map((e=>e.matches("hat")&&{title:e.getAttribute("title"),uri:e.getAttribute("uri")})))})),i}(e,this);if("error"===r.type||!r.jid&&!r.nick&&!r.occupant_id)return!0;const i=this.occupants.findOccupant(r);if("unavailable"===r.type&&i&&!r.states.includes(Su.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(r.affiliation))return i.set(r),void i.destroy();const s=r.jid||"",o=Object.assign(r,{jid:ae.getBareJidFromJid(s)||(null==i||null===(t=i.attributes)||void 0===t?void 0:t.jid),resource:ae.getResourceFromJid(s)||(null==i||null===(n=i.attributes)||void 0===n?void 0:n.resource)});i?i.save(o):this.occupants.create(o)},fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];Oo()("status",e).filter((e=>t.includes(e.getAttribute("status")))).length&&this.refreshDiscoInfo()},isSameUser(e,t){const n=ae.getBareJidFromJid(e),r=ae.getBareJidFromJid(t),i=ae.getResourceFromJid(e),s=ae.getResourceFromJid(t);return Zd.isSameBareJID(e,t)?n!==this.get("jid")||i===s:(n===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:n}))===(r===this.get("jid")?this.occupants.findOccupant({nick:s}):this.occupants.findOccupant({jid:r}))},async isSubjectHidden(){return(await yu.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))},async toggleSubjectHiddenState(){const e=this.get("jid"),t=await yu.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?yu.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):yu.user.settings.set("mucs_with_hidden_subject",[...t,e])},async handleSubjectChange(e){const t=ma.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const n=e.subject,r=e.nick;if(Zd.safeSave(this,{subject:{author:r,text:e.subject||""}}),!e.is_delayed&&r){const i=t(n?"Topic set by %1$s":"Topic cleared by %1$s",r),s=this.messages.last();(null==s?void 0:s.get("nick"))===e.nick&&"info"===(null==s?void 0:s.get("type"))&&(null==s?void 0:s.get("message"))===i||this.createMessage({message:i,nick:e.nick,type:"info"}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1},setSubject(e=""){yu.send(ie({to:this.get("jid"),from:ma.connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e).tree())},ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))},isOwnMessage(e){let t;return t=A(e)?e.getAttribute("from"):e instanceof ma.Message?e.get("from"):e.from,ae.getResourceFromJid(t)==this.get("nick")},getUpdatedMessageAttributes(e,t){const n=ma.ChatBox.prototype.getUpdatedMessageAttributes.call(this,e,t);if(n.from_muc=t.from_muc,this.isOwnMessage(t)){const r=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(n,No(t,r)),e.get("received")||(n.received=(new Date).toISOString())}return n},async isJoined(){const e=this.get("jid"),t=se({to:`${e}/${this.get("nick")}`,type:"get"}).c("ping",{xmlns:ae.NS.PING});try{await yu.sendIQ(t)}catch(t){return null===t?k.warn(`isJoined: Timeout error while checking whether we're joined to MUC: ${e}`):k.warn(`isJoined: Apparently we're no longer connected to MUC: ${e}`),!1}return!0},async rejoinIfNecessary(){if(!await this.isJoined())return this.rejoin(),!0},async shouldShowErrorMessage(e){if("Decryption"===e.error_type){if("Message key not found. The counter was repeated or the key was not filled."===e.error_message)return!1;if("not-encrypted-for-this-device"===e.error_condition)return!1}else if("not-acceptable"===e.error_condition&&await this.rejoinIfNecessary())return!1;return ma.ChatBox.prototype.shouldShowErrorMessage.call(this,e)},findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),n=e[`stanza_id ${this.get("jid")}`];return n?(t.reverse(),t.find((({attributes:e})=>"retracted"===e.moderated&&e.moderated_id===n&&e.moderated_by))):null}},async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_id","moderation_reason"];if("retracted"===e.moderated){const n={};n[`stanza_id ${this.get("jid")}`]=e.moderated_id;const r=this.messages.findWhere(n);return r?(r.save(No(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const n=this.findDanglingModeration(e);if(n){const r=No(n.attributes,t),i=Object.assign({dangling_moderation:!1},e,r);return delete i.id,n.save(i),!0}}return!1},getNotificationsText(){const{__:e}=ma,t=this.notifications.toJSON(),n=yu.settings.get("muc_show_info_messages").filter((e=>Su.MUC_ROLE_CHANGES_LIST.includes(e))),r=yu.settings.get("muc_show_info_messages").filter((e=>Su.MUC_TRAFFIC_STATES_LIST.includes(e)));return[...Su.CHAT_STATES,...r,...n].reduce(((n,r)=>{const i=t[r];if(null==i||!i.length)return n;const s=i.map((e=>{var t;return(null===(t=this.getOccupant(e))||void 0===t?void 0:t.getDisplayName())||e}));if(1===s.length){if("composing"===r)return`${n}${e("%1$s is typing",s[0])}\n`;if("paused"===r)return`${n}${e("%1$s has stopped typing",s[0])}\n`;if(r===ma.GONE)return`${n}${e("%1$s has gone away",s[0])}\n`;if("entered"===r)return`${n}${e("%1$s has entered the groupchat",s[0])}\n`;if("exited"===r)return`${n}${e("%1$s has left the groupchat",s[0])}\n`;if("op"===r)return`${n}${e("%1$s is now a moderator",s[0])}\n`;if("deop"===r)return`${n}${e("%1$s is no longer a moderator",s[0])}\n`;if("voice"===r)return`${n}${e("%1$s has been given a voice",s[0])}\n`;if("mute"===r)return`${n}${e("%1$s has been muted",s[0])}\n`}else if(s.length>1){let t;if(s.length>3)t=`${Array.from(s).slice(0,2).join(", ")} and others`;else{const n=s.pop();t=e("%1$s and %2$s",s.join(", "),n)}if("composing"===r)return`${n}${e("%1$s are typing",t)}\n`;if("paused"===r)return`${n}${e("%1$s have stopped typing",t)}\n`;if(r===ma.GONE)return`${n}${e("%1$s have gone away",t)}\n`;if("entered"===r)return`${n}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===r)return`${n}${e("%1$s have left the groupchat",t)}\n`;if("op"===r)return`${n}${e("%1$s are now moderators",s[0])}\n`;if("deop"===r)return`${n}${e("%1$s are no longer moderators",s[0])}\n`;if("voice"===r)return`${n}${e("%1$s have been given voices",s[0])}\n`;if("mute"===r)return`${n}${e("%1$s have been muted",s[0])}\n`}return n}),"")},removeNotification(e,t){const n=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const r=Array.from(n[t]||[]);if(r.includes(e)){const n=r.indexOf(e);r.splice(n,1),this.notifications.set(t,Array.from(r))}}))},updateNotifications(e,t){const n=this.notifications.toJSON(),r=n[t]||[];if(r.includes(e))return;const i=(i,s)=>(i[s]=s===t?[...r,e]:(n[s]||[]).filter((t=>t!==e)),i),s=Su.CHAT_STATES.reduce(i,{}),o=Su.MUC_TRAFFIC_STATES_LIST.reduce(i,{}),a=Su.MUC_ROLE_CHANGES_LIST.reduce(i,{});this.notifications.set(Object.assign(s,o,a)),window.setTimeout((()=>this.removeNotification(e,t)),1e4)},handleMetadataFastening(e){if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const n=t.get("ogp_metadata")||[];if(n.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const r=[...n,No(e,_l)];return t.save("ogp_metadata",r),!0}}return!1},handleMEPNotification(e){var t;return!(e.from!==this.get("jid")||!e.activities||(null===(t=e.activities)||void 0===t||t.forEach((t=>{const n=Object.assign(e,t);this.createMessage(n),yu.trigger("message",{attrs:n,chatbox:this})})),!e.activities.length))},getDuplicateMessage(e){var t;return null!==(t=e.activities)&&void 0!==t&&t.length?this.messages.findWhere({type:"mep",msgid:e.msgid}):ma.ChatBox.prototype.getDuplicateMessage.call(this,e)},async onMessage(e){if(e=await e,Zd.isErrorObject(e))return e.stanza&&k.error(e.stanza),k.error(e.message);if("error"===e.type&&!await this.shouldShowErrorMessage(e))return;const t=this.getDuplicateMessage(e);if(t)"groupchat"===t.get("type")&&this.updateMessage(t,e);else if(!(e.is_valid_receipt_request||e.is_marker||this.ignorableCSN(e)))if(this.handleMetadataFastening(e)||this.handleMEPNotification(e)||await this.handleRetraction(e)||await this.handleModeration(e)||await this.handleSubjectChange(e))e.nick&&this.removeNotification(e.nick,["composing","paused"]);else if(this.setEditable(e,e.time),e.chat_state&&this.updateNotifications(e.nick,e.chat_state),Zd.shouldCreateGroupchatMessage(e)){const t=this.handleCorrection(e)||await this.createMessage(e);this.removeNotification(e.nick,["composing","paused"]),this.handleUnreadMessage(t)}},handleModifyError(e){var t;const n=null===(t=e.querySelector("error text"))||void 0===t?void 0:t.textContent;if(n)if(this.session.get("connection_status")===Su.ROOMSTATUS.CONNECTING)this.setDisconnectionState(n);else{const e={type:"error",message:n,is_ephemeral:!0};this.createMessage(e)}},handleDisconnection(e){var t;const n=null!==e.querySelector("status[code='110']"),r=Oo()(`x[xmlns="${ae.NS.MUC_USER}"]`,e).pop();if(!r)return;const i=Object.keys(ma.muc.disconnect_messages),s=Oo()("status",r).map((e=>e.getAttribute("code"))).filter((e=>i.includes(e)));if(!(n&&s.length>0))return;const o=r.querySelector("item"),a=o?null===(t=o.querySelector("reason"))||void 0===t?void 0:t.textContent:void 0,c=o?wa(o.querySelector("actor"),"getAttribute","nick"):void 0,u=ma.muc.disconnect_messages[s[0]],d=s.includes("301")?Su.ROOMSTATUS.BANNED:Su.ROOMSTATUS.DISCONNECTED;this.setDisconnectionState(u,a,c,d)},getActionInfoMessage(e,t,n){const r=ma.__;return"301"===e?n?r("%1$s has been banned by %2$s",t,n):r("%1$s has been banned",t):"303"===e?r("%1$s's nickname has changed",t):"307"===e?n?r("%1$s has been kicked out by %2$s",t,n):r("%1$s has been kicked out",t):"321"===e?r("%1$s has been removed because of an affiliation change",t):"322"===e?r("%1$s has been removed for not being a member",t):void 0},createAffiliationChangeMessage(e){const t=ma.__,n=e._previousAttributes.affiliation;if(!n)return;const r=e.get("affiliation");"admin"===n&&ma.isInfoVisible(Su.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===n&&ma.isInfoVisible(Su.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===n&&ma.isInfoVisible(Su.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===r&&"member"===n&&ma.isInfoVisible(Su.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===r&&ma.isInfoVisible(Su.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===r&&ma.isInfoVisible(Su.AFFILIATION_CHANGES.ADMIN)||"owner"==r&&ma.isInfoVisible(Su.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),r)})},createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const n=e._previousAttributes.role;"moderator"===n&&ma.isInfoVisible(Su.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),Su.MUC_ROLE_CHANGES.DEOP):"visitor"===n&&ma.isInfoVisible(Su.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),Su.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&ma.isInfoVisible(Su.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),Su.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&ma.isInfoVisible(Su.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),Su.MUC_ROLE_CHANGES.OP)},createInfoMessage(e,t,n){const r=ma.__,i={type:"info",is_ephemeral:!0};if(ma.isInfoVisible(e)&&"110"!==e&&("100"!==e||n)){if(e in ma.muc.info_messages)i.message=ma.muc.info_messages[e];else if(!n&&yl.includes(e)){var s,o;const n=ae.getResourceFromJid(t.getAttribute("from")),r=Oo()(`x[xmlns="${ae.NS.MUC_USER}"] item`,t).pop();i.actor=r?null===(s=r.querySelector("actor"))||void 0===s?void 0:s.getAttribute("nick"):void 0,i.reason=r?null===(o=r.querySelector("reason"))||void 0===o?void 0:o.textContent:void 0,i.message=this.getActionInfoMessage(e,n,i.actor)}else if(n&&e in ma.muc.new_nickname_messages){let s;n&&"210"===e?s=ae.getResourceFromJid(t.getAttribute("from")):n&&"303"===e&&(s=Oo()(`x[xmlns="${ae.NS.MUC_USER}"] item`,t).pop().getAttribute("nick")),this.save("nick",s),i.message=r(ma.muc.new_nickname_messages[e],s)}if(i.message){if("201"===e&&this.messages.findWhere(i))return;this.createMessage(i)}}},createInfoMessages(e){const t=Oo()(`x[xmlns="${ae.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code")));t.includes("333")&&t.includes("307")&&t.splice(t.indexOf("307"),1);const n=t.includes("110");t.forEach((t=>this.createInfoMessage(t,e,n)))},setDisconnectionState(e,t,n,r=Su.ROOMSTATUS.DISCONNECTED){this.session.save({connection_status:r,disconnection_actor:n,disconnection_message:e,disconnection_reason:t})},onNicknameClash(e){const t=ma.__;if(yu.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===ma.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),n=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(n)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:Su.ROOMSTATUS.NICKNAME_REQUIRED})},onErrorPresence(e){var t;const n=ma.__,r=e.querySelector("error"),i=r.getAttribute("type"),s=null===(t=Oo()(`text[xmlns="${ae.NS.STANZAS}"]`,r).pop())||void 0===t?void 0:t.textContent;if("modify"===i)this.handleModifyError(e);else if("auth"===i)if(Oo()(`not-authorized[xmlns="${ae.NS.STANZAS}"]`,r).length&&(this.save({password_validation_message:s||n("Password incorrect")}),this.session.save({connection_status:Su.ROOMSTATUS.PASSWORD_REQUIRED})),r.querySelector("registration-required")){const e=n("You are not on the member list of this groupchat.");this.setDisconnectionState(e,s)}else r.querySelector("forbidden")&&this.setDisconnectionState(ma.muc.disconnect_messages[301],s,null,Su.ROOMSTATUS.BANNED);else if("cancel"===i)if(r.querySelector("not-allowed")){const e=n("You are not allowed to create new groupchats.");this.setDisconnectionState(e,s)}else if(r.querySelector("not-acceptable")){const e=n("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,s)}else if(Oo()(`gone[xmlns="${ae.NS.STANZAS}"]`,r).length){var o;const e=null===(o=Oo()(`gone[xmlns="${ae.NS.STANZAS}"]`,r).pop())||void 0===o?void 0:o.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:s}),this.session.save({connection_status:Su.ROOMSTATUS.DESTROYED})}else if(r.querySelector("conflict"))this.onNicknameClash(e);else if(r.querySelector("item-not-found")){const e=n("This groupchat does not (yet) exist.");this.setDisconnectionState(e,s)}else if(r.querySelector("service-unavailable")){const e=n("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,s)}else if(r.querySelector("remote-server-not-found")){const e=n("Remote server not found"),t=s?n('The explanation given is: "%1$s".',s):void 0;this.setDisconnectionState(e,t)}},onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===(null==t?void 0:t.getAttribute("type"))&&null!=t&&t.querySelector("resource-constraint")&&this.session.get("connection_status")===Su.ROOMSTATUS.DISCONNECTED&&this.rejoin()}},onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);this.createInfoMessages(e),e.querySelector("status[code='110']")?(this.onOwnPresence(e),"none"!==this.getOwnRole()&&this.session.get("connection_status")===Su.ROOMSTATUS.CONNECTING&&this.session.save("connection_status",Su.ROOMSTATUS.CONNECTED)):this.updateOccupantsOnPresence(e)},async onOwnPresence(e){await this.occupants.fetched;const t=this.session.get("connection_status");if("unavailable"!==e.getAttribute("type")&&t!==Su.ROOMSTATUS.ENTERED&&t!==Su.ROOMSTATUS.CLOSING?(this.session.save("connection_status",Su.ROOMSTATUS.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e),"unavailable"!==e.getAttribute("type"))if(e.querySelector("status[code='201']"))if(this.get("auto_configure"))this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo()));else{if(!yu.settings.get("muc_instant_rooms"))return void this.session.save({view:Su.MUC.VIEWS.CONFIG});this.sendConfiguration().then((()=>this.refreshDiscoInfo()))}else this.features.get("fetched")||("owner"===this.getOwnAffiliation()&&this.get("auto_configure")?this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):this.getDiscoInfo());else this.handleDisconnection(e)},isUserMentioned(e){const t=this.get("nick");return e.get("references").length?e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t):new RegExp(`\\b${t}\\b`).test(e.get("message"))},incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)},clearUnreadMsgCounter(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&this.sendMarkerForMessage(this.messages.last()),Zd.safeSave(this,{has_activity:!1,num_unread:0,num_unread_general:0})}},Sl=Vo.extend({defaults:{hats:[],show:"offline",states:[]},initialize(e){this.set(Object.assign({id:Zd.getUniqueId()},e)),this.on("change:image_hash",this.onAvatarChanged,this)},onAvatarChanged(){const e=this.get("image_hash"),t=[];this.get("jid")&&t.push(ma.vcards.findWhere({jid:this.get("jid")})),t.push(ma.vcards.findWhere({jid:this.get("from")})),t.filter((e=>e)).forEach((t=>{e&&t.get("image_hash")!==e&&yu.vcard.update(t,!0)}))},getDisplayName(){return this.get("nick")||this.get("jid")},isMember(){return["admin","owner","member"].includes(this.get("affiliation"))},isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")},isSelf(){return this.get("states").includes("110")}}),El={moderator:1,participant:2,visitor:3,none:2},xl=Ka.extend({model:Sl,comparator(e,t){const n=e.get("role")||"none",r=t.get("role")||"none";if(El[n]===El[r]){const n=e.getDisplayName().toLowerCase(),r=t.getDisplayName().toLowerCase();return n<r?-1:n>r?1:0}return El[n]<El[r]?-1:1},getOwnOccupant(){return this.findWhere({jid:ma.bare_jid})},getAutoFetchedAffiliationLists(){const e=yu.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]},async fetchMembers(){var e;if(!["member","admin","owner"].includes(null===(e=this.getOwnOccupant())||void 0===e?void 0:e.get("affiliation")))return;const t=this.getAutoFetchedAffiliationLists();if(0===t.length)return;const n=this.chatroom.get("jid"),r=await Promise.all(t.map((e=>ll(e,n)))),i=r.reduce(((e,t)=>Zd.isErrorObject(t)?e:[...t,...e]),[]),s=t.filter((e=>!Zd.isErrorObject(r[t.indexOf(e)]))),o=i.map((e=>e.jid)).filter((e=>void 0!==e)),a=i.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e));this.filter((e=>s.includes(e.get("affiliation"))&&!a.includes(e.get("nick"))&&!o.includes(e.get("jid")))).forEach((e=>{e.get("jid")!==ma.bare_jid&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),i.forEach((e=>{const t=this.findOccupant(e);t?t.save(e):this.create(e)})),yu.trigger("membersFetched")},findOccupant(e){const t=e.jid&&ae.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||e.occupant_id&&this.findWhere({occupant_id:e.occupant_id})||e.nick&&this.findWhere({nick:e.nick})}}),Al={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],hl(e=Array.isArray(e)?e:[e],t))}},Nl={rooms:{create(e,t={}){if(!(t="string"==typeof t?{nick:t}:t||{}).nick&&yu.settings.get("muc_nickname_from_jid")&&(t.nick=ae.getNodeFromJid(ma.bare_jid)),void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?yu.rooms.get(Zd.getJIDFromURI(e),t,!0):e.map((e=>yu.rooms.get(Zd.getJIDFromURI(e),t,!0)))},async open(e,t={},n=!1){if(await yu.waitUntil("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw k.error(e),new TypeError(e)}if("string"==typeof e){const r=await yu.rooms.get(e,t,!0);return!t.hidden&&(null==r||r.maybeShow(n)),r}{const r=await Promise.all(e.map((e=>yu.rooms.get(e,t,!0))));return r.forEach((e=>!t.hidden&&e.maybeShow(n))),r}},async get(e,t={},n=!1){async function r(e){e=Zd.getJIDFromURI(e);let r=await yu.chatboxes.get(e);return!r&&n?r=await yu.chatboxes.create(e,t,ma.ChatRoom):(r=r&&r.get("type")===ma.CHATROOMS_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}return await yu.waitUntil("chatBoxesFetched"),void 0===e?(await yu.chatboxes.get()).filter((e=>e.get("type")===ma.CHATROOMS_TYPE)):"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}},{Strophe:jl,sizzle:Tl,u:Cl}=Su.env;function Il(){ma.connection.addHandler((e=>(ma.onDirectMUCInvitation(e),!0)),"jabber:x:conference","message")}function Ol(){return ma.chatboxes.filter((e=>e.get("type")===ma.CHATROOMS_TYPE)).forEach((e=>e.session.save({connection_status:Su.ROOMSTATUS.DISCONNECTED})))}async function kl(e){"visible"===e.state&&yu.connection.connected()&&(await yu.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}async function Ml(e){if(!Cl.isValidMUCJID(e))return k.warn(`invalid jid "${e}" provided in url fragment`);await yu.waitUntil("roomsAutoJoined"),yu.settings.get("allow_bookmarks")&&await yu.waitUntil("bookmarksInitialized"),yu.rooms.open(e)}async function Rl(e){const{__:t}=ma,n=Tl('x[xmlns="jabber:x:conference"]',e).pop(),r=jl.getBareJidFromJid(e.getAttribute("from")),i=n.getAttribute("jid"),s=n.getAttribute("reason");let o;if(yu.settings.get("auto_join_on_invite"))o=!0;else{let e=ma.roster.get(r);e=e?e.getDisplayName():r,o=s?confirm(t('%1$s has invited you to join a groupchat: %2$s, and left the following reason: "%3$s"',e,i,s)):confirm(t("%1$s has invited you to join a groupchat: %2$s",e,i))}!0===o&&(await async function(e,t){t.type=ma.CHATROOMS_TYPE,t.id=e;const n=await yu.rooms.get(e,t,!0);return n.maybeShow(!0),n}(i,{password:n.getAttribute("password")})).session.get("connection_status")===Su.ROOMSTATUS.DISCONNECTED&&ma.chatboxes.get(i).rejoin()}function Dl(){if(!ma.xmppstatus)throw new Error("Can't call _converse.getDefaultMUCNickname before the statusInitialized has been fired.");return ma.xmppstatus.getNickname()||(yu.settings.get("muc_nickname_from_jid")?jl.unescapeNode(jl.getNodeFromJid(ma.bare_jid)):void 0)}function Fl(e){return!!yu.settings.get("muc_show_info_messages").includes(e)}async function Ll(){await Promise.all(yu.settings.get("auto_join_rooms").map((e=>"string"==typeof e?ma.chatboxes.where({jid:e}).length?Promise.resolve():yu.rooms.open(e):pe(e)?yu.rooms.open(e.jid,{...e}):(k.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),yu.trigger("roomsAutoJoined")}function Pl(){yu.settings.get("allow_muc")&&yu.disco.own.features.add(jl.NS.MUC),yu.settings.get("allow_muc_invitations")&&yu.disco.own.features.add("jabber:x:conference")}function Ul(){ma.chatboxes.where({type:ma.CHATROOMS_TYPE}).forEach((e=>ra(e.session,{connection_status:Su.ROOMSTATUS.DISCONNECTED})))}function $l(){window.addEventListener(ma.unloadevent,(()=>{!yu.connection.isType("websocket")||yu.settings.get("enable_smacks")&&ma.session.get("smacks_stream_id")||Ol()}))}function zl(){ma.connection.addHandler((e=>{const t=jl.getBareJidFromJid(e.getAttribute("from"));return ma.chatboxes.get(t)||yu.waitUntil("chatBoxesFetched").then((async()=>{const n=ma.chatboxes.get(t);n&&(await n.initialized,n.message_handler.run(e))})),!0}),null,"message","groupchat")}Object.assign(ma,{getAssignableRoles:function(e){let t=yu.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?Bl:[]),"moderator"===e.get("role")?Bl.filter((e=>!t.includes(e))):[]}});const Bl=["moderator","participant","visitor"],Hl=["owner","admin","member","outcast","none"];Su.AFFILIATION_CHANGES={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},Su.AFFILIATION_CHANGES_LIST=Object.values(Su.AFFILIATION_CHANGES),Su.MUC_TRAFFIC_STATES={ENTERED:"entered",EXITED:"exited"},Su.MUC_TRAFFIC_STATES_LIST=Object.values(Su.MUC_TRAFFIC_STATES),Su.MUC_ROLE_CHANGES={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},Su.MUC_ROLE_CHANGES_LIST=Object.values(Su.MUC_ROLE_CHANGES),Su.MUC={},Su.MUC.INFO_CODES={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...Su.AFFILIATION_CHANGES_LIST],join_leave_events:[...Su.MUC_TRAFFIC_STATES_LIST],role_changes:[...Su.MUC_ROLE_CHANGES_LIST]};const{Strophe:ql}=Su.env;ql.addNamespace("MUC_ADMIN",ql.NS.MUC+"#admin"),ql.addNamespace("MUC_OWNER",ql.NS.MUC+"#owner"),ql.addNamespace("MUC_REGISTER","jabber:iq:register"),ql.addNamespace("MUC_ROOMCONF",ql.NS.MUC+"#roomconfig"),ql.addNamespace("MUC_USER",ql.NS.MUC+"#user"),ql.addNamespace("MUC_HATS","xmpp:prosody.im/protocol/hats:1"),ql.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),Su.MUC_NICK_CHANGED_CODE="303",Su.ROOM_FEATURES=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled"],Su.ROOMSTATUS={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7,CLOSING:8},Su.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e&&e.type==n.CHATROOMS_TYPE?new n.ChatRoom(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){const{__:e,___:t}=ma;if(yu.settings.extend({allow_muc:!0,allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[...Su.MUC.INFO_CODES.visibility_changes,...Su.MUC.INFO_CODES.self,...Su.MUC.INFO_CODES.non_privacy_changes,...Su.MUC.INFO_CODES.muc_logging_changes,...Su.MUC.INFO_CODES.nickname_changes,...Su.MUC.INFO_CODES.disconnected,...Su.MUC.INFO_CODES.affiliation_changes,...Su.MUC.INFO_CODES.join_leave_events,...Su.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_subscribe_to_rai:!1}),yu.promises.add(["roomsAutoJoined"]),yu.settings.get("locked_muc_domain")&&"string"!=typeof yu.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");Su.env.muc_utils={computeAffiliationsDelta:fl},Object.assign(yu,Nl),Object.assign(yu.rooms,Al),ma.muc={info_messages:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created")},new_nickname_messages:{210:t("Your nickname has been automatically set to %1$s"),303:t("Your nickname has been changed to %1$s")},disconnect_messages:{301:e("You have been banned from this groupchat"),333:e("You have exited this groupchat due to a technical problem"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because the groupchat has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down")}},ma.router.route("converse/room?jid=:jid",Ml),ma.ChatRoom=ma.ChatBox.extend(wl),ma.ChatRoomMessage=ma.Message.extend(Qd),ma.ChatRoomOccupants=xl,ma.ChatRoomOccupant=Sl,ma.ChatRoomMessages=Ka.extend({model:ma.ChatRoomMessage,comparator:"time"}),Object.assign(ma,{getDefaultMUCNickname:Dl,isInfoVisible:Fl,onDirectMUCInvitation:Rl}),yu.settings.get("allow_muc_invitations")&&(yu.listen.on("connected",Il),yu.listen.on("reconnected",Il)),yu.listen.on("addClientFeatures",(()=>yu.disco.own.features.add(`${ql.NS.CONFINFO}+notify`))),yu.listen.on("addClientFeatures",Pl),yu.listen.on("beforeResourceBinding",zl),yu.listen.on("beforeTearDown",Ul),yu.listen.on("chatBoxesFetched",Ll),yu.listen.on("disconnected",Ol),yu.listen.on("statusInitialized",$l),yu.listen.on("windowStateChanged",kl)}});const{Strophe:Gl}=Su.env,Wl=Vo.extend({idAttribute:"jid",getDisplayName(){return Gl.xmlunescape(this.get("name"))}});var Jl=o(2353),Ql=o.n(Jl);const{dayjs:Vl}=Su.env;function Yl(e,t){return"string"==typeof e&&t.includes(e)}function Xl(e,t){return"string"!=typeof e||"en"!==e&&!t(e)?function(e){let t;if(window.navigator.userLanguage&&(t=Kl(window.navigator.userLanguage,e)),window.navigator.languages&&!t)for(let n=0;n<window.navigator.languages.length&&!t;n++)t=Kl(window.navigator.languages[n],e);return window.navigator.browserLanguage&&!t&&(t=Kl(window.navigator.browserLanguage,e)),window.navigator.language&&!t&&(t=Kl(window.navigator.language,e)),window.navigator.systemLanguage&&!t&&(t=Kl(window.navigator.systemLanguage,e)),t||"en"}(t)||"en":e}function Kl(e,t){if(t(e))return e;var n=e.split("-")[0];return n!==e&&t(n)?n:void 0}let Zl;Object.assign(r,{getLocale:(e,t)=>Xl(e,(e=>Yl(e,t))),translate(e){if(!Zl)return Ql().sprintf.apply(Ql(),arguments);const t=Zl.translate(e);return arguments.length>1?t.fetch.apply(t,[].slice.call(arguments,1)):t.fetch()},async initialize(){if(ma.isTestEnv())ma.locale="en";else try{const e=yu.settings.get("i18n");ma.locale=r.getLocale(e,yu.settings.get("locales")),await async function(e){const{api:t,locale:n}=e,r=n.toLowerCase().replace("_","-");if(!Yl(n,t.settings.get("locales"))||"en"===n)return;const{default:i}=await o(7521)(`./${n}/LC_MESSAGES/converse.po`);await o(9434)(`./${r}.js`),Vl.locale(Xl(r,(e=>Vl.locale(e)))),Zl=new(Ql())(i)}(ma)}catch(e){k.fatal(e.message),ma.locale="en"}},__:(...e)=>r.translate(...e)});const eh=r.__,{Strophe:th,$iq:nh,sizzle:rh}=Su.env,ih={model:Wl,comparator:e=>e.get("name").toLowerCase(),initialize(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>k.fatal(e))))),this.on("remove",this.markRoomAsUnbookmarked,this),this.on("remove",this.sendBookmarkStanza,this);const e=`converse.room-bookmarks${ma.bare_jid}`;this.fetched_flag=e+"fetched",vo(this,e)},openBookmarkedRoom:async e=>(yu.settings.get("muc_respect_autojoin")&&e.get("autojoin")&&(await yu.rooms.create(e.get("jid"),{nick:e.get("nick")})).maybeShow(),e),fetchBookmarks(){const e=Ni();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e},createBookmark(e){this.create(e),this.sendBookmarkStanza().catch((t=>this.onBookmarkError(t,e)))},sendBookmarkStanza(){const e=nh({type:"set",from:ma.connection.jid}).c("pubsub",{xmlns:th.NS.PUBSUB}).c("publish",{node:th.NS.BOOKMARKS}).c("item",{id:"current"}).c("storage",{xmlns:th.NS.BOOKMARKS});return this.forEach((t=>{e.c("conference",{name:t.get("name"),autojoin:t.get("autojoin"),jid:t.get("jid")}).c("nick").t(t.get("nick")).up().up()})),e.up().up().up(),e.c("publish-options").c("x",{xmlns:th.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("http://jabber.org/protocol/pubsub#publish-options").up().up().c("field",{var:"pubsub#persist_items"}).c("value").t("true").up().up().c("field",{var:"pubsub#access_model"}).c("value").t("whitelist"),yu.sendIQ(e)},onBookmarkError(e,t){k.error("Error while trying to add bookmark"),k.error(e),yu.alert("error",eh("Error"),[eh("Sorry, something went wrong while trying to save your bookmark.")]),this.findWhere({jid:t.jid}).destroy()},fetchBookmarksFromServer(e){const t=nh({from:ma.connection.jid,type:"get"}).c("pubsub",{xmlns:th.NS.PUBSUB}).c("items",{node:th.NS.BOOKMARKS});yu.sendIQ(t).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))},markRoomAsBookmarked(e){const t=ma.chatboxes.get(e.get("jid"));void 0!==t&&t.save("bookmarked",!0)},markRoomAsUnbookmarked(e){const t=ma.chatboxes.get(e.get("jid"));void 0!==t&&t.save("bookmarked",!1)},createBookmarksFromStanza(e){const t=th.NS.BOOKMARKS;rh(`items[node="${t}"] item storage[xmlns="${t}"] conference`,e).forEach((e=>{var t;const n=e.getAttribute("jid"),r=this.get(n),i={jid:n,name:e.getAttribute("name")||n,autojoin:"true"===e.getAttribute("autojoin"),nick:(null===(t=e.querySelector("nick"))||void 0===t?void 0:t.textContent)||""};r?r.save(i):this.create(i)}))},onBookmarksReceived(e,t){if(this.createBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,!0),void 0!==e)return e.resolve()},onBookmarksReceivedError(e,t){if(null===t)k.error("Error: timeout while fetching bookmarks"),yu.alert("error",eh("Timeout Error"),[eh("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]);else{if(e)return t.querySelector('error[type="cancel"] item-not-found')?(window.sessionStorage.setItem(this.fetched_flag,!0),e.resolve()):(k.error("Error while fetching bookmarks"),k.error(t),e.reject(new Error("Could not fetch bookmarks")));k.error("Error while fetching bookmarks"),k.error(t)}},getUnopenedBookmarks(){return this.filter((e=>!ma.chatboxes.get(e.get("jid"))))}},{Strophe:sh}=Su.env;const{Strophe:oh,sizzle:ah}=Su.env;function ch(e){return ah(`event[xmlns="${oh.NS.PUBSUB}#event"] items[node="${oh.NS.BOOKMARKS}"]`,e).length&&yu.waitUntil("bookmarksInitialized").then((()=>ma.bookmarks.createBookmarksFromStanza(e))).catch((e=>k.fatal(e))),!0}oh.addNamespace("BOOKMARKS","storage:bookmarks"),Su.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],overrides:{ChatRoom:{getDisplayName(){const{_converse:e}=this.__super__;if(this.get("bookmarked")&&e.bookmarks){const t=e.bookmarks.findWhere({jid:this.get("jid")});if(t)return t.get("name")}return this.__super__.getDisplayName.apply(this,arguments)},getAndPersistNickname(e){return e=e||function(e){if(!ma.bookmarks||!yu.settings.get("allow_bookmarks"))return null;const t=ma.bookmarks.findWhere({jid:e});return t?t.get("nick"):void 0}(this.get("jid")),this.__super__.getAndPersistNickname.call(this,e)}}},initialize(){yu.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),yu.promises.add("bookmarksInitialized"),ma.Bookmark=Wl,ma.Bookmarks=Ka.extend(ih),ma.BookmarksList=Vo.extend({defaults:{"toggle-state":ma.OPENED}}),yu.listen.on("addClientFeatures",(()=>{yu.settings.get("allow_bookmarks")&&yu.disco.own.features.add(oh.NS.BOOKMARKS+"+notify")})),yu.listen.on("clearSession",(()=>{void 0!==ma.bookmarks&&(ma.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(ma.bookmarks.fetched_flag),delete ma.bookmarks)})),yu.listen.on("connected",(async()=>{const{connection:e}=ma;e.addHandler(ch,null,"message","headline",null,ma.bare_jid),await Promise.all([yu.waitUntil("chatBoxesFetched")]),async function(){yu.settings.get("allow_bookmarks")&&await async function(){const e=await yu.disco.getIdentity("pubsub","pep",ma.bare_jid);return yu.settings.get("allow_public_bookmarks")?!!e:yu.disco.supports(sh.NS.PUBSUB+"#publish-options",ma.bare_jid)}()&&(ma.bookmarks=new ma.Bookmarks,await ma.bookmarks.fetchBookmarks(),yu.trigger("bookmarksInitialized"))}()}))}});const{Strophe:uh}=Su.env,dh="converse.bosh-session";Su.plugins.add("converse-bosh",{enabled:()=>!ma.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){yu.settings.extend({bosh_service_url:void 0,prebind_url:null}),ma.startNewPreboundBOSHSession=function(){if(!yu.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=new XMLHttpRequest;e.open("GET",yu.settings.get("prebind_url"),!0),e.setRequestHeader("Accept","application/json, text/javascript"),e.onload=async function(){if(e.status>=200&&e.status<400){const t=JSON.parse(e.responseText),n=await ma.setUserJID(t.jid);ma.connection.attach(n,t.sid,t.rid,ma.connection.onConnectStatusChanged)}else e.onerror()},e.onerror=function(){delete ma.connection,yu.trigger("noResumeableBOSHSession",ma)},e.send()},ma.restoreBOSHSession=async function(){const e=(await async function(){const e=dh;if(ma.bosh_session||(ma.bosh_session=new Vo({id:e}),ma.bosh_session.browserStorage=ma.createStore(e,"session"),await new Promise((e=>ma.bosh_session.fetch({success:e,error:e})))),ma.jid){if(ma.bosh_session.get("jid")!==ma.jid){const e=await ma.setUserJID(ma.jid);ma.bosh_session.clear({silent:!0}),ma.bosh_session.save({jid:e})}}else{const e=ma.bosh_session.get("jid");e&&await ma.setUserJID(e)}return ma.bosh_session}()).get("jid");if(e&&ma.connection._proto instanceof uh.Bosh)try{return ma.connection.restore(e,ma.connection.onConnectStatusChanged),!0}catch(t){return!ma.isTestEnv()&&k.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1},yu.listen.on("clearSession",(()=>{if(void 0===ma.bosh_session){const e=dh;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else ma.bosh_session.destroy(),delete ma.bosh_session})),yu.listen.on("setUserJID",(()=>{void 0!==ma.bosh_session&&ma.bosh_session.save({jid:ma.jid})})),yu.listen.on("addClientFeatures",(()=>yu.disco.own.features.add(uh.NS.BOSH))),Object.assign(yu,{tokens:{get:e=>void 0===ma.connection?null:"rid"===e.toLowerCase()?ma.connection.rid||ma.connection._proto.rid:"sid"===e.toLowerCase()?ma.connection.sid||ma.connection._proto.sid:void 0}})}});const{Strophe:lh,$build:hh}=Su.env;function fh(e,t){return e.sort(((e,n)=>e[t]>n[t]?-1:1))}function ph(){const e=ma.api.disco.own.identities.get(),t=ma.api.disco.own.features.get();e.length>1&&(fh(e,"category"),fh(e,"type"),fh(e,"lang"));let n=e.reduce(((e,t)=>`${e}${t.category}/${t.type}/${(null==t?void 0:t.lang)??""}/${t.name}<`),"");return t.sort(),n=t.reduce(((e,t)=>`${e}${t}<`),n),te.b64_sha1(n)}function gh(){return hh("c",{xmlns:lh.NS.CAPS,hash:"sha-1",node:"https://conversejs.org",ver:ph()}).nodeTree}const{Strophe:mh}=Su.env;function vh(e){var t,n;if(e&&(null===(n=ma.session)||void 0===n||n.set({carbons_enabled:!1})),!yu.settings.get("message_carbons")||null!==(t=ma.session)&&void 0!==t&&t.get("carbons_enabled"))return;const r=new ae.Builder("iq",{from:ma.connection.jid,id:"enablecarbons",type:"set"}).c("enable",{xmlns:ae.NS.CARBONS});ma.connection.addHandler((e=>{e.querySelectorAll("error").length>0?k.warn("An error occurred while trying to enable message carbons."):(ma.session.set({carbons_enabled:!0}),k.debug("Message carbons have been enabled.")),ma.session.save()}),null,"iq",null,"enablecarbons"),ma.connection.send(r)}mh.addNamespace("CAPS","http://jabber.org/protocol/caps"),Su.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){yu.listen.on("constructedPresence",((e,t)=>t.root().cnode(gh()).up()&&t)),yu.listen.on("constructedMUCPresence",((e,t)=>t.root().cnode(gh()).up()&&t))}}),Su.plugins.add("converse-carbons",{initialize(){yu.settings.extend({message_carbons:!0}),yu.listen.on("afterResourceBinding",vh)}});const _h=Ka.extend({comparator:"time_opened",model:(e,t)=>new ma.ChatBox(e,t),onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),yu.trigger("chatBoxesFetched")},onConnected(e){e||(vo(this,`converse.chatboxes-${ma.bare_jid}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)}))}}),{Strophe:yh}=Su.env;async function bh(e,t,n){let r;e=yh.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{r=new n(t,{collection:ma.chatboxes})}catch(e){return k.error(e),null}return await r.initialized,r.isValid()?(ma.chatboxes.add(r),r):(r.destroy(),null)}const wh={create:async(e=[],t={},n)=>(await yu.waitUntil("chatBoxesFetched"),"string"==typeof e?bh(e,t,n):Promise.all(e.map((e=>bh(e,t,n))))),get:async e=>(await yu.waitUntil("chatBoxesFetched"),void 0===e?ma.chatboxes.models:"string"==typeof e?ma.chatboxes.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),ma.chatboxes.models.filter((t=>e.includes(t.get("jid"))))))},{Strophe:Sh}=Su.env;Su.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){yu.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(yu,{chatboxes:wh}),ma.ChatBoxes=_h,yu.listen.on("addClientFeatures",(()=>{yu.disco.own.features.add(Sh.NS.MESSAGE_CORRECT),yu.disco.own.features.add(Sh.NS.HTTPUPLOAD),yu.disco.own.features.add(Sh.NS.OUTOFBAND)})),yu.listen.on("pluginsInitialized",(()=>{ma.chatboxes=new ma.ChatBoxes,yu.trigger("chatBoxesInitialized")})),yu.listen.on("presencesInitialized",(e=>ma.chatboxes.onConnected(e))),yu.listen.on("reconnected",(()=>ma.chatboxes.forEach((e=>e.onReconnection()))))}}),Su.plugins.add("converse-headlines",{dependencies:["converse-chat"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e.type==n.HEADLINES_TYPE?new n.HeadlinesBox(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){function e(){ma.connection.addHandler((e=>async function(e){if(Ju(e)||Qu(e)){const t=e.getAttribute("from");if(await yu.waitUntil("rosterInitialized"),t.includes("@")&&!ma.roster.get(t)&&!yu.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const n=ma.chatboxes.create({id:t,jid:t,type:ma.HEADLINES_TYPE,from:t}),r=await ud(e,ma);await n.createMessage(r),yu.trigger("message",{chatbox:n,stanza:e,attrs:r})}}(e)||!0),null,"message")}ma.HeadlinesBox=ma.ChatBox.extend({defaults(){return{bookmarked:!1,hidden:["mobile","fullscreen"].includes(yu.settings.get("view_mode")),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),type:ma.HEADLINES_TYPE}},async initialize(){this.set({box_id:`box-${this.get("jid")}`}),this.initUI(),this.initMessages(),await this.fetchMessages(),yu.trigger("headlinesBoxInitialized",this)}}),yu.listen.on("connected",e),yu.listen.on("reconnected",e),Object.assign(yu,{headlines:{async get(e,t={},n=!1){async function r(e){let r=await yu.chatboxes.get(e);return!r&&n?r=await yu.chatboxes.create(e,t,ma.HeadlinesBox):(r=r&&r.get("type")===ma.HEADLINES_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}return void 0===e?(await yu.chatboxes.get()).filter((e=>e.get("type")===ma.HEADLINES_TYPE)):"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}})}});const Eh=Su.env.utils;class xh extends Vo{defaults(){return{msgid:Eh.getUniqueId(),is_ephemeral:!1}}}const{Strophe:Ah,$build:Nh}=Su.env;Ah.addNamespace("RSM","http://jabber.org/protocol/rsm");const jh=["after","before","index","max"],Th=e=>Number(e),Ch=e=>e.toString(),Ih={after:Ch,before:Ch,count:Th,first:Ch,index:Th,last:Ch,max:Th},Oh=e=>void 0===e,kh=Object.keys(Ih);class Mh{static getQueryParameters(e={}){return No(e,jh)}static parseXMLResult(e){const t={};for(var n=0;n<kh.length;n++){const r=kh[n],i=e.getElementsByTagName(r)[0];Oh(i)||null===i||(t[r]=Ih[r](Ah.getText(i)),"first"==r&&(t.index=Ih.index(i.getAttribute("index"))))}return t}constructor(e={}){this.query=Mh.getQueryParameters(e),this.result=e.xml?Mh.parseXMLResult(e.xml):{}}toXML(){const e=Nh("set",{xmlns:Ah.NS.RSM});return jh.reduce(((e,t)=>Oh(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}next(e,t){const n=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new Mh(n)}previous(e,t){const n=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new Mh(n)}}ma.RSM_ATTRIBUTES=kh,ma.RSM=Mh;const{Strophe:Rh,$iq:Dh,dayjs:Fh}=Su.env,{NS:Lh}=Rh,Ph=Su.env.utils,Uh={archive:{async query(e){if(!yu.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");const t={type:"set"};if(e&&e.groupchat){if(!e.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');t.to=e.with}const n=t.to||ma.bare_jid;if(!await yu.disco.supports(Lh.MAM,n))return k.warn(`Did not fetch MAM archive for ${n} because it doesn't support ${Lh.MAM}`),{messages:[]};const r=Ph.getUniqueId(),i=Dh(t).c("query",{xmlns:Lh.MAM,queryid:r});if(e){i.c("x",{xmlns:Lh.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Lh.MAM).up().up(),e.with&&!e.groupchat&&i.c("field",{var:"with"}).c("value").t(e.with).up().up(),["start","end"].forEach((t=>{if(e[t]){const n=Fh(e[t]);if(!n.isValid())throw new TypeError(`archive.query: invalid date provided for: ${t}`);i.c("field",{var:t}).c("value").t(n.toISOString()).up().up()}})),i.up();const t=new Mh(e);Object.keys(t.query).length&&i.cnode(t.toXML())}const s=[],o=ma.connection.addHandler((t=>{const n=Oo()(`message > result[xmlns="${Lh.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==r)return!0;const i=t.getAttribute("from")||ma.bare_jid;if(e.groupchat){if(i!==e.with)return k.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(i!==ma.bare_jid)return k.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return s.push(t),!0}),Lh.MAM);let a;const c=await yu.sendIQ(i,yu.settings.get("message_archiving_timeout"),!1);if(null===c){const{__:e}=ma,t=e("Timeout while trying to fetch archived messages.");return k.error(t),a=new ma.TimeoutError(t),{messages:s,error:a}}if(Ph.isErrorStanza(c)){const{__:e}=ma,t=e("An error occurred while querying for archived messages.");return k.error(t),k.error(c),a=new Error(t),{messages:s,error:a}}let u;ma.connection.deleteHandler(o);const d=c&&Oo()(`fin[xmlns="${Lh.MAM}"]`,c).pop(),l="true"===(null==d?void 0:d.getAttribute("complete")),h=Oo()(`set[xmlns="${Lh.RSM}"]`,d).pop();return h&&(u=new Mh({...e,xml:h})),{messages:s,rsm:u,complete:l}}}},{Strophe:$h,$iq:zh}=Su.env,{NS:Bh}=$h,Hh=Su.env.utils;function qh(e){null!=e&&e.querySelectorAll("feature-not-implemented").length?k.warn(`Message Archive Management (XEP-0313) not supported by ${e.getAttribute("from")}`):(k.error(`Error while trying to set archiving preferences for ${e.getAttribute("from")}.`),k.error(e))}function Gh(e,t){const n=Oo()(`prefs[xmlns="${Bh.MAM}"]`,e).pop();if(n.getAttribute("default")!==yu.settings.get("message_archiving")){const e=zh({type:"set"}).c("prefs",{xmlns:Bh.MAM,default:yu.settings.get("message_archiving")});Array.from(n.children).forEach((t=>e.cnode(t).up())),yu.sendIQ(e).then((()=>t.save({preferences:{default:yu.settings.get("message_archiving")}}))).catch(ma.onMAMError)}else t.save({preferences:{default:yu.settings.get("message_archiving")}})}function Wh(e){const t=e.get("preferences")||{};e.get("var")===Bh.MAM&&void 0!==yu.settings.get("message_archiving")&&t.default!==yu.settings.get("message_archiving")&&yu.sendIQ(zh({type:"get"}).c("prefs",{xmlns:Bh.MAM})).then((t=>ma.onMAMPreferences(t,e))).catch(ma.onMAMError)}function Jh(e){yu.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(Yh(e),e.save({prejoin_mam_fetched:!0}))}async function Qh(e,t,n,r,i){await yu.emojis.initialize();const s=e.get("type")===ma.CHATROOMS_TYPE;t.messages=t.messages.map((t=>s?al(t,e):ud(t,ma)));const o={query:n,chatbox:e,messages:t.messages};if(await yu.trigger("MAMResult",o,{synchronous:!0}),t.messages.forEach((t=>e.queueMessage(t))),t.error){const n=t.error.retry_event_id=Hh.getUniqueId();yu.listen.once(n,(()=>Vh(e,r,i))),e.createMessageFromError(t.error)}}async function Vh(e,t={},n=null){if(e.disable_mam)return;const r=e.get("type")===ma.CHATROOMS_TYPE,i=r?e.get("jid"):ma.bare_jid;if(!await yu.disco.supports(Bh.MAM,i))return;const s=yu.settings.get("archived_messages_page_size"),o=Object.assign({groupchat:r,max:s,with:e.get("jid")},t),a=await yu.archive.query(o);if(await Qh(e,a,o,t,n),a.rsm&&!a.complete){if(n)return"forwards"===n?t=a.rsm.next(s,t.before).query:"backwards"===n&&(t=a.rsm.previous(s,t.after).query),Vh(e,t,n);!async function(e,t,n){if(""==t.before&&(0===e.messages.length||!t.start))return;if(t.before&&!t.start)return;if(null==t.before)return;const r=await Promise.all(n.messages),{rsm:i}=n,s=`stanza_id ${e.get("jid")}`,o=r.find((e=>e[s]===i.result.first)),a={template_hook:"getMessageTemplate",time:new Date(new Date(o.time)-1).toISOString(),before:i.result.first,start:t.start};e.messages.add(new xh(a))}(e,t,a)}}function Yh(e){if(e.disable_mam)return;const t=e.getMostRecentMessage();if(t&&!yu.settings.get("clear_messages_on_reconnection"))if(yu.settings.get("mam_request_all_pages")){const n=t.get(`stanza_id ${e.get("jid")}`);Vh(e,n?{after:n}:{start:t.get("time")},"forwards")}else Vh(e,{before:"",start:t.get("time")});else Vh(e,{before:""})}const{Strophe:Xh}=Su.env,{NS:Kh}=Xh;Su.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){yu.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!0,message_archiving:void 0,message_archiving_timeout:2e4}),Object.assign(yu,Uh),Object.assign(ma,{onMAMError:qh,onMAMPreferences:Gh,handleMAMResult:Qh,MAMPlaceholderMessage:xh}),yu.listen.on("addClientFeatures",(()=>yu.disco.own.features.add(Kh.MAM))),yu.listen.on("serviceDiscovered",Wh),yu.listen.on("chatRoomViewInitialized",(e=>{yu.settings.get("muc_show_logs_before_join")&&(Jh(e.model),e.model.features.on("change:mam_enabled",(()=>Jh(e.model))))})),yu.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&Yh(e))),yu.listen.on("chatReconnected",(e=>{e.get("type")===ma.PRIVATE_CHAT_TYPE&&Yh(e)})),yu.listen.on("afterMessagesFetched",(e=>{e.get("type")!==ma.PRIVATE_CHAT_TYPE||ma.connection.restored||Yh(e)}))}});const{Strophe:Zh,$iq:ef}=Su.env;let tf;function nf(e){"visible"===e.state&&yu.connection.connected()&&yu.ping(null,5e3)}function rf(e){tf=new Date;const t=e.getAttribute("from"),n=e.getAttribute("id"),r=ef({type:"result",to:t,id:n});return ma.connection.sendIQ(r),!0}function sf(){void 0!==ma.connection.disco&&yu.disco.own.features.add(Zh.NS.PING),ma.connection.addHandler(rf,Zh.NS.PING,"iq","get"),ma.connection.addHandler((()=>{if(yu.settings.get("ping_interval")>0)return tf=new Date,!0}))}function of(){if(ma.isTestEnv()||!yu.connection.connected())return;const e=yu.settings.get("ping_interval");if(e>0){const t=new Date;tf||(tf=t),(t-tf)/1e3>e&&yu.ping()}}const{Strophe:af,$iq:cf,u:uf}=Su.env,df={async ping(e,t){var n;if(n=new Date,tf=n,e=e||af.getDomainFromJid(ma.bare_jid),ma.connection){const n=cf({type:"get",to:e,id:uf.getUniqueId("ping")}).c("ping",{xmlns:af.NS.PING}),r=await yu.sendIQ(n,t||1e4,!1);return null===r?(k.warn(`Timeout while pinging ${e}`),e===af.getDomainFromJid(ma.bare_jid)&&yu.connection.reconnect()):uf.isErrorStanza(r)&&(k.error(`Error while pinging ${e}`),k.error(r)),!0}return!1}},{Strophe:lf}=Su.env;lf.addNamespace("PING","urn:xmpp:ping"),Su.plugins.add("converse-ping",{initialize(){yu.settings.extend({ping_interval:60}),Object.assign(yu,df),setInterval(of,1e3),yu.listen.on("connected",sf),yu.listen.on("reconnected",sf),yu.listen.on("windowStateChanged",nf)}});const{Strophe:hf,$iq:ff}=Su.env;hf.addNamespace("PUBSUB_ERROR",hf.NS.PUBSUB+"#errors"),Su.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){Object.assign(ma.api,{pubsub:{async publish(e,t,n,r,i=!0){const s=ff({from:ma.bare_jid,type:"set",to:e}).c("pubsub",{xmlns:hf.NS.PUBSUB}).c("publish",{node:t}).cnode(n.tree()).up().up();r&&(e=e||ma.bare_jid,await yu.disco.supports(hf.NS.PUBSUB+"#publish-options",e)?(s.c("publish-options").c("x",{xmlns:hf.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(`${hf.NS.PUBSUB}#publish-options`).up().up(),Object.keys(r).forEach((e=>s.c("field",{var:e}).c("value").t(r[e]).up().up()))):k.warn(`_converse.api.publish: ${e} does not support #publish-options, so we didn't set them even though they were provided.`));try{await yu.sendIQ(s)}catch(e){if(!(e instanceof Element&&i&&e.querySelector(`precondition-not-met[xmlns="${hf.NS.PUBSUB_ERROR}"]`)))throw e;{const e=s.nodeTree;e.querySelector("publish-options").outerHTML="",k.warn(`PubSub: Republishing without publish options. ${e.outerHTML}`),await yu.sendIQ(e)}}}}})}});const pf=function(e){return function(e){return"number"==typeof e||i(e)&&"[object Number]"==m(e)}(e)&&e!=+e},{Strophe:gf,$pres:mf}=Su.env,vf=Vo.extend({defaults:()=>({status:yu.settings.get("default_state")}),initialize(){this.on("change",(e=>{pe(e.changed)&&("status"in e.changed||"status_message"in e.changed)&&yu.user.presence.send(this.get("status"),null,this.get("status_message"))}))},getNickname:()=>yu.settings.get("nickname"),getFullname:()=>"",async constructPresence(e,t=null,n){let r;e="string"==typeof e?e:this.get("status")||yu.settings.get("default_state"),n="string"==typeof n?n:this.get("status_message");const i={to:t};"unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribe"===e||"subscribed"===e?(i.type=e,r=mf(i)):"offline"===e?(i.type="unavailable",r=mf(i)):r="online"===e?mf(i):mf(i).c("show").t(e).up(),n&&r.c("status").t(n).up();const s=yu.settings.get("priority");if(r.c("priority").t(pf(Number(s))?0:s).up(),ma.idle){const e=new Date;e.setSeconds(e.getSeconds()-ma.idle_seconds),r.c("idle",{xmlns:gf.NS.IDLE,since:e.toISOString()})}return r=await yu.hook("constructedPresence",null,r),r}}),_f={presence:{async send(e,t,n,r){await yu.waitUntil("statusInitialized");const i=ma.xmppstatus,s=await i.constructPresence(e,t,n);r&&(Array.isArray(r)||(r=[r]),r.map((e=>(null==e?void 0:e.tree())??e)).forEach((e=>s.cnode(e).up()))),yu.send(s),["away","chat","dnd","online","xa",void 0].includes(e)&&(await yu.rooms.get()).forEach((async t=>{const s=await i.constructPresence(e,t.getRoomJIDAndNick(),n);r&&(Array.isArray(r)||(r=[r]),r.map((e=>(null==e?void 0:e.tree())??e)).forEach((e=>s.cnode(e).up()))),yu.send(s)}))}},status:{get:async()=>(await yu.waitUntil("statusInitialized"),ma.xmppstatus.get("status")),async set(e,t){const n={status:e};if(!Object.keys(ma.STATUS_WEIGHTS).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof t&&(n.status_message=t),await yu.waitUntil("statusInitialized"),ma.xmppstatus.save(n)},message:{get:async()=>(await yu.waitUntil("statusInitialized"),ma.xmppstatus.get("status_message")),async set(e){await yu.waitUntil("statusInitialized"),ma.xmppstatus.save({status_message:e})}}}},{Strophe:yf,$build:bf}=Su.env;function wf(e){yu.trigger("statusInitialized",e)}function Sf(e){if(e=void 0!==ma.xmppstatus&&e)wf(e);else{const t=`converse.xmppstatus-${ma.bare_jid}`;ma.xmppstatus=new ma.XMPPStatus({id:t}),vo(ma.xmppstatus,t,"session"),ma.xmppstatus.fetch({success:()=>wf(e),error:()=>wf(e),silent:!0})}}function Ef(){var e;ma.idle_seconds>0&&(ma.idle_seconds=0),null!==(e=ma.connection)&&void 0!==e&&e.authenticated&&(ma.inactive&&ma.sendCSI(ma.ACTIVE),ma.idle&&(ma.idle=!1,yu.user.presence.send()),!0===ma.auto_changed_status&&(ma.auto_changed_status=!1,ma.xmppstatus.set("status",yu.settings.get("default_state"))))}function xf(){var e;if(null===(e=ma.connection)||void 0===e||!e.authenticated)return;const t=ma.xmppstatus.get("status");ma.idle_seconds++,yu.settings.get("csi_waiting_time")>0&&ma.idle_seconds>yu.settings.get("csi_waiting_time")&&!ma.inactive&&ma.sendCSI(ma.INACTIVE),yu.settings.get("idle_presence_timeout")>0&&ma.idle_seconds>yu.settings.get("idle_presence_timeout")&&!ma.idle&&(ma.idle=!0,yu.user.presence.send()),yu.settings.get("auto_away")>0&&ma.idle_seconds>yu.settings.get("auto_away")&&"away"!==t&&"xa"!==t&&"dnd"!==t?(ma.auto_changed_status=!0,ma.xmppstatus.set("status","away")):yu.settings.get("auto_xa")>0&&ma.idle_seconds>yu.settings.get("auto_xa")&&"xa"!==t&&"dnd"!==t&&(ma.auto_changed_status=!0,ma.xmppstatus.set("status","xa"))}function Af(e){yu.send(bf(e,{xmlns:yf.NS.CSI})),ma.inactive=e===ma.INACTIVE}function Nf(){if(yu.settings.get("auto_away")<1&&yu.settings.get("auto_xa")<1&&yu.settings.get("csi_waiting_time")<1&&yu.settings.get("idle_presence_timeout")<1)return;ma.idle_seconds=0,ma.auto_changed_status=!1;const{unloadevent:e}=ma;window.addEventListener("click",ma.onUserActivity),window.addEventListener("focus",ma.onUserActivity),window.addEventListener("keypress",ma.onUserActivity),window.addEventListener("mousemove",ma.onUserActivity),window.addEventListener(e,ma.onUserActivity,{once:!0,passive:!0}),window.addEventListener(e,(()=>{var e;return null===(e=ma.session)||void 0===e?void 0:e.save("active",!1)})),ma.everySecondTrigger=window.setInterval(ma.onEverySecond,1e3)}Su.plugins.add("converse-status",{initialize(){yu.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,default_state:"online",priority:0}),yu.promises.add(["statusInitialized"]),ma.XMPPStatus=vf,ma.onUserActivity=Ef,ma.onEverySecond=xf,ma.sendCSI=Af,ma.registerIntervalHandler=Nf,Object.assign(ma.api.user,_f),yu.listen.on("presencesInitialized",(e=>{e||ma.registerIntervalHandler()})),yu.listen.on("clearSession",(()=>{ma.shouldClearCache()&&ma.xmppstatus&&(ma.xmppstatus.destroy(),delete ma.xmppstatus,yu.promises.add(["statusInitialized"]))})),yu.listen.on("connected",(()=>Sf(!1))),yu.listen.on("reconnected",(()=>Sf(!0)))}});const{$pres:jf}=Su.env;function Tf(e){var t;const n=null===(t=ma.roster)||void 0===t?void 0:t.findWhere({jid:e.get("jid")});null==n||n.save({num_unread:e.get("num_unread")})}function Cf(){void 0!==ma.presence_ref&&(ma.connection.deleteHandler(ma.presence_ref),delete ma.presence_ref)}async function If(){var e;await(null===(e=ma.presences)||void 0===e?void 0:e.clearStore())}async function Of(){var e;await If(),ma.shouldClearCache()&&(ma.rostergroups&&(await ma.rostergroups.clearStore(),delete ma.rostergroups),ma.roster&&(null===(e=ma.roster.data)||void 0===e||e.destroy(),await ma.roster.clearStore(),delete ma.roster))}async function kf(e){e?yu.trigger("rosterReadyAfterReconnection"):await async function(){await yu.waitUntil("VCardsInitialized"),ma.roster=new ma.RosterContacts;let e=`converse.contacts-${ma.bare_jid}`;vo(ma.roster,e),ma.roster.data=new Vo,e=`converse-roster-model-${ma.bare_jid}`,ma.roster.data.id=e,vo(ma.roster.data,e),ma.roster.data.fetch(),yu.trigger("rosterInitialized")}(),ma.roster.onConnected(),Cf(),ma.presence_ref=ma.connection.addHandler((e=>(ma.roster.presenceHandler(e),!0)),null,"presence",null),async function(e=!1){e&&(ma.send_initial_presence=!0);try{await ma.roster.fetchRosterContacts(),yu.trigger("rosterContactsFetched")}catch(e){k.error(e)}finally{ma.send_initial_presence&&yu.user.presence.send()}}(!ma.connection.restored)}async function Mf(e){if(e)!ma.connection.hasResumed()&&await If();else{ma.presences=new ma.Presences;const e=`converse.presences-${ma.bare_jid}`;vo(ma.presences,e,"session"),ma.presences.fetch()}yu.trigger("presencesInitialized",e)}function Rf(){ma.chatboxes.on("change:num_unread",Tf),ma.chatboxes.on("add",(e=>{e.get("type")===ma.PRIVATE_CHAT_TYPE&&e.setRosterContact(e.get("jid"))}))}function Df(){ma.roster.on("add",(e=>{const t=ma.chatboxes.findWhere({jid:e.get("jid")});null==t||t.setRosterContact(e.get("jid"))}))}function Ff(e,t){const n=jf({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),yu.send(n)}const{Strophe:Lf,$iq:Pf,$pres:Uf}=Su.env,$f=Vo.extend({defaults:{chat_state:void 0,groups:[],image:ma.DEFAULT_IMAGE,image_type:ma.DEFAULT_IMAGE_TYPE,num_unread:0,status:void 0},async initialize(e){this.initialized=Ni(),this.setPresence();const{jid:t}=e,n=Lf.getBareJidFromJid(t).toLowerCase();e.jid=n,this.set(Object.assign({id:n,jid:n,user_id:Lf.getNodeFromJid(t)},e)),this.listenTo(this.presence,"change:show",(()=>yu.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presenceChanged"))),await yu.trigger("rosterContactInitialized",this,{Synchronous:!0}),this.initialized.resolve()},setPresence(){const e=this.get("jid");this.presence=ma.presences.findWhere({jid:e})||ma.presences.create({jid:e})},openChat(){const e=this.attributes;yu.chats.open(e.jid,e,!0)},getFilterCriteria(){const e=this.get("nickname"),t=this.get("jid");let n=this.getDisplayName();return n=n.includes(t)?n:n.concat(`   ${t}`),n=n.includes(e)?n:n.concat(`   ${e}`),n.toLowerCase()},getDisplayName(){return this.get("nickname")?this.get("nickname"):this.get("jid")},getFullname(){return this.get("jid")},subscribe(e){const t=Uf({to:this.get("jid"),type:"subscribe"});e&&""!==e&&t.c("status").t(e).up();const n=ma.xmppstatus.getNickname()||ma.xmppstatus.getFullname();return n&&t.c("nick",{xmlns:Lf.NS.NICK}).t(n).up(),yu.send(t),this.save("ask","subscribe"),this},ackSubscribe(){yu.send(Uf({type:"subscribe",to:this.get("jid")}))},ackUnsubscribe(){yu.send(Uf({type:"unsubscribe",to:this.get("jid")})),this.removeFromRoster(),this.destroy()},unauthorize(e){return Ff(this.get("jid"),e),this},authorize(e){const t=Uf({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),yu.send(t),this},removeFromRoster(){const e=Pf({type:"set"}).c("query",{xmlns:Lf.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return yu.sendIQ(e)}}),{Strophe:zf,$iq:Bf,sizzle:Hf,u:qf}=Su.env,Gf=Ka.extend({model:$f,initialize(){const e=`roster.state-${ma.bare_jid}-${this.get("jid")}`;this.state=new Vo({id:e,collapsed_groups:[]}),vo(this.state,e),this.state.fetch()},onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()},registerRosterHandler(){ma.connection.addHandler((e=>(ma.roster.onRosterPush(e),!0)),zf.NS.ROSTER,"iq","set")},registerRosterXHandler(){let e=0;ma.connection.addHandler((function(t){return window.setTimeout((function(){ma.connection.flush(),ma.roster.subscribeToSuggestedItems.bind(ma.roster)(t)}),e),e+=250*t.querySelectorAll("item").length,!0}),zf.NS.ROSTERX,"message",null)},async fetchRosterContacts(){const e=await new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,n)=>t(n)})}));if(qf.isErrorObject(e)&&(k.error(e),ma.session.save("roster_cached",!1),this.data.save("version",void 0)),!ma.session.get("roster_cached"))return ma.send_initial_presence=!0,ma.roster.fetchFromServer();yu.trigger("cachedRoster",e)},subscribeToSuggestedItems:e=>(Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&ma.roster.addAndSubscribe(e.getAttribute("jid"),ma.xmppstatus.getNickname()||ma.xmppstatus.getFullname())})),!0),isSelf:e=>qf.isSameBareJID(e,ma.connection.jid),async addAndSubscribe(e,t,n,r,i){const s=await this.addContactToRoster(e,t,n,i);s instanceof ma.RosterContact&&s.subscribe(r)},sendContactAddIQ(e,t,n){t=t||null;const r=Bf({type:"set"}).c("query",{xmlns:zf.NS.ROSTER}).c("item",{jid:e,name:t});return n.forEach((e=>r.c("group").t(e).up())),yu.sendIQ(r)},async addContactToRoster(e,t,n,r){await yu.waitUntil("rosterContactsFetched"),n=n||[];try{await this.sendContactAddIQ(e,t,n)}catch(n){return k.error(n),alert(eh("Sorry, there was an error while trying to add %1$s as a contact.",t||e)),n}return this.create(Object.assign({ask:void 0,nickname:t,groups:n,jid:e,requesting:!1,subscription:"none"},r),{sort:!1})},async subscribeBack(e,t){const n=this.get(e);if(n instanceof ma.RosterContact)n.authorize().subscribe();else{var r;const n=(null===(r=Hf(`nick[xmlns="${zf.NS.NICK}"]`,t).pop())||void 0===r?void 0:r.textContent)||null,i=await this.addContactToRoster(e,n,[],{subscription:"from"});i instanceof ma.RosterContact&&i.authorize().subscribe()}},getNumOnlineContacts(){const e=["offline","unavailable"];return(t=this.models.filter((t=>!e.includes(t.presence.get("show")))))&&t.length?function(e,t){for(var n,r=-1,i=e.length;++r<i;){var s=t(e[r]);void 0!==s&&(n=void 0===n?s:n+s)}return n}(t,De):0;var t},onRosterPush(e){const t=e.getAttribute("id"),n=e.getAttribute("from");if(n&&n!==ma.bare_jid)return void k.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);yu.send(Bf({type:"result",id:t,from:ma.connection.jid}));const r=Hf(`query[xmlns="${zf.NS.ROSTER}"]`,e).pop();this.data.save("version",r.getAttribute("ver"));const i=Hf("item",r);if(i.length>1)throw k.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===i.length)return k.warn(e),void k.warn('Received a roster push stanza without an "item" element.');this.updateContact(i.pop()),yu.trigger("rosterPush",e)},rosterVersioningSupported(){return yu.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")&&this.data.get("version")},async fetchFromServer(){const e=Bf({type:"get",id:qf.getUniqueId("roster")}).c("query",{xmlns:zf.NS.ROSTER});this.rosterVersioningSupported()&&e.attrs({ver:this.data.get("version")});const t=await yu.sendIQ(e,null,!1);if("error"!==t.getAttribute("type")){const e=Hf(`query[xmlns="${zf.NS.ROSTER}"]`,t).pop();e&&(Hf("item",e).forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver")))}else if(!qf.isServiceUnavailableError(t))return k.error(t),void k.error("Error while trying to fetch roster from the server");ma.session.save("roster_cached",!0),yu.trigger("roster",t)},updateContact(e){const t=e.getAttribute("jid"),n=this.get(t),r=e.getAttribute("subscription"),i=e.getAttribute("ask"),s=[...new Set(Hf("group",e).map((e=>e.textContent)))];if(n){if("remove"===r)return n.destroy();n.save({subscription:r,ask:i,nickname:e.getAttribute("name"),requesting:null,groups:s})}else{if("none"===r&&null===i||"remove"===r)return;this.create({ask:i,nickname:e.getAttribute("name"),groups:s,jid:t,subscription:r},{sort:!1})}},createRequestingContact(e){var t;const n={jid:zf.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:(null===(t=Hf(`nick[xmlns="${zf.NS.NICK}"]`,e).pop())||void 0===t?void 0:t.textContent)||null};yu.trigger("contactRequest",this.create(n))},handleIncomingSubscription(e){const t=e.getAttribute("from"),n=zf.getBareJidFromJid(t),r=this.get(n);yu.settings.get("allow_contact_requests")||Ff(t,eh("This client does not allow presence subscriptions")),yu.settings.get("auto_subscribe")?r&&"to"===r.get("subscription")?r.authorize():this.subscribeBack(n,e):r?("none"!==r.get("subscription")||"subscribe"===r.get("ask"))&&r.authorize():this.createRequestingContact(e)},handleOwnPresence(e){const t=e.getAttribute("from"),n=zf.getResourceFromJid(t),r=e.getAttribute("type");if(ma.connection.jid!==t&&"unavailable"!==r&&(!0===yu.settings.get("synchronize_availability")||yu.settings.get("synchronize_availability")===n)){var i,s;const t=(null===(i=e.querySelector("show"))||void 0===i?void 0:i.textContent)||"online";ma.xmppstatus.save({status:t},{silent:!0});const n=null===(s=e.querySelector("status"))||void 0===s?void 0:s.textContent;n&&ma.xmppstatus.save({status_message:n})}ma.jid===t&&"unavailable"===r&&yu.user.presence.send()},presenceHandler(e){var t;const n=e.getAttribute("type");if("error"===n)return!0;const r=e.getAttribute("from"),i=zf.getBareJidFromJid(r);if(this.isSelf(i))return this.handleOwnPresence(e);if(Hf(`query[xmlns="${zf.NS.MUC}"]`,e).length)return;const s=null===(t=e.querySelector("status"))||void 0===t?void 0:t.textContent,o=this.get(i);if(o&&s!==o.get("status")&&o.save({status:s}),"subscribed"===n&&o)o.ackSubscribe();else if("unsubscribed"===n&&o)o.ackUnsubscribe();else{if("unsubscribe"===n)return;if("subscribe"===n)this.handleIncomingSubscription(e);else if("unavailable"===n&&o){const e=zf.getResourceFromJid(r);o.presence.removeResource(e)}else o&&o.presence.addResource(e)}}}),{Strophe:Wf}=Su.env,Jf={contacts:{async get(e){await yu.waitUntil("rosterContactsFetched");const t=e=>ma.roster.get(Wf.getBareJidFromJid(e));if(void 0===e)e=ma.roster.pluck("jid");else if("string"==typeof e)return t(e);return e.map(t)},async add(e,t){if(await yu.waitUntil("rosterContactsFetched"),"string"!=typeof e||!e.includes("@"))throw new TypeError("contacts.add: invalid jid");return ma.roster.addAndSubscribe(e,t)}}},{Strophe:Qf,dayjs:Vf,sizzle:Yf}=Su.env,Xf=Vo.extend({idAttribute:"name"}),Kf=Ka.extend({model:Xf}),Zf=Vo.extend({defaults:{show:"offline"},initialize(){this.resources=new Kf;const e=`converse.identities-${this.get("jid")}`;vo(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)},onResourcesChanged(){var e;const t=this.getHighestPriorityResource(),n=(null==t||null===(e=t.attributes)||void 0===e?void 0:e.show)||"offline";this.get("show")!==n&&this.save({show:n})},getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]},addResource(e){var t,n;const r=e.getAttribute("from"),i=Qf.getResourceFromJid(r),s=Yf(`delay[xmlns="${Qf.NS.DELAY}"]`,e).pop(),o=(null===(t=e.querySelector("priority"))||void 0===t?void 0:t.textContent)??0,a=this.resources.get(i),c={name:i,priority:pf(parseInt(o,10))?0:parseInt(o,10),show:(null===(n=e.querySelector("show"))||void 0===n?void 0:n.textContent)??"online",timestamp:s?Vf(s.getAttribute("stamp")).toISOString():(new Date).toISOString()};a?a.save(c):this.resources.create(c)},removeResource(e){const t=this.resources.get(e);t&&t.destroy()}}),ep=Ka.extend({model:Zf});Su.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){yu.settings.extend({allow_contact_requests:!0,auto_subscribe:!1,synchronize_availability:!0}),yu.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized"]),Object.assign(ma.api,Jf),ma.HEADER_CURRENT_CONTACTS=eh("My contacts"),ma.HEADER_PENDING_CONTACTS=eh("Pending contacts"),ma.HEADER_REQUESTING_CONTACTS=eh("Contact requests"),ma.HEADER_UNGROUPED=eh("Ungrouped"),ma.HEADER_UNREAD=eh("New messages"),ma.Presence=Zf,ma.Presences=ep,ma.RosterContact=$f,ma.RosterContacts=Gf,yu.listen.on("beforeTearDown",(()=>Cf())),yu.listen.on("chatBoxesInitialized",Rf),yu.listen.on("clearSession",Of),yu.listen.on("presencesInitialized",kf),yu.listen.on("statusInitialized",Mf),yu.listen.on("streamResumptionFailed",(()=>ma.session.set("roster_cached",!1))),yu.waitUntil("rosterContactsFetched").then(Df)}});const{Strophe:tp}=Su.env,np=Su.env.utils;function rp(){return!(yu.connection.isType("bosh")&&!ma.isTestEnv())&&yu.disco.stream.getFeature("sm",tp.NS.SM)}function ip(e){if(!ma.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),n=ma.session.get("num_stanzas_handled_by_server"),r=t-n;if(r<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${n}`;k.error(e)}const i=ma.session.get("unacked_stanzas");if(r>i.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${r} -Unacknowledged Stanza Count: ${i.length} -New: ${t} - Previous: ${n}`;k.error(e)}return ma.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:i.slice(r)}),!0}function sp(){if(ma.session.get("smacks_enabled")){const e=ma.session.get("num_stanzas_handled"),t=np.toStanza(`<a xmlns="${tp.NS.SM}" h="${e}"/>`);yu.send(t)}return!0}function op(e){if(ma.session.get("smacks_enabled")&&(np.isTagEqual(e,"iq")||np.isTagEqual(e,"presence")||np.isTagEqual(e,"message"))){const e=ma.session.get("num_stanzas_handled");ma.session.save("num_stanzas_handled",e+1)}return!0}function ap(){ma.session.save({smacks_enabled:ma.session.get("smacks_enabled")||!1,num_stanzas_handled:ma.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:ma.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:ma.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:ma.session.get("unacked_stanzas")||[]})}function cp(){var e;null===(e=ma.session)||void 0===e||e.save({smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function up(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),ma.session.save(t),!0}function dp(e){return e.querySelector("item-not-found")?k.warn("Could not resume previous SMACKS session, session id not found. A new session will be established."):(k.error("Failed to enable stream management"),k.error(e.outerHTML)),cp(),yu.trigger("streamResumptionFailed"),!0}async function lp(){if(yu.settings.get("enable_smacks")&&!ma.session.get("smacks_enabled")&&await rp()){const e=Ni();ma.connection._addSysHandler((t=>e.resolve(up(t))),tp.NS.SM,"enabled"),ma.connection._addSysHandler((t=>e.resolve(dp(t))),tp.NS.SM,"failed");const t=yu.connection.isType("websocket")||ma.isTestEnv(),n=np.toStanza(`<enable xmlns="${tp.NS.SM}" resume="${t}"/>`);yu.send(n),ma.connection.flush(),await e}}const hp=[];async function fp(){var e;if(!yu.settings.get("enable_smacks"))return;if(!await rp())return;const t=ma.connection;for(;hp.length;)t.deleteHandler(hp.pop());hp.push(t.addHandler(op)),hp.push(t.addHandler(sp,tp.NS.SM,"r")),hp.push(t.addHandler(ip,tp.NS.SM,"a")),null!==(e=ma.session)&&void 0!==e&&e.get("smacks_stream_id")?await async function(){const e=Ni();ma.connection._addSysHandler((t=>e.resolve(function(e){up(e),ip(e),function(){const e=ma.session.get("unacked_stanzas");ma.session.save("unacked_stanzas",[]),e.forEach((e=>yu.send(e)))}(),ma.connection.do_bind=!1,ma.connection.authenticated=!0,ma.connection.restored=!0,ma.connection._changeConnectStatus(tp.Status.CONNECTED,null)}(t))),tp.NS.SM,"resumed"),ma.connection._addSysHandler((t=>e.resolve(dp(t))),tp.NS.SM,"failed");const t=ma.session.get("smacks_stream_id"),n=ma.session.get("num_stanzas_handled"),r=np.toStanza(`<resume xmlns="${tp.NS.SM}" h="${n}" previd="${t}"/>`);yu.send(r),ma.connection.flush(),await e}():cp()}function pp(e){if(ma.session){if(ma.session.get("smacks_enabled")&&(np.isTagEqual(e,"iq")||np.isTagEqual(e,"presence")||np.isTagEqual(e,"message"))){const t=tp.serialize(e);ma.session.save("unacked_stanzas",(ma.session.get("unacked_stanzas")||[]).concat([t]));const n=yu.settings.get("smacks_max_unacked_stanzas");if(n>0){const e=ma.session.get("num_stanzas_since_last_ack")+1;e%n==0&&yu.send(np.toStanza(`<r xmlns="${tp.NS.SM}"/>`)),ma.session.save({num_stanzas_since_last_ack:e})}}}else k.warn("No _converse.session!")}const{Strophe:gp}=Su.env;gp.addNamespace("SM","urn:xmpp:sm:3"),Su.plugins.add("converse-smacks",{initialize(){yu.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),yu.listen.on("afterResourceBinding",lp),yu.listen.on("beforeResourceBinding",fp),yu.listen.on("send",pp),yu.listen.on("userSessionInitialized",ap)}});const mp=Vo.extend({defaults:{image:ma.DEFAULT_IMAGE,image_type:ma.DEFAULT_IMAGE_TYPE},set(e,t,n){let r;return"object"==typeof e?(r=e,n=t):(r={})[e]=t,"image"in r&&!r.image?(r.image=ma.DEFAULT_IMAGE,r.image_type=ma.DEFAULT_IMAGE_TYPE,Vo.prototype.set.call(this,r,n)):Vo.prototype.set.apply(this,arguments)},getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}}),{Strophe:vp,$iq:_p,u:yp}=Su.env;function bp(e,t,n){const r=_p(t?{type:e,to:t}:{type:e});return n?r.cnode(n):r.c("vCard",{xmlns:vp.NS.VCARD}),r}async function wp(e){let t;if(e instanceof ma.Message){if("error"===e.get("type"))return;t=e.get("from")}else t=e.get("jid");await yu.waitUntil("VCardsInitialized"),e.vcard=ma.vcards.findWhere({jid:t}),e.vcard||(e.vcard=ma.vcards.create({jid:t})),e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")}function Sp(e){var t;const n=null==e||null===(t=e.collection)||void 0===t?void 0:t.chatbox,r=vp.getResourceFromJid(e.get("from"));if(n&&n.get("nick")===r)return ma.xmppstatus.vcard;{const t=e.occupant&&e.occupant.get("jid")||e.get("from");return t?ma.vcards.findWhere({jid:t})||ma.vcards.create({jid:t}):void k.error(`Could not assign VCard for message because no JID found! msgid: ${e.get("msgid")}`)}}async function Ep(e){await yu.waitUntil("VCardsInitialized"),e.vcard=Sp(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add"))}async function xp(){ma.vcards=new ma.VCards;const e=`${ma.bare_jid}-converse.vcards`;vo(ma.vcards,e),await new Promise((e=>{ma.vcards.fetch({success:e,error:e},{silent:!0})}));const t=ma.vcards;if(ma.session){const e=ma.session.get("bare_jid"),n=ma.xmppstatus;n.vcard=t.findWhere({jid:e})||t.create({jid:e}),n.vcard&&(n.vcard.on("change",(()=>n.trigger("vcard:change"))),n.trigger("vcard:add"))}yu.trigger("VCardsInitialized")}async function Ap(e,t){const n=vp.getBareJidFromJid(t)===e.bare_jid?null:t;let r;try{r=await yu.sendIQ(bp("get",n))}catch(r){return{stanza:r,jid:t,vcard_error:(new Date).toISOString()}}return async function(e,t){const n=t.querySelector("vCard");let r={};var i,s,o,a,c,u,d;if(null!==n&&(r={stanza:t,fullname:null===(i=n.querySelector("FN"))||void 0===i?void 0:i.textContent,nickname:null===(s=n.querySelector("NICKNAME"))||void 0===s?void 0:s.textContent,image:null===(o=n.querySelector("PHOTO BINVAL"))||void 0===o?void 0:o.textContent,image_type:null===(a=n.querySelector("PHOTO TYPE"))||void 0===a?void 0:a.textContent,url:null===(c=n.querySelector("URL"))||void 0===c?void 0:c.textContent,role:null===(u=n.querySelector("ROLE"))||void 0===u?void 0:u.textContent,email:null===(d=n.querySelector("EMAIL USERID"))||void 0===d?void 0:d.textContent,vcard_updated:(new Date).toISOString(),vcard_error:void 0}),r.image){const e=yp.base64ToArrayBuffer(r.image),t=await crypto.subtle.digest("SHA-1",e);r.image_hash=yp.arrayBufferToHex(t)}return r}(0,r)}const{dayjs:Np,u:jp}=Su.env,Tp={vcard:{async set(e,t){if(!e)throw Error("No jid provided for the VCard data");const n=document.createElement("div"),r=jp.toStanza(`\n                <vCard xmlns="vcard-temp">\n                    <FN>${t.fn}</FN>\n                    <NICKNAME>${t.nickname}</NICKNAME>\n                    <URL>${t.url}</URL>\n                    <ROLE>${t.role}</ROLE>\n                    <EMAIL><INTERNET/><PREF/><USERID>${t.email}</USERID></EMAIL>\n                    <PHOTO>\n                        <TYPE>${t.image_type}</TYPE>\n                        <BINVAL>${t.image}</BINVAL>\n                    </PHOTO>\n                </vCard>`,n);let i;try{i=await yu.sendIQ(bp("set",e,r))}catch(e){throw e}return await yu.vcard.update(e,!0),i},get(e,t){if("string"==typeof e)return Ap(ma,e);if(!t&&e.get("vcard_updated")&&Np(e.get("vcard_error")).isSame(new Date,"day"))return Promise.resolve({});{const t=e.get("jid");return t||k.error("No JID to get vcard for"),Ap(ma,t)}},async update(e,t){const n=await this.get(e,t);(e="string"==typeof e?ma.vcards.findWhere({jid:e}):e)?(delete n.stanza,e.save(n)):k.error(`Could not find a VCard model for ${e}`)}}},{Strophe:Cp}=Su.env;Su.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],overrides:{XMPPStatus:{getNickname(){const{_converse:e}=this.__super__,t=this.__super__.getNickname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("nickname"):t},getFullname(){const{_converse:e}=this.__super__,t=this.__super__.getFullname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("fullname"):t}},RosterContact:{getDisplayName(){return!this.get("nickname")&&this.vcard?this.vcard.getDisplayName():this.__super__.getDisplayName.apply(this)},getFullname(){return this.vcard?this.vcard.get("fullname"):this.__super__.getFullname.apply(this)}}},initialize(){yu.promises.add("VCardsInitialized"),ma.VCard=mp,ma.VCards=Ka.extend({model:ma.VCard,initialize(){this.on("add",(e=>e.get("jid")&&yu.vcard.update(e)))}}),yu.listen.on("chatRoomInitialized",(e=>{wp(e),e.occupants.forEach(Ep),e.listenTo(e.occupants,"add",Ep)})),yu.listen.on("chatBoxInitialized",(e=>wp(e))),yu.listen.on("chatRoomMessageInitialized",(e=>async function(e){["error","info"].includes(e.get("type"))||(await yu.waitUntil("VCardsInitialized"),e.vcard=Sp(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")))}(e))),yu.listen.on("addClientFeatures",(()=>yu.disco.own.features.add(Cp.NS.VCARD))),yu.listen.on("clearSession",(()=>{ma.shouldClearCache()&&(yu.promises.add("VCardsInitialized"),ma.vcards&&(ma.vcards.clearStore(),delete ma.vcards))})),yu.listen.on("messageInitialized",(e=>wp(e))),yu.listen.on("rosterContactInitialized",(e=>wp(e))),yu.listen.on("statusInitialized",xp),Object.assign(ma.api,Tp)}})})()})();
//# sourceMappingURL=converse-headless.min.js.map